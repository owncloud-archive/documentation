
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installing and Configuring the External Storage: Windows Network Drives App &#8212; ownCloud 10.0.7 Server Administration Manual 10.0.7 documentation</title>
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/responsive.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Configuring S3 and OpenStack Swift Objects as Primary Storage" href="s3_swift_as_primary_object_store_configuration.html" />
    <link rel="prev" title="Configuring SharePoint Integration" href="sharepoint-integration_configuration.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.owncloud.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '4']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

  </head><body>
  

<noscript><p><img src="https://piwik.owncloud.com/piwik.php?idsite=4&rec=1" style="border:0" alt=""></p></noscript>
<div class="header_con">
<div class="container">
<h1 id="site-title"><a href="http://doc.owncloud.com" title="ownCloud" rel="home">ownCloud</a></h1>

<form class="headersearch" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<div class="follow">
<p><a class="visible" href="https://owncloud.com" title="ownCloud">Back to owncloud.com</a>|<span class="visible">Follow us:</span></p>
<a class="twitter" href="https://twitter.com/owncloud" target="_blank">Twitter</a>
<a class="facebook" href="http://www.facebook.com/owncloud" target="_blank">Facebook</a>
<a class="google" href="https://plus.google.com/+OwncloudOfficial" target="_blank">Google</a>
</div>

</div>
</div>

<div id="main">
<div class="container">
  <div class="content">

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="box sidenavi">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>

<li><a href="../../contents.html">Table of Contents</a></li>
									</ul>
                  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new_admin.html">What’s New in ownCloud 10.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Enterprise Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewall/index.html">Firewall Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ransomware-protection/index.html">Ransomware Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_management/index.html">File Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">External Storage</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="enterprise_only_auth.html">Enterprise-Only Authentication Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap_home_connector_configuration.html">LDAP Home Connector</a></li>
<li class="toctree-l3"><a class="reference internal" href="sharepoint-integration_configuration.html">Configuring SharePoint Integration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Installing and Configuring the External Storage: Windows Network Drives App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#windows-network-drive-listener">Windows Network Drive Listener</a></li>
<li class="toctree-l3"><a class="reference internal" href="s3_swift_as_primary_object_store_configuration.html">Configuring S3 and OpenStack Swift Objects as Primary Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="onedrive.html">How to Create and Configure Microsoft OneDrive</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_management/index.html">User Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clients/index.html">Creating Branded ownCloud Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server_branding/index.html">Server Branding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appliance/index.html">The ownCloud X Appliance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="installing-and-configuring-the-external-storage-windows-network-drives-app">
<h1>Installing and Configuring the External Storage: Windows Network Drives App<a class="headerlink" href="#installing-and-configuring-the-external-storage-windows-network-drives-app" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://marketplace.owncloud.com/apps/windows_network_drive">External Storage: Windows Network Drives</a> app creates a control panel in your Admin page for seamlessly integrating Windows and Samba/CIFS shared network drives as external storages.</p>
<p>Any Windows file share and Samba servers on Linux and other Unix-type operating systems use the SMB/CIFS file-sharing protocol.
The files and directories on the SMB/CIFS server will be visible on your Files page just like your other ownCloud files and folders.</p>
<p>They are labeled with a little four-pane Windows-style icon, and the left pane of your Files page includes a Windows Network Drive filter.
Figure 1 shows a new Windows Network Drive share marked with red warnings.</p>
<p>These indicate that ownCloud cannot connect to the share because it requires the user to login, it is not available, or there is an error in the configuration.</p>
<div class="figure" id="id1">
<img alt="Windows Network Drive share on your Files page." src="../../_images/wnd-1.png" />
<p class="caption"><span class="caption-text"><em>Figure 1: Windows Network Drive share on your Files page.</em></span></p>
</div>
<p>Files are synchronized bi-directionally, and you can create, upload, and delete files and folders.
ownCloud server admins can create Windows Network Drive mounts and optionally allow users to set up their own personal Windows Network Drive mounts.</p>
<p>Depending on the authentication method, passwords for each mount are encrypted and stored in the ownCloud database, using a long random secret key stored in <code class="docutils literal notranslate"><span class="pre">config.php</span></code>, which allows ownCloud to access the shares when the users who own the mounts are not logged in.
Or, passwords are not stored and available only for the current session, which adds security.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Install <a class="reference external" href="https://marketplace.owncloud.com/apps/windows_network_drive">the External Storage: Windows Network Drives app</a> from the ownCloud Market App or ownCloud Marketplace.
For it to work, there are a few dependencies to install.</p>
<ul class="simple">
<li>A Samba client. This is included in all Linux distributions. On Debian, Ubuntu, and other Debian derivatives it is called <code class="docutils literal notranslate"><span class="pre">smbclient</span></code>. On SUSE, Red Hat, CentOS, and other Red Hat derivatives it is <code class="docutils literal notranslate"><span class="pre">samba-client</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">php-smbclient</span></code> (version 0.8.0+). It should be included in most Linux distributions. You can use <a class="reference external" href="https://github.com/eduardok/libsmbclient-php">eduardok/libsmbclient-php</a>, if your distribution does not provide it.</li>
<li><code class="docutils literal notranslate"><span class="pre">which</span></code> and <code class="docutils literal notranslate"><span class="pre">stdbuf</span></code>. These should be included in most Linux distributions.</li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Assuming that your ownCloud installation is on Ubuntu, then the following commands will install the required dependencies:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Install core packages
<span class="go">sudo apt-get update -y</span>
<span class="go">sudo apt-get install -y smbclient php-smbclient coreutils</span>
</pre></div>
</div>
<p>Other method using PECL is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Install php-smbclient using PECL
<span class="go">pecl install smbclient</span>

<span class="gp">#</span> Install it from <span class="nb">source</span>
<span class="go">git clone git://github.com/eduardok/libsmbclient-php.git</span>
<span class="go">cd libsmbclient-php ; phpize</span>
<span class="go">./configure</span>
<span class="go">make</span>
<span class="go">sudo make install</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Regardless of the method you use, remember to check if an smbclient.ini file exists in <code class="docutils literal notranslate"><span class="pre">/etc/php/&lt;your</span> <span class="pre">php</span> <span class="pre">version&gt;/mods-available</span></code> and contains the following line:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extension</span><span class="o">=</span><span class="s2">&quot;smbclient.so&quot;</span>
</pre></div>
</div>
</div>
<p>If so, then make it available via by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">phpenmod</span> <span class="o">-</span><span class="n">v</span> <span class="n">ALL</span> <span class="n">smbclient</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-new-share">
<h2>Creating a New Share<a class="headerlink" href="#creating-a-new-share" title="Permalink to this headline">¶</a></h2>
<p>When you create a new WND share you need three things:</p>
<ul class="simple">
<li>The login credentials for the share</li>
<li>The server address, the share name; and</li>
<li>The folder you want to connect to</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Treat all the parameters as being case-sensitive.</strong>
Although some parts of the app might work properly, regardless of case, other parts might have problems if case isn’t respected.</p>
</div>
<ol class="arabic simple">
<li>Enter the ownCloud mount point for your new WND share. This must not be an existing folder.</li>
<li>Then select your authentication method; See  <a class="reference internal" href="enterprise_only_auth.html"><span class="doc">Enterprise-Only Authentication Options</span></a> for complete information on the five available authentication methods.</li>
</ol>
<div class="figure" id="id2">
<img alt="WND mountpoint and auth." src="../../_images/wnd-2.png" />
<p class="caption"><span class="caption-text"><em>Figure 2: WND mountpoint and authorization credentials.</em></span></p>
</div>
<ol class="arabic simple" start="3">
<li>Enter the address of the server that contains the WND share.</li>
<li>The Windows share name.</li>
<li>The root folder of the share. This is the folder name, or the
<code class="docutils literal notranslate"><span class="pre">$user</span></code> variable for user’s home directories. Note that the LDAP
<code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">Username</span> <span class="pre">Attribute</span></code> must be set to the <code class="docutils literal notranslate"><span class="pre">samaccountname</span></code> for either the share or the root to work, and the user’s home directory needs to match the <code class="docutils literal notranslate"><span class="pre">samaccountname</span></code>. (See
<a class="reference internal" href="../../configuration/user/user_auth_ldap.html"><span class="doc">User Authentication with LDAP</span></a>.)</li>
<li>Login credentials.</li>
<li>Select users or groups with access to the share. The default is all users.</li>
<li>Click the gear icon for additional mount options. Note that previews are enabled by default, while sharing is not (see figure 2). Sharing is not available for all authorization methods; see <a class="reference internal" href="enterprise_only_auth.html"><span class="doc">Enterprise-Only Authentication Options</span></a>. For large storages with many files, you may want to disable previews, because this can significantly increase performance.</li>
</ol>
<div class="figure" id="id3">
<img alt="WND server and credentials." src="../../_images/wnd-3.png" />
<p class="caption"><span class="caption-text"><em>Figure 3: WND server, credentials, and additional mount options.</em></span></p>
</div>
<p>Your changes are saved automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you create a new mountpoint using Login credentials, you must log out of ownCloud and then log back in so you can access the share. You only have to do this the first time.</p>
</div>
</div>
<div class="section" id="personal-wnd-mounts">
<h2>Personal WND Mounts<a class="headerlink" href="#personal-wnd-mounts" title="Permalink to this headline">¶</a></h2>
<p>Users create their own WND mounts on their Personal pages.
These are created the same way as Admin-created shares.
Users have four options for login credentials:</p>
<ul class="simple">
<li>Username and password</li>
<li>Log-in credentials, save in session</li>
<li>Log-in credentials, save in database</li>
<li>Global credentials</li>
</ul>
</div>
<div class="section" id="libsmbclient-issues">
<h2>libsmbclient Issues<a class="headerlink" href="#libsmbclient-issues" title="Permalink to this headline">¶</a></h2>
<p>If your Linux distribution ships with <code class="docutils literal notranslate"><span class="pre">libsmbclient</span> <span class="pre">3.x</span></code>, which is included in the Samba client, you may need to set up the HOME variable in Apache to prevent a segmentation fault.
If you have <code class="docutils literal notranslate"><span class="pre">libsmbclient</span> <span class="pre">4.1.6</span></code> and higher it doesn’t seem to be an issue, so you won’t have to change your HOME variable.
To set up the HOME variable on Ubuntu, modify the <code class="docutils literal notranslate"><span class="pre">/etc/apache2/envvars</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unset</span> <span class="n">HOME</span>
<span class="n">export</span> <span class="n">HOME</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span>
</pre></div>
</div>
<p>In Red Hat/CentOS, modify the <code class="docutils literal notranslate"><span class="pre">/etc/sysconfig/httpd</span></code> file and add the following line to set the HOME variable in Apache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HOME</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">httpd</span>
</pre></div>
</div>
<p>By default, CentOS has activated SELinux, and the <code class="docutils literal notranslate"><span class="pre">httpd</span></code> process can not make outgoing network connections.
This will cause problems with the <code class="docutils literal notranslate"><span class="pre">curl</span></code>, <code class="docutils literal notranslate"><span class="pre">ldap</span></code> and <code class="docutils literal notranslate"><span class="pre">samba</span></code> libraries.
You’ll need to get around this to make this work. First, check the status:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">getsebool</span> <span class="o">-</span><span class="n">a</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">httpd</span>
<span class="n">httpd_can_network_connect</span> <span class="o">--&gt;</span> <span class="n">off</span>
</pre></div>
</div>
<p>Then enable support for network connections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setsebool</span> <span class="o">-</span><span class="n">P</span> <span class="n">httpd_can_network_connect</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In openSUSE, modify the <code class="docutils literal notranslate"><span class="pre">/usr/sbin/start_apache2</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HOME</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">apache2</span>
</pre></div>
</div>
<p>Restart Apache, open your ownCloud Admin page and start creating SMB/CIFS mounts.</p>
</div>
</div>
<div class="section" id="windows-network-drive-listener">
<h1>Windows Network Drive Listener<a class="headerlink" href="#windows-network-drive-listener" title="Permalink to this headline">¶</a></h1>
<p>The SMB protocol supports registering for notifications of file changes on remote Windows SMB storage servers.
Notifications are more efficient than polling for changes, as polling requires scanning the whole SMB storage.
ownCloud supports SMB notifications with an <code class="docutils literal notranslate"><span class="pre">occ</span></code> command, <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The notifier only works with remote storage on Windows servers. It
does not work reliably with Linux servers due to technical limitations.</p>
</div>
<p>Your <code class="docutils literal notranslate"><span class="pre">smbclient</span></code> version needs to be 4.x, as older versions do not support notifications.
The ownCloud server needs to know about changes to files on integrated storage so that the changed files will be synced to the ownCloud server, and to desktop sync clients.</p>
<p>Files changed through the ownCloud Web Interface, or sync clients are automatically updated in the ownCloud file cache, but this is not possible when files are changed directly on remote SMB storage mounts.</p>
<p>To create a new SMB notification, start a listener on your ownCloud server with <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code>.
The listener marks changed files, and a background job updates the file metadata.</p>
<p>Windows network drive connections and setup of <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code> often does not always work the first time.
If you encounter issues using it, then try the following troubleshooting steps:</p>
<ol class="arabic simple">
<li>Check the connection with <a class="reference external" href="https://www.samba.org/samba/docs/man/manpages-3/smbclient.1.html">smbclient</a> on the command line of the ownCloud server</li>
</ol>
<p>Take the example of attempting to connect to the share named <cite>MyData</cite> using <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">wnd:listen</span></code>.
Running the following command would work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="n">MyHost</span> <span class="n">MyData</span> <span class="n">svc_owncloud</span> <span class="n">password</span>
</pre></div>
</div>
<p>However, running this command would not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="n">MyHost</span> <span class="n">mydata</span> <span class="n">svc_owncloud</span> <span class="n">password</span>
</pre></div>
</div>
<div class="section" id="setting-up-the-wnd-listener">
<h2>Setting Up the WND Listener<a class="headerlink" href="#setting-up-the-wnd-listener" title="Permalink to this headline">¶</a></h2>
<p>The WND listener for ownCloud 10 includes two different commands that need to be executed:</p>
<ul class="simple">
<li><a class="reference internal" href="#wnd-listen">wnd:listen</a></li>
<li><a class="reference internal" href="#wnd-process-queue">wnd:process-queue</a></li>
</ul>
</div>
<div class="section" id="wnd-listen">
<h2>wnd:listen<a class="headerlink" href="#wnd-listen" title="Permalink to this headline">¶</a></h2>
<p>This command listens and stores notifications in the database coming from one specific host and share.
It is intended to be run as a service.
The command requires the host and share, which the listener will listen to, and the Windows/Samba account that will listen.
The command does not produce any output by default, unless errors happen.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can increase the command’s verbosity by using <code class="docutils literal notranslate"><span class="pre">-vvv</span></code>.
Doing so displays what the listener is doing, including a timestamp and the notifications received.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the exact permissions required for the Windows account are unknown, read-only should be enough.</p>
</div>
<p>The simplest way to start the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> process manually, perhaps for initial testing, is as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The password is an optional parameter and you’ll be asked for it if you didn’t provide it, as in the example above.
In order to start the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> without any user interaction, provide the password as the user’s 4th parameter, as in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For additional options to provide the password, check <a class="reference internal" href="#password-options-label"><span class="std std-ref">Password Options</span></a></p>
<p>Note that in any case there won’t be any processing of the password by default.
This means that spaces or newline chars won’t be removed unless explicitly told.
Use the <code class="docutils literal notranslate"><span class="pre">--password-trim</span></code> option in those cases.</p>
<p>You should be able to run any of those commands, and/or wrap them into a systemd service or any other startup service, so that the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> command is automatically started during boot, if you need it.</p>
</div>
<div class="section" id="wnd-process-queue">
<h2>wnd:process-queue<a class="headerlink" href="#wnd-process-queue" title="Permalink to this headline">¶</a></h2>
<p>This command processes the stored notifications for a given host and share.
This process is intended to be run periodically as a Cron job, or via a similar mechanism.
The command will process the notifications stored by the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> process, showing only errors by default.
If you need more information, increase the verbosity by calling <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span> <span class="pre">-vvv</span></code>.</p>
<p>As a simple example, you can check the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">process</span><span class="o">-</span><span class="n">queue</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You can run that command, even if there are no notifications to be processed.</p>
<p>As said, you can wrap that command in a Cron job so it’s run every 5 minutes for example.</p>
</div>
<div class="section" id="basic-setup-for-one-owncloud-server">
<h2>Basic Setup for One ownCloud Server<a class="headerlink" href="#basic-setup-for-one-owncloud-server" title="Permalink to this headline">¶</a></h2>
<p>First, go to the admin settings and set up the required WND mounts.
Be aware though, that there are some limitations.
These are:</p>
<ul class="simple">
<li>We need access to the Windows account password for the mounts to update the file cache properly. This means that “<em>login credentials, saved in session</em>” won’t work with the listener. “<em>login credentials, saved in DB</em>” should work and could be the best replacement.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">$user</span></code> placeholder in the share, such as <code class="docutils literal notranslate"><span class="pre">//host/$user/path/to/root</span></code>, for providing a share which is accessible per/user won’t work with the listener. This is because the listener won’t scale, as you’ll need to setup one listener per/share. As a result, you’ll end up with too many listeners. An alternative is to provide a common share for the users and use the <code class="docutils literal notranslate"><span class="pre">$user</span></code> placeholder in the root, such as <code class="docutils literal notranslate"><span class="pre">//host/share/$user/folder</span></code>.</li>
</ul>
<p>Second, start the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> process if it’s not already started, ideally running it as a service.
If it isn’t running, no notification are stored.
The listener stores the notifications.
Any change in the mount point configuration, such as adding or removing new mounts, and logins by new users, won’t affect the behavior, so there is no need to restart the listener in those cases.</p>
<p>In case you have several mount point configurations, note that each listener attaches to one host and share.
If there are several mount configurations targeting different shares, you’ll need to spawn one listener for each.
For example, if you have one configuration with <code class="docutils literal notranslate"><span class="pre">10.0.0.2/share1</span></code> and another with <code class="docutils literal notranslate"><span class="pre">10.0.0.2/share2</span></code>, you’ll need to spawn 2 listeners, one for the first configuration and another for the second.</p>
<p>Third, run the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> periodically, usually via <a class="reference internal" href="../../configuration/server/background_jobs_configuration.html#cron-job-label"><span class="std std-ref">a Cron job</span></a>.
The command processes all the stored notifications for a specific host and share.
If you have several, you could set up several Cron jobs, one for each host and share with different intervals, depending on the load or update urgency.
As a simple example, you could run the command every 2 minutes for one server and every 5 minutes for another.</p>
<p>As said, the command processes all the stored notifications, squeeze them and scan the resulting folders.
The process might crash if there are too many notifications, or if it has too many storages to update.
The <code class="docutils literal notranslate"><span class="pre">--chunk-size</span></code> option will help by making the command process all the notifications in buckets of that size.</p>
<p>On the one hand the memory usage is reduced, on the other hand there is more network activity.
We recommend using the option with a value high enough to process a large number of notifications, but not so large to crash the process.
Between 200 and 500 should be fine, and we’ll likely process all the notifications in one go.</p>
</div>
<div class="section" id="password-options">
<span id="password-options-label"></span><h2>Password Options<a class="headerlink" href="#password-options" title="Permalink to this headline">¶</a></h2>
<p>There are several ways to supply a password:</p>
<ol class="arabic">
<li><p class="first">Interactively in response to a password prompt.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Sent as a parameter to the command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Read from a file, using the <code class="docutils literal notranslate"><span class="pre">--password-file</span></code> switch to specify the file to read from. Note that the password must be in plain text inside the file, and neither spaces nor newline characters will be removed from the file by default, unless the <code class="docutils literal notranslate"><span class="pre">--pasword-trim</span></code> option is added. The password file must be readable by the apache user (or www-data)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> \
  <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="n">my</span><span class="o">/</span><span class="n">secret</span><span class="o">/</span><span class="n">password</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">listen</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> \
  <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="n">my</span><span class="o">/</span><span class="n">secret</span><span class="o">/</span><span class="n">password</span><span class="o">/</span><span class="n">file</span> <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">trim</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use the <code class="docutils literal notranslate"><span class="pre">--password-file</span></code> switch, the entire contents of the file will be used for the password, so please be careful with newlines.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If using <code class="docutils literal notranslate"><span class="pre">--password-file</span></code> make sure that the file is only readable by the
apache / www-data user and inaccessible from the web. This prevents tampering or leaking of the information. The password won’t be leaked to any
other user using <code class="docutils literal notranslate"><span class="pre">ps</span></code>.</p>
</div>
</li>
<li><p class="first">Using 3rd party software to store and fetch the password. When using this option, the 3rd party app needs to show the password as plaintext on standard output.</p>
</li>
</ol>
<div class="section" id="rd-party-software-examples">
<h3>3rd Party Software Examples<a class="headerlink" href="#rd-party-software-examples" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat /tmp/plainpass | sudo -u www-data ./occ wnd:listen &lt;host&gt; &lt;share&gt; &lt;username&gt; --password-file=-</span>
</pre></div>
</div>
<p>This provides a bit more security because the <code class="docutils literal notranslate"><span class="pre">/tmp/plainpass</span></code> password should be owned by root and only root should be able to read the file (0400 permissions); Apache, particularly, shouldn’t be able to read it.
It’s expected that root will be the one to run this command.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">base64 -d /tmp/encodedpass | sudo -u www-data ./occ wnd:listen &lt;host&gt; &lt;share&gt; &lt;username&gt; \</span>
<span class="go">  --password-file=-</span>
</pre></div>
</div>
<p>Similar to the previous example, but this time the contents are encoded in <a class="reference external" href="https://www.base64decode.org/">Base64 format</a> (there’s not much security, but it has additional obfuscation).</p>
<p>Third party password managers can also be integrated.
The only requirement is that they have to provide the password in plain text somehow.
If not, additional operations might be required to get the password as plain text and inject it in the listener.</p>
<p>As an example:</p>
<blockquote>
<div>You can use “pass” as a password manager. You can go through <a class="reference external" href="http://xmodulo.com/manage-passwords-command-line-linux.html">http://xmodulo.com/manage-passwords-command-line-linux.html</a> to setup the keyring for whoever will fetch the password (probably root) and then use something like the following</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pass the-password-name | sudo -u www-data ./occ wnd:listen &lt;host&gt; &lt;share&gt; &lt;username&gt; --password-file=-</span>
</pre></div>
</div>
</div>
<div class="section" id="password-option-precedence">
<h3>Password Option Precedence<a class="headerlink" href="#password-option-precedence" title="Permalink to this headline">¶</a></h3>
<p>If both the argument and the option are passed, e.g., <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">wnd:listen</span> <span class="pre">&lt;host&gt;</span> <span class="pre">&lt;share&gt;</span> <span class="pre">&lt;username&gt;</span> <span class="pre">&lt;password&gt;</span> <span class="pre">--password-file=/tmp/pass</span></code>, then the <code class="docutils literal notranslate"><span class="pre">--password-file</span></code> option will take precedence.</p>
</div>
</div>
<div class="section" id="optimizing-wnd-process-queue">
<h2>Optimizing wnd:process-queue<a class="headerlink" href="#optimizing-wnd-process-queue" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not use this option if the process-queue is fast enough.
The option has some drawbacks, specifically regarding password changes in the backend.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> creates all the storages that need to be updated from scratch.
To do so, we need to fetch all the users from all the backends (currently only the ones that have logged in at least once because the others won’t have the storages that we’ll need updates).</p>
<p>To optimize this, <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> make use of two switches: “–serializer-type” and “–serializer-params”.
These serialize storages for later use, so that future executions don’t need to fetch the users, saving precious time — especially for large organizations.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Switch</th>
<th class="head">Allowed Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">--serializer-type</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">file</span></code>.  Other valid values may be added in the future, as more
implementations are requested.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">--serializer-params</span></code></td>
<td>Depends on <code class="docutils literal notranslate"><span class="pre">--serializer-type</span></code>, because those will be the parameters
that the chosen serializer will use. For the <code class="docutils literal notranslate"><span class="pre">file</span></code> serializer, you
need to provide a file location in the host FS where the storages will
be serialized. You can use <code class="docutils literal notranslate"><span class="pre">--serializer-params</span> <span class="pre">file=/tmp/file</span></code> as an
example.</td>
</tr>
</tbody>
</table>
<p>While the specific behavior will depend on the serializer implementation, the overall behavior can be simplified as follows:</p>
<p>If the serializer’s data source (such as <em>a file</em>, <em>a database table</em>, or some <em>Redis keys</em>) has storage data, it uses that data to create the storages; otherwise, it creates the storages from scratch.</p>
<p>After the storages are created, notifications are processed for the storages.
If the storages have been created from scratch, those storages are written in the data source so that they can be read on the next run.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s imperative to periodically clean up the data source to fetch fresh data, such as for new storages and updated passwords. There isn’t a generic command to do this from ownCloud, because it depends on the specific serializer type. Though this option could be provided at some point if requested.</p>
</div>
</div>
<div class="section" id="the-file-serializer">
<h2>The File Serializer<a class="headerlink" href="#the-file-serializer" title="Permalink to this headline">¶</a></h2>
<p>The file serializer is a serializer implementation that can be used with the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> command.
It requires an additional parameter where you can specify the location of the file containing the serialized storages.</p>
<p>There are several things you should know about this serializer:</p>
<ul class="simple">
<li>The generated file contains the encrypted passwords for accessing the backend. This is necessary in order to avoid re-fetching the user information, when next accessing the storages.</li>
<li>The generated file is intended to be readable and writable <strong>only</strong> for the web server user. Other users shouldn’t have access to this file. Do not manually edit the file. You can remove the file if it contains obsolete information.</li>
</ul>
<div class="section" id="usage-recommendations">
<h3>Usage Recommendations<a class="headerlink" href="#usage-recommendations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="number-of-serializers">
<h4>Number of Serializers<a class="headerlink" href="#number-of-serializers" title="Permalink to this headline">¶</a></h4>
<p>Only one file serializer should be used per server and share, as the serialized file has to be per server and share.
Consider the following usage scenario:</p>
<ul class="simple">
<li>If you have three shares: <code class="docutils literal notranslate"><span class="pre">10.0.2.2/share1</span></code>, <code class="docutils literal notranslate"><span class="pre">10.0.2.2/share2</span></code>, and <code class="docutils literal notranslate"><span class="pre">10.0.10.20/share2</span></code>, then you should use three different calls to <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code>, changing the target file for the serializer for each one.</li>
</ul>
<p>Since the serialized file has to be per server and share, the serialized file has some checks to prevent misuse.
Specifically, if we detect you’re trying to read the storages for another server and share from the file, the contents of the file won’t be read and will fallback to creating the storage from scratch.
At this point, we’ll then update the contents of that file with the new storage.</p>
<p>Doing so, though, creates unneeded competition, where several process-queue will compete for the serializer file.
For example, let’s say that you have two process-queues targeting the same serializer file.
After the first process creates the file the second process will notice that the file is no longer available.
As a result, it will recreate the file with new content.</p>
<p>At this point the first process runs again and notices that the file isn’t available and recreate the file again.
When this happens, the serializer file’s purpose isn’t fulfilled
As a result, we recommend the use of a different file per server and share.</p>
</div>
<div class="section" id="file-clean-up">
<h4>File Clean Up<a class="headerlink" href="#file-clean-up" title="Permalink to this headline">¶</a></h4>
<p>The file will need to cleaned up from time to time.
The easiest way to do this is to remove the file when it is no longer needed.
The file will be regenerated with fresh data the next execution if the serializer option is set.</p>
</div>
</div>
</div>
<div class="section" id="interaction-between-listener-serializer-and-windows-password-lockout">
<h2>Interaction Between Listener, Serializer, and Windows Password Lockout<a class="headerlink" href="#interaction-between-listener-serializer-and-windows-password-lockout" title="Permalink to this headline">¶</a></h2>
<p>Windows supports <a class="reference external" href="https://technet.microsoft.com/en-us/library/dd277400.aspx">password lockout policies</a>.
If one is enabled on the server where an ownCloud share is located, and a user fails to enter their password correctly several times, they may be locked out and unable to access the share.</p>
<p>This is <a class="reference external" href="https://github.com/owncloud/Windows_network_drive/issues/94">a known issue</a> that prevents these two inter-operating correctly.
Currently, the only viable solution is to ignore that feature and use the <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> and <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code>, without the serializer options.</p>
<p>There is also an additional issue to take into account though, which is that parallel runs of <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> might lead to a user lockout.
The reason for this is that several <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> might use the same wrong password because it hasn’t been updated by the time they fetch it.</p>
<p>As a result, it’s recommended to force the execution serialization of that command to prevent this issue.
You might want to use <a class="reference external" href="http://www.thegeekstuff.com/2011/05/anacron-examples">Anacron</a>, which seems to have an option for this scenario, or wrap the command with <a class="reference external" href="http://linuxaria.com/howto/linux-shell-introduction-to-flock">flock</a>.</p>
<p>If you need to serialize the execution of the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code>, check the following example with <a class="reference external" href="http://linuxaria.com/howto/linux-shell-introduction-to-flock">flock</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flock</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span><span class="n">my</span><span class="o">/</span><span class="n">lock</span><span class="o">/</span><span class="n">file</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">process</span><span class="o">-</span><span class="n">queue</span> <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">share</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In that case, flock will try get the lock of that file and won’t run the command if it isn’t possible.
For our case, and considering that file isn’t being used by any other process, it will run only one <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> at a time.
If someone tries to run the same command a second time while the previous one is running, the second will fail and won’t be executed.
Check <a class="reference external" href="https://linux.die.net/man/2/flock">flock’s documentation</a> for details and other options.</p>
</div>
<div class="section" id="multiple-server-setup">
<h2>Multiple Server Setup<a class="headerlink" href="#multiple-server-setup" title="Permalink to this headline">¶</a></h2>
<p>Setups with several servers might have some difficulties in some scenarios:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">wnd:listen</span></code> component <em>might</em> be duplicated among several servers. This shouldn’t cause a problem, depending on the limitations of the underlying database engine. The supported database engines should be able to handle concurrent access and de-duplication.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> <em>should</em> also be able to run from any server, however limitations for concurrent executions still apply. As a result, you might need to serialized command execution of the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> among the servers (to avoid for the password lockout), which might not be possible or difficult to achieve. You might want to execute the command from just one specific server in this case.</li>
<li><code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> + serializer. First, check the above section to know the interactions with the password lockout. Right now, the only option you have to set it up is to store the target file in a common location for all the server. We might need to provide a specific serializer for this scenario (based on Redis or DB)</li>
</ul>
</div>
<div class="section" id="basic-command-execution-examples">
<h2>Basic Command Execution Examples<a class="headerlink" href="#basic-command-execution-examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo -u www-data ./occ ``wnd:listen`` host share username password

sudo -u www-data ./occ ``wnd:process-queue`` host share

sudo -u www-data ./occ ``wnd:process-queue`` host share -c 500

sudo -u www-data ./occ ``wnd:process-queue`` host share -c 500 \
    --serializer-type file \
    --serializer-params file=/opt/oc/store

sudo -u www-data ./occ ``wnd:process-queue`` host2 share2 -c 500 \
    --serializer-type File \
    --serializer-params file=/opt/oc/store2
</pre></div>
</div>
<p>To set it up, make sure the listener is running as a system service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo -u www-data ./occ ``wnd:listen`` host share username password
</pre></div>
</div>
<p>Setup a Cron job or similar with something like the following two commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="o">./</span><span class="n">occ</span> <span class="n">wnd</span><span class="p">:</span><span class="n">process</span><span class="o">-</span><span class="n">queue</span> <span class="n">host</span> <span class="n">share</span> <span class="o">-</span><span class="n">c</span> <span class="mi">500</span> \
    <span class="o">--</span><span class="n">serializer</span><span class="o">-</span><span class="nb">type</span> <span class="n">file</span> \
    <span class="o">--</span><span class="n">serializer</span><span class="o">-</span><span class="n">params</span> <span class="n">file</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">oc</span><span class="o">/</span><span class="n">store1</span>

<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oc</span><span class="o">/</span><span class="n">store1</span> <span class="c1"># With a different schedule</span>
</pre></div>
</div>
<p>The first run will create the <code class="docutils literal notranslate"><span class="pre">/opt/oc/store1</span></code> with the serialized storages, the rest of the executions will use that file.
The second Cron job, the one removing the file, will force the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> to refresh the data.</p>
<p>It’s intended to be run in a different schedule, so there are several executions of the <code class="docutils literal notranslate"><span class="pre">wnd:process-queue</span></code> fetching the data from the file.
Note that the file can be removed manually at any time if it’s needed (for example, the admin has reset some passwords, or has been notified about password changing).</p>
</div>
</div>


					</div>
				</div>
			</div>

  </div>
</div>
</div>
<footer class="footer">
  <div class="container">
  <div class="footer_navi">

  <div class="menu-footer-navigation-container">
  	<ul id="menu-footer-navigation" class="menu">
  		<li><a href="https://owncloud.com">Home</a></li>
  		<li><a href="https://owncloud.com/about">About ownCloud</a></li>
  		<li><a href="https://owncloud.com/resources">Resources</a></li>
  		<li><a href="https://owncloud.com/become-partner">Become a Partner</a></li>
  		<li><a href="https://owncloud.org">Community</a></li>
  		<li><a href="https://owncloud.com/blog">Blog</a></li>
  		<li><a href="https://owncloud.com/jobs">Jobs</a></li>
  		<li><a href="https://owncloud.com/contact">Contact</a></li>
  	</ul>
  </div>

  <div class="follow_f">
  	<ul>
  		<li><a class="twitter" href="https://twitter.com/ownloud" target="_blank">Twitter</a></li>
  		<li><a class="facebook" href="http://www.facebook.com/owncloud" target="_blank">Facebook</a></li>
  		<li><a class="google" href="https://plus.google.com/+OwncloudOfficial" target="_blank">Google</a></li>
  	</ul>
  </div>

  <p class="copyright">© ownCloud 2011-2015</p>

  </div>
  </div>
</footer>
  </body>
</html>