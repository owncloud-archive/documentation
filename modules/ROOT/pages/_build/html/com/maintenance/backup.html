
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Backing up ownCloud &#8212; ownCloud 10.0.7 Server Administration Manual 10.0.7 documentation</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/responsive.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Upgrade Your ownCloud Server" href="upgrade.html" />
    <link rel="prev" title="Maintenance Mode Configuration" href="enable_maintenance.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.owncloud.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '4']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

  </head><body>
  

<noscript><p><img src="https://piwik.owncloud.com/piwik.php?idsite=4&rec=1" style="border:0" alt=""></p></noscript>
<div class="header_con">
<div class="container">
<h1 id="site-title"><a href="http://doc.owncloud.com" title="ownCloud" rel="home">ownCloud</a></h1>

<form class="headersearch" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<div class="follow">
<p><a class="visible" href="https://owncloud.com" title="ownCloud">Back to owncloud.com</a>|<span class="visible">Follow us:</span></p>
<a class="twitter" href="https://twitter.com/owncloud" target="_blank">Twitter</a>
<a class="facebook" href="http://www.facebook.com/owncloud" target="_blank">Facebook</a>
<a class="google" href="https://plus.google.com/+OwncloudOfficial" target="_blank">Google</a>
</div>

</div>
</div>

<div id="main">
<div class="container">
  <div class="content">

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="box sidenavi">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>

<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What’s New in ownCloud 10.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Maintenance</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="enable_maintenance.html">Maintenance Mode Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Backing up ownCloud</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#backing-up-the-config-and-data-directories">Backing Up the config/ and data/ Directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backup-database">Backup Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restoring-files-from-backup-when-encryption-is-enabled">Restoring Files From Backup When Encryption Is Enabled</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">How to Upgrade Your ownCloud Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_upgrade.html">Upgrade ownCloud From Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="update.html">Upgrading ownCloud with the Updater App</a></li>
<li class="toctree-l2"><a class="reference internal" href="manual_upgrade.html">Manual ownCloud Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="restore.html">Restoring ownCloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating.html">Migrating to a Different Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="manually-moving-data-folders.html">How To Manually Move a Data Directory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise/index.html">Enterprise Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appliance/index.html">The ownCloud X Appliance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="backing-up-owncloud">
<h1>Backing up ownCloud<a class="headerlink" href="#backing-up-owncloud" title="Permalink to this headline">¶</a></h1>
<p>When you backup your ownCloud server, there are four things that you need to copy:</p>
<ol class="arabic simple">
<li>Your <code class="docutils literal notranslate"><span class="pre">config/</span></code> directory.</li>
<li>Your <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory.</li>
<li>Your ownCloud database.</li>
<li>Your custom theme files, if you have any. (See <a class="reference external" href="https://doc.owncloud.org/server/latest/developer_manual/core/theming.html">Theming ownCloud</a>)</li>
</ol>
<p>When you install your ownCloud server from our <a class="reference external" href="https://download.owncloud.org/download/repositories/stable/owncloud/">Open Build Service</a> packages (or from distro packages, which we do not recommend) <strong>do not backup your ownCloud server files</strong>, which are the other files in your <code class="docutils literal notranslate"><span class="pre">owncloud/</span></code> directory such as <code class="docutils literal notranslate"><span class="pre">core/</span></code>, <code class="docutils literal notranslate"><span class="pre">3rdparty/</span></code>, <code class="docutils literal notranslate"><span class="pre">apps/</span></code>, <code class="docutils literal notranslate"><span class="pre">lib/</span></code>, and all the rest of the ownCloud files. If you restore these files from backup they may not be in sync with the current package versions, and will fail the code integrity check. This may also cause other errors, such as white pages.</p>
<p>When you install ownCloud from the source tarballs this will not be an issue, and you can safely backup your entire ownCloud installation, with the exception of your ownCloud database. Databases cannot be copied, but you must use the database tools to make a correct database dump.</p>
<p>To restore your ownCloud installation from backup, see <a class="reference internal" href="restore.html"><span class="doc">Restoring ownCloud</span></a> .</p>
<div class="section" id="backing-up-the-config-and-data-directories">
<span id="backing-up-the-config-and-data-directories-label"></span><h2>Backing Up the config/ and data/ Directories<a class="headerlink" href="#backing-up-the-config-and-data-directories" title="Permalink to this headline">¶</a></h2>
<p>Simply copy your <code class="docutils literal notranslate"><span class="pre">config/</span></code> and <code class="docutils literal notranslate"><span class="pre">data/</span></code> folder to a place outside of your ownCloud environment. This example uses <code class="docutils literal notranslate"><span class="pre">rsync</span></code> to copy the two directories to <code class="docutils literal notranslate"><span class="pre">/oc-backupdir</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rsync</span> <span class="o">-</span><span class="n">Aax</span> <span class="n">config</span> <span class="n">data</span> <span class="o">/</span><span class="n">oc</span><span class="o">-</span><span class="n">backupdir</span><span class="o">/</span>
</pre></div>
</div>
<p>There are many ways to backup normal files, and you may use whatever method you are accustomed to.</p>
</div>
<div class="section" id="backup-database">
<span id="backup-database-label"></span><h2>Backup Database<a class="headerlink" href="#backup-database" title="Permalink to this headline">¶</a></h2>
<p>You can’t just copy a database, but must use the database tools to make a correct database dump.</p>
<div class="section" id="mysql-mariadb">
<h3>MySQL/MariaDB<a class="headerlink" href="#mysql-mariadb" title="Permalink to this headline">¶</a></h3>
<p>MySQL or MariaDB, which is a drop-in MySQL replacement, is the recommended database engine. To backup MySQL/MariaDB:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysqldump --single-transaction -h [server] -u [username] -p [password] [db_name] &gt; owncloud-dbbackup_`date +&quot;%Y%m%d&quot;`.bak
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysqldump --single-transaction -h localhost -u username -p password owncloud &gt; owncloud-dbbackup_`date +&quot;%Y%m%d&quot;`.bak
</pre></div>
</div>
</div>
<div class="section" id="sqlite">
<h3>SQLite<a class="headerlink" href="#sqlite" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sqlite3 data/owncloud.db .dump &gt; owncloud-dbbackup_`date +&quot;%Y%m%d&quot;`.bak
</pre></div>
</div>
</div>
<div class="section" id="postgresql">
<h3>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PGPASSWORD=&quot;password&quot; pg_dump [db_name] -h [server] -U [username] -f owncloud-dbbackup_`date +&quot;%Y%m%d&quot;`.bak
</pre></div>
</div>
</div>
</div>
<div class="section" id="restoring-files-from-backup-when-encryption-is-enabled">
<h2>Restoring Files From Backup When Encryption Is Enabled<a class="headerlink" href="#restoring-files-from-backup-when-encryption-is-enabled" title="Permalink to this headline">¶</a></h2>
<p>If you need to restore files from backup, which were backed up when encryption
was enabled, here’s how to do it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is effective from at least version v8.2.7 of ownCloud onwards. Also,
this is <strong>not officially supported</strong>. ownCloud officially supports either
restoring the full backup or restoring nothing — not restoring individual
parts of it.</p>
</div>
<ol class="arabic simple">
<li>Restore the file from backup.</li>
<li>Restore the file’s encryption keys from backup.</li>
<li>Run <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">files:scan</span></code>; this makes the scanner find it. Note that, in the DB
it will (1) have the “size” set to the encrypted size, which is wrong (and
bigger) and (2) the “encrypted” flag will be set to 0.</li>
<li>Update the “encrypted” flag to 1 in the DB to all <em>files</em> under
<code class="docutils literal notranslate"><span class="pre">files/path</span></code>, but <strong>not</strong> directories. Setting the flag to 1 tells the
encryption application that the file is encrypted and needs to be processed.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There’s no need to update the encrypted flag for files in either
“files_versions” or “files_trashbin”, because these aren’t scanned or found
by <code class="docutils literal notranslate"><span class="pre">occ</span> <span class="pre">files:scan</span></code>.</p>
</div>
<ol class="arabic simple" start="5">
<li>Download the file once as the user; the file’s size will be corrected
automatically.</li>
</ol>
<p>This process might not be suitable across all environments.
If it’s not suitable for yours, you might need to run an OCC command that does
the scanning.
But, that will require the user’s password or recovery key.</p>
</div>
</div>


					</div>
				</div>
			</div>

  </div>
</div>
</div>
<footer class="footer">
  <div class="container">
  <div class="footer_navi">

  <div class="menu-footer-navigation-container">
  	<ul id="menu-footer-navigation" class="menu">
  		<li><a href="https://owncloud.com">Home</a></li>
  		<li><a href="https://owncloud.com/about">About ownCloud</a></li>
  		<li><a href="https://owncloud.com/resources">Resources</a></li>
  		<li><a href="https://owncloud.com/become-partner">Become a Partner</a></li>
  		<li><a href="https://owncloud.org">Community</a></li>
  		<li><a href="https://owncloud.com/blog">Blog</a></li>
  		<li><a href="https://owncloud.com/jobs">Jobs</a></li>
  		<li><a href="https://owncloud.com/contact">Contact</a></li>
  	</ul>
  </div>

  <div class="follow_f">
  	<ul>
  		<li><a class="twitter" href="https://twitter.com/ownloud" target="_blank">Twitter</a></li>
  		<li><a class="facebook" href="http://www.facebook.com/owncloud" target="_blank">Facebook</a></li>
  		<li><a class="google" href="https://plus.google.com/+OwncloudOfficial" target="_blank">Google</a></li>
  	</ul>
  </div>

  <p class="copyright">© ownCloud 2011-2015</p>

  </div>
  </div>
</footer>
  </body>
</html>