<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Setup Apache &#8212; ownCloud 10.0.8 Server Administration Manual 10.0.8 documentation</title>
    <link rel="stylesheet" href="../../_static/" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/main.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1d2d44">
<link rel="shortcut icon" href="https://owncloud.org/wp-content/themes/owncloudorgnew/assets/img/common/favicon.png" />
<link rel="apple-touch-icon-precomposed" href="https://owncloud.org/wp-content/themes/owncloudorgnew/assets/img/common/favicon.png" />

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https//piwik.owncloud.org/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '4']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

  </head><body>
<noscript><p><img src="https://piwik.owncloud.com/piwik.php?idsite=4&rec=1" style="border:0" alt=""></p></noscript>

<header class="banner navbar navbar-default navbar-static-top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="brand" href="http://owncloud.org/" rel="home" title="ownCloud.org"><img class="logo" src="../../_static/img/logo_owncloud.svg" itemprop="logo"></a>
    </div>

    <nav class="collapse navbar-collapse" role="navigation">
      <ul id="menu-header" class="nav navbar-nav">
        <li class="menu-news"><a href="https://owncloud.org/news/">News</a></li>
        <li class="menu-features"><a href="https://owncloud.org/features/">Features</a></li>
        <li class="menu-demo"><a target="_blank" href="https://demo.owncloud.org">Demo</a></li>
        <li class="menu-documentation top-nav-active"><a href="https://doc.owncloud.org">Documentation</a></li>
        <li class="menu-contribute"><a href="https://owncloud.org/contribute/">Contribute</a>
        <li class="menu-support"><a href="https://owncloud.org/support">Support</a></li>
        <li class="menu-commercial"><a target="_blank" href="https://owncloud.com">Enterprise Edition</a></li>
        <li class="menu-install"><a href="https://owncloud.org/install/">Download</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="wrap container not-front">
  <div class="content row">
  <main class="main">
    <div class="row page-content-header">
      <div class="col-md-6">
        <h1><a href="../../contents.html">ownCloud 10.0.8 Server Administration Manual</a></h1>
      </div>
      <div class="col-md-5 col-md-offset-1">
      
        <form class="headersearch" style="margin-bottom:-3px;" action="../../search.html" method="get">
        <input type="text" value="" name="q" id="q" class="form-control" />
        <button  class="btn btn-default" type="submit" id="searchsubmit">Search</button>
        </form>
      
      </div>
    </div>
    
			<div class="row">
				<div class="col-md-3">
					<div class="sidebar">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>

<li><a href="../../contents.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new_admin.html">What’s New in ownCloud 10.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise/index.html">Enterprise Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appliance/index.html">The ownCloud X Appliance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>

								</ul>
							</div>
					</div>
				</div>
        

				<div class="col-md-9">
					<div class="page-content">
            
						
  <div class="section" id="setup-apache">
<h1>Setup Apache<a class="headerlink" href="#setup-apache" title="Permalink to this headline">¶</a></h1>
<p>The following is an example setup process for Apache, please adopt to your exact needs.</p>
<div class="section" id="apache-sslopensslconfcmd-dhparameters">
<h2>Apache SSLOpenSSLConfCmd DHParameters<a class="headerlink" href="#apache-sslopensslconfcmd-dhparameters" title="Permalink to this headline">¶</a></h2>
<p>For Apache 2.4.8 or later and OpenSSL 1.0.2 or later, you can generate and specify your <a class="reference external" href="https://en.wikipedia.org/wiki/Diffie–Hellman_key_exchange">Diffie-Hellman</a> (DH) params file.
If not already present, add an <a class="reference external" href="https://httpd.apache.org/docs/trunk/mod/mod_ssl.html#sslopensslconfcmd">SSLOpenSSLConfCmd</a> directive and a new certificate with stronger keys (which improves <a class="reference external" href="https://scotthelme.co.uk/perfect-forward-secrecy/">forward secrecy</a>).
The OpenSSL command may take a quite a while to complete, so please be patient.</p>
<p>You can place the certificate into any directory of your choice.
We recommend <code class="docutils literal notranslate"><span class="pre">/etc/apache2/</span></code> in this guide, just for the sake of simplicity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">openssl</span> <span class="n">dhparam</span> <span class="o">-</span><span class="n">out</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">dh4096</span><span class="o">.</span><span class="n">pem</span> <span class="mi">4096</span>
</pre></div>
</div>
<p>Add the following directive to your common SSL configuration:</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nb">SSLOpenSSLConfCmd</span> DHParameters <span class="sx">/etc/apache2/dh4096.pem</span>
</pre></div>
</div>
<p>Add the <code class="docutils literal notranslate"><span class="pre">/.well-known/acme-challenge</span></code> location in your Virtual Host directive for port 80</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;virtualHost</span> <span class="s">*.80</span><span class="nt">&gt;</span>
  <span class="nb">ServerName</span> mydom.tld

  <span class="nb">Alias</span> /.well-known/acme-challenge/ <span class="sx">/var/www/letsencrypt/.well-known/acme-challenge/</span>
  <span class="nt">&lt;Directory</span> <span class="s">&quot;/var/www/letsencrypt/.well-known/acme-challenge/&quot;</span><span class="nt">&gt;</span>
      <span class="nb">Options</span> <span class="k">None</span>
      <span class="nb">AllowOverride</span> <span class="k">None</span>
      <span class="nb">ForceType</span> text/plain
      <span class="nb">RedirectMatch</span> <span class="m">404</span> <span class="s2">&quot;^(?!/\.well-known/acme-challenge/[\w-]{43}$)&quot;</span>
  <span class="nt">&lt;/Directory&gt;</span>

  <span class="c"># ...</span>
<span class="nt">&lt;/virtualHost&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="prepare-a-virtualhost-directive-for-port-443">
<h2>Prepare a virtualHost directive for port 443<a class="headerlink" href="#prepare-a-virtualhost-directive-for-port-443" title="Permalink to this headline">¶</a></h2>
<p>It is easiest, if you create a separate file for the following <code class="docutils literal notranslate"><span class="pre">SSL</span></code> directives.
If these directives already exist in this Virtual Host, delete them and include the file instead.
When the certificate has been created, you can use this file in any SSL Virtual Host for which the certificate is valid, without
reissuing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="n">ssl_rules</span>
</pre></div>
</div>
<p>Create a file named <code class="docutils literal notranslate"><span class="pre">ssl_mydom.tld</span></code> in the newly created directory.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="c"># ssl rules for mydom.tld</span>
<span class="c"># eases letsencrypt initial cert issuing</span>

<span class="nb">SSLEngine</span> <span class="k">on</span>

<span class="nb">SSLCertificateChainFile</span>  <span class="sx">/etc/letsencrypt/live/mydom.tld/fullchain.pem</span>
<span class="nb">SSLCertificateKeyFile</span>    <span class="sx">/etc/letsencrypt/live/mydom.tld/privkey.pem</span>
<span class="nb">SSLCertificateFile</span>       <span class="sx">/etc/letsencrypt/live/mydom.tld/cert.pem</span>
</pre></div>
</div>
<p>To reduce the SSL performance penalty, we recommend you use the <a class="reference external" href="https://httpd.apache.org/docs/trunk/mod/mod_ssl.html#sslusestapling">SSLUseStapling</a> and <a class="reference external" href="https://httpd.apache.org/docs/trunk/mod/mod_ssl.html#sslstaplingcache">SSLStaplingCache</a> directives:
Here’s an example configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SSLUseStapling</span> <span class="n">on</span>
<span class="n">SSLStaplingCache</span>         <span class="n">shmcb</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">stapling_cache</span><span class="p">(</span><span class="mi">2097152</span><span class="p">)</span>
</pre></div>
</div>
<p>Then adopt your Virtual Host block:</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;virtualHost</span> <span class="s">*:443</span><span class="nt">&gt;</span>
  <span class="nb">ServerName</span> mydom.tld

  <span class="c"># ssl letsencrypt</span>
  <span class="c"># Include /etc/apache2/ssl_rules/ssl_mydom.tld</span>

  <span class="c">#...</span>
<span class="nt">&lt;/virtualHost&gt;</span>
</pre></div>
</div>
<p>Commenting the <code class="docutils literal notranslate"><span class="pre">Include</span></code> directive is required, because the certificate files currently do not exist.</p>
</div>
<div class="section" id="test-and-enable-your-apache-configuration">
<h2>Test and enable your Apache configuration<a class="headerlink" href="#test-and-enable-your-apache-configuration" title="Permalink to this headline">¶</a></h2>
<p>To test your configuration run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apache2ctl</span> <span class="o">-</span><span class="n">t</span> <span class="c1"># You can also use: sudo apache2ctl configtest</span>
</pre></div>
</div>
<p>It should reply without errors.
Load your new Apache configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apache2ctl</span> <span class="n">graceful</span>
</pre></div>
</div>
<div class="section" id="creating-certificates">
<h3>Creating certificates<a class="headerlink" href="#creating-certificates" title="Permalink to this headline">¶</a></h3>
<p>Check that you have commented out the <code class="docutils literal notranslate"><span class="pre">Include</span></code> directive as stated above and run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;.</span><span class="n">sh</span>
</pre></div>
</div>
<p>To double check the issued certificate, run the <code class="docutils literal notranslate"><span class="pre">list.sh</span></code> script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="nb">list</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>If successful, you will see output similar to that below, when the command completes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Saving</span> <span class="n">debug</span> <span class="n">log</span> <span class="n">to</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">.</span><span class="n">log</span>

<span class="o">-------------------------------------------------------------------------------</span>
<span class="n">Found</span> <span class="n">the</span> <span class="n">following</span> <span class="n">certs</span><span class="p">:</span>
  <span class="n">Certificate</span> <span class="n">Name</span><span class="p">:</span> <span class="n">mydom</span><span class="o">.</span><span class="n">tld</span>
    <span class="n">Domains</span><span class="p">:</span> <span class="n">mydom</span><span class="o">.</span><span class="n">tld</span>
    <span class="n">Expiry</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">18</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="p">(</span><span class="n">VALID</span><span class="p">:</span> <span class="mi">89</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">Certificate</span> <span class="n">Path</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">mydom</span><span class="o">.</span><span class="n">tld</span><span class="o">/</span><span class="n">fullchain</span><span class="o">.</span><span class="n">pem</span>
    <span class="n">Private</span> <span class="n">Key</span> <span class="n">Path</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">mydom</span><span class="o">.</span><span class="n">tld</span><span class="o">/</span><span class="n">privkey</span><span class="o">.</span><span class="n">pem</span>
<span class="o">-------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>When successfully issuing the certificate for the first time, the certificate files exist and you can un-comment the <code class="docutils literal notranslate"><span class="pre">Include</span></code> directive to use them with SSL.</p>
<div class="highlight-apacheconf notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;virtualHost</span> <span class="s">*:443</span><span class="nt">&gt;</span>
  <span class="nb">ServerName</span> mydom.tld

  <span class="c"># ssl letsencrypt</span>
  <span class="nb">Include</span> <span class="sx">/etc/apache2/ssl_rules/ssl_mydom.tld</span>

  <span class="c">#...</span>
<span class="nt">&lt;/virtualHost&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reload-the-apache-configuration">
<h2>Reload the Apache configuration<a class="headerlink" href="#reload-the-apache-configuration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">apache2</span> <span class="n">reload</span>
</pre></div>
</div>
<p>Your web server is now ready to serve https request for the given domain using the issued certificates.</p>
</div>
</div>


            
					</div>
				</div>
			</div>
  </main>
  </div>
</div>
<div class="container">
<div class="row">
    <div class="col-lg-12 footer-social-icons">
      <p class="text-center"><a target="_blank" href="https://plus.google.com/107072838776436530705/about"><img width=50 src="../../_static/img/social/googleplus.svg" title="Follow us on Google Plus!" alt="Follow us on Google Plus!"></img></a>
      <a target="_blank" style="margin: 0 7px 0 14px;" href="https://www.facebook.com/ownClouders"><img width=50 src="../../_static/img/social/facebook.svg" title="Like our facebook page!" alt="Like our facebook page!"></img></a>
      <a target="_blank" style="margin: 0 14px 0 7px;" href="https://twitter.com/ownClouders"><img width=50 src="../../_static/img/social/twitter.svg" title="Subscribe to our twitter channel!" alt="Subscribe to our twitter channel!"></img></a>
      <a target="_blank" href="https://owncloud.org/blogfeed"><img class="img-circle" width=50 src="../../_static/img/social/rss.svg" title="Subscribe to our news feed!" alt="Subscribe to our news feed!"></img></a>
      <a target="_blank" href="http://visitor.r20.constantcontact.com/d.jsp?llr=ixens9uab&amp;p=oi&amp;m=1121878184680&amp;sit=mf4qye7jb&amp;f=cc4cd13f-acdf-45d3-b132-75252542c37d"><img class="img-circle" width=50 src="../../_static/img/social/mail.svg"  title="Subscribe to our newsletter!" alt="Subscribe to our newsletter!"></img></a></p>
    </div>
    <div class="text-center">
      All documentation licensed under the <a href="https://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 Unported license</a>.
    </div>
</div>
</div>
<footer class="content-info" role="contentinfo">
<div class="container">
   <div class="row">
     <div class="col-sm-2 col-sm-offset-1">
        <div class="footer-nav">
          <h4>About ownCloud</h4>
          <ul id="menu-about" class="menu">
            <li class="menu-contact"><a href="https://owncloud.org/contact/">People</a></li>
            <li class="menu-history"><a href="https://owncloud.org/history/">History</a></li>
            <li class="menu-events"><a href="https://owncloud.org/events/">Events</a></li>
            <li class="menu-press"><a href="https://owncloud.org/press">Press</a></li>
            <li class="menu-privacy"><a href="https://owncloud.org/privacy/">Privacy policy</a></li>
          </ul>
        </div>
     </div>
     <div class="col-sm-2 col-sm-offset-2">
        <div class="footer-nav">
          <h4>Resources</h4>
          <ul id="menu-support-and-documentation" class="menu">
            <li class="menu-faq"><a href="https://owncloud.org/faq/">FAQ</a></li>
            <li class="menu-support"><a href="https://owncloud.org/support/">Support</a></li>
            <li class="menu-admin-manual"><a href="https://doc.owncloud.org">Documentation</a></li>
            <li class="menu-security"><a href="https://owncloud.org/security/">Security</a></li>
            <li class="menu-store"><a href="http://www.cafepress.com/owncloudshop">ownCloud Store</a></li>
          </ul>
        </div>
     </div>
     <div class="col-sm-2 col-sm-offset-2">
        <div class="footer-nav">
          <h4>Interact</h4>
          <ul id="menu-interact" class="menu">
            <li class="menu-irc-channel"><a href="https://webchat.freenode.net/?channels=owncloud">IRC Channel</a></li>
            <li class="menu-mailing-list"><a href="https://mailman.owncloud.org/mailman/listinfo/">Mailing List</a></li>
            <li class="menu-forums"><a href="https://forum.owncloud.org/">Forums</a></li>
            <li class="menu-bug-tracker"><a href="https://owncloud.org/contribute">Get involved</a></li>
            <li class="menu-promote"><a href="https://owncloud.org/promote/">Discuss ownCloud with others</a></li>

          </ul>
        </div>
     </div>
   </div>
   <div class="row">
      <div class="col-lg-12 footer-text">
        <p>
              &copy; Copyright 2013-2018, The ownCloud developers.<br/>
        </p>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>