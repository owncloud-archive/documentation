<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How To Manually Move a Data Directory &#8212; ownCloud 10.0.8 Server Administration Manual 10.0.8 documentation</title>
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/main.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Issues and Troubleshooting" href="../issues/index.html" />
    <link rel="prev" title="Migrating to a Different Server" href="migrating.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1d2d44">
<link rel="shortcut icon" href="https://owncloud.org/wp-content/themes/owncloudorgnew/assets/img/common/favicon.png" />
<link rel="apple-touch-icon-precomposed" href="https://owncloud.org/wp-content/themes/owncloudorgnew/assets/img/common/favicon.png" />

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https//piwik.owncloud.org/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '4']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

  </head><body>
<noscript><p><img src="https://piwik.owncloud.com/piwik.php?idsite=4&rec=1" style="border:0" alt=""></p></noscript>

<header class="banner navbar navbar-default navbar-static-top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="brand" href="http://owncloud.org/" rel="home" title="ownCloud.org"><img class="logo" src="../_static/img/logo_owncloud.svg" itemprop="logo"></a>
    </div>

    <nav class="collapse navbar-collapse" role="navigation">
      <ul id="menu-header" class="nav navbar-nav">
        <li class="menu-news"><a href="https://owncloud.org/news/">News</a></li>
        <li class="menu-features"><a href="https://owncloud.org/features/">Features</a></li>
        <li class="menu-demo"><a target="_blank" href="https://demo.owncloud.org">Demo</a></li>
        <li class="menu-documentation top-nav-active"><a href="https://doc.owncloud.org">Documentation</a></li>
        <li class="menu-contribute"><a href="https://owncloud.org/contribute/">Contribute</a>
        <li class="menu-support"><a href="https://owncloud.org/support">Support</a></li>
        <li class="menu-commercial"><a target="_blank" href="https://owncloud.com">Enterprise Edition</a></li>
        <li class="menu-install"><a href="https://owncloud.org/install/">Download</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="wrap container not-front">
  <div class="content row">
  <main class="main">
    <div class="row page-content-header">
      <div class="col-md-6">
        <h1><a href="../contents.html">ownCloud 10.0.8 Server Administration Manual</a></h1>
      </div>
      <div class="col-md-5 col-md-offset-1">
      
        <form class="headersearch" style="margin-bottom:-3px;" action="../search.html" method="get">
        <input type="text" value="" name="q" id="q" class="form-control" />
        <button  class="btn btn-default" type="submit" id="searchsubmit">Search</button>
        </form>
      
      </div>
    </div>
    
			<div class="row">
				<div class="col-md-3">
					<div class="sidebar">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>

<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What’s New in ownCloud 10.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Maintenance</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="enable_maintenance.html">Maintenance Mode Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html">Backing up ownCloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">How to Upgrade Your ownCloud Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="package_upgrade.html">Upgrade ownCloud From Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="update.html">Upgrading ownCloud with the Updater App</a></li>
<li class="toctree-l2"><a class="reference internal" href="manual_upgrade.html">Manual ownCloud Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="restore.html">Restoring ownCloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating.html">Migrating to a Different Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How To Manually Move a Data Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fix-hardcoded-database-path-variables">Fix Hardcoded Database Path Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fix-application-settings">Fix Application Settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise/index.html">Enterprise Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appliance/index.html">The ownCloud X Appliance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

								</ul>
							</div>
					</div>
				</div>
        

				<div class="col-md-9">
					<div class="page-content">
            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="migrating.html" title="Previous Chapter: Migrating to a Different Server"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Migrating to ...</span>
    </a>
  </li>
  <li class="next">
    <a href="../issues/index.html" title="Next Chapter: Issues and Troubleshooting"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Issues and Tr... &raquo;</span>
    </a>
  </li>
</ul>
						
  <div class="section" id="how-to-manually-move-a-data-directory">
<span id="datadir-move-label"></span><h1>How To Manually Move a Data Directory<a class="headerlink" href="#how-to-manually-move-a-data-directory" title="Permalink to this headline">¶</a></h1>
<p>If you need to move your ownCloud data directory from its current location to
somewhere else, here is a manual process that you can take to make it happen.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This example assumes that:</p>
<ul class="last simple">
<li>The current folder is: <cite>/var/www/owncloud/data</cite></li>
<li>The new folder is: <cite>/mnt/owncloud</cite></li>
<li>You’re using Apache as your webserver</li>
</ul>
</div>
<ol class="arabic simple">
<li>Stop Apache</li>
<li>Use rsync to sync the files from the current folder to the new one</li>
<li>Create a symbolic link from the new directory to the old one</li>
<li>Double-check <a class="reference external" href="https://doc.owncloud.org/server/latest/admin_manual/installation/installation_wizard.html#strong-perms-label">the directory permissions</a> on the new directory</li>
<li>Restart Apache</li>
</ol>
<p>To save time, here’s the commands which you can copy and use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apachectl</span> <span class="o">-</span><span class="n">k</span> <span class="n">stop</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">avz</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">owncloud</span><span class="o">/</span><span class="n">data</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">owncloud</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">owncloud</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">owncloud</span><span class="o">/</span><span class="n">data</span>
<span class="n">apachectl</span> <span class="o">-</span><span class="n">k</span> <span class="n">graceful</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re on CentOS/Fedora, try <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">httpd</span></code>.
If you’re on Debian/Ubuntu try <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">apache2</span></code>
To learn more about the systemctl command, please refer to <a class="reference external" href="https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal">the systemd essentials guide</a></p>
</div>
<div class="section" id="fix-hardcoded-database-path-variables">
<h2>Fix Hardcoded Database Path Variables<a class="headerlink" href="#fix-hardcoded-database-path-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="update-the-oc-storages-table">
<h3>Update the oc_storages table<a class="headerlink" href="#update-the-oc-storages-table" title="Permalink to this headline">¶</a></h3>
<p>If you want to manually change the location of the data folder in the database,
run the SQL below:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">oc_storages</span> <span class="k">SET</span> <span class="n">id</span><span class="o">=</span><span class="s1">&#39;local::/mnt/owncloud&#39;</span>
  <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="s1">&#39;local::/var/www/owncloud/data/&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="update-the-oc-accounts-table">
<h3>Update the oc_accounts table<a class="headerlink" href="#update-the-oc-accounts-table" title="Permalink to this headline">¶</a></h3>
<p>You next need to update the <code class="docutils literal notranslate"><span class="pre">home</span></code> column in the <code class="docutils literal notranslate"><span class="pre">oc_accounts</span></code> table.
This column contains the absolute path for user folders, e.g., <code class="docutils literal notranslate"><span class="pre">/mnt/data/files/admin</span></code>.
Assuming that the new home directory is: <code class="docutils literal notranslate"><span class="pre">/mnt/data/files/super-admin</span></code>, and that the user’s id is 1, you could change it using the following SQL statement:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">oc_accounts</span> <span class="k">SET</span> <span class="n">home</span><span class="o">=</span><span class="s1">&#39;/mnt/data/files/super-admin&#39;</span>
  <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please don’t copy and paste this example verbatim — nor any of the others.
It, and the others, are provided only as guides to what you should or could do.</p>
</div>
</div>
<div class="section" id="update-the-oc-jobs-table">
<h3>Update the oc_jobs table<a class="headerlink" href="#update-the-oc-jobs-table" title="Permalink to this headline">¶</a></h3>
<p>The next area to check is the <cite>oc_jobs</cite> table.
The logrotate process may have hard-coded a non-standard (or old) value for the data path.
To check it, run the SQL below and see if any results are returned:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">oc_jobs</span>
  <span class="k">WHERE</span> <span class="k">class</span> <span class="o">=</span> <span class="s1">&#39;OC\Log\Rotate&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>If any are, run the SQL below to update them, changing the value as appropriate.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">oc_jobs</span> <span class="k">SET</span> <span class="n">argument</span> <span class="o">=</span> <span class="s1">&#39;/your/new/data/path&#39;</span>
  <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">id</span> <span class="k">of</span> <span class="n">the</span> <span class="n">incorrect</span> <span class="n">record</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fix-application-settings">
<h2>Fix Application Settings<a class="headerlink" href="#fix-application-settings" title="Permalink to this headline">¶</a></h2>
<p>One thing worth noting is that individual apps may reference the data directory
separate from the core system configuration. If so, then you will need to find
which applications do this, and change them as needed.</p>
<p>For example, if you listed the application configuration by running <cite>occ
config:list</cite>, then you might see output similar to that below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;fictitious&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
            <span class="nt">&quot;installed_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.3.2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;types&quot;</span><span class="p">:</span> <span class="s2">&quot;filesystem&quot;</span><span class="p">,</span>
            <span class="nt">&quot;datadir&quot;</span><span class="p">:</span> <span class="s2">&quot;var/www/owncloud/data&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, the “fictitious” application references the data directory as being set to
<cite>var/www/owncloud/data</cite>. So you would have to change the value by using the
<cite>config:app:set</cite> option. Here’s an example of how you would update the setting:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">occ config:app:set --value /mnt/owncloud fictitious datadir</span>
</pre></div>
</div>
</div>
</div>


            
<ul class="prevnext-title list-unstyled list-inline">
  <li class="prev">
    <a href="migrating.html" title="Previous Chapter: Migrating to a Different Server"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Migrating to ...</span>
    </a>
  </li>
  <li class="next">
    <a href="../issues/index.html" title="Next Chapter: Issues and Troubleshooting"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Issues and Tr... &raquo;</span>
    </a>
  </li>
</ul>
					</div>
				</div>
			</div>
  </main>
  </div>
</div>
<div class="container">
<div class="row">
    <div class="col-lg-12 footer-social-icons">
      <p class="text-center"><a target="_blank" href="https://plus.google.com/107072838776436530705/about"><img width=50 src="../_static/img/social/googleplus.svg" title="Follow us on Google Plus!" alt="Follow us on Google Plus!"></img></a>
      <a target="_blank" style="margin: 0 7px 0 14px;" href="https://www.facebook.com/ownClouders"><img width=50 src="../_static/img/social/facebook.svg" title="Like our facebook page!" alt="Like our facebook page!"></img></a>
      <a target="_blank" style="margin: 0 14px 0 7px;" href="https://twitter.com/ownClouders"><img width=50 src="../_static/img/social/twitter.svg" title="Subscribe to our twitter channel!" alt="Subscribe to our twitter channel!"></img></a>
      <a target="_blank" href="https://owncloud.org/blogfeed"><img class="img-circle" width=50 src="../_static/img/social/rss.svg" title="Subscribe to our news feed!" alt="Subscribe to our news feed!"></img></a>
      <a target="_blank" href="http://visitor.r20.constantcontact.com/d.jsp?llr=ixens9uab&amp;p=oi&amp;m=1121878184680&amp;sit=mf4qye7jb&amp;f=cc4cd13f-acdf-45d3-b132-75252542c37d"><img class="img-circle" width=50 src="../_static/img/social/mail.svg"  title="Subscribe to our newsletter!" alt="Subscribe to our newsletter!"></img></a></p>
    </div>
    <div class="text-center">
      All documentation licensed under the <a href="https://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 Unported license</a>.
    </div>
</div>
</div>
<footer class="content-info" role="contentinfo">
<div class="container">
   <div class="row">
     <div class="col-sm-2 col-sm-offset-1">
        <div class="footer-nav">
          <h4>About ownCloud</h4>
          <ul id="menu-about" class="menu">
            <li class="menu-contact"><a href="https://owncloud.org/contact/">People</a></li>
            <li class="menu-history"><a href="https://owncloud.org/history/">History</a></li>
            <li class="menu-events"><a href="https://owncloud.org/events/">Events</a></li>
            <li class="menu-press"><a href="https://owncloud.org/press">Press</a></li>
            <li class="menu-privacy"><a href="https://owncloud.org/privacy/">Privacy policy</a></li>
          </ul>
        </div>
     </div>
     <div class="col-sm-2 col-sm-offset-2">
        <div class="footer-nav">
          <h4>Resources</h4>
          <ul id="menu-support-and-documentation" class="menu">
            <li class="menu-faq"><a href="https://owncloud.org/faq/">FAQ</a></li>
            <li class="menu-support"><a href="https://owncloud.org/support/">Support</a></li>
            <li class="menu-admin-manual"><a href="https://doc.owncloud.org">Documentation</a></li>
            <li class="menu-security"><a href="https://owncloud.org/security/">Security</a></li>
            <li class="menu-store"><a href="http://www.cafepress.com/owncloudshop">ownCloud Store</a></li>
          </ul>
        </div>
     </div>
     <div class="col-sm-2 col-sm-offset-2">
        <div class="footer-nav">
          <h4>Interact</h4>
          <ul id="menu-interact" class="menu">
            <li class="menu-irc-channel"><a href="https://webchat.freenode.net/?channels=owncloud">IRC Channel</a></li>
            <li class="menu-mailing-list"><a href="https://mailman.owncloud.org/mailman/listinfo/">Mailing List</a></li>
            <li class="menu-forums"><a href="https://forum.owncloud.org/">Forums</a></li>
            <li class="menu-bug-tracker"><a href="https://owncloud.org/contribute">Get involved</a></li>
            <li class="menu-promote"><a href="https://owncloud.org/promote/">Discuss ownCloud with others</a></li>

          </ul>
        </div>
     </div>
   </div>
   <div class="row">
      <div class="col-lg-12 footer-text">
        <p>
              &copy; Copyright 2013-2018, The ownCloud developers.<br/>
        </p>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>