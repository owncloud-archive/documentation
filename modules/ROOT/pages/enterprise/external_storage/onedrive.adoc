= How to Create and Configure Microsoft OneDrive

To use Microsoft OneDrive as an external storage option in ownCloud, you
need to do two things:

1.  link:[Create an application configuration]
2.  link:[Configure a mount point in ownCloud]

[[create-an-application-configuration]]
== Create an Application Configuration

image:/owncloud-docs/_images/enterprise/external_storage/onedrive/register-an-application.png[image]

To create a new application:

* Open https://apps.dev.microsoft.com/ in your browser of choice and
click ``__Create App__''.
* Under ``__Properties__'', set the applicationâ€™s name.
* Click ``__Create__''.

With the application created, you can then add a range of further
settings. However, only a few of them are required for use with
ownCloud.

[[application-password]]
=== Application Password

image:/owncloud-docs/_images/enterprise/external_storage/onedrive/set-application-name.png[image]

Under ``__Application Secrets__'', click ``__Generate New Password__'',
which generates a password and displays it in a popup window. It is
required later during when configuring a mount point.

Copy the password to your preferred password manager, as it is only
displayed *once*.

[[redirect-urls]]
=== Redirect URLs

Under ``__Platforms__'', click ``__Add Platform__'' and choose
``__Web__'' in the popup window which appears. Only one redirect URL
field is visible at first, so click ``__Add URL__'' to add another one.

With two fields available, add two redirect URLs; one for
`settings/admin` and one for `settings/personal`, as you can see in the
image below.

image:/owncloud-docs/_images/enterprise/external_storage/onedrive/set-redirect-urls.png[image]

[[application-permissions]]
=== Application Permissions

image:/owncloud-docs/_images/enterprise/external_storage/onedrive/set-permissions.png[image]

Under ``__Microsoft Graph Permissions__'', click ``__Add__'' next to
``__Application Permissions__''. This opens a popup window where you can
choose the required permissions. Add a least the following four:

* `Files.Read.All`
* `Files.ReadWrite.All`
* `IdentityRiskEvent.Read.All`
* `User.Read.All`

With those settings added, click ``__Save__'', located right at the
bottom of the page.

[[configure-a-mount-point-in-owncloud]]
== Configure a Mount Point in ownCloud

You can add as many OneDrive mount points as you want. To do so:

1.  Add a new storage, selecting ``One Drive'' for external storage.
2.  Set the credentials of your OneDrive application, and then accept
the permissions.
3.  If everything is accepted, the mount points should appear, with a
green status icon on the far left-hand side.

image:/owncloud-docs/_images/enterprise/external_storage/onedrive/configure-mountpoints.png[image]

To be able to use the occ command `files_onedrive:subscribe`, you need
to have the variable `overwrite.cli.url` set in `config/config.php`, as
in this example:

[source,php]
----
'overwrite.cli.url' => 'https://example.org:63984/index.php',
----

The HTTPS prefix, port, and `/index.php` suffix are mandatory.
