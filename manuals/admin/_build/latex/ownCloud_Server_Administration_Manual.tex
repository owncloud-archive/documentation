% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\usepackage[utf8]{inputenc}
\DeclareUnicodeCharacter{00A0}{\nobreakspace}
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{babel}
\usepackage{times}
\usepackage[Bjarne]{fncychap}
\usepackage{longtable}
\usepackage{sphinx}
\usepackage{multirow}
\usepackage{morefloats}

\title{ownCloud Server Administration Manual}
\date{December 09, 2016}
\release{9.2}
\author{The ownCloud developers}
\newcommand{\sphinxlogo}{\includegraphics{logo-blue.pdf}\par}
\renewcommand{\releasename}{Release}
\makeindex

\makeatletter
\def\PYG@reset{\let\PYG@it=\relax \let\PYG@bf=\relax%
    \let\PYG@ul=\relax \let\PYG@tc=\relax%
    \let\PYG@bc=\relax \let\PYG@ff=\relax}
\def\PYG@tok#1{\csname PYG@tok@#1\endcsname}
\def\PYG@toks#1+{\ifx\relax#1\empty\else%
    \PYG@tok{#1}\expandafter\PYG@toks\fi}
\def\PYG@do#1{\PYG@bc{\PYG@tc{\PYG@ul{%
    \PYG@it{\PYG@bf{\PYG@ff{#1}}}}}}}
\def\PYG#1#2{\PYG@reset\PYG@toks#1+\relax+\PYG@do{#2}}

\expandafter\def\csname PYG@tok@gd\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gu\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@gt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PYG@tok@gs\endcsname{\let\PYG@bf=\textbf}
\expandafter\def\csname PYG@tok@gr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@cm\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@vg\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@m\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@mh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@cs\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\colorbox[rgb]{1.00,0.94,0.94}{\strut ##1}}}
\expandafter\def\csname PYG@tok@ge\endcsname{\let\PYG@it=\textit}
\expandafter\def\csname PYG@tok@vc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@il\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@go\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.20,0.20,0.20}{##1}}}
\expandafter\def\csname PYG@tok@cp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@gi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gh\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@ni\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.84,0.33,0.22}{##1}}}
\expandafter\def\csname PYG@tok@nl\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.13,0.44}{##1}}}
\expandafter\def\csname PYG@tok@nn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@no\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.38,0.68,0.84}{##1}}}
\expandafter\def\csname PYG@tok@na\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@nb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@nd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.33,0.33,0.33}{##1}}}
\expandafter\def\csname PYG@tok@ne\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.49}{##1}}}
\expandafter\def\csname PYG@tok@si\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.44,0.63,0.82}{##1}}}
\expandafter\def\csname PYG@tok@s2\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@vi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@nt\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.45}{##1}}}
\expandafter\def\csname PYG@tok@nv\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@s1\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@gp\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@sh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@ow\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@sx\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@bp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c1\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@kc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@mf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@err\endcsname{\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PYG@tok@kd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@ss\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.32,0.47,0.09}{##1}}}
\expandafter\def\csname PYG@tok@sr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.14,0.33,0.53}{##1}}}
\expandafter\def\csname PYG@tok@mo\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@mi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@kn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@o\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PYG@tok@kr\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@s\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@kp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@w\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PYG@tok@kt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.56,0.13,0.00}{##1}}}
\expandafter\def\csname PYG@tok@sc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@k\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@se\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sd\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}

\def\PYGZbs{\char`\\}
\def\PYGZus{\char`\_}
\def\PYGZob{\char`\{}
\def\PYGZcb{\char`\}}
\def\PYGZca{\char`\^}
\def\PYGZam{\char`\&}
\def\PYGZlt{\char`\<}
\def\PYGZgt{\char`\>}
\def\PYGZsh{\char`\#}
\def\PYGZpc{\char`\%}
\def\PYGZdl{\char`\$}
\def\PYGZhy{\char`\-}
\def\PYGZsq{\char`\'}
\def\PYGZdq{\char`\"}
\def\PYGZti{\char`\~}
% for compatibility with earlier versions
\def\PYGZat{@}
\def\PYGZlb{[}
\def\PYGZrb{]}
\makeatother

\begin{document}

\maketitle
\tableofcontents
\phantomsection\label{contents::doc}



\chapter{ownCloud 9.2 Server Administration Manual Introduction}
\label{index::doc}\label{index:table-of-contents}\label{index:owncloud-version-server-administration-manual-introduction}

\section{Introduction}
\label{index:introduction}
Welcome to the ownCloud Server Administration Guide. This guide describes
administration tasks for ownCloud, the flexible open source file synchronization
and sharing solution. ownCloud includes the ownCloud server, which runs on
Linux, client applications for Microsoft Windows, Mac OS X and Linux, and mobile
clients for the Android and Apple iOS operating systems.

Current editions of ownCloud manuals are always available online at
\href{https://doc.owncloud.org/}{doc.owncloud.org} and \href{https://doc.owncloud.com/}{doc.owncloud.com}.

ownCloud server is available in three editions:
\begin{itemize}
\item {} 
The free community-supported Server. This is the core server for all editions.

\item {} 
The Standard Subscription for customers who want paid support for the core
Server, without Enterprise applications.

\item {} 
The Enterprise Subscription provides paid support for the Enterprise Edition.
This includes the core Server and Enterprise apps.

\end{itemize}

See {\hyperref[whats_new_admin::doc]{\emph{What's New for Admins in ownCloud 9.2}}} for more information on the different ownCloud
editions.


\section{ownCloud Videos and Blogs}
\label{index:owncloud-videos-and-blogs}
See the \href{https://www.youtube.com/channel/UC\_4gez4lsWqciH-otOlXo5w}{official ownCloud channel} and \href{https://www.youtube.com/channel/UCA8Ehsdu3KaxSz5KOcCgHbw}{ownClouders
community channel}
on YouTube for tutorials, overviews, and conference videos.

Visit \href{https://owncloud.org/news/}{ownCloud Planet} for news and developer
blogs.


\section{Target Audience}
\label{index:target-audience}
This guide is for users who want to install, administer, and
optimize their ownCloud servers. To learn more about the ownCloud Web
user interface, and desktop and mobile clients, please refer to their
respective manuals:
\begin{itemize}
\item {} 
\href{https://doc.owncloud.org/server/9.2/user\_manual/}{ownCloud User Manual}

\item {} 
\href{https://doc.owncloud.org/desktop/2.2/}{ownCloud Desktop Client}

\item {} 
\href{https://doc.owncloud.org/android/}{ownCloud Android App}

\item {} 
\href{https://doc.owncloud.org/ios/}{ownCloud iOS App}

\end{itemize}


\chapter{ownCloud 9.2 Release Notes}
\label{release_notes::doc}\label{release_notes:owncloud-ios-app}\label{release_notes:owncloud-version-release-notes}

\section{Changes in 9.2}
\label{release_notes:changes-in-9-2}\begin{itemize}
\item {} 
Supported PHP versions are 5.6+ and 7.0+.

\item {} 
The upgrade migration test has been removed; see {\hyperref[maintenance/upgrade:migration-test-label]{\emph{Migration Test}}}.

\item {} 
Requires to use at least desktop client version 2.0 by default.

\end{itemize}


\section{Changes in 9.1}
\label{release_notes:changes-in-9-1}
\textbf{General}
\begin{itemize}
\item {} 
Background jobs (cron) can now run in parallel

\item {} 
Update notifications in client via API - You can now be notified in your desktop client
about available updates for core and apps. The notifications are made available via the
notifications API.

\item {} 
Multi-bucket support for primary objectstore integration

\item {} 
Support for Internet Explorer below version 11 was dropped

\item {} 
Symlinks pointing outside of the datadir are disallowed. Please use the {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}}
with the {\hyperref[configuration_files/external_storage/local::doc]{\emph{Local}}} storage backend instead.

\item {} 
Removed \code{dav:migrate-calendars} and \code{dav:migrate-addressbooks} commands for \code{occ}.
Users planning to upgrade from oC 9.0 or below to oC 9.1 needs to make sure that their
Calendars and Adressbooks are correctly migrated \textbf{before} continuing to upgrade to 9.1.

\end{itemize}

\textbf{Authentication}
\begin{itemize}
\item {} 
Pluggable authentication: plugin system that supports different authentication schemes

\item {} 
Token-based authentication

\item {} 
Ability to invalidate sessions

\item {} 
List connected browsers/devices in the personal settings page. Allows the user to disconnect browsers/devices.

\item {} 
Device-specific passwords/tokens, can be generated in the personal page and revoked

\item {} 
Disable users and automatically revoke their sessions

\item {} 
Detect disabled LDAP users or password changes and revoke their sessions

\item {} 
Log in with email address

\item {} 
Configuration option to enforce token-based login outside the web UI

\item {} 
Two Factor authentication plug-in system

\item {} 
OCC command added to (temporarily) disable/enable two-factor authentication for single users

\end{itemize}

\begin{notice}{note}{Note:}
The current desktop and mobile client versions do not support two-factor yet, this
will be added later. It is already possible to generate a device specific password and
enter that in the current client versions.
\end{notice}

\textbf{Files app}
\begin{itemize}
\item {} 
Ability to toggle displaying hidden files

\item {} 
Remember sort order

\item {} 
Permalinks for internal shares

\item {} 
Visual cue when dragging in files app

\item {} 
Autoscroll file list when dragging files

\item {} 
Upload progress estimate

\end{itemize}

\textbf{Federated sharing}
\begin{itemize}
\item {} 
Ability to create federated shares with CRUDS permissions

\item {} 
Resharing a federated share does not create a chain of shares any more but connects the
share owner's server to the reshare recipient

\end{itemize}

\textbf{External storage}
\begin{itemize}
\item {} 
UTF-8 NFD encoding compatibility support for NFD file names stored directly on external
storages (new mount option in external storage admin page)

\item {} 
Direct links to the configuration pages for setting up a GDrive or Dropbox app for use with ownCloud

\item {} 
Some performance and memory usage improvements for GDrive, stream download and chunk upload

\item {} 
Performance and memory usage improvements for Dropbox with stream download

\item {} 
GDrive library update provides exponential backoff which will reduce rate limit errors

\end{itemize}

\textbf{Minor additions}
\begin{itemize}
\item {} 
Support for print style sheets

\item {} 
Command line based update will now be suggested if the instance is bigger to avoid potential timeouts

\item {} 
Web updater will be disabled if LDAP or shibboleth are installed

\item {} 
DB/app update process now shows better progress information

\item {} 
Added occ files:scan --unscanned to only scan folders that haven't yet been explored on external storages

\item {} 
Chunk cache TTL can now be configured

\item {} 
Added warning for wrongly configured database transactions, helps prevent ``database is locked'' issues

\item {} 
Use a capped memory cache to reduce memory usage especially in background jobs and the file scanner

\item {} 
Allow login by email

\item {} 
Respect CLASS property in calendar events

\item {} 
Allow addressbook export using VCFExportPlugin

\item {} 
Birthdays are also generated based on shared addressbooks

\end{itemize}

\textbf{For developers}
\begin{itemize}
\item {} 
New DAV endpoint with a new chunking protocol aiming to solve many issues like timeouts (not used by clients yet)

\item {} 
New webdav property for share permissions

\item {} 
Background repair steps can be specified info.xml

\item {} 
Background jobs (cron) can now be declared in info.xml

\item {} 
Apps can now define repair steps to run at install/uninstall time

\item {} 
Export contact images via sabre dav plugin

\item {} 
Sabre DAV's browser plugin is available in debug mode to allow easier development around webdav

\end{itemize}

\textbf{Technical debt}
\begin{itemize}
\item {} 
PSR-4 autoloading forced for OCand OCP, optional for OCAdocs at \href{https://doc.owncloud.org/server/9.1/developer\_manual/app/classloader.html}{https://doc.owncloud.org/server/9.1/developer\_manual/app/classloader.html}

\item {} 
More cleanup of the sharing code (ongoing)

\end{itemize}


\section{Changes in 9.0}
\label{release_notes:release-notes-label}\label{release_notes:changes-in-9-0}
9.0 requires .ico files for favicons. This will change in 9.1, which will
use .svg files. See \href{https://doc.owncloud.org/server/9.0/developer\_manual/core/theming.html\#changing-favicon}{Changing favicon} in the Developer Manual.

Home folder rule is enforced in the user\_ldap application in new ownCloud installations; see
{\hyperref[configuration_user/user_auth_ldap::doc]{\emph{User Authentication with LDAP}}}. This affects ownCloud 8.0.10, 8.1.5 and 8.2.0 and up.

The Calendar and Contacts apps have been rewritten and the CalDAV and CardDAV backends of these
apps were merged into ownCloud core. During the upgrade existing Calendars and Addressbooks
are automatically migrated (except when using the the \code{IMAP user backend}). As a fallback
for failed upgrades, when using the \code{IMAP user backend} or as an option to test a migration
\code{dav:migrate-calendars} and/or \code{dav:migrate-addressbooks} scripts are available
(\textbf{only in oC 9.0}) via the \code{occ} command. See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}}.

\begin{notice}{warning}{Warning:}
After upgrading to ownCloud 9.0 and \textbf{before} continuing to upgrade to 9.1 make sure
that all of your and your users Calendars and Addressbooks are migrated correctly. Especially
when using the \code{IMAP user backend} (other user backends might be also affected) you need to
manually run the mentioned \code{occ} migration commands described above.
\end{notice}

Updates on systems with large datasets will take longer, due to the addition of checksums to the
oC database. See \href{https://github.com/owncloud/core/issues/22747}{https://github.com/owncloud/core/issues/22747}.

Linux packages are available from our \href{https://download.owncloud.org/download/repositories/stable/owncloud/}{official download repository} .
New in 9.0: split packages. \code{owncloud} installs ownCloud plus dependencies, including Apache
and PHP. \code{owncloud-files} installs only ownCloud. This is useful for custom LAMP stacks, and
allows you to install your own LAMP apps and versions without packaging conflicts with ownCloud.
See {\hyperref[installation/linux_installation::doc]{\emph{Preferred Linux Installation Method}}}.

New option for the ownCloud admin to enable or disable sharing on individual external mountpoints
(see {\hyperref[configuration_files/external_storage_configuration_gui:external-storage-mount-options-label]{\emph{Mount Options}}}). Sharing on such mountpoints is disabled by default.


\section{Enterprise 9.0}
\label{release_notes:enterprise-9-0}
owncloud-enterprise packages are no longer available for CentOS6, RHEL6,
Debian7, or any version of Fedora. A new package, owncloud-enterprise-files, is available for all supported platforms, including the above. This new package comes without dependencies, and is installable on a larger number of platforms. System administrators must install their own LAMP stacks and databases. See \href{https://owncloud.org/blog/time-to-upgrade-to-owncloud-9-0/}{https://owncloud.org/blog/time-to-upgrade-to-owncloud-9-0/}


\section{Changes in 8.2}
\label{release_notes:changes-in-8-2}
New location for Linux package repositories; ownCloud admins must manually
change to the new repos. See {\hyperref[maintenance/upgrade::doc]{\emph{How to Upgrade Your ownCloud Server}}}

PHP 5.6.11+ breaks the LDAP wizard with a `Could not connect to LDAP' error. See \href{https://github.com/owncloud/core/issues/20020}{https://github.com/owncloud/core/issues/20020}.

\code{filesystem\_check\_changes} in \code{config.php} is set to 0 by default. This
prevents unnecessary update checks and improves performance. If you are using
external storage mounts such as NFS on a remote storage server, set this to 1
so that ownCloud will detect remote file changes.

XSendFile support has been removed, so there is no longer support for \href{https://doc.owncloud.org/server/8.1/admin\_manual/configuration\_files/serving\_static\_files\_configuration.html}{serving
static files} from your ownCloud server.

LDAP issue: 8.2 uses the \code{memberof} attribute by default. If this is not
activated on your LDAP server your user groups will not be detected, and you
will see this message in your ownCloud log: \code{Error PHP Array to string
conversion at /var/www/html/owncloud/lib/private/template/functions.php\#36}.
Fix this by disabling the \code{memberof} attribute on your ownCloud server with
the \code{occ} command, like this example on Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:set\PYGZhy{}config \PYGZdq{}s01\PYGZdq{} useMemberOfToDetectMembership 0
\end{Verbatim}

Run \code{sudo -u www-data php occ ldap:show-config} to find the correct \code{sNN}
value; if there is not one then use empty quotes, \code{""}. (See
{\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}}.)

Users of the Linux Package need to update their repository setup as described
in this \href{https://owncloud.org/blog/upgrading-to-owncloud-server-8-2/}{blogpost}.


\section{Changes in 8.1}
\label{release_notes:changes-in-8-1}
Use APCu only if available in version 4.0.6 and higher. If you install an older version,
you will see a \code{APCu below version 4.0.6 is installed, for stability and performance
reasons we recommend to update to a newer APCu version} warning on your ownCloud admin page.

SMB external storage now based on \code{php5-libsmbclient}, which must be downloaded
from the ownCloud software repositories (\href{https://software.opensuse.org/download.html?project=isv\%3AownCloud\%3Acommunity\%3A8.1\&package=php5-libsmbclient}{installation instructions}).

``Download from link'' feature has been removed.

The \code{.htaccess} and \code{index.html} files in the \code{data/} directory are now
updated after every update. If you make any modifications to these files they
will be lost after updates.

The SabreDAV browser at \code{/remote.php/webdav} has been removed.

Using ownCloud without a \code{trusted\_domain} configuration will not work anymore.

The logging format for failed logins has changed and considers now the proxy
configuration in \code{config.php}.

A default set of security and privacy HTTP headers have been added to the
ownCloud \code{.htaccess} file, and ownCloud administrators may now customize which
headers are sent.

More strict SSL certificate checking improves security but can result in
``cURL error 60: SSL certificate problem: unable to get local issuer certificate''
errors with certain broken PHP versions. Please verify your SSL setup, update your
PHP or contact your vendor if you receive these errors.

The persistent file-based cache (e.g. used by LDAP integration) has been dropped and
replaced with a memory-only cache, which must be explicitly configured. See
{\hyperref[configuration_user/user_auth_ldap::doc]{\emph{User Authentication with LDAP}}}. Memory cache configuration for the
ownCloud server is no longer automatic, requiring installation of
your desired cache backend and configuration in
\code{config.php} (see {\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}}.)

The OC\_User\_HTTP backend has been removed. Administrators are encouraged to use
the \code{user\_webdavauth} application instead.

ownCloud ships now with its own root certificate bundle derived from Mozilla's
root certificates file. The system root certificate bundle will not be used
anymore for most requests.

When you upgrade from ownCloud 8.0, with encryption enabled, to 8.1, you must
enable the new encryption backend and migrate your encryption keys. See
{\hyperref[configuration_files/encryption_configuration:upgrading-encryption-label]{\emph{Encryption migration to ownCloud 8.0}}}.

Encryption can no longer be disabled in ownCloud 8.1. It is planned to re-add
this feature to the command line client for a future release.

It is not recommended to upgrade encryption-enabled systems from ownCloud Server 8.0
to version 8.1.0 as there is a chance the migration will break. We recommend
migrating to the first bugfix release, ownCloud Server 8.1.1.

Due to various technical issues, by default desktop sync clients older than
1.7 are not allowed to connect and sync with the ownCloud server. This is
configurable via the \code{minimum.supported.desktop.version} switch in
\code{config.php}.

Previews are now generated at a maximum size of 2048 x 2048 pixels. This is configurable
via the \code{preview\_max\_x} and \code{preview\_max\_y} switches in \code{config.php}.

The ownCloud 8 server is not supported on any version of Windows.

The 8.1.0 release has a minor bug which makes app updates fail at first try. Reload the
apps page and try again, and the update will succeed.

The \code{forcessl} option within the \code{config.php} and the \code{Enforce SSL} option
within the Admin-Backend was removed. This now needs to be configured like
described in {\hyperref[configuration_server/harden_server:use-https-label]{\emph{Use HTTPS}}}.

WebDAV file locking was removed in oC 8.1 which causes Finder on Mac OS X to mount WebDAV read-only.


\section{Enterprise 8.1 Only}
\label{release_notes:enterprise-8-1-only}
The SharePoint Drive app does not verify the SSL certificate of the SharePoint
server or the ownCloud server, as it is expected that both devices are in the
same trusted environment.


\section{ownCloud 8.0}
\label{release_notes:owncloud-8-0}

\subsection{Manual LDAP Port Configuration}
\label{release_notes:manual-ldap-port-configuration}
When you are configuring the LDAP user and group backend application, ownCloud
may not auto-detect the LDAP server's port number, so you will need to enter it
manually.


\subsection{No Preview Icon on Text Files}
\label{release_notes:no-preview-icon-on-text-files}
There is no preview icon displayed for text files when the file contains fewer than six characters.


\subsection{Remote Federated Cloud Share Cannot be Reshared With Local Users}
\label{release_notes:remote-federated-cloud-share-cannot-be-reshared-with-local-users}
When you mount a Federated Cloud share from a remote ownCloud server, you cannot re-share it with
your local ownCloud users. (See {\hyperref[configuration_files/federated_cloud_sharing_configuration::doc]{\emph{Configuring Federation Sharing}}}
to learn more about federated cloud sharing)


\subsection{Manually Migrate Encryption Keys after Upgrade}
\label{release_notes:manually-migrate-encryption-keys-after-upgrade}
If you are using the Encryption app and upgrading from older versions of
ownCloud to ownCloud 8.0, you must manually migrate your encryption keys.
See {\hyperref[configuration_files/encryption_configuration:upgrading-encryption-label]{\emph{Encryption migration to ownCloud 8.0}}}.


\subsection{Windows Server Not Supported}
\label{release_notes:windows-server-not-supported}
Windows Server is not supported in ownCloud 8.


\subsection{PHP 5.3 Support Dropped}
\label{release_notes:php-5-3-support-dropped}
PHP 5.3 is not supported in ownCloud 8, and PHP 5.4 or better is required.


\subsection{Disable Apache Multiviews}
\label{release_notes:disable-apache-multiviews}
If Multiviews are enabled in your Apache configuration, this may cause problems
with content negotiation, so disable Multiviews by removing it from your Apache
configuration. Look for lines like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}Directory /var/www/owncloud\PYGZgt{}
Options Indexes FollowSymLinks Multiviews
\end{Verbatim}

Delete \code{Multiviews} and restart Apache.


\subsection{ownCloud Does Not Follow Symlinks}
\label{release_notes:owncloud-does-not-follow-symlinks}
ownCloud's file scanner does not follow symlinks, which could lead to
infinite loops. To avoid this do not use soft or hard links in your ownCloud
data directory.


\subsection{No Commas in Group Names}
\label{release_notes:no-commas-in-group-names}
Creating an ownCloud group with a comma in the group name causes ownCloud to
treat the group as two groups.


\subsection{Hebrew File Names Too Large on Windows}
\label{release_notes:hebrew-file-names-too-large-on-windows}
On Windows servers Hebrew file names grow to five times their original size
after being translated to Unicode.


\subsection{Google Drive Large Files Fail with 500 Error}
\label{release_notes:google-drive-large-files-fail-with-500-error}
Google Drive tries to download the entire file into memory, then write it to a
temp file, and then stream it to the client, so very large file downloads from
Google Drive may fail with a 500 internal server error.


\subsection{Encrypting Large Numbers of Files}
\label{release_notes:encrypting-large-numbers-of-files}
When you activate the Encryption app on a running server that has large numbers
of files, it is possible that you will experience timeouts. It is best to
activate encryption at installation, before accumulating large numbers of files
on your ownCloud server.


\section{Enterprise 8.0 Only}
\label{release_notes:enterprise-8-0-only}

\subsection{Sharepoint Drive SSL Not Verified}
\label{release_notes:sharepoint-drive-ssl-not-verified}
The SharePoint Drive app does not verify the SSL certificate of the SharePoint
server or the ownCloud server, as it is expected that both devices are in the
same trusted environment.


\subsection{No Federated Cloud Sharing with Shibboleth}
\label{release_notes:no-federated-cloud-sharing-with-shibboleth}
Federated Cloud Sharing (formerly Server-to-Server file sharing)does not work
with Shibboleth .


\subsection{Direct Uploads to SWIFT do not Appear in ownCloud}
\label{release_notes:direct-uploads-to-swift-do-not-appear-in-owncloud}
When files are uploaded directly to a SWIFT share mounted as external storage
in ownCloud, the files do not appear in ownCloud. However, files uploaded to
the SWIFT mount through ownCloud are listed correctly in both locations.


\subsection{SWIFT Objectstore Incompatible with Encryption App}
\label{release_notes:swift-objectstore-incompatible-with-encryption-app}
The current SWIFT implementation is incompatible with any app that uses direct
file I/O and circumvents the ownCloud virtual filesystem. Using the Encryption
app on a SWIFT object store incurs twice as many HTTP requests and increases
latency significantly.


\subsection{App Store is Back}
\label{release_notes:app-store-is-back}
The ownCloud App Store has been re-enabled in oC 8. Note that third-party apps
are not supported.


\section{ownCloud 7 Release Notes}
\label{release_notes:owncloud-7-release-notes}

\subsection{Manual LDAP Port Configuration}
\label{release_notes:id1}
When you are configuring the LDAP user and group backend application, ownCloud
may not auto-detect the LDAP server's port number, so you will need to enter it
manually.


\subsection{LDAP Search Performance Improved}
\label{release_notes:ldap-search-performance-improved}
Prior to 7.0.4, LDAP searches were substring-based and would match search
attributes if the substring occurred anywhere in the attribute value. Rather,
searches are performed on beginning attributes. With 7.0.4, searches will match
at the beginning of the attribute value only. This provides better performance
and a better user experience.

Substring searches can still be performed by prepending the search term with
``*''.For example, a search for \code{te} will find Terri, but not Nate:

\begin{Verbatim}[commandchars=\\\{\}]
occ ldap:search \PYGZdq{}te\PYGZdq{}
\end{Verbatim}

If you want to broaden the search to include
Nate, then search for \code{*te}:

\begin{Verbatim}[commandchars=\\\{\}]
occ ldap:search \PYGZdq{}*te\PYGZdq{}
\end{Verbatim}

Refine searches by adjusting the \code{User Search Attributes} field of the
Advanced tab in your LDAP configuration on the Admin page. For example, if your
search attributes are \code{givenName} and \code{sn} you can find users by first name
+ last name very quickly. For example, you'll find Terri Hanson by searching for
\code{te ha}. Trailing whitespaces are ignored.


\subsection{Protecting ownCloud on IIS from Data Loss}
\label{release_notes:protecting-owncloud-on-iis-from-data-loss}
Under certain circumstances, running your ownCloud server on IIS could be at
risk of data loss. To prevent this, follow these steps.
\begin{itemize}
\item {} 
In your ownCloud server configuration file, \code{owncloud\textbackslash{}config\textbackslash{}config.php}, set
\code{config\_is\_read\_only} to true.

\item {} 
Set the \code{config.php} file to read-only.

\item {} 
When you make server updates \code{config.php} must be made writeable. When your
updates are completed re-set it to read-only.

\end{itemize}


\subsection{Antivirus App Modes}
\label{release_notes:antivirus-app-modes}
The Antivirus App offers three modes for running the ClamAV anti-virus scanner:
as a daemon on the ownCloud server, a daemon on a remote server, or an
executable mode that calls \code{clamscan} on the local server. We recommend using
one of the daemon modes, as they are the most reliable.


\subsection{``Enable Only for Specific Groups'' Fails}
\label{release_notes:enable-only-for-specific-groups-fails}
Some ownCloud applications have the option to be enabled only for certain
groups. However, when you select specific groups they do not get access to the
app.


\subsection{Changes to File Previews}
\label{release_notes:changes-to-file-previews}
For security and performance reasons, file previews are available only for
image files, covers of MP3 files, and text files, and have been disabled for
all other filetypes. Files without previews are represented by generic icons
according to their file types.


\subsection{4GB Limit on SFTP Transfers}
\label{release_notes:gb-limit-on-sftp-transfers}
Because of limitations in \code{phpseclib}, you cannot upload files larger than
4GB over SFTP.


\subsection{``Not Enough Space Available'' on File Upload}
\label{release_notes:not-enough-space-available-on-file-upload}
Setting user quotas to \code{unlimited} on an ownCloud installation that has
unreliable free disk space reporting-- for example, on a shared hosting
provider-- may cause file uploads to fail with a ``Not Enough Space Available''
error. A workaround is to set file quotas for all users instead of
\code{unlimited}.


\subsection{No More Expiration Date On Local Shares}
\label{release_notes:no-more-expiration-date-on-local-shares}
In older versions of ownCloud, you could set an expiration date on both local
and public shares. Now you can set an expiration date only on public shares,
and
local shares do not expire when public shares expire.


\subsection{Zero Quota Not Read-Only}
\label{release_notes:zero-quota-not-read-only}
Setting a user's storage quota should be the equivalent of read-only, however,
users can
still create empty files.


\section{Enterprise 7 Only}
\label{release_notes:enterprise-7-only}

\subsection{No Federated Cloud Sharing with Shibboleth}
\label{release_notes:id2}
Federated Cloud Sharing (formerly Server-to-Server file sharing) does not work
with Shibboleth .


\subsection{Windows Network Drive}
\label{release_notes:windows-network-drive}
Windows Network Drive runs only on Linux servers because it requires the Samba
client, which is included in all Linux distributions.

\code{php5-libsmbclient} is also required, and there may be issues with older
versions of \code{libsmbclient}; see Using External Storage \textgreater{} Installing and
Configuring the Windows Network Drive App in the Enterprise Admin manual for
more information.

By default CentOS has activated SELinux, and the \code{httpd} process can not make
outgoing network connections. This will cause problems with curl, ldap and samba
libraries. Again, see Using External Storage \textgreater{} Installing and Configuring the
Windows Network Drive App in the Enterprise Admin manual for instructions.


\subsection{Sharepoint Drive SSL}
\label{release_notes:sharepoint-drive-ssl}
The SharePoint Drive app does not verify the SSL certificate of the SharePoint
server or the ownCloud server, as it is expected that both devices are in the
same trusted environment.


\subsection{Shibboleth and WebDAV Incompatible}
\label{release_notes:shibboleth-and-webdav-incompatible}
Shibboleth and standard WebDAV are incompatible, and cannot be used together in
ownCloud. If Shibboleth is enabled, the ownCloud client uses an extended WebDAV
protocol


\subsection{No SQLite}
\label{release_notes:no-sqlite}
SQLite is no longer an installation option for ownCloud Enterprise Edition, as
it not suitable for multiple-user installations or managing large numbers of
files.


\subsection{No App Store}
\label{release_notes:no-app-store}
The App Store is disabled for the Enterprise Edition.


\subsection{LDAP Home Connector Linux Only}
\label{release_notes:ldap-home-connector-linux-only}
The LDAP Home Connector application requires Linux (with MySQL, MariaDB,
or PostgreSQL) to operate correctly.


\chapter{What's New for Admins in ownCloud 9.2}
\label{whats_new_admin::doc}\label{whats_new_admin:what-s-new-for-admins-in-owncloud-version}
See the \href{https://github.com/owncloud/core/wiki/ownCloud-9.2-Features}{ownCloud 9.2 Features page} on Github for a
comprehensive list of new features and updates.


\chapter{Installation}
\label{installation/index:installation}\label{installation/index::doc}

\section{System Requirements}
\label{installation/system_requirements::doc}\label{installation/system_requirements:system-requirements}

\subsection{Memory}
\label{installation/system_requirements:memory}
Memory requirements for running an ownCloud server are greatly variable,
depending on the numbers of users and files, and volume of server activity.
ownCloud needs a minimum of 128MB RAM, and we recommend a minimum of 512MB.


\subsection{Recommended Setup for Running ownCloud}
\label{installation/system_requirements:recommended-setup-for-running-owncloud}
For best performance, stability, support, and full functionality we recommend:
\begin{itemize}
\item {} 
Ubuntu 16.04

\item {} 
MySQL/MariaDB

\item {} 
PHP 5.6+ and 7.0+

\item {} 
Apache 2.4 with mod\_php

\end{itemize}


\subsection{Supported Platforms}
\label{installation/system_requirements:supported-platforms}\begin{itemize}
\item {} 
Server: Linux (Debian 7 and 8, SUSE Linux Enterprise Server 12 and 12 SP1, Red Hat Enterprise Linux/Centos 6.5 and 7 (7 is 64-bit only), Ubuntu 14.04 LTS, 16.04 LTS)

\item {} 
Web server: Apache 2.4 with mod\_php

\item {} 
Databases: MySQL/MariaDB 5.5+; Oracle 11g (ownCloud Enterprise edition only); PostgreSQL

\item {} 
PHP 5.6+ required

\item {} 
Hypervisors: Hyper-V, VMware ESX, Xen, KVM

\item {} 
Desktop: Windows 7+, Mac OS X 10.7+ (64-bit
only), Linux (CentOS 6.5, 7 (7 is 64-bit only), Ubuntu 12.04+, Fedora 20+, openSUSE 12.3+, Debian 7 \& 8).

\item {} 
Mobile apps: iOS 7+, Android 4+

\item {} 
Web browser: IE11+ (except Compatibility Mode), Firefox 14+, Chrome 18+,
Safari 5+

\end{itemize}

See {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}} for minimum software versions for installing
ownCloud.


\subsection{Database Requirements for MySQL / MariaDB}
\label{installation/system_requirements:database-requirements-for-mysql-mariadb}
The following is currently required if you're running ownCloud together with a MySQL / MariaDB database:
\begin{itemize}
\item {} 
Disabled or BINLOG\_FORMAT = MIXED configured Binary Logging (See: {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}})

\item {} 
InnoDB storage engine (MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}})

\item {} 
``READ COMMITED'' transaction isolation level (See: {\hyperref[configuration_database/linux_database_configuration:db-transaction-label]{\emph{MySQL / MariaDB ``READ COMMITED'' transaction isolation level}}})

\end{itemize}


\section{ownCloud Deployment Recommendations}
\label{installation/deployment_recommendations::doc}\label{installation/deployment_recommendations:owncloud-deployment-recommendations}
What is the best way to install and maintain ownCloud? The answer to that is
\emph{``it depends''} because every ownCloud customer has their own
particular needs and IT infrastructure. ownCloud and the LAMP stack are
highly-configurable, so we will present three typical scenarios and make
best-practice recommendations for both software and hardware.


\subsection{General Recommendations}
\label{installation/deployment_recommendations:general-recommendations}
\begin{notice}{note}{Note:}
Whatever the size of your organization, always keep one thing in mind:
the amount of data stored in ownCloud will only grow. Plan ahead.
\end{notice}

Consider setting up a scale-out deployment, or using Federated Cloud Sharing to
keep individual ownCloud instances to a manageable size.
\begin{itemize}
\item {} 
Operating system: Linux.

\item {} 
Web server: Apache 2.4.

\item {} 
Database: MySQL/MariaDB with InnoDB storage engine (MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}})

\item {} 
PHP 5.6+.

\end{itemize}


\subsection{Small Workgroups or Departments}
\label{installation/deployment_recommendations:small-workgroups-or-departments}\begin{itemize}
\item {} \begin{description}
\item[{Number of users}] \leavevmode
Up to 150 users.

\end{description}

\item {} \begin{description}
\item[{Storage size}] \leavevmode
100 GB to 10TB.

\end{description}

\item {} \begin{description}
\item[{High availability level}] \leavevmode
Zero-downtime backups via Btrfs snapshots, component failure leads to
interruption of service. Alternate backup scheme on other filesystems:
nightly backups with service interruption.

\end{description}

\end{itemize}


\subsubsection{Recommended System Requirements}
\label{installation/deployment_recommendations:recommended-system-requirements}
One machine running the application server, Web server, database server and
local storage.

Authentication via an existing LDAP or Active Directory server.
\begin{figure}[htbp]
\centering

\includegraphics{deprecs-1.png}
\end{figure}
\begin{itemize}
\item {} \begin{description}
\item[{Components}] \leavevmode
One server with at least 2 CPU cores, 16GB RAM, local storage as needed.

\end{description}

\item {} \begin{description}
\item[{Operating system}] \leavevmode
Enterprise-grade Linux distribution with full support from OS vendor. We
recommend Red Hat Enterprise Linux or SUSE Linux Enterprise Server 12.

\end{description}

\item {} \begin{description}
\item[{SSL Configuration}] \leavevmode
The SSL termination is done in Apache. A standard SSL certificate is
needed, installed according to the Apache documentation.

\end{description}

\item {} \begin{description}
\item[{Load Balancer}] \leavevmode
None.

\end{description}

\item {} \begin{description}
\item[{Database}] \leavevmode
MySQL, MariaDB or PostgreSQL. We currently recommend MySQL / MariaDB, as our
customers have had good experiences when moving to a Galera cluster to
scale the DB. (InnoDB storage engine, MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}})

\end{description}

\item {} \begin{description}
\item[{Backup}] \leavevmode
Install owncloud, ownCloud data directory and database on Btrfs filesystem.
Make regular snapshots at desired intervals for zero downtime backups.
Mount DB partitions with the ``nodatacow'' option to prevent fragmentation.

Alternatively, make nightly backups with service interruption:
\begin{itemize}
\item {} 
Shut down Apache.

\item {} 
Create database dump.

\item {} 
Push data directory to backup.

\item {} 
Push database dump to backup.

\item {} 
Start Apache.

\end{itemize}

Then optionally rsync to a backup storage or tape backup. (See the
\href{https://doc.owncloud.org/server/9.0/admin\_manual/maintenance/index.html}{Maintenance} section of the Administration manual for tips on backups
and restores.)

\end{description}

\item {} \begin{description}
\item[{Authentication}] \leavevmode
User authentication via one or several LDAP or Active Directory servers. (See
\href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_user/user\_auth\_ldap.html}{User Authentication with LDAP} for information on configuring ownCloud to
use LDAP and AD.)

\end{description}

\item {} \begin{description}
\item[{Session Management}] \leavevmode
Local session management on the application server. PHP sessions are stored
in a tmpfs mounted at the operating system-specific session storage
location. You can find out where that is by running \code{grep -R
'session.save\_path' /etc/php5} and then add it to the \code{/etc/fstab} file,
for example:
\code{echo "tmpfs /var/lib/php5/pool-www tmpfs defaults,noatime,mode=1777 0 0"
\textgreater{}\textgreater{} /etc/fstab}.

\end{description}

\item {} \begin{description}
\item[{Memory Caching}] \leavevmode
A memcache speeds up server performance, and ownCloud supports four
memcaches; refer to \href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_server/caching\_configuration.html}{Configuring Memory Caching} for information on
selecting and configuring a memcache.

\end{description}

\item {} \begin{description}
\item[{Storage}] \leavevmode
Local storage.

\end{description}

\item {} \begin{description}
\item[{ownCloud Edition}] \leavevmode
Standard Edition. (See \href{https://owncloud.com/owncloud-server-or-enterprise-edition/}{ownCloud Server or Enterprise Edition} for
comparisons of the ownCloud editions.)

\end{description}

\end{itemize}


\subsection{Mid-sized Enterprises}
\label{installation/deployment_recommendations:mid-sized-enterprises}\begin{itemize}
\item {} \begin{description}
\item[{Number of users}] \leavevmode
150 to 1,000 users.

\end{description}

\item {} \begin{description}
\item[{Storage size}] \leavevmode
Up to 200TB.

\end{description}

\item {} \begin{description}
\item[{High availability level}] \leavevmode
Every component is fully redundant and can fail without service interruption.
Backups without service interruption

\end{description}

\end{itemize}


\subsubsection{Recommended System Requirements}
\label{installation/deployment_recommendations:id1}
2 to 4 application servers.

A cluster of two database servers.

Storage on an NFS server.

Authentication via an existing LDAP or Active Directory server.
\begin{figure}[htbp]
\centering

\includegraphics{deprecs-2.png}
\end{figure}
\begin{itemize}
\item {} \begin{description}
\item[{Components}] \leavevmode\begin{itemize}
\item {} 
2 to 4 application servers with 4 sockets and 32GB RAM.

\item {} 
2 DB servers with 4 sockets and 64GB RAM.

\item {} 
1 HAproxy load balancer with 2 sockets and 16GB RAM.

\item {} 
NFS storage server as needed.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Operating system}] \leavevmode
Enterprise grade Linux distribution with full support from OS vendor. Red
Hat Enterprise Linux or SUSE Linux Enterprise Server 12 are recommended.

\end{description}

\item {} \begin{description}
\item[{SSL Configuration}] \leavevmode
The SSL termination is done in the HAProxy load balancer. A standard SSL
certificate is needed, installed according to the \href{http://www.haproxy.org/\#docs}{HAProxy documentation}.

\end{description}

\item {} \begin{description}
\item[{Load Balancer}] \leavevmode
HAProxy running on a dedicated server in front of the application servers.
Sticky session needs to be used because of local session management on the
application servers.

\end{description}

\item {} \begin{description}
\item[{Database}] \leavevmode
MySQL/MariaDB Galera cluster with master-master replication. (InnoDB storage engine, MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}})

\end{description}

\item {} \begin{description}
\item[{Backup}] \leavevmode
Minimum daily backup without downtime. All MySQL/MariaDB statements should
be replicated to a backup MySQL/MariaDB slave instance.
\begin{itemize}
\item {} 
Create a snapshot on the NFS storage server.

\item {} 
At the same time stop the MySQL replication.

\item {} 
Create a MySQL dump of the backup slave.

\item {} 
Push the NFS snapshot to the backup.

\item {} 
Push the MySQL dump to the backup.

\item {} 
Delete the NFS snapshot.

\item {} 
Restart MySQL replication.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Authentication}] \leavevmode
User authentication via one or several LDAP or Active Directory servers.
(See \href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_user/user\_auth\_ldap.html}{User Authentication with LDAP}  for information on configuring
ownCloud to use LDAP and AD.)

\end{description}

\item {} \begin{description}
\item[{LDAP}] \leavevmode
Read-only slaves should be deployed on every application server for
optimal scalability

\end{description}

\item {} \begin{description}
\item[{Session Management}] \leavevmode
Session management on the application server. PHP sessions are stored
in a tmpfs mounted at the operating system-specific session storage
location. You can find out where that is by running \code{grep -R
'session.save\_path' /etc/php5} and then add it to the \code{/etc/fstab} file,
for example:
\code{echo "tmpfs /var/lib/php5/pool-www tmpfs defaults,noatime,mode=1777 0 0"
\textgreater{}\textgreater{} /etc/fstab}.

\end{description}

\item {} \begin{description}
\item[{Memory Caching}] \leavevmode
A memcache speeds up server performance, and ownCloud supports four
memcaches; refer to \href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_server/caching\_configuration.html}{Configuring Memory Caching} for information on
selecting and configuring a memcache.

\end{description}

\item {} \begin{description}
\item[{Storage}] \leavevmode
Use an off-the-shelf NFS solution, such as IBM Elastic Storage or RedHat
Ceph.

\end{description}

\item {} \begin{description}
\item[{ownCloud Edition}] \leavevmode
Enterprise Edition. (See \href{https://owncloud.com/owncloud-server-or-enterprise-edition/}{ownCloud Server or Enterprise Edition} for
comparisons of the ownCloud editions.)

\end{description}

\end{itemize}


\subsection{Large Enterprises and Service Providers}
\label{installation/deployment_recommendations:large-enterprises-and-service-providers}\begin{itemize}
\item {} \begin{description}
\item[{Number of users}] \leavevmode
5,000 to \textgreater{}100,000 users.

\end{description}

\item {} \begin{description}
\item[{Storage size}] \leavevmode
Up to 1 petabyte.

\end{description}

\item {} \begin{description}
\item[{High availabily level}] \leavevmode
Every component is fully redundant and can fail without service interruption.
Backups without service interruption

\end{description}

\end{itemize}


\subsubsection{Recommended System Requirements}
\label{installation/deployment_recommendations:id2}
4 to 20 application/Web servers.

A cluster of two or more database servers.

Storage is an NFS server, or an object store that is S3 compatible.

Cloud federation for a distributed setup over several data centers.

Authentication via an existing LDAP or Active Directory server, or SAML.
\begin{figure}[htbp]
\centering

\scalebox{0.600000}{\includegraphics{deprecs-3.png}}
\end{figure}
\begin{itemize}
\item {} \begin{description}
\item[{Components}] \leavevmode\begin{itemize}
\item {} 
4 to 20 application servers with 4 sockets and 64GB  RAM.

\item {} 
4 DB servers with 4 sockets and 128GB RAM

\item {} 
2 Hardware load balancer, for example BIG IP from F5

\item {} 
NFS storage server as needed.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Operating system}] \leavevmode
RHEL 7 with latest service packs.

\end{description}

\item {} \begin{description}
\item[{SSL Configuration}] \leavevmode
The SSL termination is done in the load balancer. A standard SSL certificate
is needed, installed according to the load balancer documentation.

\end{description}

\item {} \begin{description}
\item[{Load Balancer}] \leavevmode
A redundant hardware load-balancer with heartbeat, for example \href{https://f5.com/products/big-ip/}{F5 Big-IP}.
This runs two load balancers in front of the application servers.

\end{description}

\item {} \begin{description}
\item[{Database}] \leavevmode
MySQL/MariaDB Galera Cluster with 4x master -- master replication. (InnoDB storage engine, MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}})

\end{description}

\item {} \begin{description}
\item[{Backup}] \leavevmode
Minimum daily backup without downtime. All MySQL/MariaDB statements should
be replicated to a backup MySQL/MariaDB slave instance.
\begin{itemize}
\item {} 
Create a snapshot on the NFS storage server.

\item {} 
At the same time stop the MySQL replication.

\item {} 
Create a MySQL dump of the backup slave.

\item {} 
Push the NFS snapshot to the backup.

\item {} 
Push the MySQL dump to the backup.

\item {} 
Delete the NFS snapshot.

\item {} 
Restart MySQL replication.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Authentication}] \leavevmode
User authentication via one or several LDAP or Active Directory
servers, or SAML/Shibboleth. (See \href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_user/user\_auth\_ldap.html}{User Authentication with LDAP} and
\href{https://doc.owncloud.org/server/9.0/admin\_manual/enterprise\_user\_management/user\_auth\_shibboleth.html}{Shibboleth Integration}.)

\end{description}

\item {} \begin{description}
\item[{LDAP}] \leavevmode
Read-only slaves should be deployed on every application server for
optimal scalability.

\end{description}

\item {} \begin{description}
\item[{Session Management}] \leavevmode
Redis should be used for the session management storage.

\end{description}

\item {} \begin{description}
\item[{Caching}] \leavevmode
Redis for distributed in-memory caching (see \href{https://doc.owncloud.org/server/9.0/admin\_manual/configuration\_server/caching\_configuration.html}{Configuring Memory
Caching}).

\end{description}

\item {} \begin{description}
\item[{Storage}] \leavevmode
An off-the-shelf NFS solution should be used. Examples are IBM Elastic
Storage or RedHAT Ceph. Optionally, an S3 compatible object store can also
be used.

\end{description}

\item {} \begin{description}
\item[{ownCloud Edition}] \leavevmode
Enterprise Edition. (See \href{https://owncloud.com/owncloud-server-or-enterprise-edition/}{ownCloud Server or Enterprise Edition} for
comparisons of the ownCloud editions.)

\end{description}

\end{itemize}


\subsection{Hardware Considerations}
\label{installation/deployment_recommendations:hardware-considerations}\begin{itemize}
\item {} 
Solid-state drives (SSDs) for I/O.

\item {} 
Separate hard disks for storage and database, SSDs for databases.

\item {} 
Multiple network interfaces to distribute server synchronisation and backend
traffic across multiple subnets.

\end{itemize}


\subsubsection{Single Machine / Scale-Up Deployment}
\label{installation/deployment_recommendations:single-machine-scale-up-deployment}
The single-machine deployment is widely used in the community.

Pros:
\begin{itemize}
\item {} 
Easy setup: no session storage daemon, use tmpfs and memory caching to
enhance performance, local storage.

\item {} 
No network latency to consider.

\item {} 
To scale buy a bigger CPU, more memory, larger hard drive, or additional hard
drives.

\end{itemize}

Cons:
\begin{itemize}
\item {} 
Fewer high availability options.

\item {} 
The amount of data in ownCloud tends to continually grow. Eventually a
single machine will not scale; I/O performance decreases and becomes a
bottleneck with multiple up- and downloads, even with solid-state drives.

\end{itemize}


\subsubsection{Scale-Out Deployment}
\label{installation/deployment_recommendations:scale-out-deployment}
Provider setup:
\begin{itemize}
\item {} 
DNS round robin to HAProxy servers (2-n, SSL offloading, cache static
resources)

\item {} 
Least load to Apache servers (2-n)

\item {} 
Memcached/Redis for shared session storage (2-n)

\item {} 
Database cluster with single Master, multiple slaves and proxy to split
requests accordingly (2-n)

\item {} 
GPFS or Ceph via phprados (2-n, 3 to be safe, Ceph 10+ nodes to see speed
benefits under load)

\end{itemize}

Pros:
\begin{itemize}
\item {} 
Components can be scaled as needed.

\item {} 
High availability.

\item {} 
Test migrations easier.

\end{itemize}

Cons:
\begin{itemize}
\item {} 
More complicated to setup.

\item {} 
Network becomes the bottleneck (10GB Ethernet recommended).

\item {} 
Currently DB filecache table will grow rapidly, making migrations painful in
case the table is altered.

\end{itemize}


\subsubsection{What About Nginx / PHP-FPM?}
\label{installation/deployment_recommendations:what-about-nginx-php-fpm}
Could be used instead of HAproxy as the load balancer.
But on uploads stores the whole file on disk before handing it over to PHP-FPM.


\subsubsection{A Single Master DB is Single Point of Failure, Does Not Scale}
\label{installation/deployment_recommendations:a-single-master-db-is-single-point-of-failure-does-not-scale}
When master fails another slave can become master. However, the increased
complexity carries some risks: Multi-master has the risk of split brain, and
deadlocks. ownCloud tries to solve the problem of deadlocks with high-level
file locking.


\subsection{Software Considerations}
\label{installation/deployment_recommendations:software-considerations}

\subsubsection{Operating System}
\label{installation/deployment_recommendations:operating-system}
We are dependent on distributions that offer an easy way to install the various
components in up-to-date versions. ownCloud has a partnership with RedHat
and SUSE for customers who need commercial support. Canonical, the parent
company of Ubuntu Linux, also offers enterprise service and support. Debian
and Ubuntu are free of cost, and include newer software packages. CentOS is the
community-supported free-of-cost Red Hat Enterprise Linux clone. openSUSE is
community-supported, and includes many of the same system administration tools
as SUSE Linux Enterprise Server.


\subsubsection{Web server}
\label{installation/deployment_recommendations:web-server}
Taking Apache and Nginx as the contenders, Apache with mod\_php is currently the
best option, as Nginx does not support all features necessary for enterprise
deployments. Mod\_php is recommended instead of PHP\_FPM, because in scale-out
deployments separate PHP pools are simply not necessary.


\subsubsection{Relational Database}
\label{installation/deployment_recommendations:relational-database}
More often than not the customer already has an opinion on what database to
use. In general, the recommendation is to use what their database administrator
is most familiar with. Taking into account what we are seeing at customer
deployments, we recommend MySQL/MariaDB in a master-slave deployment with a
MySQL proxy in front of them to send updates to master, and selects to the
slave(s).

The second best option is PostgreSQL (alter table does not lock table, which
makes migration less painful) although we have yet to find a customer who uses a
master-slave setup.

What about the other DBMS?
\begin{itemize}
\item {} 
Sqlite is adequate for simple testing, and for low-load single-user
deployments. It is not adequate for production systems.

\item {} 
Microsoft SQL Server is not a supported option.

\item {} 
Oracle DB is the de facto standard at large enterprises and is fully
supported with ownCloud Enterprise Edition only.

\end{itemize}


\subsection{File Storage}
\label{installation/deployment_recommendations:file-storage}
While many customers are starting with NFS, sooner or later that requires scale-out storage. Currently the options are GPFS or GlusterFS, or an object store protocol like S3 (supported in Enterprise Edition only) or Swift. S3 also allows access to Ceph Storage.


\subsection{Session Storage}
\label{installation/deployment_recommendations:session-storage}\begin{itemize}
\item {} 
Redis: provides persistence, nice graphical inspection tools available,
supports ownCloud high-level file locking.

\item {} 
If Shibboleth is a requirement you must use Memcached, and it can also be
used to scale-out shibd session storage (see \href{https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPStorageService\#NativeSPStorageService-MemcacheStorageService}{Memcache StorageService}).

\end{itemize}


\subsection{References}
\label{installation/deployment_recommendations:references}
\href{http://www.severalnines.com/blog/become-mysql-dba-blog-series-database-high-availability}{Database High Availability}

\href{http://blog.bitnami.com/2014/06/performance-enhacements-for-apache-and.html}{Performance enhancements for Apache and PHP}

\href{https://www.digitalocean.com/community/tutorials/how-to-set-up-a-redis-server-as-a-session-handler-for-php-on-ubuntu-14-04}{How to Set Up a Redis Server as a Session Handler for PHP on Ubuntu 14.04}


\section{Preferred Linux Installation Method}
\label{installation/linux_installation:preferred-linux-installation-method}\label{installation/linux_installation:haproxy-documentation}\label{installation/linux_installation::doc}
For production environments, we recommend the installation from the tar archive.
This applies in particular to scenarios, where the Web server, storage and database are on separate machines.
In this constellation, all dependencies and requirements are managed by the package management
of your operating system, while the ownCloud code itself is maintained in a sequence of simple steps
as documented in our instructions for the {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}} and the {\hyperref[maintenance/manual_upgrade::doc]{\emph{Manual ownCloud Upgrade}}}.

The package installation is for single-server setups only.


\subsection{Changes in ownCloud 9}
\label{installation/linux_installation:changes-in-owncloud-9}
Linux distribution packages (from \href{https://download.owncloud.org/download/repositories/9.2/owncloud/}{Open Build Service}) have been divided into
multiple packages for ownCloud 9: \code{owncloud}, \code{owncloud-deps} and \code{owncloud-files}.

Install the metapackage \code{owncloud} to get a complete installation with all dependencies.

The \code{owncloud-files} package installs only ownCloud, without Apache, database,
or PHP dependencies.

The \code{owncloud-deps} packages install all dependencies: Apache, PHP, and MySQL.
\code{owncloud-deps} is not intended to be installed by itself, but rather is
pulled in by the metapackage \code{owncloud}.

\code{owncloud-files} is available for the following distributions, but not
\code{owncloud-deps}.

You will have to install your own LAMP stack first. This
allows you to create your own custom LAMP stack without dependency conflicts
with the ownCloud package. Browse
\href{http://download.owncloud.org/download/repositories/9.1/owncloud/}{http://download.owncloud.org/download/repositories/9.1/owncloud/} to find
the \code{owncloud-files} package for your distro:
\begin{itemize}
\item {} 
Ubuntu 14.04, 16.04

\item {} 
Debian 7, 8

\item {} 
RHEL 6, 7

\item {} 
CentOS 6 SCL, 7

\item {} 
SLES 12, 12 SP1

\item {} 
openSUSE 13.2, Leap 42.1

\end{itemize}

ownCloud packages with dependencies are available for the following Linux distributions:
\begin{itemize}
\item {} 
Ubuntu 14.04, 16.04

\item {} 
Debian 8

\item {} 
RHEL 7

\item {} 
CentOS 7

\item {} 
SLES 12

\item {} 
openSUSE 13.2, Leap 42.1

\end{itemize}

Repositories for Fedora, openSUSE Tumbleweed and Ubuntu 15.04 were dropped. If
you use Fedora, use the tar archive with your own LAMP stack. openSUSE
users can rely on LEAP packages for Tumbleweed.

Follow the instructions on the download page to install ownCloud. Then run the
Installation Wizard to complete your installation. (see
{\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}}).

\begin{notice}{warning}{Warning:}
Do not move the folders provided by these packages after the
installation, as this will break updates.
\end{notice}

See the {\hyperref[installation/system_requirements::doc]{\emph{System Requirements}}} for the recommended ownCloud setup and
supported platforms.


\subsection{Repos: Stable or Major Release?}
\label{installation/linux_installation:repos-stable-or-major-release}
You may use either of the following repositories for ownCloud 9.1:
\begin{itemize}
\item {} 
\href{https://download.owncloud.org/download/repositories/stable/owncloud/}{https://download.owncloud.org/download/repositories/stable/owncloud/}

\item {} 
\href{https://download.owncloud.org/download/repositories/9.1/owncloud/}{https://download.owncloud.org/download/repositories/9.1/owncloud/}

\end{itemize}

When you use the Stable repo, you never have to change it as it always tracks
the current stable ownCloud version through all major releases: 8.2, 9.0,
and so on. (Major releases are indicated by the second number, so 8.0, 8.1,
8.2, and 9.0 were all major releases.)

If you wish to track a specific major release, such as 9.0 or 9.1, then use
that repo. That way you won't accidentally find yourself looking at an upgrade
to the next major release before you're ready.


\subsection{Installing ownCloud Enterprise Edition}
\label{installation/linux_installation:installing-owncloud-enterprise-edition}
See {\hyperref[enterprise_installation/linux_installation::doc]{\emph{Installing \& Upgrading ownCloud Enterprise Edition}}} for instructions on
installing ownCloud Enterprise edition.


\subsection{Downgrading Not Supported}
\label{installation/linux_installation:downgrading-not-supported}
Downgrading is not supported and risks corrupting your data! If you want to
revert to an older ownCloud version, install it from scratch and then restore
your data from backup. Before doing this, file a support ticket (if you have
paid support) or ask for help in the ownCloud forums to see if your issue can be
resolved without downgrading.


\subsection{BINLOG\_FORMAT = STATEMENT}
\label{installation/linux_installation:binlog-format-statement}
If your ownCloud installation fails and you see this in your ownCloud log:

\begin{Verbatim}[commandchars=\\\{\}]
An unhandled exception has been thrown: exception ‘PDOException’ with message
\PYGZsq{}SQLSTATE[HY000]: General error: 1665 Cannot execute statement: impossible to
write to binary log since BINLOG\PYGZus{}FORMAT = STATEMENT and at least one table
uses a storage engine limited to row\PYGZhy{}based logging. InnoDB is limited to
row\PYGZhy{}logging when transaction isolation level is READ COMMITTED or READ
UNCOMMITTED.\PYGZsq{}
\end{Verbatim}

See {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}}.


\subsection{Additional Installation Guides and Notes}
\label{installation/linux_installation:additional-installation-guides-and-notes}
See {\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}} for important steps such as choosing the best
database and setting correct directory permissions.

See {\hyperref[installation/selinux_configuration::doc]{\emph{SELinux Configuration}}} for a suggested configuration for
SELinux-enabled distributions such as Fedora and CentOS.

If your distribution is not listed, your Linux distribution may maintain its
own
ownCloud packages, or you may prefer to install from source code (see
{\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}}).

\textbf{Archlinux:} The current \href{https://www.archlinux.org/packages/community/any/owncloud}{stable version} is in the
official community repository, and more packages are in
the \href{https://aur.archlinux.org/packages/?O=0\&K=owncloud}{Arch User Repository}.

\textbf{Mageia:} The \href{https://wiki.mageia.org/en/OwnCloud}{Mageia Wiki} has a good page on installing ownCloud from the
Mageia software repository.

\textbf{Running ownCloud in a subdirectory}: If you're running ownCloud in a
subdirectory and want to use CalDAV or CardDAV clients make sure you have
configured the correct {\hyperref[issues/general_troubleshooting:service-discovery-label]{\emph{Service discovery}}} URLs.

\textbf{Note for MySQL/MariaDB environments}: Please refer to {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}}
on how to correctly configure your environment if you have binary logging enabled.


\section{Installation Wizard}
\label{installation/installation_wizard:installation-wizard}\label{installation/installation_wizard:open-build-service}\label{installation/installation_wizard::doc}

\subsection{Quick Start}
\label{installation/installation_wizard:quick-start}
When ownCloud prerequisites are fulfilled and all ownCloud files are installed,
the last step to completing the installation is running the Installation
Wizard.
This is just three steps:
\begin{enumerate}
\item {} 
Point your Web browser to \code{http://localhost/owncloud}

\item {} 
Enter your desired administrator's username and password.

\item {} 
Click \textbf{Finish Setup}.

\end{enumerate}
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{install-wizard-a.png}}
\end{figure}

You're finished and can start using your new ownCloud server.

Of course, there is much more that you can do to set up your ownCloud server for
best performance and security. In the following sections we will cover important
installation and post-installation steps. Note that you must follow the
instructions in {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Permissions}}} in order
to use the {\hyperref[configuration_server/occ_command::doc]{\emph{occ Command}}}.
\begin{itemize}
\item {} 
{\hyperref[installation/installation_wizard:data-directory-location-label]{\emph{Data Directory Location}}}

\item {} 
{\hyperref[installation/installation_wizard:database-choice-label]{\emph{Database Choice}}}

\item {} 
{\hyperref[installation/installation_wizard:trusted-domains-label]{\emph{Trusted Domains}}}

\item {} 
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Permissions}}}

\end{itemize}


\subsection{Data Directory Location}
\label{installation/installation_wizard:data-directory-location}\label{installation/installation_wizard:data-directory-location-label}
Click \textbf{Storage and Database} to expose additional installation configuration
options for your ownCloud data directory and database.
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{install-wizard-a1.png}}
\end{figure}

You should locate your ownCloud data directory outside of your Web root if you
are using an HTTP server other than Apache, or you may wish to store your
ownCloud data in a different location for other reasons (e.g. on a storage
server). It is best to configure your data directory location at installation,
as it is difficult to move after installation. You may put it anywhere; in this
example is it located in \code{/var/oc\_data}. This directory must already exist,
and must be owned by your HTTP user (see
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}).


\subsection{Database Choice}
\label{installation/installation_wizard:database-choice-label}\label{installation/installation_wizard:database-choice}
When installing ownCloud Server \& ownCloud Enterprise editions the administrator
may choose one of 3 supported database products.


\subsubsection{SQLite}
\label{installation/installation_wizard:sqlite}
Is the default database for ownCloud Server, but is not available and not supported
for the ownCloud Enterprise edition.

SQLite will be installed by the ownCloud packages and all the necessary dependencies
will be satisfied.  See see {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}} for a detailed listing of
required and optional PHP modules.

If you used the packages to install ownCloud, you may ``Finish Setup'' with no
additional steps to configure ownCloud using the SQLite database for limited use.

Please note that SQLite is good only for testing and lightweight single user setups.
There is no client synchronization support.  Therefore, other devices will not be able
to synchronize with the data stored in an ownCloud SQLite database.


\subsubsection{MYSQL/MariaDB}
\label{installation/installation_wizard:mysql-mariadb}
Is the ownCloud recommended database. See {\hyperref[installation/system_requirements::doc]{\emph{MySQL/MariaDB}}}.
It may be used with either ownCloud Server or ownCloud Enterprise editions.
\begin{description}
\item[{First you should install the recommended MySQL/MariaDB database.  Use package:}] \leavevmode
\code{sudo apt-get install mariadb-server}

\end{description}

If you have an administrator login that has permissions to create and modify databases,
you may choose ``Storage \& Database''.  Then enter your database administrator name,
password and any name you want for your ownCloud database.

Otherwise, use these steps to create temporary database administrator account.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \code{sudo mysql -{-}user=root mysql}
\item[] 
\item[] \code{CREATE USER 'dbadmin'@'localhost' IDENTIFIED BY 'Apassword';}
\item[] \code{GRANT ALL PRIVILEGES ON *.* TO 'dbadmin'@'localhost' WITH GRANT OPTION;}
\item[] \code{FLUSH PRIVILEGES;}
\item[] 
\item[] \code{exit}
\end{DUlineblock}
\end{quote}


\subsubsection{PostgreSQL}
\label{installation/installation_wizard:postgresql}
Is also supported by ownCloud.
\begin{description}
\item[{To install PostgreSQL, use the apt-get (or other apt-driving) command:}] \leavevmode
\code{sudo apt-get install postgresql}

\item[{You may view more information about the PostgreSQL database system at:}] \leavevmode
\code{http://www.postgresql.org}

\end{description}

In order to allow ownCloud access to the database, create a known password for the
default user ``postgres'' added when the database is installed.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \code{sudo -i -u postgres psql}
\item[] 
\item[] \code{postgres=\# \textbackslash{}password}
\item[] \code{Enter new password:}
\item[] \code{Enter it again:}
\item[] \code{postgres=\# \textbackslash{}q}
\item[] 
\item[] \code{exit}
\end{DUlineblock}
\end{quote}


\subsubsection{Oracle11g}
\label{installation/installation_wizard:oracle11g}
Is only supported for the ownCloud Enterprise edition.


\subsubsection{Database Setup By ownCloud}
\label{installation/installation_wizard:database-setup-by-owncloud}
Your database and PHP connectors must be installed before you run the Installation Wizard
by clicking the ``Finish setup'' button.

After you enter your temporary or root administrator login for your database, the installer
creates a special database user with privileges limited to the ownCloud database. Then ownCloud
needs only this special ownCloud database user and drops the temporary or root database login.

This new user is named from your ownCloud admin user, with an {\color{red}\bfseries{}oc\_} prefix, and then given a
random password.  The ownCloud database user and password are written into config.ph:

\begin{DUlineblock}{0em}
\item[] For MySQL/MariaDB:
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] \code{'dbuser' =\textgreater{} 'oc\_dbadmin',}
\item[] \code{'dbpassword' =\textgreater{} 'pX65Ty5DrHQkYPE5HRsDvyFHlZZHcm',}
\end{DUlineblock}
\end{DUlineblock}

\begin{DUlineblock}{0em}
\item[] For PostgreSQL:
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] \code{'dbuser' =\textgreater{} 'oc\_postgres',}
\item[] \code{'dbpassword' =\textgreater{} 'pX65Ty5DrHQkYPE5HRsDvyFHlZZHcm',}
\end{DUlineblock}
\end{DUlineblock}

Click Finish Setup, and start using your new ownCloud server.
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{install-wizard-a2.png}}
\end{figure}

Now we will look at some important post-installation steps.


\subsection{Trusted Domains}
\label{installation/installation_wizard:trusted-domains-label}\label{installation/installation_wizard:trusted-domains}
All URLs used to access your ownCloud server must be whitelisted in your
\code{config.php} file, under the \code{trusted\_domains} setting. Users
are allowed to log into ownCloud only when they point their browsers to a
URL that is listed in the \code{trusted\_domains} setting. You may use IP addresses
and domain names. A typical configuration looks like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}trusted\PYGZus{}domains\PYGZsq{} =\PYGZgt{}
  array (
   0 =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
   1 =\PYGZgt{} \PYGZsq{}server1.example.com\PYGZsq{},
   2 =\PYGZgt{} \PYGZsq{}192.168.1.50\PYGZsq{},
),
\end{Verbatim}

The loopback address, \code{127.0.0.1}, is automatically whitelisted, so as long
as you have access to the physical server you can always log in. In the event
that a load balancer is in place there will be no issues as long as it sends
the correct X-Forwarded-Host header. When a user tries a URL that
is not whitelisted the following error appears:
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{install-wizard-a4.png}}
\end{figure}


\subsection{Setting Strong Directory Permissions}
\label{installation/installation_wizard:strong-perms-label}\label{installation/installation_wizard:setting-strong-directory-permissions}
For hardened security we recommend setting the permissions on your ownCloud
directories as strictly as possible, and for proper server operations. This
should be done immediately after the initial installation and before running the
setup. Your HTTP user must own the \code{config/}, \code{data/} and \code{apps/} directories
so that you can configure ownCloud, create, modify and delete your data files,
and install apps via the ownCloud Web interface.

You can find your HTTP user in your HTTP server configuration files. Or you can
use {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}} (Look for the \textbf{User/Group} line).
\begin{itemize}
\item {} 
The HTTP user and group in Debian/Ubuntu is \code{www-data}.

\item {} 
The HTTP user and group in Fedora/CentOS is \code{apache}.

\item {} 
The HTTP user and group in Arch Linux is \code{http}.

\item {} 
The HTTP user in openSUSE is \code{wwwrun}, and the HTTP group is \code{www}.

\end{itemize}

\begin{notice}{note}{Note:}
When using an NFS mount for the data directory, do not change its
ownership from the default. The simple act of mounting the drive will set
proper permissions for ownCloud to write to the directory. Changing
ownership as above could result in some issues if the NFS mount is
lost.
\end{notice}

The easy way to set the correct permissions is to copy and run this script.
Replace the \code{ocpath} variable with the path to your ownCloud directory, and
replace the \code{htuser} and \code{htgroup} variables with your HTTP user and group:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}!/bin/bash
ocpath=\PYGZsq{}/var/www/owncloud\PYGZsq{}
htuser=\PYGZsq{}www\PYGZhy{}data\PYGZsq{}
htgroup=\PYGZsq{}www\PYGZhy{}data\PYGZsq{}
rootuser=\PYGZsq{}root\PYGZsq{}

printf \PYGZdq{}Creating possible missing Directories\PYGZbs{}n\PYGZdq{}
mkdir \PYGZhy{}p \PYGZdl{}ocpath/data
mkdir \PYGZhy{}p \PYGZdl{}ocpath/assets
mkdir \PYGZhy{}p \PYGZdl{}ocpath/updater

printf \PYGZdq{}chmod Files and Directories\PYGZbs{}n\PYGZdq{}
find \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/ \PYGZhy{}type f \PYGZhy{}print0 \textbar{} xargs \PYGZhy{}0 chmod 0640
find \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/ \PYGZhy{}type d \PYGZhy{}print0 \textbar{} xargs \PYGZhy{}0 chmod 0750

printf \PYGZdq{}chown Directories\PYGZbs{}n\PYGZdq{}
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}rootuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/apps/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/assets/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/config/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/data/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/themes/
chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/updater/

chmod +x \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/occ

printf \PYGZdq{}chmod/chown .htaccess\PYGZbs{}n\PYGZdq{}
if [ \PYGZhy{}f \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/.htaccess ]
 then
  chmod 0644 \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/.htaccess
  chown \PYGZdl{}\PYGZob{}rootuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/.htaccess
fi
if [ \PYGZhy{}f \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/data/.htaccess ]
 then
  chmod 0644 \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/data/.htaccess
  chown \PYGZdl{}\PYGZob{}rootuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}/data/.htaccess
fi
\end{Verbatim}

If you have customized your ownCloud installation and your filepaths are
different than the standard installation, then modify this script accordingly.

This lists the recommended modes and ownership for your ownCloud directories
and files:
\begin{itemize}
\item {} 
All files should be read-write for the file owner, read-only for the
group owner, and zero for the world

\item {} 
All directories should be executable (because directories always need the
executable bit set), read-write for the directory owner, and read-only for
the group owner

\item {} 
The \code{apps/} directory should be owned by \code{{[}HTTP user{]}:{[}HTTP group{]}}

\item {} 
The \code{config/} directory should be owned by \code{{[}HTTP user{]}:{[}HTTP group{]}}

\item {} 
The \code{themes/} directory should be owned by \code{{[}HTTP user{]}:{[}HTTP group{]}}

\item {} 
The \code{assets/} directory should be owned by \code{{[}HTTP user{]}:{[}HTTP group{]}}

\item {} 
The \code{data/} directory should be owned by \code{{[}HTTP user{]}:{[}HTTP group{]}}

\item {} 
The \code{{[}ocpath{]}/.htaccess} file should be owned by \code{root:{[}HTTP group{]}}

\item {} 
The \code{data/.htaccess} file should be owned by \code{root:{[}HTTP group{]}}

\item {} 
Both \code{.htaccess} files are read-write file owner, read-only group and
world

\end{itemize}

These strong permissions prevent upgrading your ownCloud server;
see {\hyperref[maintenance/update:set-updating-permissions-label]{\emph{Setting Permissions for Updating}}} for a script to quickly change
permissions to allow upgrading.


\section{Installing ownCloud From the Command Line}
\label{installation/command_line_installation:installing-owncloud-from-the-command-line}\label{installation/command_line_installation::doc}
It is now possible to install ownCloud entirely from the command line. This is
convenient for scripted operations, headless servers, and sysadmins who prefer
the command line. There are three stages to installing ownCloud via the command
line:

1. Download and install the ownCloud code via your package manager, or download
and unpack the tarball in the appropriate directories. (See
{\hyperref[installation/linux_installation::doc]{\emph{Preferred Linux Installation Method}}} and {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}}.)

2. Change the ownership of your \code{owncloud} directory to your HTTP user, like
this example for Debian/Ubuntu. You must run \code{occ} as your HTTP user; see
{\hyperref[configuration_server/occ_command:http-user-label]{\emph{Run occ As Your HTTP User}}}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo chown \PYGZhy{}R www\PYGZhy{}data:www\PYGZhy{}data /var/www/owncloud/
\end{Verbatim}

3. Use the \code{occ} command to complete your installation. This takes the place
of running the graphical Installation Wizard:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} cd /var/www/owncloud/
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ  maintenance:install \PYGZhy{}\PYGZhy{}database
\PYGZdq{}mysql\PYGZdq{} \PYGZhy{}\PYGZhy{}database\PYGZhy{}name \PYGZdq{}owncloud\PYGZdq{}  \PYGZhy{}\PYGZhy{}database\PYGZhy{}user \PYGZdq{}root\PYGZdq{} \PYGZhy{}\PYGZhy{}database\PYGZhy{}pass
\PYGZdq{}password\PYGZdq{} \PYGZhy{}\PYGZhy{}admin\PYGZhy{}user \PYGZdq{}admin\PYGZdq{} \PYGZhy{}\PYGZhy{}admin\PYGZhy{}pass \PYGZdq{}password\PYGZdq{}
ownCloud is not installed \PYGZhy{} only a limited number of commands are available
ownCloud was successfully installed
\end{Verbatim}

Note that you must change to the root ownCloud directory, as in the example
above, to run \code{occ  maintenance:install}, or the installation will fail with
a PHP fatal error message.

Supported databases are:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZhy{} sqlite (SQLite3 \PYGZhy{} ownCloud Community edition only)
\PYGZhy{} mysql (MySQL/MariaDB)
\PYGZhy{} pgsql (PostgreSQL)
\PYGZhy{} oci (Oracle \PYGZhy{} ownCloud Enterprise edition only)
\end{Verbatim}

See {\hyperref[configuration_server/occ_command:command-line-installation-label]{\emph{Command Line Installation}}} for more information.

Finally, apply the correct strong permissions to your ownCloud files and
directories (see {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}). This is an extremely important
step. It helps protect your ownCloud installation, and ensures that it will run
correctly.


\subsection{BINLOG\_FORMAT = STATEMENT}
\label{installation/command_line_installation:binlog-format-statement}
If your ownCloud installation fails and you see this in your ownCloud log:

\begin{Verbatim}[commandchars=\\\{\}]
An unhandled exception has been thrown: exception ‘PDOException’ with message
\PYGZsq{}SQLSTATE[HY000]: General error: 1665 Cannot execute statement: impossible to
write to binary log since BINLOG\PYGZus{}FORMAT = STATEMENT and at least one table
uses a storage engine limited to row\PYGZhy{}based logging. InnoDB is limited to
row\PYGZhy{}logging when transaction isolation level is READ COMMITTED or READ
UNCOMMITTED.\PYGZsq{}
\end{Verbatim}

See {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}}.


\section{Changing Your ownCloud URL}
\label{installation/changing_the_web_route::doc}\label{installation/changing_the_web_route:changing-your-owncloud-url}
This admin manual assumes that the ownCloud server is already accessible under the Web route
\code{/owncloud}, which is the default at installation, e.g. \code{https://example.com/owncloud}. You can change this in your Web server configuration, for example from \code{https://example.com/owncloud/} to \code{https://example.com/}.

On Debian/Ubuntu Linux edit these files:
\begin{itemize}
\item {} 
\code{/etc/apache2/sites-enabled/owncloud.conf}

\item {} 
\code{/var/www/owncloud/config/config.php}

\end{itemize}

Edit the \code{Alias} in \code{/etc/apache2/sites-enabled/owncloud.conf} to alias your ownCloud directory to the Web server root:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{Alias} \PYG{o}{/} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{/var/www/owncloud/}\PYG{l+s}{\PYGZdq{}}
\end{Verbatim}

Edit the \code{overwrite.cli.url} parameter in \code{/var/www/owncloud/config/config.php}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwrite.cli.url\PYGZsq{} =\PYGZgt{} \PYGZsq{}http://localhost/\PYGZsq{},
\end{Verbatim}

Restart Apache, and now you can access ownCloud from either \code{https://example.com/} or \code{https://localhost/}. Note that you will not be able to run any other virtual hosts, as ownCloud is aliased to your Web root.

On CentOS/Fedora/Red Hat, edit \code{/etc/httpd/conf.d/owncloud.conf} and \code{/var/www/html/owncloud/config/config.php}, then restart Apache.


\section{Installing and Managing Apps}
\label{installation/apps_management_installation:installing-and-managing-apps}\label{installation/apps_management_installation::doc}
After installing ownCloud, you may provide added functionality by installing
applications.


\subsection{Supported Apps}
\label{installation/apps_management_installation:supported-apps}
See {\hyperref[installation/apps_supported::doc]{\emph{Supported Apps in ownCloud}}} for a list of supported Enterprise edition apps.


\subsection{Viewing Enabled Apps}
\label{installation/apps_management_installation:viewing-enabled-apps}
During the ownCloud installation, some apps are enabled by default. To see which
apps are enabled go to your Apps page.
\begin{figure}[htbp]
\centering

\includegraphics{oc_admin_app_page.png}
\end{figure}

You will see which apps are enabled, not enabled, and recommended. You'll also
see additional filters, such as Multimedia, Productivity, and Tool for finding
more apps quickly.


\subsection{Managing Apps}
\label{installation/apps_management_installation:managing-apps}
In the Apps page you can enable or disable applications. Some apps have
configurable options on the Apps page, such as \textbf{Enable only for specific
groups}, but mainly they are enabled or disabled here, and are configured on
your ownCloud Admin page, Personal page, or in \code{config.php}.


\subsection{Adding Third Party Apps}
\label{installation/apps_management_installation:adding-third-party-apps}
Some apps are developed and supported by ownCloud directly. These have an
\textbf{Official} tag. Apps with the \textbf{Approved} tag are community-developed and
supported; they are maintained by trusted developers, and are under active
development. Only \textbf{Official} and \textbf{Approved} apps are linked on the Apps
page by default.

Click the app name to view a description of the app and any of the app settings in the Application View field.  Clicking the \textbf{Enable} button will enable the app.  If the app is not part of the ownCloud installation, it will be downloaded from the app store, installed and enabled.

Click the gear icon on the lower left to browse experimental apps in the \href{https://apps.owncloud.com/}{ownCloud Apps
Store}. Install experimental apps at your own risk.

Sometimes the installation of a third-party app fails silently, possibly because
\code{'appcodechecker' =\textgreater{} true,} is enabled in \code{config.php}. When \code{appcodechecker} is
enabled it checks if third-party apps are using the private API, rather than the public
API. If they are then they will not be installed.

\begin{notice}{note}{Note:}
If you would like to create or add your own ownCloud app, please
refer to the \href{https://doc.owncloud.org/server/9.0/developer\_manual/app/index.html}{developer manual}.
\end{notice}


\subsection{Using Custom App Directories}
\label{installation/apps_management_installation:using-custom-app-directories}
Use the \textbf{apps\_paths} array in \code{config.php} to set any custom apps directory
locations. The key \textbf{path} defines the absolute file system path to the app
folder. The key \textbf{url} defines the HTTP web path to that folder, starting at
the ownCloud web root. The key \textbf{writable} indicates if a user can install apps
in that folder.

\begin{notice}{note}{Note:}
To ensure that the default \textbf{/apps/} folder only contains apps
shipped with ownCloud, follow this example to setup an \textbf{/apps2/} folder
which will be used to store all other apps.
\end{notice}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}apps\PYGZus{}paths\PYGZdq{} =\PYGZgt{} array (
      0 =\PYGZgt{} array (
              \PYGZdq{}path\PYGZdq{}     =\PYGZgt{} OC::\PYGZdl{}SERVERROOT.\PYGZdq{}/apps\PYGZdq{},
              \PYGZdq{}url\PYGZdq{}      =\PYGZgt{} \PYGZdq{}/apps\PYGZdq{},
              \PYGZdq{}writable\PYGZdq{} =\PYGZgt{} false,
      ),
      1 =\PYGZgt{} array (
              \PYGZdq{}path\PYGZdq{}     =\PYGZgt{} OC::\PYGZdl{}SERVERROOT.\PYGZdq{}/apps2\PYGZdq{},
              \PYGZdq{}url\PYGZdq{}      =\PYGZgt{} \PYGZdq{}/apps2\PYGZdq{},
              \PYGZdq{}writable\PYGZdq{} =\PYGZgt{} true,
      ),
  ),
\end{Verbatim}


\subsection{Using Your Own Appstore}
\label{installation/apps_management_installation:using-your-own-appstore}
You can enable the installation of apps from your own apps store. This requires that you
can write to at least one of the configured apps directories.

To enable installation from your own apps store:
\begin{enumerate}
\item {} 
Set the \textbf{appstoreenabled} parameter to ``true''.

This parameter is used to enable your apps store in ownCloud.

\item {} 
Set the \textbf{appstoreurl} to the URL of your ownCloud apps store.

This parameter is used to set the http path to the ownCloud apps store. The appstore
server must use \textsc{OCS} (Open Collaboration Services).

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}appstoreenabled\PYGZdq{} =\PYGZgt{} true,
  \PYGZdq{}appstoreurl\PYGZdq{} =\PYGZgt{} \PYGZdq{}https://api.owncloud.com/v1\PYGZdq{},
\end{Verbatim}


\section{Supported Apps in ownCloud}
\label{installation/apps_supported::doc}\label{installation/apps_supported:supported-apps-in-owncloud}

\subsection{AGPL Apps}
\label{installation/apps_supported:agpl-apps}\begin{itemize}
\item {} 
Activity

\item {} 
AntiVirus

\item {} 
Collaborative Tags

\item {} 
Comments

\item {} 
Encryption

\item {} 
External Sites

\item {} 
External Storage

\item {} 
ownCloud WebDAV Endpoint (handles old and new webdav endpoints)

\item {} 
Federated File Sharing (allows file sharing across ownCloud instances)

\item {} 
Federation (allows usernname auto-complete across ownCloud instances)

\item {} 
Files (cannot be disabled)

\item {} 
Files PDF Viewer

\item {} 
Files Sharing

\item {} 
Files TextEditor

\item {} 
Files Trashbin

\item {} 
Files Versions

\item {} 
Files VideoPlayer

\item {} 
First Run Wizard

\item {} 
Gallery

\item {} 
Notifications

\item {} 
Object Storage (Swift)

\item {} 
Provisioning API

\item {} 
Template Editor (for notification emails)

\item {} 
Update Notifications

\item {} 
User External

\item {} 
User LDAP

\end{itemize}


\subsection{Enterprise-Only Apps}
\label{installation/apps_supported:enterprise-only-apps}\begin{itemize}
\item {} 
Enterprise License Key

\item {} 
Files Drop

\item {} 
File Firewall

\item {} 
LDAP Home Connector

\item {} 
Log user and Sharing actions (1 new app, replacing the 2 former logging apps)

\item {} 
Object Storage (S3)

\item {} 
SharePoint

\item {} 
Shibboleth (SAML)

\item {} 
Windows Network Drives (requires External Storage)

\item {} 
Workflow

\end{itemize}


\section{Manual Installation on Linux}
\label{installation/source_installation::doc}\label{installation/source_installation:manual-installation-on-linux}
Installing ownCloud on Linux from our Open Build Service packages is the
preferred method (see {\hyperref[installation/linux_installation::doc]{\emph{Preferred Linux Installation Method}}}). These are maintained by
ownCloud engineers, and you can use your package manager to keep your ownCloud
server up-to-date.

\begin{notice}{note}{Note:}
Enterprise customers should refer to
{\hyperref[enterprise_installation/linux_installation::doc]{\emph{Installing \& Upgrading ownCloud Enterprise Edition}}}
\end{notice}

If there are no packages for your Linux distribution, or you prefer installing
from the source tarball, you can setup ownCloud from scratch using a classic
LAMP stack (Linux, Apache, MySQL/MariaDB, PHP). This document provides a
complete walk-through for installing ownCloud on Ubuntu 14.04 LTS Server with
Apache and MariaDB, using \href{https://owncloud.org/install/}{the ownCloud .tar archive}.
\begin{itemize}
\item {} 
{\hyperref[installation/source_installation:prerequisites-label]{\emph{Prerequisites}}}

\item {} 
{\hyperref[installation/source_installation:ubuntu-installation-label]{\emph{Example Installation on Ubuntu 16.04 LTS Server}}}

\item {} 
{\hyperref[installation/source_installation:binlog-format-label]{\emph{BINLOG\_FORMAT = STATEMENT}}}

\item {} 
{\hyperref[installation/source_installation:apache-configuration-label]{\emph{Apache Web Server Configuration}}}

\item {} 
{\hyperref[installation/source_installation:enabling-ssl-label]{\emph{Enabling SSL}}}

\item {} 
{\hyperref[installation/source_installation:installation-wizard-label]{\emph{Installation Wizard}}}

\item {} 
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}

\item {} 
{\hyperref[installation/source_installation:selinux-tips-label]{\emph{SELinux Configuration Tips}}}

\item {} 
{\hyperref[installation/source_installation:php-ini-tips-label]{\emph{php.ini Configuration Notes}}}

\item {} 
{\hyperref[installation/source_installation:php-fpm-tips-label]{\emph{php-fpm Configuration Notes}}}

\item {} 
{\hyperref[installation/source_installation:other-http-servers-label]{\emph{Other Web Servers}}}

\end{itemize}

\begin{notice}{note}{Note:}
Admins of SELinux-enabled distributions such as CentOS, Fedora, and
Red Hat Enterprise Linux may need to set new rules to enable installing
ownCloud. See {\hyperref[installation/source_installation:selinux-tips-label]{\emph{SELinux Configuration Tips}}} for a suggested configuration.
\end{notice}


\subsection{Prerequisites}
\label{installation/source_installation:prerequisites}\label{installation/source_installation:prerequisites-label}
The ownCloud .tar archive contains all of the required PHP modules. This section
lists all required and optional PHP modules.  Consult the \href{http://php.net/manual/en/extensions.php}{PHP manual} for more information on modules.
Your Linux distribution should have packages for all required modules. You can
check the presence of a module by typing \code{php -m \textbar{} grep -i \textless{}module\_name\textgreater{}}.
If you get a result, the module is present.

Required:
\begin{itemize}
\item {} 
php5 (\textgreater{}= 5.6)

\item {} 
PHP module ctype

\item {} 
PHP module dom

\item {} 
PHP module GD

\item {} 
PHP module iconv

\item {} 
PHP module JSON

\item {} 
PHP module libxml (Linux package libxml2 must be \textgreater{}=2.7.0)

\item {} 
PHP module mb multibyte

\item {} 
PHP module posix

\item {} 
PHP module SimpleXML

\item {} 
PHP module XMLWriter

\item {} 
PHP module zip

\item {} 
PHP module zlib

\end{itemize}

Database connectors (pick the one for your database:)
\begin{itemize}
\item {} 
PHP module sqlite (\textgreater{}= 3, usually not recommended for performance reasons)

\item {} 
PHP module pdo\_mysql (MySQL/MariaDB)

\item {} 
PHP module pgsql (requires PostgreSQL \textgreater{}= 9.0)

\end{itemize}

\emph{Recommended} packages:
\begin{itemize}
\item {} 
PHP module curl (highly recommended, some functionality, e.g. HTTP user
authentication, depends on this)

\item {} 
PHP module fileinfo (highly recommended, enhances file analysis performance)

\item {} 
PHP module bz2 (recommended, required for extraction of apps)

\item {} 
PHP module intl (increases language translation performance and fixes sorting
of non-ASCII characters)

\item {} 
PHP module mcrypt (increases file encryption performance)

\item {} 
PHP module openssl (required for accessing HTTPS resources)

\end{itemize}

Required for specific apps:
\begin{itemize}
\item {} 
PHP module ldap (for LDAP integration)

\item {} 
PHP module ftp (for FTP storage / external user authentication)

\item {} 
PHP module imap (for external user authentication)

\item {} 
PHP module smbclient  (SMB/CIFS integration)

\end{itemize}

\begin{notice}{note}{Note:}
SMB/Windows Network Drive mounts require the PHP module smbclient version 0.8.0+; see
{\hyperref[configuration_files/external_storage/smb::doc]{\emph{SMB/CIFS}}}.
\end{notice}

Recommended for specific apps (\emph{optional}):
\begin{itemize}
\item {} 
PHP module exif (for image rotation in pictures app)

\item {} 
PHP module gmp (for SFTP storage)

\end{itemize}

For enhanced server performance (\emph{optional}) select one of the following
memcaches:
\begin{itemize}
\item {} 
PHP module apc

\item {} 
PHP module apcu

\item {} 
PHP module memcached

\item {} 
PHP module redis (\textgreater{}= 2.2.6+, required for Transactional File Locking)

\end{itemize}

See {\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}} to learn how to select
and configure a memcache.

For preview generation (\emph{optional}):
\begin{itemize}
\item {} 
PHP module imagick

\item {} 
avconv or ffmpeg

\item {} 
OpenOffice or LibreOffice

\end{itemize}

For command line processing (\emph{optional}):
\begin{itemize}
\item {} 
PHP module pcntl (enables command interruption by pressing \code{ctrl-c})

\end{itemize}

You don’t need the WebDAV module for your Web server (i.e. Apache’s
\code{mod\_webdav}), as ownCloud has a built-in WebDAV server of its own, SabreDAV.
If \code{mod\_webdav} is enabled you must disable it for ownCloud. (See
{\hyperref[installation/source_installation:apache-configuration-label]{\emph{Apache Web Server Configuration}}} for an example configuration.)


\subsection{MySQL/MariaDB Require InnoDB}
\label{installation/source_installation:mysql-mariadb-require-innodb}
The InnoDB storage engine is required, and MyISAM is not supported, see: {\hyperref[configuration_database/linux_database_configuration:db-storage-engine-label]{\emph{MySQL / MariaDB storage engine}}}.


\subsection{Example Installation on Ubuntu 16.04 LTS Server}
\label{installation/source_installation:example-installation-on-ubuntu-16-04-lts-server}\label{installation/source_installation:ubuntu-installation-label}
On a machine running a pristine Ubuntu 16.04 LTS server, install the
required and recommended modules for a typical ownCloud installation, using
Apache and MariaDB, by issuing the following commands in a terminal:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get install apache2 mariadb\PYGZhy{}server libapache2\PYGZhy{}mod\PYGZhy{}php7.0
apt\PYGZhy{}get install php7.0\PYGZhy{}gd php7.0\PYGZhy{}json php7.0\PYGZhy{}mysql php7.0\PYGZhy{}curl
apt\PYGZhy{}get install php7.0\PYGZhy{}intl php7.0\PYGZhy{}mcrypt php\PYGZhy{}imagick
apt\PYGZhy{}get install php7.0\PYGZhy{}zip php7.0\PYGZhy{}xml php7.0\PYGZhy{}mbstring
\end{Verbatim}

The remaining steps are analogous to the installation on Ubuntu 14.04 as shown below.


\subsection{Example Installation on Ubuntu 14.04 LTS Server}
\label{installation/source_installation:example-installation-on-ubuntu-14-04-lts-server}
On a machine running a pristine Ubuntu 14.04 LTS server, install the
required and recommended modules for a typical ownCloud installation, using
Apache and MariaDB, by issuing the following commands in a terminal:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get install apache2 mariadb\PYGZhy{}server libapache2\PYGZhy{}mod\PYGZhy{}php5
apt\PYGZhy{}get install php5\PYGZhy{}gd php5\PYGZhy{}json php5\PYGZhy{}mysql php5\PYGZhy{}curl
apt\PYGZhy{}get install php5\PYGZhy{}intl php5\PYGZhy{}mcrypt php5\PYGZhy{}imagick
\end{Verbatim}
\begin{itemize}
\item {} 
This installs the packages for the ownCloud core system.
\code{libapache2-mod-php5} provides the following PHP extensions: \code{bcmath bz2
calendar Core ctype date dba dom ereg exif fileinfo filter ftp gettext hash
iconv libxml mbstring mhash openssl pcre Phar posix Reflection session shmop
SimpleXML soap sockets SPL standard sysvmsg sysvsem sysvshm tokenizer wddx
xml xmlreader xmlwriter zip zlib}. If you are planning
on running additional apps, keep in mind that they might require additional
packages.  See {\hyperref[installation/source_installation:prerequisites-label]{\emph{Prerequisites}}} for details.

\item {} 
At the installation of the MySQL/MariaDB server, you will be prompted to
create a root password. Be sure to remember your password as you will need it
during ownCloud database setup.

\end{itemize}

Now download the archive of the latest ownCloud version:
\begin{itemize}
\item {} 
Go to the \href{https://owncloud.org/install}{ownCloud Download Page}.

\item {} 
Go to \textbf{Download ownCloud Server \textgreater{} Download \textgreater{} Archive file for
server owners} and download either the tar.bz2 or .zip archive.

\item {} 
This downloads a file named owncloud-x.y.z.tar.bz2 or owncloud-x.y.z.zip
(where x.y.z is the version number).

\item {} 
Download its corresponding checksum file, e.g. owncloud-x.y.z.tar.bz2.md5,
or owncloud-x.y.z.tar.bz2.sha256.

\item {} 
Verify the MD5 or SHA256 sum:

\begin{Verbatim}[commandchars=\\\{\}]
md5sum \PYGZhy{}c owncloud\PYGZhy{}x.y.z.tar.bz2.md5 \PYGZlt{} owncloud\PYGZhy{}x.y.z.tar.bz2
sha256sum \PYGZhy{}c owncloud\PYGZhy{}x.y.z.tar.bz2.sha256 \PYGZlt{} owncloud\PYGZhy{}x.y.z.tar.bz2
md5sum  \PYGZhy{}c owncloud\PYGZhy{}x.y.z.zip.md5 \PYGZlt{} owncloud\PYGZhy{}x.y.z.zip
sha256sum  \PYGZhy{}c owncloud\PYGZhy{}x.y.z.zip.sha256 \PYGZlt{} owncloud\PYGZhy{}x.y.z.zip
\end{Verbatim}

\item {} 
You may also verify the PGP signature:

\begin{Verbatim}[commandchars=\\\{\}]
wget https://download.owncloud.org/community/owncloud\PYGZhy{}x.y.z.tar.bz2.asc
wget https://owncloud.org/owncloud.asc
gpg \PYGZhy{}\PYGZhy{}import owncloud.asc
gpg \PYGZhy{}\PYGZhy{}verify owncloud\PYGZhy{}x.y.z.tar.bz2.asc owncloud\PYGZhy{}x.y.z.tar.bz2
\end{Verbatim}

\item {} 
Now you can extract the archive contents. Run the appropriate unpacking
command for your archive type:

\begin{Verbatim}[commandchars=\\\{\}]
tar \PYGZhy{}xjf owncloud\PYGZhy{}x.y.z.tar.bz2
unzip owncloud\PYGZhy{}x.y.z.zip
\end{Verbatim}

\item {} 
This unpacks to a single \code{owncloud} directory. Copy the ownCloud directory
to its final destination. When you are running the Apache HTTP server you may
safely install ownCloud in your Apache document root:

\begin{Verbatim}[commandchars=\\\{\}]
cp \PYGZhy{}r owncloud /path/to/webserver/document\PYGZhy{}root
\end{Verbatim}

where \code{/path/to/webserver/document-root} is replaced by the
document root of your Web server:

\begin{Verbatim}[commandchars=\\\{\}]
cp \PYGZhy{}r owncloud /var/www
\end{Verbatim}

\end{itemize}

On other HTTP servers it is recommended to install ownCloud outside of the
document root.


\subsection{BINLOG\_FORMAT = STATEMENT}
\label{installation/source_installation:binlog-format-label}\label{installation/source_installation:binlog-format-statement}
If your ownCloud installation fails and you see this in your ownCloud log:

\begin{Verbatim}[commandchars=\\\{\}]
An unhandled exception has been thrown: exception ‘PDOException’ with message
\PYGZsq{}SQLSTATE[HY000]: General error: 1665 Cannot execute statement: impossible to
write to binary log since BINLOG\PYGZus{}FORMAT = STATEMENT and at least one table
uses a storage engine limited to row\PYGZhy{}based logging. InnoDB is limited to
row\PYGZhy{}logging when transaction isolation level is READ COMMITTED or READ
UNCOMMITTED.\PYGZsq{}
\end{Verbatim}

See {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}}.


\subsection{Apache Web Server Configuration}
\label{installation/source_installation:apache-web-server-configuration}\label{installation/source_installation:apache-configuration-label}
On Debian, Ubuntu, and their derivatives, Apache installs with a useful
configuration so all you have to do is create a
\code{/etc/apache2/sites-available/owncloud.conf} file with these lines in
it, replacing the \textbf{Directory} and other filepaths with your own filepaths:

\begin{Verbatim}[commandchars=\\\{\}]
Alias /owncloud \PYGZdq{}/var/www/owncloud/\PYGZdq{}

\PYGZlt{}Directory /var/www/owncloud/\PYGZgt{}
  Options +FollowSymlinks
  AllowOverride All

 \PYGZlt{}IfModule mod\PYGZus{}dav.c\PYGZgt{}
  Dav off
 \PYGZlt{}/IfModule\PYGZgt{}

 SetEnv HOME /var/www/owncloud
 SetEnv HTTP\PYGZus{}HOME /var/www/owncloud

\PYGZlt{}/Directory\PYGZgt{}
\end{Verbatim}

Then create a symlink to \code{/etc/apache2/sites-enabled}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{ln} \PYG{o}{\PYGZhy{}}\PYG{n}{s} \PYG{o}{/}\PYG{n}{etc}\PYG{o}{/}\PYG{n}{apache2}\PYG{o}{/}\PYG{n}{sites}\PYG{o}{\PYGZhy{}}\PYG{n}{available}\PYG{o}{/}\PYG{n}{owncloud}\PYG{o}{.}\PYG{n}{conf} \PYG{o}{/}\PYG{n}{etc}\PYG{o}{/}\PYG{n}{apache2}\PYG{o}{/}\PYG{n}{sites}\PYG{o}{\PYGZhy{}}\PYG{n}{enabled}\PYG{o}{/}\PYG{n}{owncloud}\PYG{o}{.}\PYG{n}{conf}
\end{Verbatim}


\subsubsection{Additional Apache Configurations}
\label{installation/source_installation:additional-apache-configurations}\begin{itemize}
\item {} 
For ownCloud to work correctly, we need the module \code{mod\_rewrite}. Enable it
by running:

\begin{Verbatim}[commandchars=\\\{\}]
a2enmod rewrite
\end{Verbatim}

Additional recommended modules are \code{mod\_headers}, \code{mod\_env}, \code{mod\_dir} and \code{mod\_mime}:

\begin{Verbatim}[commandchars=\\\{\}]
a2enmod headers
a2enmod env
a2enmod dir
a2enmod mime
\end{Verbatim}

If you're running \code{mod\_fcgi} instead of the standard \code{mod\_php} also enable:

\begin{Verbatim}[commandchars=\\\{\}]
a2enmod setenvif
\end{Verbatim}

\item {} 
You must disable any server-configured authentication for ownCloud, as it
uses Basic authentication internally for DAV services. If you have turned on
authentication on a parent folder (via e.g. an \code{AuthType Basic}
directive), you can turn off the authentication specifically for the ownCloud
entry. Following the above example configuration file, add the following line
in the \code{\textless{}Directory} section:

\begin{Verbatim}[commandchars=\\\{\}]
Satisfy Any
\end{Verbatim}

\item {} 
When using SSL, take special note of the ServerName. You should specify one in
the  server configuration, as well as in the CommonName field of the
certificate. If you want your ownCloud to be reachable via the internet, then
set both of these to the domain you want to reach your ownCloud server.

\item {} 
Now restart Apache:

\begin{Verbatim}[commandchars=\\\{\}]
service apache2 restart
\end{Verbatim}

\item {} 
If you're running ownCloud in a subdirectory and want to use CalDAV or
CardDAV clients make sure you have configured the correct
{\hyperref[issues/general_troubleshooting:service-discovery-label]{\emph{Service discovery}}} URLs.

\end{itemize}


\subsection{Enabling SSL}
\label{installation/source_installation:enabling-ssl-label}\label{installation/source_installation:enabling-ssl}
\begin{notice}{note}{Note:}
You can use ownCloud over plain HTTP, but we strongly encourage you to
use SSL/TLS to encrypt all of your server traffic, and to protect
user's logins and data in transit.
\end{notice}

Apache installed under Ubuntu comes already set-up with a simple
self-signed certificate. All you have to do is to enable the ssl module and
the default site. Open a terminal and run:

\begin{Verbatim}[commandchars=\\\{\}]
a2enmod ssl
a2ensite default\PYGZhy{}ssl
service apache2 reload
\end{Verbatim}

\begin{notice}{note}{Note:}
Self-signed certificates have their drawbacks - especially when you
plan to make your ownCloud server publicly accessible. You might want
to consider getting a certificate signed by a commercial signing
authority. Check with your domain name registrar or hosting service
for good deals on commercial certificates.
\end{notice}


\subsection{Installation Wizard}
\label{installation/source_installation:installation-wizard}\label{installation/source_installation:installation-wizard-label}
After restarting Apache you must complete your installation by running either
the graphical Installation Wizard, or on the command line with the \code{occ}
command. To enable this, temporarily change the ownership on your ownCloud
directories to your HTTP user (see {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}} to learn how to
find your HTTP user):

\begin{Verbatim}[commandchars=\\\{\}]
chown \PYGZhy{}R www\PYGZhy{}data:www\PYGZhy{}data /var/www/owncloud/
\end{Verbatim}

\begin{notice}{note}{Note:}
Admins of SELinux-enabled distributions may need to write new SELinux
rules to complete their ownCloud installation; see
{\hyperref[installation/source_installation:selinux-tips-label]{\emph{SELinux Configuration Tips}}}.
\end{notice}

To use \code{occ} see {\hyperref[installation/command_line_installation::doc]{\emph{Installing ownCloud From the Command Line}}}.

To use the graphical Installation Wizard see {\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}}.


\subsection{Setting Strong Directory Permissions}
\label{installation/source_installation:setting-strong-directory-permissions}
After completing installation, you must immediately set the directory
permissions in your ownCloud installation as strictly as possible for stronger
security. Please refer to {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}.

Now your ownCloud server is ready to use.


\subsection{SELinux Configuration Tips}
\label{installation/source_installation:selinux-configuration-tips}\label{installation/source_installation:selinux-tips-label}
See {\hyperref[installation/selinux_configuration::doc]{\emph{SELinux Configuration}}} for a suggested configuration for
SELinux-enabled distributions such as Fedora and CentOS.


\subsection{php.ini Configuration Notes}
\label{installation/source_installation:php-ini-configuration-notes}\label{installation/source_installation:php-ini-tips-label}
Keep in mind that changes to \code{php.ini} may have to be configured on more than one
ini file. This can be the case, for example, for the \code{date.timezone} setting.

\textbf{php.ini - used by the Web server:}

\begin{Verbatim}[commandchars=\\\{\}]
  /etc/php5/apache2/php.ini
or
  /etc/php5/fpm/php.ini
or ...
\end{Verbatim}

\textbf{php.ini - used by the php-cli and so by ownCloud CRON jobs:}

\begin{Verbatim}[commandchars=\\\{\}]
/etc/php5/cli/php.ini
\end{Verbatim}


\subsection{php-fpm Configuration Notes}
\label{installation/source_installation:php-fpm-tips-label}\label{installation/source_installation:php-fpm-configuration-notes}
\textbf{System environment variables}

When you are using \code{php-fpm}, system environment variables like
PATH, TMP or others are not automatically populated in the same way as
when using \code{php-cli}. A PHP call like \code{getenv('PATH');} can therefore
return an empty result. So you may need to manually configure environment
variables in the appropropriate \code{php-fpm} ini/config file.

Here are some example root paths for these ini/config files:

\begin{tabulary}{\linewidth}{|L|L|}
\hline

Ubuntu/Mint
 & 
CentOS/Red Hat/Fedora
\\
\hline
\code{/etc/php5/fpm/}
 & 
\code{/etc/php-fpm.d/}
\\
\hline\end{tabulary}


In both examples, the ini/config file is called \code{www.conf}, and depending on
the distro version or customizations you have made, it may be in a subdirectory.

Usually, you will find some or all of the environment variables
already in the file, but commented out like this:

\begin{Verbatim}[commandchars=\\\{\}]
;env[HOSTNAME] = \PYGZdl{}HOSTNAME
;env[PATH] = /usr/local/bin:/usr/bin:/bin
;env[TMP] = /tmp
;env[TMPDIR] = /tmp
;env[TEMP] = /tmp
\end{Verbatim}

Uncomment the appropriate existing entries. Then run \code{printenv PATH} to
confirm your paths, for example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} printenv PATH
/home/user/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:
/sbin:/bin:/
\end{Verbatim}

If any of your system environment variables are not present in the file then
you must add them.

When you are using shared hosting or a control panel to manage your ownCloud VM
or server, the configuration files are almost certain to be located somewhere
else, for security and flexibility reasons, so check your documentation for the
correct locations.

Please keep in mind that it is possible to create different settings for
\code{php-cli} and \code{php-fpm}, and for different domains and Web sites.
The best way to check your settings is with {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}}.

\textbf{Maximum upload size}

If you want to increase the maximum upload size, you will also have to modify
your \code{php-fpm} configuration and increase the \code{upload\_max\_filesize} and
\code{post\_max\_size} values. You will need to restart \code{php5-fpm} and your HTTP
server in order for these changes to be applied.

\textbf{.htaccess notes for Apache}

ownCloud comes with its own \code{owncloud/.htaccess} file. Because \code{php-fpm} can't
read PHP settings in \code{.htaccess} these settings and permissions must be set
in the \code{owncloud/.user.ini} file.


\subsection{Other Web Servers}
\label{installation/source_installation:other-http-servers-label}\label{installation/source_installation:other-web-servers}
{\hyperref[installation/nginx_examples::doc]{\emph{nginx Example Configurations}}}

\href{https://github.com/owncloud/documentation/wiki/Alternate-Web-server-notes}{Other HTTP servers}

\href{https://github.com/owncloud/documentation/wiki/UCS-Installation}{Univention Corporate Server installation}


\section{ownCloud Community Appliance}
\label{installation/appliance_installation::doc}\label{installation/appliance_installation:owncloud-community-appliance}
ownCloud has a publicly developed community appliance \href{https://github.com/ownCloud/vm}{on GitHub}. Download the
latest release from the Appliances tab on the \href{https://owncloud.org/install/\#instructions-server}{ownCloud server installation
page}. The easiest way to get the VM up and running is by using \href{https://www.virtualbox.org}{VirtualBox}
and downloading the OVA image from the installation page.


\subsection{Instructions for VirtualBox and OVA}
\label{installation/appliance_installation:instructions-for-virtualbox-and-ova}
Follow these steps to get the appliance working:
\begin{enumerate}
\item {} 
Download the Virtual Machine image zip file and unpack it.

\item {} 
Start VirtualBox and click on \emph{File ...} \textgreater{} \emph{Import Appliance} and import
your new ownCloud image.

\item {} 
Click the green Start arrow. After a minute you should see the console
greeting message.

\end{enumerate}
\begin{figure}[htbp]
\centering

\includegraphics{community-vm-console.png}
\end{figure}
\begin{enumerate}
\setcounter{enumi}{3}
\item {} 
Note the username and password here. It is a random password that we generate
for you on first boot. If you log in at the console, you'll  be prompted to
change the password. This is optional.

\item {} 
With your Web browser try \code{http://localhost:8888} or
\code{http://localhost:80} or the address printed on the console. One of them
should work. If not, please review and adjust the network setup of
Virtualbox to bridged mode.

\item {} 
You should see a Web page with login credentials (if you haven't changed
them already) and a list of URLs to try to reach the ownCloud web
service.  Which one works, again depends on the network setup of your
hypervisor.

\end{enumerate}
\begin{figure}[htbp]
\centering
\capstart

\scalebox{0.500000}{\includegraphics{community-vm-splash.png}}
\caption{\emph{Click to enlarge}}\end{figure}

\begin{notice}{note}{Note:}
You should write down your admin password, and make sure the login
credentials are no longer displayed. Click the \emph{{[}Hide Credentials{]}} button.
When using the ownCloud Proxy app, this Web page may be publicly visible.
\end{notice}

\begin{notice}{note}{Note:}
Inside the VM, ownCloud runs with a default disk size of 40 GB and its
own MySQL database. The ownCloud admin user is also a valid account on the
Ubuntu system that runs inside the VM. You can administer the VM via SSH.
\end{notice}

\textbf{For VMware}

You can follow most of the steps above, however, after opening the VMX file, you will have to configure \code{Bridged Network} as \emph{Network Adapter}


\subsection{Software Appliances}
\label{installation/appliance_installation:software-appliances}
There are a number of unofficial pre-made virtual machine-based appliances:
\begin{itemize}
\item {} 
\href{https://www.techandme.se/pre-configured-owncloud-installaton/}{Tech and me - ownCloud VM on Ubuntu 16.04 with PHP 7, MySQL, and Apache}, fully configured
environment.

\item {} 
\href{http://susestudio.com/a/TadMax/owncloud-in-a-box}{SUSE Studio, ownCloud on openSuSE}, which runs directly from an USB stick.

\item {} 
\href{https://wiki.amahi.org/index.php/OwnCloud}{Amahi home server}

\end{itemize}


\section{SELinux Configuration}
\label{installation/selinux_configuration:selinux-config-label}\label{installation/selinux_configuration:synology-package}\label{installation/selinux_configuration::doc}\label{installation/selinux_configuration:selinux-configuration}
When you have SELinux enabled on your Linux distribution, you may run into
permissions problems after a new ownCloud installation, and see \code{permission
denied} errors in your ownCloud logs.

When you are testing ownCloud or troubleshooting,

The following settings should work for most SELinux systems that use the
default distro profiles. Run these commands as root, and remember to adjust the filepaths
in these examples for your installation:

\begin{Verbatim}[commandchars=\\\{\}]
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/data(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/config(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/apps(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/assets(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/.htaccess\PYGZsq{}
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud/.user.ini\PYGZsq{}

restorecon \PYGZhy{}Rv \PYGZsq{}/var/www/html/owncloud/\PYGZsq{}
\end{Verbatim}

If you uninstall ownCloud you need to remove the ownCloud directory labels. To do
this execute the following commands as root after uninstalling ownCloud:

\begin{Verbatim}[commandchars=\\\{\}]
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/data(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/config(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/apps(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/assets(/.*)?\PYGZsq{}
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/.htaccess\PYGZsq{}
semanage fcontext \PYGZhy{}d \PYGZsq{}/var/www/html/owncloud/.user.ini\PYGZsq{}

restorecon \PYGZhy{}Rv \PYGZsq{}/var/www/html/owncloud/\PYGZsq{}
\end{Verbatim}

Note: The assets folder is only required if JavaScript and CSS Asset Management is enabled. (\code{asset-pipeline.enabled' =\textgreater{} true,} in \code{config.php})

If you have customized SELinux policies and these examples do not work, you must give the
HTTP server write access to these directories:

\begin{Verbatim}[commandchars=\\\{\}]
/var/www/html/owncloud/data
/var/www/html/owncloud/config
/var/www/html/owncloud/apps
/var/www/html/owncloud/assets
\end{Verbatim}


\subsection{Enable updates via the web interface}
\label{installation/selinux_configuration:enable-updates-via-the-web-interface}
To enable updates via the ownCloud web interface, you may need this to enable writing to the ownCloud directories:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool httpd\PYGZus{}unified on
\end{Verbatim}

When the update is completed, disable write access:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P  httpd\PYGZus{}unified  off
\end{Verbatim}


\subsection{Disallow write access to the whole web directory}
\label{installation/selinux_configuration:disallow-write-access-to-the-whole-web-directory}
For security reasons it's suggested to disable write access to all folders in /var/www/ (default):

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P  httpd\PYGZus{}unified  off
\end{Verbatim}


\subsection{Allow access to a remote database}
\label{installation/selinux_configuration:allow-access-to-a-remote-database}
An additional setting is needed if your installation is connecting to a remote database:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}network\PYGZus{}connect\PYGZus{}db on
\end{Verbatim}


\subsection{Allow access to LDAP server}
\label{installation/selinux_configuration:allow-access-to-ldap-server}
Use this setting to allow LDAP connections:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}connect\PYGZus{}ldap on
\end{Verbatim}


\subsection{Allow access to remote network}
\label{installation/selinux_configuration:allow-access-to-remote-network}
ownCloud requires access to remote networks for functions such as Server-to-Server sharing, external storages or
the app store. To allow this access use the following setting:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}network\PYGZus{}connect on
\end{Verbatim}


\subsection{Allow access to network memcache}
\label{installation/selinux_configuration:allow-access-to-network-memcache}
This setting is not required if \code{httpd\_can\_network\_connect} is already on:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}network\PYGZus{}memcache on
\end{Verbatim}


\subsection{Allow access to SMTP/sendmail}
\label{installation/selinux_configuration:allow-access-to-smtp-sendmail}
If you want to allow ownCloud to send out e-mail notifications via sendmail you need
to use the following setting:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}sendmail on
\end{Verbatim}


\subsection{Allow access to CIFS/SMB}
\label{installation/selinux_configuration:allow-access-to-cifs-smb}
If you have placed your datadir on a CIFS/SMB share use the following setting:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}use\PYGZus{}cifs on
\end{Verbatim}


\subsection{Allow access to FuseFS}
\label{installation/selinux_configuration:allow-access-to-fusefs}
If your owncloud data folder resides on a Fuse Filesystem (e.g. EncFS etc), this setting is required as well:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}use\PYGZus{}fusefs on
\end{Verbatim}


\subsection{Allow access to GPG for Rainloop}
\label{installation/selinux_configuration:allow-access-to-gpg-for-rainloop}
If you use a the rainloop webmail client app which supports GPG/PGP, you might need this:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}use\PYGZus{}gpg on
\end{Verbatim}


\subsection{Troubleshooting}
\label{installation/selinux_configuration:troubleshooting}
For general Troubleshooting of SELinux and its profiles try to install the package \code{setroubleshoot} and run:

\begin{Verbatim}[commandchars=\\\{\}]
sealert \PYGZhy{}a /var/log/audit/audit.log \PYGZgt{} /path/to/mylogfile.txt
\end{Verbatim}

to get a report which helps you configuring your SELinux profiles.

Another tool for troubleshooting is to enable a single ruleset for your ownCloud directory:

\begin{Verbatim}[commandchars=\\\{\}]
semanage fcontext \PYGZhy{}a \PYGZhy{}t httpd\PYGZus{}sys\PYGZus{}rw\PYGZus{}content\PYGZus{}t \PYGZsq{}/var/www/html/owncloud(/.*)?\PYGZsq{}
restorecon \PYGZhy{}RF /var/www/html/owncloud
\end{Verbatim}

It is much stronger security to have a more fine-grained ruleset as in the examples at the beginning, so use this only for testing and troubleshooting. It has a similar effect to disabling SELinux, so don't use it on production systems.

See this \href{https://github.com/owncloud/documentation/pull/2693}{discussion on GitHub} to learn more about configuring SELinux correctly for ownCloud.


\section{nginx Example Configurations}
\label{installation/nginx_examples::doc}\label{installation/nginx_examples:nginx-example-configurations}
This page covers example nginx configurations to use with running an ownCloud
server. Note that nginx is not officially supported, and this page is
community-maintained. (Thank you, contributors!)
\begin{itemize}
\item {} 
You need to insert the following code into \textbf{your nginx configuration file.}

\item {} 
The configuration assumes that ownCloud is installed in
\code{/var/www/owncloud} and that it is accessed via
\code{http(s)://cloud.example.com}.

\item {} 
Adjust \textbf{server\_name}, \textbf{root}, \textbf{ssl\_certificate} and
\textbf{ssl\_certificate\_key} to suit your needs.

\item {} 
Make sure your SSL certificates are readable by the server (see \href{http://wiki.nginx.org/HttpSslModule}{nginx HTTP
SSL Module documentation}).

\item {} 
\code{add\_header} statements are only taken from the current level and are not
cascaded from or to a different level. All necessary \code{add\_header}
statements must be defined in each level needed. For better readability it
is possible to move \emph{common} add header statements into a separate file
and include that file wherever necessary. However, each \code{add\_header}
statement must be written in a single line to prevent connection problems
with sync clients.

\end{itemize}


\subsection{Example Configurations}
\label{installation/nginx_examples:example-configurations}
Be careful about line breaks if you copy the examples, as long lines may be broken
for page formatting.

Thanks to \href{https://github.com/josh4trunks}{@josh4trunks} for providing /
creating these configuration examples.

You can use ownCloud over plain http, but we strongly encourage you to use
SSL/TLS to encrypt all of your server traffic, and to protect user's logins and
data in transit.
\begin{itemize}
\item {} 
Remove the server block containing the redirect

\item {} 
Change \textbf{listen 443 ssl} to \textbf{listen 80;}

\item {} 
Remove \textbf{ssl\_certificate} and \textbf{ssl\_certificate\_key}.

\item {} 
Remove \textbf{fastcgi\_params HTTPS on;}

\end{itemize}


\subsubsection{ownCloud in the webroot of nginx}
\label{installation/nginx_examples:owncloud-in-the-webroot-of-nginx}
The following config should be used when ownCloud is placed in the webroot of
your nginx installation.

\begin{Verbatim}[commandchars=\\\{\}]
upstream php\PYGZhy{}handler \PYGZob{}
    server 127.0.0.1:9000;
    \PYGZsh{}server unix:/var/run/php5\PYGZhy{}fpm.sock;
\PYGZcb{}

server \PYGZob{}
    listen 80;
    server\PYGZus{}name cloud.example.com;
    \PYGZsh{} enforce https
    return 301 https://\PYGZdl{}server\PYGZus{}name\PYGZdl{}request\PYGZus{}uri;
\PYGZcb{}

server \PYGZob{}
    listen 443 ssl;
    server\PYGZus{}name cloud.example.com;

    ssl\PYGZus{}certificate /etc/ssl/nginx/cloud.example.com.crt;
    ssl\PYGZus{}certificate\PYGZus{}key /etc/ssl/nginx/cloud.example.com.key;

    \PYGZsh{} Add headers to serve security related headers
    \PYGZsh{} Before enabling Strict\PYGZhy{}Transport\PYGZhy{}Security headers please read into this topic first.
    \PYGZsh{}add\PYGZus{}header Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options nosniff;
    add\PYGZus{}header X\PYGZhy{}Frame\PYGZhy{}Options \PYGZdq{}SAMEORIGIN\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}XSS\PYGZhy{}Protection \PYGZdq{}1; mode=block\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}Robots\PYGZhy{}Tag none;
    add\PYGZus{}header X\PYGZhy{}Download\PYGZhy{}Options noopen;
    add\PYGZus{}header X\PYGZhy{}Permitted\PYGZhy{}Cross\PYGZhy{}Domain\PYGZhy{}Policies none;

    \PYGZsh{} Path to the root of your installation
    root /var/www/owncloud/;

    location = /robots.txt \PYGZob{}
        allow all;
        log\PYGZus{}not\PYGZus{}found off;
        access\PYGZus{}log off;
    \PYGZcb{}

    \PYGZsh{} The following 2 rules are only needed for the user\PYGZus{}webfinger app.
    \PYGZsh{} Uncomment it if you\PYGZsq{}re planning to use this app.
    \PYGZsh{}rewrite \PYGZca{}/.well\PYGZhy{}known/host\PYGZhy{}meta /public.php?service=host\PYGZhy{}meta last;
    \PYGZsh{}rewrite \PYGZca{}/.well\PYGZhy{}known/host\PYGZhy{}meta.json /public.php?service=host\PYGZhy{}meta\PYGZhy{}json last;

    location = /.well\PYGZhy{}known/carddav \PYGZob{}
        return 301 \PYGZdl{}scheme://\PYGZdl{}host/remote.php/dav;
    \PYGZcb{}
    location = /.well\PYGZhy{}known/caldav \PYGZob{}
        return 301 \PYGZdl{}scheme://\PYGZdl{}host/remote.php/dav;
    \PYGZcb{}

    location /.well\PYGZhy{}known/acme\PYGZhy{}challenge \PYGZob{} \PYGZcb{}

    \PYGZsh{} set max upload size
    client\PYGZus{}max\PYGZus{}body\PYGZus{}size 512M;
    fastcgi\PYGZus{}buffers 64 4K;

    \PYGZsh{} Disable gzip to avoid the removal of the ETag header
    gzip off;

    \PYGZsh{} Uncomment if your server is build with the ngx\PYGZus{}pagespeed module
    \PYGZsh{} This module is currently not supported.
    \PYGZsh{}pagespeed off;

    error\PYGZus{}page 403 /core/templates/403.php;
    error\PYGZus{}page 404 /core/templates/404.php;

    location / \PYGZob{}
        rewrite \PYGZca{} /index.php\PYGZdl{}uri;
    \PYGZcb{}

    location \PYGZti{} \PYGZca{}/(?:build\textbar{}tests\textbar{}config\textbar{}lib\textbar{}3rdparty\textbar{}templates\textbar{}data)/ \PYGZob{}
        return 404;
    \PYGZcb{}
    location \PYGZti{} \PYGZca{}/(?:\PYGZbs{}.\textbar{}autotest\textbar{}occ\textbar{}issue\textbar{}indie\textbar{}db\PYGZus{}\textbar{}console) \PYGZob{}
        return 404;
    \PYGZcb{}

    location \PYGZti{} \PYGZca{}/(?:index\textbar{}remote\textbar{}public\textbar{}cron\textbar{}core/ajax/update\textbar{}status\textbar{}ocs/v[12]\textbar{}updater/.+\textbar{}ocs\PYGZhy{}provider/.+\textbar{}core/templates/40[34])\PYGZbs{}.php(?:\PYGZdl{}\textbar{}/) \PYGZob{}
        fastcgi\PYGZus{}split\PYGZus{}path\PYGZus{}info \PYGZca{}(.+\PYGZbs{}.php)(/.*)\PYGZdl{};
        include fastcgi\PYGZus{}params;
        fastcgi\PYGZus{}param SCRIPT\PYGZus{}FILENAME \PYGZdl{}document\PYGZus{}root\PYGZdl{}fastcgi\PYGZus{}script\PYGZus{}name;
        fastcgi\PYGZus{}param PATH\PYGZus{}INFO \PYGZdl{}fastcgi\PYGZus{}path\PYGZus{}info;
        fastcgi\PYGZus{}param HTTPS on;
        fastcgi\PYGZus{}param modHeadersAvailable true; \PYGZsh{}Avoid sending the security headers twice
        fastcgi\PYGZus{}param front\PYGZus{}controller\PYGZus{}active true;
        fastcgi\PYGZus{}pass php\PYGZhy{}handler;
        fastcgi\PYGZus{}intercept\PYGZus{}errors on;
        fastcgi\PYGZus{}request\PYGZus{}buffering off;
    \PYGZcb{}

    location \PYGZti{} \PYGZca{}/(?:updater\textbar{}ocs\PYGZhy{}provider)(?:\PYGZdl{}\textbar{}/) \PYGZob{}
        try\PYGZus{}files \PYGZdl{}uri \PYGZdl{}uri/ =404;
        index index.php;
    \PYGZcb{}

    \PYGZsh{} Adding the cache control header for js and css files
    \PYGZsh{} Make sure it is BELOW the PHP block
    location \PYGZti{}* \PYGZbs{}.(?:css\textbar{}js)\PYGZdl{} \PYGZob{}
        try\PYGZus{}files \PYGZdl{}uri /index.php\PYGZdl{}uri\PYGZdl{}is\PYGZus{}args\PYGZdl{}args;
        add\PYGZus{}header Cache\PYGZhy{}Control \PYGZdq{}max\PYGZhy{}age=15778463\PYGZdq{};
        \PYGZsh{} Add headers to serve security related headers (It is intended to have those duplicated to the ones above)
        \PYGZsh{} Before enabling Strict\PYGZhy{}Transport\PYGZhy{}Security headers please read into this topic first.
        \PYGZsh{}add\PYGZus{}header Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{};
        add\PYGZus{}header X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options nosniff;
        add\PYGZus{}header X\PYGZhy{}Frame\PYGZhy{}Options \PYGZdq{}SAMEORIGIN\PYGZdq{};
        add\PYGZus{}header X\PYGZhy{}XSS\PYGZhy{}Protection \PYGZdq{}1; mode=block\PYGZdq{};
        add\PYGZus{}header X\PYGZhy{}Robots\PYGZhy{}Tag none;
        add\PYGZus{}header X\PYGZhy{}Download\PYGZhy{}Options noopen;
        add\PYGZus{}header X\PYGZhy{}Permitted\PYGZhy{}Cross\PYGZhy{}Domain\PYGZhy{}Policies none;
        \PYGZsh{} Optional: Don\PYGZsq{}t log access to assets
        access\PYGZus{}log off;
    \PYGZcb{}

    location \PYGZti{}* \PYGZbs{}.(?:svg\textbar{}gif\textbar{}png\textbar{}html\textbar{}ttf\textbar{}woff\textbar{}ico\textbar{}jpg\textbar{}jpeg)\PYGZdl{} \PYGZob{}
        try\PYGZus{}files \PYGZdl{}uri /index.php\PYGZdl{}uri\PYGZdl{}is\PYGZus{}args\PYGZdl{}args;
        \PYGZsh{} Optional: Don\PYGZsq{}t log access to other assets
        access\PYGZus{}log off;
    \PYGZcb{}
\PYGZcb{}
\end{Verbatim}


\subsubsection{ownCloud in a subdir of nginx}
\label{installation/nginx_examples:owncloud-in-a-subdir-of-nginx}
The following config should be used when ownCloud is placed within a subdir of
your nginx installation.

\begin{Verbatim}[commandchars=\\\{\}]
upstream php\PYGZhy{}handler \PYGZob{}
    server 127.0.0.1:9000;
    \PYGZsh{}server unix:/var/run/php5\PYGZhy{}fpm.sock;
\PYGZcb{}

server \PYGZob{}
    listen 80;
    server\PYGZus{}name cloud.example.com;
    \PYGZsh{} enforce https
    return 301 https://\PYGZdl{}server\PYGZus{}name\PYGZdl{}request\PYGZus{}uri;
\PYGZcb{}

server \PYGZob{}
    listen 443 ssl;
    server\PYGZus{}name cloud.example.com;

    ssl\PYGZus{}certificate /etc/ssl/nginx/cloud.example.com.crt;
    ssl\PYGZus{}certificate\PYGZus{}key /etc/ssl/nginx/cloud.example.com.key;

    \PYGZsh{} Add headers to serve security related headers
    \PYGZsh{} Before enabling Strict\PYGZhy{}Transport\PYGZhy{}Security headers please read into this topic first.
    \PYGZsh{}add\PYGZus{}header Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options nosniff;
    add\PYGZus{}header X\PYGZhy{}Frame\PYGZhy{}Options \PYGZdq{}SAMEORIGIN\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}XSS\PYGZhy{}Protection \PYGZdq{}1; mode=block\PYGZdq{};
    add\PYGZus{}header X\PYGZhy{}Robots\PYGZhy{}Tag none;
    add\PYGZus{}header X\PYGZhy{}Download\PYGZhy{}Options noopen;
    add\PYGZus{}header X\PYGZhy{}Permitted\PYGZhy{}Cross\PYGZhy{}Domain\PYGZhy{}Policies none;

    \PYGZsh{} Path to the root of your installation
    root /var/www/;

    location = /robots.txt \PYGZob{}
        allow all;
        log\PYGZus{}not\PYGZus{}found off;
        access\PYGZus{}log off;
    \PYGZcb{}

    \PYGZsh{} The following 2 rules are only needed for the user\PYGZus{}webfinger app.
    \PYGZsh{} Uncomment it if you\PYGZsq{}re planning to use this app.
    \PYGZsh{}rewrite \PYGZca{}/.well\PYGZhy{}known/host\PYGZhy{}meta /owncloud/public.php?service=host\PYGZhy{}meta last;
    \PYGZsh{}rewrite \PYGZca{}/.well\PYGZhy{}known/host\PYGZhy{}meta.json /owncloud/public.php?service=host\PYGZhy{}meta\PYGZhy{}json last;

    location = /.well\PYGZhy{}known/carddav \PYGZob{}
        return 301 \PYGZdl{}scheme://\PYGZdl{}host/owncloud/remote.php/dav;
    \PYGZcb{}
    location = /.well\PYGZhy{}known/caldav \PYGZob{}
        return 301 \PYGZdl{}scheme://\PYGZdl{}host/owncloud/remote.php/dav;
    \PYGZcb{}

    location /.well\PYGZhy{}known/acme\PYGZhy{}challenge \PYGZob{} \PYGZcb{}

    location \PYGZca{}\PYGZti{} /owncloud \PYGZob{}

        \PYGZsh{} set max upload size
        client\PYGZus{}max\PYGZus{}body\PYGZus{}size 512M;
        fastcgi\PYGZus{}buffers 64 4K;

        \PYGZsh{} Disable gzip to avoid the removal of the ETag header
        gzip off;

        \PYGZsh{} Uncomment if your server is build with the ngx\PYGZus{}pagespeed module
        \PYGZsh{} This module is currently not supported.
        \PYGZsh{}pagespeed off;

        error\PYGZus{}page 403 /owncloud/core/templates/403.php;
        error\PYGZus{}page 404 /owncloud/core/templates/404.php;

        location /owncloud \PYGZob{}
            rewrite \PYGZca{} /owncloud/index.php\PYGZdl{}uri;
        \PYGZcb{}

        location \PYGZti{} \PYGZca{}/owncloud/(?:build\textbar{}tests\textbar{}config\textbar{}lib\textbar{}3rdparty\textbar{}templates\textbar{}data)/ \PYGZob{}
            return 404;
        \PYGZcb{}
        location \PYGZti{} \PYGZca{}/owncloud/(?:\PYGZbs{}.\textbar{}autotest\textbar{}occ\textbar{}issue\textbar{}indie\textbar{}db\PYGZus{}\textbar{}console) \PYGZob{}
            return 404;
        \PYGZcb{}

        location \PYGZti{} \PYGZca{}/owncloud/(?:index\textbar{}remote\textbar{}public\textbar{}cron\textbar{}core/ajax/update\textbar{}status\textbar{}ocs/v[12]\textbar{}updater/.+\textbar{}ocs\PYGZhy{}provider/.+\textbar{}core/templates/40[34])\PYGZbs{}.php(?:\PYGZdl{}\textbar{}/) \PYGZob{}
            fastcgi\PYGZus{}split\PYGZus{}path\PYGZus{}info \PYGZca{}(.+\PYGZbs{}.php)(/.*)\PYGZdl{};
            include fastcgi\PYGZus{}params;
            fastcgi\PYGZus{}param SCRIPT\PYGZus{}FILENAME \PYGZdl{}document\PYGZus{}root\PYGZdl{}fastcgi\PYGZus{}script\PYGZus{}name;
            fastcgi\PYGZus{}param PATH\PYGZus{}INFO \PYGZdl{}fastcgi\PYGZus{}path\PYGZus{}info;
            fastcgi\PYGZus{}param HTTPS on;
            fastcgi\PYGZus{}param modHeadersAvailable true; \PYGZsh{}Avoid sending the security headers twice
            fastcgi\PYGZus{}param front\PYGZus{}controller\PYGZus{}active true;
            fastcgi\PYGZus{}pass php\PYGZhy{}handler;
            fastcgi\PYGZus{}intercept\PYGZus{}errors on;
            fastcgi\PYGZus{}request\PYGZus{}buffering off;
        \PYGZcb{}

        location \PYGZti{} \PYGZca{}/owncloud/(?:updater\textbar{}ocs\PYGZhy{}provider)(?:\PYGZdl{}\textbar{}/) \PYGZob{}
            try\PYGZus{}files \PYGZdl{}uri \PYGZdl{}uri/ =404;
            index index.php;
        \PYGZcb{}

        \PYGZsh{} Adding the cache control header for js and css files
        \PYGZsh{} Make sure it is BELOW the PHP block
        location \PYGZti{}* \PYGZbs{}.(?:css\textbar{}js)\PYGZdl{} \PYGZob{}
            try\PYGZus{}files \PYGZdl{}uri /owncloud/index.php\PYGZdl{}uri\PYGZdl{}is\PYGZus{}args\PYGZdl{}args;
            add\PYGZus{}header Cache\PYGZhy{}Control \PYGZdq{}max\PYGZhy{}age=15778463\PYGZdq{};
            \PYGZsh{} Add headers to serve security related headers  (It is intended to have those duplicated to the ones above)
            \PYGZsh{} Before enabling Strict\PYGZhy{}Transport\PYGZhy{}Security headers please read into this topic first.
            \PYGZsh{}add\PYGZus{}header Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{};
            add\PYGZus{}header X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options nosniff;
            add\PYGZus{}header X\PYGZhy{}Frame\PYGZhy{}Options \PYGZdq{}SAMEORIGIN\PYGZdq{};
            add\PYGZus{}header X\PYGZhy{}XSS\PYGZhy{}Protection \PYGZdq{}1; mode=block\PYGZdq{};
            add\PYGZus{}header X\PYGZhy{}Robots\PYGZhy{}Tag none;
            add\PYGZus{}header X\PYGZhy{}Download\PYGZhy{}Options noopen;
            add\PYGZus{}header X\PYGZhy{}Permitted\PYGZhy{}Cross\PYGZhy{}Domain\PYGZhy{}Policies none;
            \PYGZsh{} Optional: Don\PYGZsq{}t log access to assets
            access\PYGZus{}log off;
        \PYGZcb{}

        location \PYGZti{}* \PYGZbs{}.(?:svg\textbar{}gif\textbar{}png\textbar{}html\textbar{}ttf\textbar{}woff\textbar{}ico\textbar{}jpg\textbar{}jpeg)\PYGZdl{} \PYGZob{}
            try\PYGZus{}files \PYGZdl{}uri /owncloud/index.php\PYGZdl{}uri\PYGZdl{}is\PYGZus{}args\PYGZdl{}args;
            \PYGZsh{} Optional: Don\PYGZsq{}t log access to other assets
            access\PYGZus{}log off;
        \PYGZcb{}
    \PYGZcb{}
\PYGZcb{}
\end{Verbatim}


\subsubsection{Suppressing Log Messages}
\label{installation/nginx_examples:suppressing-log-messages}
If you're seeing meaningless messages in your logfile, for example \href{https://central.owncloud.org/t/htaccesstest-txt-errors-in-logfiles/831}{client
denied by server configuration: /var/www/data/htaccesstest.txt},
add this section to your nginx configuration to suppress them:

\begin{Verbatim}[commandchars=\\\{\}]
location = /data/htaccesstest.txt \PYGZob{}
  allow all;
  log\PYGZus{}not\PYGZus{}found off;
  access\PYGZus{}log off;
\PYGZcb{}
\end{Verbatim}


\subsubsection{JavaScript (.js) or CSS (.css) files not served properly}
\label{installation/nginx_examples:javascript-js-or-css-css-files-not-served-properly}
A common issue with custom nginx configs is that JavaScript (.js)
or CSS (.css) files are not served properly leading to a 404 (File not found)
error on those files and a broken webinterface.

This could be caused by the:

\begin{Verbatim}[commandchars=\\\{\}]
location \PYGZti{}* \PYGZbs{}.(?:css\textbar{}js)\PYGZdl{} \PYGZob{}
\end{Verbatim}

block shown above not located \textbf{below} the:

\begin{Verbatim}[commandchars=\\\{\}]
location \PYGZti{} \PYGZbs{}.php(?:\PYGZdl{}\textbar{}/) \PYGZob{}
\end{Verbatim}

block. Other custom configurations like caching JavaScript (.js)
or CSS (.css) files via gzip could also cause such issues.


\subsubsection{Performance Tuning}
\label{installation/nginx_examples:performance-tuning}
\href{http://nginx.org/en/docs/http/ngx\_http\_spdy\_module.html}{nginx (\textless{}1.9.5) \textless{}ngx\_http\_spdy\_module}
\href{http://nginx.org/en/docs/http/ngx\_http\_v2\_module.html}{nginx (+1.9.5) \textless{}ngx\_http\_http2\_module}

To use http\_v2 for nginx you have to check two things:
\begin{quote}

1.) be aware that this module is not built in by default due to a dependency
to the openssl version used on your system. It will be enabled with the
\code{-{-}with-http\_v2\_module} configuration parameter during compilation. The
dependency should be checked automatically. You can check the presence of
http\_v2 with \code{nginx -V 2\textgreater{}\&1 \textbar{} grep http\_v2 -o}. An example of how to
compile nginx can be found in section ``Configure nginx with the
\code{nginx-cache-purge} module'' below.

2.) When you have used SPDY before, the nginx config has to be changed from
\code{listen 443 ssl spdy;} to \code{listen 443 ssl http2;}
\end{quote}


\subsubsection{nginx: caching ownCloud gallery thumbnails}
\label{installation/nginx_examples:nginx-caching-owncloud-gallery-thumbnails}
One of the optimizations for ownCloud when using nginx as the Web server is to
combine FastCGI caching with ``Cache Purge'', a \href{http://wiki.nginx.org/3rdPartyModules}{3rdparty nginx module}  that adds the ability to purge
content from \emph{FastCGI}, \emph{proxy}, \emph{SCGI} and \emph{uWSGI} caches. This mechanism
speeds up thumbnail presentation as it shifts requests to nginx and minimizes
php invocations which otherwise would take place for every thumbnail presented
every time.

The following procedure is based on an Ubuntu 14.04 system. You may need to
adapt it according your OS type and release.

\begin{notice}{note}{Note:}
Unlike Apache, nginx does not dynamically load modules. All modules needed
must be compiled into nginx. This is one of the reasons for nginx´s
performance. It is expected to have an already running nginx installation
with a working configuration set up as described in the ownCloud
documentation.
\end{notice}


\subsubsection{nginx module check}
\label{installation/nginx_examples:nginx-module-check}
As a first step, it is necessary to check if your nginx installation has the
\code{nginx cache purge} module compiled in:

\begin{Verbatim}[commandchars=\\\{\}]
nginx \PYGZhy{}V 2\PYGZgt{}\PYGZam{}1 \textbar{} grep ngx\PYGZus{}cache\PYGZus{}purge \PYGZhy{}o
\end{Verbatim}

If your output contains \code{ngx\_cache\_purge}, you can continue with the
configuration, otherwise you need to manually compile nginx with the module
needed.


\subsubsection{Compile nginx with the \texttt{nginx-cache-purge} module}
\label{installation/nginx_examples:compile-nginx-with-the-nginx-cache-purge-module}\begin{enumerate}
\item {} 
\textbf{Preparation:}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
cd /opt
wget http://nginx.org/keys/nginx\PYGZus{}signing.key
sudo apt\PYGZhy{}key add nginx\PYGZus{}signing.key
sudo vi /etc/apt/sources.list.d/nginx.list
\end{Verbatim}

Add the following lines (if different, replace \code{\{trusty\}} by your
distribution name):

\begin{Verbatim}[commandchars=\\\{\}]
deb http://nginx.org/packages/mainline/ubuntu/ trusty nginx
deb \PYGZhy{}src http://nginx.org/packages/mainline/ubuntu/ trusty nginx
\end{Verbatim}

Then run \code{sudo apt-get update}

\begin{notice}{note}{Note:}
If you're not overly cautious and wish to install the latest and
greatest nginx packages and features, you may have to install nginx from its
mainline repository. From the nginx homepage: ``In general, you should
deploy nginx from its mainline branch at all times.'' If you would like to
use standard nginx from the latest mainline branch but without compiling in
any additional modules, just run \code{sudo apt-get install nginx}.
\end{notice}
\begin{enumerate}
\setcounter{enumi}{1}
\item {} 
\textbf{Download the nginx source from the ppa repository}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
cd /opt
sudo apt\PYGZhy{}get build\PYGZhy{}dep nginx
sudo apt\PYGZhy{}get source nginx
\end{Verbatim}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
\textbf{Download module(s) to be compiled in and configure compiler arguments}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{ls} \PYG{o}{\PYGZhy{}}\PYG{n}{la}
\end{Verbatim}

Please replace \code{\{release\}} with the release downloaded:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{cd} \PYG{o}{/}\PYG{n}{opt}\PYG{o}{/}\PYG{n}{nginx}\PYG{o}{\PYGZhy{}}\PYG{p}{\PYGZob{}}\PYG{n}{release}\PYG{p}{\PYGZcb{}}\PYG{o}{/}\PYG{n}{debian}
\end{Verbatim}

If folder ``modules'' is not present, do:

\begin{Verbatim}[commandchars=\\\{\}]
sudo mkdir modules
cd modules
sudo git clone https://github.com/FRiCKLE/ngx\PYGZus{}cache\PYGZus{}purge.git
sudo vi /opt/nginx\PYGZhy{}\PYGZob{}release\PYGZcb{}/debian/rules
\end{Verbatim}

If not present, add the following line at the top under:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}export DH\PYGZus{}VERBOSE=1:
MODULESDIR = \PYGZdl{}(CURDIR)/debian/modules
\end{Verbatim}

And at the end of every \code{configure} command add:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}add\PYGZhy{}module=\PYGZdl{}(MODULESDIR)/ngx\PYGZus{}cache\PYGZus{}purge
\end{Verbatim}

Don't forget to escape preceeding lines with a backslash \code{\textbackslash{}}.
The parameters may now look like:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}with\PYGZhy{}cc\PYGZhy{}opt=\PYGZdq{}\PYGZdl{}(CFLAGS)\PYGZdq{} \PYGZbs{}
\PYGZhy{}\PYGZhy{}with\PYGZhy{}ld\PYGZhy{}opt=\PYGZdq{}\PYGZdl{}(LDFLAGS)\PYGZdq{} \PYGZbs{}
\PYGZhy{}\PYGZhy{}with\PYGZhy{}ipv6 \PYGZbs{}
\PYGZhy{}\PYGZhy{}add\PYGZhy{}module=\PYGZdl{}(MODULESDIR)/ngx\PYGZus{}cache\PYGZus{}purge
\end{Verbatim}
\begin{enumerate}
\setcounter{enumi}{3}
\item {} 
\textbf{Compile and install nginx}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
cd /opt/nginx\PYGZhy{}\PYGZob{}release\PYGZcb{}
sudo dpkg\PYGZhy{}buildpackage \PYGZhy{}uc \PYGZhy{}b
ls \PYGZhy{}la /opt
sudo dpkg \PYGZhy{}\PYGZhy{}install /opt/nginx\PYGZus{}\PYGZob{}release\PYGZcb{}\PYGZti{}\PYGZob{}distribution\PYGZcb{}\PYGZus{}amd64.deb
\end{Verbatim}
\begin{enumerate}
\setcounter{enumi}{4}
\item {} 
\textbf{Check if the compilation and installation of the ngx\_cache\_purge module
was successful}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
nginx \PYGZhy{}V 2\PYGZgt{}\PYGZam{}1 \textbar{} grep ngx\PYGZus{}cache\PYGZus{}purge \PYGZhy{}o
\end{Verbatim}

It should now show: \code{ngx\_cache\_purge}

Show nginx version including all features compiled and installed:

\begin{Verbatim}[commandchars=\\\{\}]
nginx \PYGZhy{}V 2\PYGZgt{}\PYGZam{}1 \textbar{} sed s/\PYGZdq{} \PYGZhy{}\PYGZhy{}\PYGZdq{}/\PYGZdq{}\PYGZbs{}n\PYGZbs{}t\PYGZhy{}\PYGZhy{}\PYGZdq{}/g
\end{Verbatim}
\begin{enumerate}
\setcounter{enumi}{5}
\item {} 
\textbf{Mark nginx to be blocked from further updates via apt-get}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
sudo dpkg \PYGZhy{}\PYGZhy{}get\PYGZhy{}selections \textbar{} grep nginx
\end{Verbatim}

For every nginx component listed run \code{sudo apt-mark hold \textless{}component\textgreater{}}
\begin{enumerate}
\setcounter{enumi}{6}
\item {} 
\textbf{Regular checks for nginx updates}

\end{enumerate}

Do a regular visit on the \href{http://nginx.org}{nginx news page} and proceed
in case of updates with items 2 to 5.


\subsubsection{Configure nginx with the \texttt{nginx-cache-purge} module}
\label{installation/nginx_examples:configure-nginx-with-the-nginx-cache-purge-module}\begin{enumerate}
\item {} 
\textbf{Preparation}
Create a directory where nginx will save the cached thumbnails. Use any
path that fits to your environment. Replace \code{\{path\}} in this example with
your path created:

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
sudo mkdir \PYGZhy{}p /usr/local/tmp/cache
\end{Verbatim}
\begin{enumerate}
\setcounter{enumi}{1}
\item {} 
\textbf{Configuration}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
sudo vi /etc/nginx/sites\PYGZhy{}enabled/\PYGZob{}your\PYGZhy{}ownCloud\PYGZhy{}nginx\PYGZhy{}config\PYGZhy{}file\PYGZcb{}
\end{Verbatim}

Add at the \emph{beginning}, but \emph{outside} the \code{server\{\}} block:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} cache\PYGZus{}purge
fastcgi\PYGZus{}cache\PYGZus{}path \PYGZob{}path\PYGZcb{} levels=1:2 keys\PYGZus{}zone=OWNCLOUD:100m inactive=60m;
map \PYGZdl{}request\PYGZus{}uri \PYGZdl{}skip\PYGZus{}cache \PYGZob{}
     default 1;
     \PYGZti{}*/thumbnail.php 0;
     \PYGZti{}*/apps/galleryplus/ 0;
     \PYGZti{}*/apps/gallery/ 0;
\PYGZcb{}
\end{Verbatim}

\begin{notice}{note}{Note:}
Please adopt or delete any regex line in the \code{map} block according
your needs and the ownCloud version used.
As an alternative to mapping, you can use as many \code{if} statements in
your server block as necessary:

\begin{Verbatim}[commandchars=\\\{\}]
set \PYGZdl{}skip\PYGZus{}cache 1;
if (\PYGZdl{}request\PYGZus{}uri \PYGZti{}* \PYGZdq{}thumbnail.php\PYGZdq{})      \PYGZob{} set \PYGZdl{}skip\PYGZus{}cache 0; \PYGZcb{}
if (\PYGZdl{}request\PYGZus{}uri \PYGZti{}* \PYGZdq{}/apps/galleryplus/\PYGZdq{}) \PYGZob{} set \PYGZdl{}skip\PYGZus{}cache 0; \PYGZcb{}
if (\PYGZdl{}request\PYGZus{}uri \PYGZti{}* \PYGZdq{}/apps/gallery/\PYGZdq{})     \PYGZob{} set \PYGZdl{}skip\PYGZus{}cache 0; \PYGZcb{}
\end{Verbatim}
\end{notice}

Add \emph{inside} the \code{server\{\}} block, as an example of a configuration:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} cache\PYGZus{}purge (with \PYGZdl{}http\PYGZus{}cookies we have unique keys for the user)
fastcgi\PYGZus{}cache\PYGZus{}key \PYGZdl{}http\PYGZus{}cookie\PYGZdl{}request\PYGZus{}method\PYGZdl{}host\PYGZdl{}request\PYGZus{}uri;
fastcgi\PYGZus{}cache\PYGZus{}use\PYGZus{}stale error timeout invalid\PYGZus{}header http\PYGZus{}500;
fastcgi\PYGZus{}ignore\PYGZus{}headers Cache\PYGZhy{}Control Expires Set\PYGZhy{}Cookie;

location \PYGZti{} \PYGZbs{}.php(?:\PYGZdl{}/) \PYGZob{}
      fastcgi\PYGZus{}split\PYGZus{}path\PYGZus{}info \PYGZca{}(.+\PYGZbs{}.php)(/.+)\PYGZdl{};

      include fastcgi\PYGZus{}params;
      fastcgi\PYGZus{}param SCRIPT\PYGZus{}FILENAME \PYGZdl{}document\PYGZus{}root\PYGZdl{}fastcgi\PYGZus{}script\PYGZus{}name;
      fastcgi\PYGZus{}param PATH\PYGZus{}INFO \PYGZdl{}fastcgi\PYGZus{}path\PYGZus{}info;
      fastcgi\PYGZus{}param HTTPS on;
      fastcgi\PYGZus{}pass php\PYGZhy{}handler;

      \PYGZsh{} cache\PYGZus{}purge
      fastcgi\PYGZus{}cache\PYGZus{}bypass \PYGZdl{}skip\PYGZus{}cache;
      fastcgi\PYGZus{}no\PYGZus{}cache \PYGZdl{}skip\PYGZus{}cache;
      fastcgi\PYGZus{}cache OWNCLOUD;
      fastcgi\PYGZus{}cache\PYGZus{}valid  60m;
      fastcgi\PYGZus{}cache\PYGZus{}methods GET HEAD;
      \PYGZcb{}
\end{Verbatim}

\begin{notice}{note}{Note:}
Note regarding the \code{fastcgi\_pass} parameter:
Use whatever fits your configuration. In the example above, an \code{upstream}
was defined in an nginx global configuration file.
This may look like:

\begin{Verbatim}[commandchars=\\\{\}]
upstream php\PYGZhy{}handler \PYGZob{}
    server unix:/var/run/php5\PYGZhy{}fpm.sock;
    \PYGZsh{} or
    \PYGZsh{} server 127.0.0.1:9000;
  \PYGZcb{}
\end{Verbatim}
\end{notice}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
\textbf{Test the configuration}

\end{enumerate}

\begin{Verbatim}[commandchars=\\\{\}]
sudo nginx \PYGZhy{}s reload
\end{Verbatim}
\begin{itemize}
\item {} 
Open your browser and clear your cache.

\item {} 
Logon to your ownCloud instance, open the gallery app, move thru your
folders and watch while the thumbnails are generated for the first time.

\item {} 
You may also watch with eg. \code{htop} your system load while the
thumbnails are processed.

\item {} 
Go to another app or logout and relogon.

\item {} 
Open the gallery app again and browse to the folders you accessed before.
Your thumbnails should appear more or less immediately.

\item {} 
\code{htop} will not show up additional load while processing, compared to
the high load before.

\end{itemize}


\chapter{ownCloud Server Configuration}
\label{configuration_server/index:owncloud-server-configuration}\label{configuration_server/index::doc}

\section{Warnings on Admin Page}
\label{configuration_server/security_setup_warnings::doc}\label{configuration_server/security_setup_warnings:warnings-on-admin-page}
Your ownCloud server has a built-in configuration checker, and it reports its
findings at the top of your Admin page. These are some of the warnings you
might see, and what to do about them.
\begin{figure}[htbp]
\centering

\includegraphics{security-setup-warning-1.png}
\end{figure}


\subsection{Cache Warnings}
\label{configuration_server/security_setup_warnings:cache-warnings}
``No memory cache has been configured. To enhance your performance please
configure a memcache if available.'' ownCloud supports multiple php caching
extentions:
\begin{itemize}
\item {} 
APCu

\item {} 
Memcached

\item {} 
Redis (minimum required PHP extension version: 2.2.6)

\end{itemize}

You will see this warning if you have no caches installed and enabled, or if
your cache does not have the required minimum version installed; older versions
are disabled because of performance problems.

If you see ``\emph{\{Cache\}} below version \emph{\{Version\}} is installed. for stability and
performance reasons we recommend to update to a newer \emph{\{Cache\}} version'' then
you need to upgrade, or, if you're not using it, remove it.

You are not required to use any caches, but caches improve server performance.
See {\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}}.


\subsection{Transactional file locking is disabled}
\label{configuration_server/security_setup_warnings:transactional-file-locking-is-disabled}
``Transactional file locking is disabled, this might lead to issues with race
conditions.''

Please see {\hyperref[configuration_files/files_locking_transactional::doc]{\emph{Transactional File Locking}}} on how
to correctly configure your environment for transactional file locking.


\subsection{You are accessing this site via HTTP}
\label{configuration_server/security_setup_warnings:you-are-accessing-this-site-via-http}
``You are accessing this site via HTTP. We strongly suggest you configure your
server to require using HTTPS instead.'' Please take this warning seriously;
using HTTPS is a fundamental security measure. You must configure your Web
server to support it, and then there are some settings in the \textbf{Security}
section of your ownCloud Admin page to enable. The following pages
describe how to enable HTTPS on the Apache and Nginx Web servers.

{\hyperref[installation/source_installation:enabling-ssl-label]{\emph{Enabling SSL}}} (on Apache)

{\hyperref[configuration_server/harden_server:use-https-label]{\emph{Use HTTPS}}}

{\hyperref[installation/nginx_examples::doc]{\emph{nginx Example Configurations}}}


\subsection{The test with getenv(``PATH'') only returns an empty response}
\label{configuration_server/security_setup_warnings:the-test-with-getenv-path-only-returns-an-empty-response}
Some environments are not passing a valid PATH variable to ownCloud. The
{\hyperref[installation/source_installation:php-fpm-tips-label]{\emph{php-fpm Configuration Notes}}} provides the information about how to configure your
environment.


\subsection{The ``Strict-Transport-Security'' HTTP header is not configured}
\label{configuration_server/security_setup_warnings:the-strict-transport-security-http-header-is-not-configured}
``The ``Strict-Transport-Security'' HTTP header is not configured to least ``15552000'' seconds.
For enhanced security we recommend enabling HSTS as described in our security tips.''

The HSTS header needs to be configured within your Web server by following the
{\hyperref[configuration_server/harden_server:enable-hsts-label]{\emph{Enable HTTP Strict Transport Security}}} documentation


\subsection{/dev/urandom is not readable by PHP}
\label{configuration_server/security_setup_warnings:dev-urandom-is-not-readable-by-php}
``/dev/urandom is not readable by PHP which is highly discouraged for security reasons.
Further information can be found in our documentation.''

This message is another one which needs to be taken seriously. Please have a look
at the {\hyperref[configuration_server/harden_server:dev-urandom-label]{\emph{Give PHP read access to /dev/urandom}}} documentation.


\subsection{Your Web server is not yet set up properly to allow file synchronization}
\label{configuration_server/security_setup_warnings:your-web-server-is-not-yet-set-up-properly-to-allow-file-synchronization}
``Your web server is not yet set up properly to allow file synchronization because
the WebDAV interface seems to be broken.''

At the ownCloud community forums a larger \href{https://central.owncloud.org/t/how-to-fix-caldav-carddav-webdav-problems/852}{FAQ}
is maintained containing various information and debugging hints.


\subsection{Outdated NSS / OpenSSL version}
\label{configuration_server/security_setup_warnings:outdated-nss-openssl-version}
``cURL is using an outdated OpenSSL version (OpenSSL/\$version). Please update your
operating system or features such as installing and updating apps via the app store
or Federated Cloud Sharing will not work reliably.''

``cURL is using an outdated NSS version (NSS/\$version). Please update your operating
system or features such as installing and updating apps via the app store or Federated
Cloud Sharing will not work reliably.''

There are known bugs in older OpenSSL and NSS versions leading to misbehaviour in
combination with remote hosts using SNI. A technology used by most of the HTTPS
websites. To ensure that ownCloud will work properly you need to update OpenSSL
to at least 1.0.2b or 1.0.1d. For NSS the patch version depends on your distribution
and an heuristic is running the test which actually reproduces the bug. There
are distributions such as RHEL/CentOS which have this backport still \href{https://bugzilla.redhat.com/show\_bug.cgi?id=1241172}{pending}.


\subsection{Your Web server is not set up properly to resolve /.well-known/caldav/ or /.well-known/carddav/}
\label{configuration_server/security_setup_warnings:your-web-server-is-not-set-up-properly-to-resolve-well-known-caldav-or-well-known-carddav}
Both URLs need to be correctly redirected to the DAV endpoint of ownCloud. Please
refer to {\hyperref[issues/general_troubleshooting:service-discovery-label]{\emph{Service discovery}}} for more info.


\subsection{Some files have not passed the integrity check}
\label{configuration_server/security_setup_warnings:some-files-have-not-passed-the-integrity-check}
Please refer to the {\hyperref[issues/code_signing:code-signing-fix-warning-label]{\emph{Fixing Invalid Code Integrity Messages}}} documentation how to debug this issue.


\subsection{Your database does not run with ``READ COMMITED'' transaction isolation level}
\label{configuration_server/security_setup_warnings:your-database-does-not-run-with-read-commited-transaction-isolation-level}
``Your database does not run with ``READ COMMITED'' transaction isolation level.
This can cause problems when multiple actions are executed in parallel.''

Please refer to {\hyperref[configuration_database/linux_database_configuration:db-transaction-label]{\emph{MySQL / MariaDB ``READ COMMITED'' transaction isolation level}}} how to configure your database for this requirement.


\section{Importing System-wide and Personal SSL Certificates}
\label{configuration_server/import_ssl_cert:importing-system-wide-and-personal-ssl-certificates}\label{configuration_server/import_ssl_cert::doc}
Modern Web browsers try to keep us safe, and so they blast us with scary warnings when sites have the smallest errors in their SSL certificates, or when they use self-signed SSL certificates. ownCloud admins encounter this when creating Federation shares, or setting up external storage mounts. There is no reason against using self-signed certificates on your own networks; they're fast, free, and easy.


\subsection{Importing Personal SSL Certificates}
\label{configuration_server/import_ssl_cert:importing-personal-ssl-certificates}
ownCloud has several methods for importing self-signed certificates so that you don't have to hassle with Web browser warnings. When you allow your users to create their own external storage mounts or Federation shares, they can import SSL certificates for those shares on their Personal pages.
\begin{figure}[htbp]
\centering

\includegraphics{import-ssl-cert-1.png}
\end{figure}

Click the \textbf{Import root certificate} button to open a file picker. You can distribute copies of your SSL certificates to your users (via an ownCloud share!), or users can download them from their Web browsers. Click on the little padlock icon and click through until you see a \textbf{View Certificate} button, then keep going until you can download it. In Firefox and Chromium there is an \textbf{Export} button for downloading your own copy of a site's SSL certificate.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{import-ssl-cert-2.png}
\caption{\emph{Click ``More information'' in Firefox to import SSL certificate}}\end{figure}


\subsection{Site-wide SSL Import}
\label{configuration_server/import_ssl_cert:site-wide-ssl-import}
The personal imports only work for individual users. You can enable site-wide SSL certificates for all of your users on your ownCloud admin page. To enable this, you must add this line to your \code{config.php} file:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enable\PYGZus{}certificate\PYGZus{}management\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Then you'll have a  \textbf{Import root certificate} button on your admin page, just like the one on your personal page.


\subsection{Using OCC to Import and Manage SSL Certificates}
\label{configuration_server/import_ssl_cert:using-occ-to-import-and-manage-ssl-certificates}
The \code{occ} command has options for listing and managing your SSL certificates:

\begin{Verbatim}[commandchars=\\\{\}]
security:certificates         list trusted certificates
security:certificates:import  import trusted certificate
security:certificates:remove  remove trusted certificate
\end{Verbatim}

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn about how to use \code{occ}.


\section{Using the occ Command}
\label{configuration_server/occ_command:using-the-occ-command}\label{configuration_server/occ_command::doc}
ownCloud's \code{occ} command (ownCloud console) is ownCloud's command-line
interface. You can perform many common server operations with \code{occ}, such as
installing and upgrading ownCloud, manage users, encryption, passwords, LDAP
setting, and more.

\code{occ} is in the \code{owncloud/} directory; for example
\code{/var/www/owncloud} on Ubuntu Linux. \code{occ} is a PHP script. \textbf{You must
run it as your HTTP user} to ensure that the correct permissions are maintained
on your ownCloud files and directories. In ownCloud 8.2+ you may run it from
any directory (specifying the filepath); in previous releases it had to be
run from the \code{owncloud/} directory.


\subsection{occ Command Directory}
\label{configuration_server/occ_command:occ-command-directory}\begin{itemize}
\item {} 
{\hyperref[configuration_server/occ_command:http-user-label]{\emph{Run occ As Your HTTP User}}}

\item {} 
{\hyperref[configuration_server/occ_command:apps-commands-label]{\emph{Apps Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:background-jobs-selector-label]{\emph{Background Jobs Selector}}}

\item {} 
{\hyperref[configuration_server/occ_command:config-commands-label]{\emph{Config Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:dav-label]{\emph{Dav Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:database-conversion-label]{\emph{Database Conversion}}}

\item {} 
{\hyperref[configuration_server/occ_command:encryption-label]{\emph{Encryption}}}

\item {} 
{\hyperref[configuration_server/occ_command:federation-sync-label]{\emph{Federation Sync}}}

\item {} 
{\hyperref[configuration_server/occ_command:file-operations-label]{\emph{File Operations}}}

\item {} 
{\hyperref[configuration_server/occ_command:files-external-label]{\emph{Files External}}}

\item {} 
{\hyperref[configuration_server/occ_command:integrity-check-label]{\emph{Integrity Check}}}

\item {} 
{\hyperref[configuration_server/occ_command:create-javascript-translation-files-label]{\emph{l10n, Create Javascript Translation Files for Apps}}}

\item {} 
{\hyperref[configuration_server/occ_command:ldap-commands-label]{\emph{LDAP Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:logging-commands-label]{\emph{Logging Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{Maintenance Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:security-commands-label]{\emph{Security}}}

\item {} 
{\hyperref[configuration_server/occ_command:shibboleth-label]{\emph{Shibboleth Modes (Enterprise Edition only)}}}

\item {} 
{\hyperref[configuration_server/occ_command:trashbin-label]{\emph{Trashbin}}}

\item {} 
{\hyperref[configuration_server/occ_command:user-commands-label]{\emph{User Commands}}}

\item {} 
{\hyperref[configuration_server/occ_command:versions-label]{\emph{Versions}}}

\item {} 
{\hyperref[configuration_server/occ_command:command-line-installation-label]{\emph{Command Line Installation}}}

\item {} 
{\hyperref[configuration_server/occ_command:command-line-upgrade-label]{\emph{Command Line Upgrade}}}

\item {} 
{\hyperref[configuration_server/occ_command:two-factor-auth-label]{\emph{Two-factor Authentication}}}

\item {} 
{\hyperref[configuration_server/occ_command:disable-user-label]{\emph{Disable Users}}}

\end{itemize}


\subsection{Run occ As Your HTTP User}
\label{configuration_server/occ_command:run-occ-as-your-http-user}\label{configuration_server/occ_command:http-user-label}
The HTTP user is different on the various Linux distributions. See
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}} to learn how to find your HTTP user.
\begin{itemize}
\item {} 
The HTTP user and group in Debian/Ubuntu is www-data.

\item {} 
The HTTP user and group in Fedora/CentOS is apache.

\item {} 
The HTTP user and group in Arch Linux is http.

\item {} 
The HTTP user in openSUSE is wwwrun, and the HTTP group is www.

\end{itemize}

If your HTTP server is configured to use a different PHP version than the
default (/usr/bin/php), \code{occ} should be run with the same version. For
example, in CentOS 6.5 with SCL-PHP54 installed, the command looks like this:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u apache /opt/rh/php54/root/usr/bin/php /var/www/html/owncloud/occ
\end{Verbatim}

Running \code{occ} with no options lists all commands and options, like this
example on Ubuntu:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ
ownCloud version 9.0.0

Usage:
 command [options] [arguments]

Options:
 \PYGZhy{}h, \PYGZhy{}\PYGZhy{}help            Display this help message
 \PYGZhy{}q, \PYGZhy{}\PYGZhy{}quiet           Do not output any message
 \PYGZhy{}V, \PYGZhy{}\PYGZhy{}version         Display this application version
     \PYGZhy{}\PYGZhy{}ansi            Force ANSI output
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}ansi         Disable ANSI output
 \PYGZhy{}n, \PYGZhy{}\PYGZhy{}no\PYGZhy{}interaction  Do not ask any interactive question
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}warnings     Skip global warnings, show command output only
 \PYGZhy{}v\textbar{}vv\textbar{}vvv, \PYGZhy{}\PYGZhy{}verbose  Increase the verbosity of messages: 1 for normal output,
                       2 for more verbose output and 3 for debug

Available commands:
 check                 check dependencies of the server
                       environment
 help                  Displays help for a command
 list                  Lists commands
 status                show some status information
 upgrade               run upgrade routines after installation of
                       a new release. The release has to be
                       installed before.
\end{Verbatim}

This is the same as \code{sudo -u www-data php occ list}.

Run it with the \code{-h} option for syntax help:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ \PYGZhy{}h
\end{Verbatim}

Display your ownCloud version:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ \PYGZhy{}V
  ownCloud version 9.0.0
\end{Verbatim}

Query your ownCloud server status:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ status
  \PYGZhy{} installed: true
  \PYGZhy{} version: 9.0.0.19
  \PYGZhy{} versionstring: 9.0.0
  \PYGZhy{} edition:
\end{Verbatim}

\code{occ} has options, commands, and arguments. Options and arguments are
optional, while commands are required. The syntax is:

\begin{Verbatim}[commandchars=\\\{\}]
occ [options] command [arguments]
\end{Verbatim}

Get detailed information on individual commands with the \code{help} command, like
this example for the \code{maintenance:mode} command:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ help maintenance:mode
Usage:
 maintenance:mode [options]

Options:
     \PYGZhy{}\PYGZhy{}on              enable maintenance mode
     \PYGZhy{}\PYGZhy{}off             disable maintenance mode
 \PYGZhy{}h, \PYGZhy{}\PYGZhy{}help            Display this help message
 \PYGZhy{}q, \PYGZhy{}\PYGZhy{}quiet           Do not output any message
 \PYGZhy{}V, \PYGZhy{}\PYGZhy{}version         Display this application version
     \PYGZhy{}\PYGZhy{}ansi            Force ANSI output
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}ansi         Disable ANSI output
 \PYGZhy{}n, \PYGZhy{}\PYGZhy{}no\PYGZhy{}interaction  Do not ask any interactive question
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}warnings     Skip global warnings, show command output only
 \PYGZhy{}v\textbar{}vv\textbar{}vvv, \PYGZhy{}\PYGZhy{}verbose  Increase the verbosity of messages: 1 for normal output,
                       2 for more verbose output and 3 for debug
\end{Verbatim}

The \code{status} command from above has an option to define the output format.
The default is plain text, but it can also be \code{json}:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ status \PYGZhy{}\PYGZhy{}output=json
\PYGZob{}\PYGZdq{}installed\PYGZdq{}:true,\PYGZdq{}version\PYGZdq{}:\PYGZdq{}9.0.0.19\PYGZdq{},\PYGZdq{}versionstring\PYGZdq{}:\PYGZdq{}9.0.0\PYGZdq{},\PYGZdq{}edition\PYGZdq{}:\PYGZdq{}\PYGZdq{}\PYGZcb{}
\end{Verbatim}

or \code{json\_pretty}:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ status \PYGZhy{}\PYGZhy{}output=json\PYGZus{}pretty
\PYGZob{}
   \PYGZdq{}installed\PYGZdq{}: true,
   \PYGZdq{}version\PYGZdq{}: \PYGZdq{}9.0.0.19\PYGZdq{},
   \PYGZdq{}versionstring\PYGZdq{}: \PYGZdq{}9.0.0\PYGZdq{},
   \PYGZdq{}edition\PYGZdq{}: \PYGZdq{}\PYGZdq{}
\PYGZcb{}
\end{Verbatim}

This output option is available on all list and list-like commands:
\code{status}, \code{check}, \code{app:list}, \code{config:list}, \code{encryption:status}
and \code{encryption:list-modules}


\subsection{Apps Commands}
\label{configuration_server/occ_command:apps-commands-label}\label{configuration_server/occ_command:apps-commands}
The \code{app} commands list, enable, and disable apps:

\begin{Verbatim}[commandchars=\\\{\}]
app
 app:check\PYGZhy{}code   check code to be compliant
 app:disable      disable an app
 app:enable       enable an app
 app:getpath      Get an absolute path to the app directory
                  (added in 9.0)
 app:list         List all available apps
\end{Verbatim}

List all of your installed apps, and show whether they are
enabled or disabled:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:list
\end{Verbatim}

Enable an app, for example the External Storage Support app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:enable files\PYGZus{}external
files\PYGZus{}external enabled
\end{Verbatim}

Disable an app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:disable files\PYGZus{}external
files\PYGZus{}external disabled
\end{Verbatim}

\code{app:check-code} has multiple checks: it checks if an app uses ownCloud's
public API (\code{OCP}) or private API (\code{OC\_}), and it also checks for deprecated
methods and the validity of the \code{info.xml} file. By default all checks are
enabled. The Activity app is an example of a correctly-formatted app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:check\PYGZhy{}code notifications
App is compliant \PYGZhy{} awesome job!
\end{Verbatim}

If your app has issues, you'll see output like this:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:check\PYGZhy{}code foo\PYGZus{}app
Analysing /var/www/owncloud/apps/files/foo\PYGZus{}app.php
4 errors
   line   45: OCP\PYGZbs{}Response \PYGZhy{} Static method of deprecated class must not be
   called
   line   46: OCP\PYGZbs{}Response \PYGZhy{} Static method of deprecated class must not be
   called
   line   47: OCP\PYGZbs{}Response \PYGZhy{} Static method of deprecated class must not be
   called
   line   49: OC\PYGZus{}Util \PYGZhy{} Static method of private class must not be called
\end{Verbatim}

You can get the full filepath to an app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:getpath notifications
/var/www/owncloud/apps/notifications
\end{Verbatim}


\subsection{Background Jobs Selector}
\label{configuration_server/occ_command:background-jobs-selector-label}\label{configuration_server/occ_command:background-jobs-selector}
Use the \code{background} command to select which scheduler you want to use for
controlling background jobs, Ajax, Webcron, or Cron. This is the same as using
the \textbf{Cron} section on your ownCloud Admin page:

\begin{Verbatim}[commandchars=\\\{\}]
background
 background:ajax       Use ajax to run background jobs
 background:cron       Use cron to run background jobs
 background:webcron    Use webcron to run background jobs
\end{Verbatim}

This example selects Ajax:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ background:ajax
  Set mode for background jobs to \PYGZsq{}ajax\PYGZsq{}
\end{Verbatim}

The other two commands are:
\begin{itemize}
\item {} 
\code{background:cron}

\item {} 
\code{background:webcron}

\end{itemize}

See {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}} to learn more.


\subsection{Config Commands}
\label{configuration_server/occ_command:config-commands-label}\label{configuration_server/occ_command:config-commands}
The \code{config} commands are used to configure the ownCloud server:

\begin{Verbatim}[commandchars=\\\{\}]
config
 config:app:delete      Delete an app config value
 config:app:get         Get an app config value
 config:app:set         Set an app config value
 config:import          Import a list of configs
 config:list            List all configs
 config:system:delete   Delete a system config value
 config:system:get      Get a system config value
 config:system:set      Set a system config value
\end{Verbatim}

You can list all configuration values with one command:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:list
\end{Verbatim}

By default, passwords and other sensitive data are omitted from the report, so
the output can be posted publicly (e.g. as part of a bug report). In order to
generate a full backport of all configuration values the \code{-{-}private} flag
needs to be set:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:list \PYGZhy{}\PYGZhy{}private
\end{Verbatim}

The exported content can also be imported again to allow the fast setup of
similar instances. The import command will only add or update values. Values
that exist in the current configuration, but not in the one that is being
imported are left untouched:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:import filename.json
\end{Verbatim}

It is also possible to import remote files, by piping the input:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:import \PYGZlt{} local\PYGZhy{}backup.json
\end{Verbatim}

\begin{notice}{note}{Note:}
While it is possible to update/set/delete the versions and installation
statuses of apps and ownCloud itself, it is \textbf{not} recommended to do this
directly. Use the \code{occ app:enable}, \code{occ app:disable} and \code{occ update}
commands instead.
\end{notice}


\subsubsection{Getting a Single Configuration Value}
\label{configuration_server/occ_command:getting-a-single-configuration-value}
These commands get the value of a single app or system configuration:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:get version
9.0.0.19

sudo \PYGZhy{}u www\PYGZhy{}data php occ config:app:get activity installed\PYGZus{}version
2.2.1
\end{Verbatim}


\subsubsection{Setting a Single Configuration Value}
\label{configuration_server/occ_command:setting-a-single-configuration-value}
These commands set the value of a single app or system configuration:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:set logtimezone
\PYGZhy{}\PYGZhy{}value=\PYGZdq{}Europe/Berlin\PYGZdq{}
System config value logtimezone set to Europe/Berlin

sudo \PYGZhy{}u www\PYGZhy{}data php occ config:app:set files\PYGZus{}sharing
incoming\PYGZus{}server2server\PYGZus{}share\PYGZus{}enabled \PYGZhy{}\PYGZhy{}value=\PYGZdq{}yes\PYGZdq{} \PYGZhy{}\PYGZhy{}type=boolean
Config value incoming\PYGZus{}server2server\PYGZus{}share\PYGZus{}enabled for app files\PYGZus{}sharing set to yes
\end{Verbatim}

The \code{config:system:set} command creates the value, if it does not already
exist. To update an existing value,  set \code{-{-}update-only}:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:set doesnotexist \PYGZhy{}\PYGZhy{}value=\PYGZdq{}true\PYGZdq{}
\PYGZhy{}\PYGZhy{}type=boolean \PYGZhy{}\PYGZhy{}update\PYGZhy{}only
Value not updated, as it has not been set before.
\end{Verbatim}

Note that in order to write a Boolean, float, or integer value to the
configuration file, you need to specify the type on your command. This
applies only to the \code{config:system:set} command. The following values are
known:
\begin{itemize}
\item {} 
\code{boolean}

\item {} 
\code{integer}

\item {} 
\code{float}

\item {} 
\code{string} (default)

\end{itemize}

When you want to e.g. disable the maintenance mode run the following command:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:set maintenance \PYGZhy{}\PYGZhy{}value=false
\PYGZhy{}\PYGZhy{}type=boolean
ownCloud is in maintenance mode \PYGZhy{} no app have been loaded
System config value maintenance set to boolean false
\end{Verbatim}


\subsubsection{Setting an array Configuration Value}
\label{configuration_server/occ_command:setting-an-array-configuration-value}
Some configurations (e.g. the trusted domain setting) are an array of data.
In order to set (and also get) the value of one key, you can specify multiple
\code{config} names separated by spaces:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:get trusted\PYGZus{}domains
localhost
owncloud.local
sample.tld
\end{Verbatim}

To replace \code{sample.tld} with \code{example.com} trusted\_domains =\textgreater{} 2 needs to be
set:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:set trusted\PYGZus{}domains 2
\PYGZhy{}\PYGZhy{}value=example.com
System config value trusted\PYGZus{}domains =\PYGZgt{} 2 set to string example.com

sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:get trusted\PYGZus{}domains
localhost
owncloud.local
example.com
\end{Verbatim}


\subsubsection{Deleting a Single Configuration Value}
\label{configuration_server/occ_command:deleting-a-single-configuration-value}
These commands delete the configuration of an app or system configuration:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:delete maintenance:mode
System config value maintenance:mode deleted

sudo \PYGZhy{}u www\PYGZhy{}data php occ config:app:delete appname provisioning\PYGZus{}api
Config value provisioning\PYGZus{}api of app appname deleted
\end{Verbatim}

The delete command will by default not complain if the configuration was not set
before. If you want to be notified in that case, set the
\code{-{-}error-if-not-exists} flag:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:system:delete doesnotexist
\PYGZhy{}\PYGZhy{}error\PYGZhy{}if\PYGZhy{}not\PYGZhy{}exists
Config provisioning\PYGZus{}api of app appname could not be deleted because it did not
exist
\end{Verbatim}


\subsection{Dav Commands}
\label{configuration_server/occ_command:dav-label}\label{configuration_server/occ_command:dav-commands}
A set of commands to create addressbooks, calendars, and to
migrate addressbooks from 8.2 when you upgrade to 9.0:

\begin{Verbatim}[commandchars=\\\{\}]
dav
 dav:create\PYGZhy{}addressbook        Create a dav addressbook
 dav:create\PYGZhy{}calendar           Create a dav calendar
 dav:sync\PYGZhy{}birthday\PYGZhy{}calendar    Synchronizes the birthday calendar
 dav:sync\PYGZhy{}system\PYGZhy{}addressbook   Synchronizes users to the system
                               addressbook
\end{Verbatim}

The syntax for \code{dav:create-addressbook} and  \code{dav:create-calendar} is
\code{dav:create-addressbook {[}user{]} {[}name{]}}. This example creates the addressbook
\code{mollybook} for the user molly:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:create\PYGZhy{}addressbook molly mollybook
\end{Verbatim}

This example creates a new calendar for molly:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:create\PYGZhy{}calendar molly mollycal
\end{Verbatim}

Molly will immediately see these on her Calendar and Contacts pages.

In 9.0, the CalDAV server has been integrated into core. Your existing
calendars and contacts should migrate automatically when you upgrade. If
something goes wrong you can try a manual migration. First delete any
partially-migrated calendars or addressbooks. Then run this
command to migrate user's contacts:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:migrate\PYGZhy{}addressbooks [user]
\end{Verbatim}

Run this command to migrate calendars:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:migrate\PYGZhy{}calendars [user]
\end{Verbatim}

See \href{http://morrisjobke.de/2016/03/07/ownCloud-9.0-calendar-migration-analysis/}{ownCloud 9.0 - calendar migration analysis}
for help with troubleshooting and reporting problems.

\code{dav:sync-birthday-calendar} adds all birthdays to your calendar from
addressbooks shared with you. This example syncs to your calendar from user
bernie:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:sync\PYGZhy{}birthday\PYGZhy{}calendar bernie
\end{Verbatim}

\code{dav:sync-system-addressbook} synchronizes all users to the system
addressbook:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ dav:sync\PYGZhy{}system\PYGZhy{}addressbook
\end{Verbatim}

Added in 9.0.


\subsection{Database Conversion}
\label{configuration_server/occ_command:database-conversion}\label{configuration_server/occ_command:database-conversion-label}
The SQLite database is good for testing, and for ownCloud servers with small
single-user workloads that do not use sync clients, but production servers with
multiple users should use MariaDB, MySQL, or PostgreSQL. You can use \code{occ} to
convert from SQLite to one of these other databases.

\begin{Verbatim}[commandchars=\\\{\}]
db
 db:convert\PYGZhy{}type           Convert the ownCloud database to the newly
                           configured one
 db:generate\PYGZhy{}change\PYGZhy{}script generates the change script from the current
                           connected db to db\PYGZus{}structure.xml
\end{Verbatim}

You need:
\begin{itemize}
\item {} 
Your desired database and its PHP connector installed.

\item {} 
The login and password of a database admin user.

\item {} 
The database port number, if it is a non-standard port.

\end{itemize}

This is example converts SQLite to MySQL/MariaDB:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ db:convert\PYGZhy{}type mysql oc\PYGZus{}dbuser 127.0.0.1
oc\PYGZus{}database
\end{Verbatim}

For a more detailed explanation see
{\hyperref[configuration_database/db_conversion::doc]{\emph{Converting Database Type}}}


\subsection{Encryption}
\label{configuration_server/occ_command:encryption}\label{configuration_server/occ_command:encryption-label}
\code{occ} includes a complete set of commands for managing encryption:

\begin{Verbatim}[commandchars=\\\{\}]
encryption
 encryption:change\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root   Change key storage root
 encryption:decrypt\PYGZhy{}all               Disable server\PYGZhy{}side encryption and
                                      decrypt all files
 encryption:disable                   Disable encryption
 encryption:enable                    Enable encryption
 encryption:enable\PYGZhy{}master\PYGZhy{}key         Enable the master key. Only available
                                      for fresh installations with no existing
                                      encrypted data! There is also no way to
                                      disable it again.
 encryption:encrypt\PYGZhy{}all               Encrypt all files for all users
 encryption:list\PYGZhy{}modules              List all available encryption modules
 encryption:migrate                   initial migration to encryption 2.0
 encryption:set\PYGZhy{}default\PYGZhy{}module        Set the encryption default module
 encryption:show\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root     Show current key storage root
 encryption:status                    Lists the current status of encryption
\end{Verbatim}

\code{encryption:status} shows whether you have active encryption, and your default
encryption module. To enable encryption you must first enable the Encryption
app, and then run \code{encryption:enable}:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ app:enable encryption
sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:enable
sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:status
 \PYGZhy{} enabled: true
 \PYGZhy{} defaultModule: OC\PYGZus{}DEFAULT\PYGZus{}MODULE
\end{Verbatim}

\code{encryption:change-key-storage-root} is for moving your encryption keys to a
different folder. It takes one argument, \code{newRoot}, which defines your new
root folder. The folder must exist, and the path is relative to your root ownCloud directory:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:change\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root ../../etc/oc\PYGZhy{}keys
\end{Verbatim}

You can see the current location of your keys folder:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:show\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root
Current key storage root:  default storage location (data/)
\end{Verbatim}

\code{encryption:list-modules} displays your available encryption modules. You will
see a list of modules only if you have enabled the Encryption app. Use
\code{encryption:set-default-module {[}module name{]}} to set your desired module.

\code{encryption:encrypt-all} encrypts all data files for all users. You must first
put your ownCloud server into {\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{single-user
mode}}} to prevent any user activity until encryption
is completed.

\code{encryption:decrypt-all} decrypts all user data files, or optionally a single
user:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:decrypt freda
\end{Verbatim}

Users must have enabled recovery keys on their Personal pages. You must first
put your ownCloud server into {\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{single-user
mode}}} to prevent any user activity until
decryption is completed.

Use \code{encryption:disable} to disable your encryption module. You must first put
your ownCloud server into {\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{single-user mode}}}
to prevent any user activity.

\code{encryption:enable-master-key} creates a new master key, which is used for all
user data instead of individual user keys. This is especially useful to enable
single-sign on. Use this only on fresh installations with no existing data, or
on systems where encryption has not already been enabled. It is not possible to
disable it.

\code{encryption:migrate} migrates encryption keys after a major ownCloud version
upgrade. You may optionally specify individual users in a space-delimited list.

See {\hyperref[configuration_files/encryption_configuration::doc]{\emph{Encryption Configuration}}} to learn more.


\subsection{Federation Sync}
\label{configuration_server/occ_command:federation-sync-label}\label{configuration_server/occ_command:federation-sync}
\begin{notice}{note}{Note:}
This command is only available when the ``Federation'' app (\code{federation}) is
enabled.
\end{notice}

Synchronize the addressbooks of all federated ownCloud servers:

\begin{Verbatim}[commandchars=\\\{\}]
federation:sync\PYGZhy{}addressbooks  Synchronizes addressbooks of all
                              federated clouds
\end{Verbatim}

In ownCloud 9.+, servers connected with federation shares can share user
address books, and auto-complete usernames in share dialogs. Use this command
to synchronize federated servers:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ federation:sync\PYGZhy{}addressbooks
\end{Verbatim}

Added in 9.0.


\subsection{File Operations}
\label{configuration_server/occ_command:file-operations-label}\label{configuration_server/occ_command:file-operations}
\code{occ} has three commands for managing files in ownCloud:

\begin{Verbatim}[commandchars=\\\{\}]
files
 files:cleanup              cleanup filecache
 files:scan                 rescan filesystem
 files:transfer\PYGZhy{}ownership   All files and folders are moved to another
                            user \PYGZhy{} shares are moved as well. (Added in 9.0)
\end{Verbatim}

The \code{files:scan} command scans for new files and updates the file cache. You
may rescan all files, per-user, a space-delimited list of users, and limit the
search path. If not using \code{-{-}quiet}, statistics will be shown at the end of
the scan:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ files:scan \PYGZhy{}\PYGZhy{}help
  Usage:
  files:scan [\PYGZhy{}p\textbar{}\PYGZhy{}\PYGZhy{}path=\PYGZdq{}...\PYGZdq{}] [\PYGZhy{}q\textbar{}\PYGZhy{}\PYGZhy{}quiet] [\PYGZhy{}v\textbar{}vv\textbar{}vvv \PYGZhy{}\PYGZhy{}verbose] [\PYGZhy{}\PYGZhy{}all]
  [user\PYGZus{}id1] ... [user\PYGZus{}idN]

Arguments:
  user\PYGZus{}id               will rescan all files of the given user(s)

Options:
  \PYGZhy{}\PYGZhy{}path                limit rescan to the user/path given
  \PYGZhy{}\PYGZhy{}all                 will rescan all files of all known users
  \PYGZhy{}\PYGZhy{}quiet               suppress any output
  \PYGZhy{}\PYGZhy{}verbose             files and directories being processed are shown
                        additionally during scanning
  \PYGZhy{}\PYGZhy{}unscanned           scan only previously unscanned files
\end{Verbatim}

Verbosity levels of \code{-vv} or \code{-vvv} are automatically reset to \code{-v}

Note for option --unscanned:
In general there is a background job (through cron) that will do that scan periodically.
The --unscanned option makes it possible to trigger this from the CLI.

When using the \code{-{-}path} option, the path must consist of following
components:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdq{}user\PYGZus{}id/files/path\PYGZdq{}
  or
\PYGZdq{}user\PYGZus{}id/files/mount\PYGZus{}name\PYGZdq{}
  or
\PYGZdq{}user\PYGZus{}id/files/mount\PYGZus{}name/path\PYGZdq{}
\end{Verbatim}

where the term \code{files} is mandatory.

Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{path}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{/alice/files/Music}\PYG{l+s}{\PYGZdq{}}
\end{Verbatim}

In the example above, the user\_id \code{alice} is determined implicitly from the
path component given.

The \code{-{-}path}, \code{-{-}all} and \code{{[}user\_id{]}} parameters and are exclusive - only
one must be specified.

\code{files:cleanup} tidies up the server's file cache by deleting all file
entries that have no matching entries in the storage table.

You may transfer all files and shares from one user to another. This is useful
before removing a user:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ files:transfer\PYGZhy{}ownership \PYGZlt{}source\PYGZhy{}user\PYGZgt{}
\PYGZlt{}destination\PYGZhy{}user\PYGZgt{}
\end{Verbatim}


\subsection{Files External}
\label{configuration_server/occ_command:files-external}\label{configuration_server/occ_command:files-external-label}
These commands replace the \code{data/mount.json} configuration file used in
ownCloud releases before 9.0.

\begin{notice}{note}{Note:}
These commands are only available when the ``External storage support'' app
(\code{files\_external}) is enabled.
\end{notice}

Commands for managing external storage:

\begin{Verbatim}[commandchars=\\\{\}]
files\PYGZus{}external
 files\PYGZus{}external:applicable  Manage applicable users and groups for a mount
 files\PYGZus{}external:backends    Show available authentication and storage backends
 files\PYGZus{}external:config      Manage backend configuration for a mount
 files\PYGZus{}external:create      Create a new mount configuration
 files\PYGZus{}external:delete      Delete an external mount
 files\PYGZus{}external:export      Export mount configurations
 files\PYGZus{}external:import      Import mount configurations
 files\PYGZus{}external:list        List configured mounts
 files\PYGZus{}external:option      Manage mount options for a mount
 files\PYGZus{}external:verify      Verify mount configuration
\end{Verbatim}

These commands replicate the functionality in the ownCloud Web GUI, plus two new
features:  \code{files\_external:export} and \code{files\_external:import}.

Use \code{files\_external:export} to export all admin mounts to stdout, and
\code{files\_external:export {[}user\_id{]}} to export the mounts of the specified
ownCloud user.

Use \code{files\_external:import {[}filename{]}} to import legacy JSON configurations,
and to copy external mount configurations to another ownCloud server.

Added in 9.0.


\subsection{Integrity Check}
\label{configuration_server/occ_command:integrity-check}\label{configuration_server/occ_command:integrity-check-label}
Apps which have an official tag MUST be code signed starting with ownCloud 9.0. Unsigned official apps won't be installable anymore. Code signing is optional for all third-party applications:

\begin{Verbatim}[commandchars=\\\{\}]
integrity
 integrity:check\PYGZhy{}app                 Check app integrity using a signature.
 integrity:check\PYGZhy{}core                Check core integrity using a signature.
 integrity:sign\PYGZhy{}app                  Signs an app using a private key.
 integrity:sign\PYGZhy{}core                 Sign core using a private key
\end{Verbatim}

After creating your signing key, sign your app like this example:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ integrity:sign\PYGZhy{}app \PYGZhy{}\PYGZhy{}privateKey=/Users/lukasreschke/contacts.key \PYGZhy{}\PYGZhy{}certificate=/Users/lukasreschke/CA/contacts.crt \PYGZhy{}\PYGZhy{}path=/Users/lukasreschke/Programming/contacts
\end{Verbatim}

Verify your app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ integrity:check\PYGZhy{}app \PYGZhy{}\PYGZhy{}path=/pathto/app appname
\end{Verbatim}

When it returns nothing, your app is signed correctly. When it returns a message then there is an error. See \href{https://doc.owncloud.org/server/9.0/developer\_manual/app/code\_signing.html\#how-to-get-your-app-signed}{Code Signing} in the Developer manual for more detailed information.

\code{integrity:sign-core} is for ownCloud core developers only.

See {\hyperref[issues/code_signing::doc]{\emph{Code Signing}}} to learn more.

Added in 9.0.


\subsection{l10n, Create Javascript Translation Files for Apps}
\label{configuration_server/occ_command:l10n-create-javascript-translation-files-for-apps}\label{configuration_server/occ_command:create-javascript-translation-files-label}
This command is for app developers to update their translation mechanism from
ownCloud 7 to ownCloud 8 and later.


\subsection{LDAP Commands}
\label{configuration_server/occ_command:ldap-commands}\label{configuration_server/occ_command:ldap-commands-label}
\begin{notice}{note}{Note:}
These commands are only available when the ``LDAP user and group backend'' app
(\code{user\_ldap}) is enabled.
\end{notice}

These LDAP commands appear only when you have enabled the LDAP app. Then
you can run the following LDAP commands with \code{occ}:

\begin{Verbatim}[commandchars=\\\{\}]
ldap
 ldap:check\PYGZhy{}user               checks whether a user exists on LDAP.
 ldap:create\PYGZhy{}empty\PYGZhy{}config      creates an empty LDAP configuration
 ldap:delete\PYGZhy{}config            deletes an existing LDAP configuration
 ldap:search                   executes a user or group search
 ldap:set\PYGZhy{}config               modifies an LDAP configuration
 ldap:show\PYGZhy{}config              shows the LDAP configuration
 ldap:show\PYGZhy{}remnants            shows which users are not available on
                               LDAP anymore, but have remnants in
                               ownCloud.
 ldap:test\PYGZhy{}config              tests an LDAP configuration
\end{Verbatim}

Search for an LDAP user, using this syntax:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:search [\PYGZhy{}\PYGZhy{}group] [\PYGZhy{}\PYGZhy{}offset=\PYGZdq{}...\PYGZdq{}]
[\PYGZhy{}\PYGZhy{}limit=\PYGZdq{}...\PYGZdq{}] search
\end{Verbatim}

Searches will match at the beginning of the attribute value only. This example
searches for givenNames that start with ``rob'':

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:search \PYGZdq{}rob\PYGZdq{}
\end{Verbatim}

This will find robbie, roberta, and robin. Broaden the search to find, for
example, \code{jeroboam} with the asterisk wildcard:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:search \PYGZdq{}*rob\PYGZdq{}
\end{Verbatim}

User search attributes are set with \code{ldap:set-config}
(below). For example, if your search attributes are
\code{givenName} and \code{sn} you can find users by first name + last name very
quickly. For example, you'll find Terri Hanson by searching for \code{te ha}.
Trailing whitespaces are ignored.

Check if an LDAP user exists. This works only if the ownCloud server is
connected to an LDAP server:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:check\PYGZhy{}user robert
\end{Verbatim}

\code{ldap:check-user} will not run a check when it finds a disabled LDAP
connection. This prevents users that exist on disabled LDAP connections from
being marked as deleted. If you know for certain that the user you are searching for
is not in one of the disabled connections, and exists on an active connection,
use the \code{-{-}force} option to force it to check all active LDAP connections:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:check\PYGZhy{}user \PYGZhy{}\PYGZhy{}force robert
\end{Verbatim}

\code{ldap:create-empty-config} creates an empty LDAP configuration. The first
one you create has no \code{configID}, like this example:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:create\PYGZhy{}empty\PYGZhy{}config
  Created new configuration with configID \PYGZsq{}\PYGZsq{}
\end{Verbatim}

This is a holdover from the early days, when there was no option to create
additional configurations. The second, and all subsequent, configurations
that you create are automatically assigned IDs:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:create\PYGZhy{}empty\PYGZhy{}config
   Created new configuration with configID \PYGZsq{}s01\PYGZsq{}
\end{Verbatim}

Then you can list and view your configurations:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:show\PYGZhy{}config
\end{Verbatim}

And view the configuration for a single configID:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:show\PYGZhy{}config s01
\end{Verbatim}

\code{ldap:delete-config {[}configID{]}} deletes an existing LDAP configuration:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:delete  s01
Deleted configuration with configID \PYGZsq{}s01\PYGZsq{}
\end{Verbatim}

The \code{ldap:set-config} command is for manipulating configurations, like this
example that sets search attributes:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:set\PYGZhy{}config s01 ldapAttributesForUserSearch
\PYGZdq{}cn;givenname;sn;displayname;mail\PYGZdq{}
\end{Verbatim}

\code{ldap:test-config} tests whether your configuration is correct and can bind to
the server:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:test\PYGZhy{}config s01
The configuration is valid and the connection could be established!
\end{Verbatim}

\code{ldap:show-remnants} is for cleaning up the LDAP mappings table, and is
documented in {\hyperref[configuration_user/user_auth_ldap_cleanup::doc]{\emph{LDAP User Cleanup}}}.


\subsection{Logging Commands}
\label{configuration_server/occ_command:logging-commands-label}\label{configuration_server/occ_command:logging-commands}
These commands view and configure your ownCloud logging preferences:

\begin{Verbatim}[commandchars=\\\{\}]
log
 log:manage     manage logging configuration
 log:owncloud   manipulate ownCloud logging backend
\end{Verbatim}

Run \code{log:owncloud} to see your current logging status:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ log:owncloud
Log backend ownCloud: enabled
Log file: /opt/owncloud/data/owncloud.log
Rotate at: disabled
\end{Verbatim}

Use the \code{-{-}enable} option to turn on logging. Use \code{-{-}file} to set a
different log file path. Set your rotation by log file size in bytes with
\code{-{-}rotate-size}; 0 disables rotation.

\code{log:manage} sets your logging backend, log level, and timezone. The defaults
are \code{owncloud}, \code{Warning}, and \code{UTC}. Available options are:
\begin{itemize}
\item {} 
--backend {[}owncloud, syslog, errorlog{]}

\item {} 
--level {[}debug, info, warning, error{]}

\end{itemize}


\subsection{Maintenance Commands}
\label{configuration_server/occ_command:maintenance-commands}\label{configuration_server/occ_command:maintenance-commands-label}
Use these commands when you upgrade ownCloud, manage encryption, perform
backups and other tasks that require locking users out until you are finished:

\begin{Verbatim}[commandchars=\\\{\}]
maintenance
 maintenance:data\PYGZhy{}fingerprint        update the systems data\PYGZhy{}fingerprint after
                                     a backup is restored
 maintenance:mimetype:update\PYGZhy{}db      Update database mimetypes and update
                                     filecache
 maintenance:mimetype:update\PYGZhy{}js      Update mimetypelist.js
 maintenance:mode                    set maintenance mode
 maintenance:repair                  repair this installation
 maintenance:singleuser              set single user mode
 maintenance:update:htaccess         Updates the .htaccess file
\end{Verbatim}

\code{maintenance:mode} locks the sessions of all logged-in users, including
administrators, and displays a status screen warning that the server is in
maintenance mode. Users who are not already logged in cannot log in until
maintenance mode is turned off. When you take the server out of maintenance mode
logged-in users must refresh their Web browsers to continue working:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}on
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}off
\end{Verbatim}

Putting your ownCloud server into single-user mode allows admins to log in and
work, but not ordinary users. This is useful for performing maintenance and
troubleshooting on a running server:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:singleuser \PYGZhy{}\PYGZhy{}on
Single user mode enabled
\end{Verbatim}

Turn it off when you're finished:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:singleuser \PYGZhy{}\PYGZhy{}off
Single user mode disabled
\end{Verbatim}

Run \code{maintenance:data-fingerprint} to tell desktop and mobile clients that a
server backup has been restored. Users will be prompted to resolve any
conflicts between newer and older file versions.

The \code{maintenance:repair} command runs automatically during upgrades to clean
up the database, so while you can run it manually there usually isn't a need
to:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:repair
\end{Verbatim}

\code{maintenance:mimetype:update-db} updates the ownCloud database and file cache
with changed mimetypes found in \code{config/mimetypemapping.json}. Run this
command after modifying \code{config/mimetypemapping.json}. If you change a
mimetype, run \code{maintenance:mimetype:update-db -{-}repair-filecache} to apply the
change to existing files.


\subsection{Security}
\label{configuration_server/occ_command:security}\label{configuration_server/occ_command:security-commands-label}
Use these commands to manage server-wide SSL certificates. These are useful when you create federation shares with other ownCloud servers that use self-signed certificates:

\begin{Verbatim}[commandchars=\\\{\}]
security
 security:certificates         list trusted certificates
 security:certificates:import  import trusted certificate
 security:certificates:remove  remove trusted certificate
\end{Verbatim}

This example lists your installed certificates:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ security:certificates
\end{Verbatim}

Import a new certificate:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ security:import /path/to/certificate
\end{Verbatim}

Remove a certificate:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ security:remove [certificate name]
\end{Verbatim}


\subsection{Shibboleth Modes (Enterprise Edition only)}
\label{configuration_server/occ_command:shibboleth-modes-enterprise-edition-only}\label{configuration_server/occ_command:shibboleth-label}
\begin{notice}{note}{Note:}
This command is only available when the ``Shibboleth user backend'' app
(\code{user\_shibboleth}) is enabled.
\end{notice}

\code{shibboleth:mode} sets your Shibboleth mode to \code{notactive},
\code{autoprovision}, or \code{ssoonly}:

\begin{Verbatim}[commandchars=\\\{\}]
shibboleth:mode [mode]
\end{Verbatim}


\subsection{Trashbin}
\label{configuration_server/occ_command:trashbin-label}\label{configuration_server/occ_command:trashbin}
\begin{notice}{note}{Note:}
This command is only available when the ``Deleted files'' app
(\code{files\_trashbin}) is enabled.
\end{notice}

\begin{Verbatim}[commandchars=\\\{\}]
trashbin
 trashbin:cleanup   Remove deleted files
 trashbin:expire    Expires the users trashbin
\end{Verbatim}

The \code{trashbin:cleanup} command removes the deleted files of the specified
users in a space-delimited list, or all users if none are specified. This example removes all the deleted files of all users:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ trashbin:cleanup
Remove all deleted files
Remove deleted files for users on backend Database
 freda
 molly
 stash
 rosa
 edward
\end{Verbatim}

This example removes the deleted files of users molly and freda:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ trashbin:cleanup molly freda
Remove deleted files of   molly
Remove deleted files of   freda
\end{Verbatim}

\code{trashbin:expire} deletes only expired files according to the \code{trashbin\_retention\_obligation} setting in \code{config.php} (see the Deleted Files section in {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}). The default is to delete expired files for all users, or you may list users in a space-delimited list.


\subsection{User Commands}
\label{configuration_server/occ_command:user-commands}\label{configuration_server/occ_command:user-commands-label}
The \code{user} commands create and remove users, reset passwords, display a simple
report showing how many users you have, and when a user was last logged in:

\begin{Verbatim}[commandchars=\\\{\}]
user
 user:add                            adds a user
 user:delete                         deletes the specified user
 user:disable                        disables the specified user
 user:enable                         enables the specified user
 user:lastseen                       shows when the user was logged in last time
 user:report                         shows how many users have access
 user:resetpassword                  Resets the password of the named user
 user:setting                        Read and modify user settings
\end{Verbatim}

You can create a new user with their display name, login name, and any group
memberships with the \code{user:add} command. The syntax is:

\begin{Verbatim}[commandchars=\\\{\}]
user:add [\PYGZhy{}\PYGZhy{}password\PYGZhy{}from\PYGZhy{}env] [\PYGZhy{}\PYGZhy{}display\PYGZhy{}name[=\PYGZdq{}...\PYGZdq{}]] [\PYGZhy{}g\textbar{}\PYGZhy{}\PYGZhy{}group[=\PYGZdq{}...\PYGZdq{}]]
uid
\end{Verbatim}

The \code{display-name} corresponds to the \textbf{Full Name} on the Users page in your
ownCloud Web UI, and the \code{uid} is their \textbf{Username}, which is their
login name. This example adds new user Layla Smith, and adds her to the
\textbf{users} and \textbf{db-admins} groups. Any groups that do not exist are created:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:add \PYGZhy{}\PYGZhy{}display\PYGZhy{}name=\PYGZdq{}Layla Smith\PYGZdq{}
  \PYGZhy{}\PYGZhy{}group=\PYGZdq{}users\PYGZdq{} \PYGZhy{}\PYGZhy{}group=\PYGZdq{}db\PYGZhy{}admins\PYGZdq{} layla
  Enter password:
  Confirm password:
  The user \PYGZdq{}layla\PYGZdq{} was created successfully
  Display name set to \PYGZdq{}Layla Smith\PYGZdq{}
  User \PYGZdq{}layla\PYGZdq{} added to group \PYGZdq{}users\PYGZdq{}
  User \PYGZdq{}layla\PYGZdq{} added to group \PYGZdq{}db\PYGZhy{}admins\PYGZdq{}
\end{Verbatim}

Go to your Users page, and you will see your new user.

\code{password-from-env} allows you to set the user's password from an environment
variable. This prevents the password from being exposed to all users via the
process list, and will only be visible in the history of the user (root)
running the command. This also permits creating scripts for adding multiple new
users.

To use \code{password-from-env} you must run as ``real'' root, rather than \code{sudo},
because \code{sudo} strips environment variables. This example adds new user Fred
Jones:

\begin{Verbatim}[commandchars=\\\{\}]
export OC\PYGZus{}PASS=newpassword
su \PYGZhy{}s /bin/sh www\PYGZhy{}data \PYGZhy{}c \PYGZsq{}php occ user:add \PYGZhy{}\PYGZhy{}password\PYGZhy{}from\PYGZhy{}env
  \PYGZhy{}\PYGZhy{}display\PYGZhy{}name=\PYGZdq{}Fred Jones\PYGZdq{} \PYGZhy{}\PYGZhy{}group=\PYGZdq{}users\PYGZdq{} fred\PYGZsq{}
The user \PYGZdq{}fred\PYGZdq{} was created successfully
Display name set to \PYGZdq{}Fred Jones\PYGZdq{}
User \PYGZdq{}fred\PYGZdq{} added to group \PYGZdq{}users\PYGZdq{}
\end{Verbatim}

You can reset any user's password, including administrators (see
{\hyperref[configuration_user/reset_admin_password::doc]{\emph{Resetting a Lost Admin Password}}}):

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:resetpassword layla
  Enter a new password:
  Confirm the new password:
  Successfully reset password for layla
\end{Verbatim}

You may also use \code{password-from-env} to reset passwords:

\begin{Verbatim}[commandchars=\\\{\}]
export OC\PYGZus{}PASS=newpassword
su \PYGZhy{}s /bin/sh www\PYGZhy{}data \PYGZhy{}c \PYGZsq{}php occ user:resetpassword \PYGZhy{}\PYGZhy{}password\PYGZhy{}from\PYGZhy{}env
  layla\PYGZsq{}
  Successfully reset password for layla
\end{Verbatim}

You can delete users:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:delete fred
\end{Verbatim}

View a user's most recent login:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:lastseen layla
  layla\PYGZsq{}s last login: 09.01.2015 18:46
\end{Verbatim}

Read user settings:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:setting layla
  \PYGZhy{} core:
    \PYGZhy{} lang: en
  \PYGZhy{} login:
    \PYGZhy{} lastLogin: 1465910968
  \PYGZhy{} settings:
    \PYGZhy{} email: layla@example.tld
\end{Verbatim}

Filter by app:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:setting layla core
  \PYGZhy{} core:
    \PYGZhy{} lang: en
\end{Verbatim}

Get a single setting:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:setting layla core lang
en
\end{Verbatim}

Set a setting:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:setting layla settings email \PYGZhy{}\PYGZhy{}value \PYGZdq{}new\PYGZhy{}layla@example.tld\PYGZdq{}
\end{Verbatim}

Delete a setting:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:setting layla settings email \PYGZhy{}\PYGZhy{}delete
\end{Verbatim}

Generate a simple report that counts all users, including users on external user
authentication servers such as LDAP:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:report
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} User Report      \textbar{}    \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} Database         \textbar{} 12 \textbar{}
\textbar{} LDAP             \textbar{} 86 \textbar{}
\textbar{}                  \textbar{}    \textbar{}
\textbar{} total users      \textbar{} 98 \textbar{}
\textbar{}                  \textbar{}    \textbar{}
\textbar{} user directories \textbar{} 2  \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\end{Verbatim}


\subsection{Versions}
\label{configuration_server/occ_command:versions-label}\label{configuration_server/occ_command:versions}
\begin{notice}{note}{Note:}
This command is only available when the ``Versions'' app (\code{files\_versions}) is
enabled.
\end{notice}

\begin{Verbatim}[commandchars=\\\{\}]
versions
 versions:cleanup   Delete versions
 versions:expire    Expires the users file versions
\end{Verbatim}

Use \code{versions:cleanup} to delete all older file versions for specific users (keeping the most recent versions), or for all users when none are specified.

This example deletes all files versions for all users, except the most recent versions:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ versions:cleanup
Delete all versions
Delete versions for users on backend Database
  freda
  molly
  stash
  rosa
  edward
\end{Verbatim}

You can delete versions for specific users in a space-delimited list:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ versions:cleanup freda molly
Delete versions of   freda
Delete versions of   molly
\end{Verbatim}

\code{versions:expire} Deletes only expired files according to the \code{versions\_retention\_obligation} setting in \code{config.php} (see the File versions section in {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}). The default is to delete expired files for all users, or you may list users in a space-delimited list.


\subsection{Command Line Installation}
\label{configuration_server/occ_command:command-line-installation-label}\label{configuration_server/occ_command:command-line-installation}
These commands are available only after you have downloaded and unpacked the
ownCloud archive, and taken no further installation steps.

You can install ownCloud entirely from the command line. After downloading the
tarball and copying ownCloud into the appropriate directories, or
after installing ownCloud packages (See
{\hyperref[installation/linux_installation::doc]{\emph{Preferred Linux Installation Method}}} and
{\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}}) you can use \code{occ} commands in
place of running the graphical Installation Wizard.

Apply correct permissions to your ownCloud directories; see
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}. Then choose your \code{occ} options. This lists your
available options:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php /var/www/owncloud/occ
ownCloud is not installed \PYGZhy{} only a limited number of commands are available
ownCloud version 9.0.0

Usage:
 [options] command [arguments]

Options:
 \PYGZhy{}\PYGZhy{}help (\PYGZhy{}h)           Display this help message
 \PYGZhy{}\PYGZhy{}quiet (\PYGZhy{}q)          Do not output any message
 \PYGZhy{}\PYGZhy{}verbose (\PYGZhy{}v\textbar{}vv\textbar{}vvv) Increase the verbosity of messages: 1 for normal
 output,  2 for more verbose output and 3 for debug
 \PYGZhy{}\PYGZhy{}version (\PYGZhy{}V)        Display this application version
 \PYGZhy{}\PYGZhy{}ansi                Force ANSI output
 \PYGZhy{}\PYGZhy{}no\PYGZhy{}ansi             Disable ANSI output
 \PYGZhy{}\PYGZhy{}no\PYGZhy{}interaction (\PYGZhy{}n) Do not ask any interactive question

Available commands:
 check                 check dependencies of the server environment
 help                  Displays help for a command
 list                  Lists commands
 status                show some status information
 app
 app:check\PYGZhy{}code        check code to be compliant
 l10n
 l10n:createjs         Create javascript translation files for a given app
 maintenance
 maintenance:install   install ownCloud
\end{Verbatim}

Display your \code{maintenance:install} options:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ help maintenance:install
ownCloud is not installed \PYGZhy{} only a limited number of commands are available
Usage:
 maintenance:install [\PYGZhy{}\PYGZhy{}database=\PYGZdq{}...\PYGZdq{}] [\PYGZhy{}\PYGZhy{}database\PYGZhy{}name=\PYGZdq{}...\PYGZdq{}]
[\PYGZhy{}\PYGZhy{}database\PYGZhy{}host=\PYGZdq{}...\PYGZdq{}] [\PYGZhy{}\PYGZhy{}database\PYGZhy{}user=\PYGZdq{}...\PYGZdq{}] [\PYGZhy{}\PYGZhy{}database\PYGZhy{}pass[=\PYGZdq{}...\PYGZdq{}]]
[\PYGZhy{}\PYGZhy{}database\PYGZhy{}table\PYGZhy{}prefix[=\PYGZdq{}...\PYGZdq{}]] [\PYGZhy{}\PYGZhy{}admin\PYGZhy{}user=\PYGZdq{}...\PYGZdq{}] [\PYGZhy{}\PYGZhy{}admin\PYGZhy{}pass=\PYGZdq{}...\PYGZdq{}]
[\PYGZhy{}\PYGZhy{}data\PYGZhy{}dir=\PYGZdq{}...\PYGZdq{}]

Options:
 \PYGZhy{}\PYGZhy{}database               Supported database type (default: \PYGZdq{}sqlite\PYGZdq{})
 \PYGZhy{}\PYGZhy{}database\PYGZhy{}name          Name of the database
 \PYGZhy{}\PYGZhy{}database\PYGZhy{}host          Hostname of the database (default: \PYGZdq{}localhost\PYGZdq{})
 \PYGZhy{}\PYGZhy{}database\PYGZhy{}user          User name to connect to the database
 \PYGZhy{}\PYGZhy{}database\PYGZhy{}pass          Password of the database user
 \PYGZhy{}\PYGZhy{}database\PYGZhy{}table\PYGZhy{}prefix  Prefix for all tables (default: oc\PYGZus{})
 \PYGZhy{}\PYGZhy{}admin\PYGZhy{}user             User name of the admin account (default: \PYGZdq{}admin\PYGZdq{})
 \PYGZhy{}\PYGZhy{}admin\PYGZhy{}pass             Password of the admin account
 \PYGZhy{}\PYGZhy{}data\PYGZhy{}dir               Path to data directory (default:
                          \PYGZdq{}/var/www/owncloud/data\PYGZdq{})
 \PYGZhy{}\PYGZhy{}help (\PYGZhy{}h)              Display this help message
 \PYGZhy{}\PYGZhy{}quiet (\PYGZhy{}q)             Do not output any message
 \PYGZhy{}\PYGZhy{}verbose (\PYGZhy{}v\textbar{}vv\textbar{}vvv)    Increase the verbosity of messages: 1 for normal
  output, 2 for more verbose output and 3 for debug
 \PYGZhy{}\PYGZhy{}version (\PYGZhy{}V)           Display this application version
 \PYGZhy{}\PYGZhy{}ansi                   Force ANSI output
 \PYGZhy{}\PYGZhy{}no\PYGZhy{}ansi                Disable ANSI output
 \PYGZhy{}\PYGZhy{}no\PYGZhy{}interaction (\PYGZhy{}n)    Do not ask any interactive question
\end{Verbatim}

This example completes the installation:

\begin{Verbatim}[commandchars=\\\{\}]
cd /var/www/owncloud/
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:install \PYGZhy{}\PYGZhy{}database
\PYGZdq{}mysql\PYGZdq{} \PYGZhy{}\PYGZhy{}database\PYGZhy{}name \PYGZdq{}owncloud\PYGZdq{}  \PYGZhy{}\PYGZhy{}database\PYGZhy{}user \PYGZdq{}root\PYGZdq{} \PYGZhy{}\PYGZhy{}database\PYGZhy{}pass
\PYGZdq{}password\PYGZdq{} \PYGZhy{}\PYGZhy{}admin\PYGZhy{}user \PYGZdq{}admin\PYGZdq{} \PYGZhy{}\PYGZhy{}admin\PYGZhy{}pass \PYGZdq{}password\PYGZdq{}
ownCloud is not installed \PYGZhy{} only a limited number of commands are available
ownCloud was successfully installed
\end{Verbatim}

Supported databases are:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZhy{} sqlite (SQLite3 \PYGZhy{} ownCloud Community edition only)
\PYGZhy{} mysql (MySQL/MariaDB)
\PYGZhy{} pgsql (PostgreSQL)
\PYGZhy{} oci (Oracle \PYGZhy{} ownCloud Enterprise edition only)
\end{Verbatim}


\subsection{Command Line Upgrade}
\label{configuration_server/occ_command:command-line-upgrade-label}\label{configuration_server/occ_command:command-line-upgrade}
These commands are available only after you have downloaded upgraded packages or
tar archives, and before you complete the upgrade.

List all options, like this example on CentOS Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade \PYGZhy{}h
Usage:
 upgrade [options]

Options:
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}app\PYGZhy{}disable  skips the disable of third party apps
 \PYGZhy{}h, \PYGZhy{}\PYGZhy{}help            Display this help message
 \PYGZhy{}q, \PYGZhy{}\PYGZhy{}quiet           Do not output any message
 \PYGZhy{}V, \PYGZhy{}\PYGZhy{}version         Display this application version
     \PYGZhy{}\PYGZhy{}ansi            Force ANSI output
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}ansi         Disable ANSI output
 \PYGZhy{}n, \PYGZhy{}\PYGZhy{}no\PYGZhy{}interaction  Do not ask any interactive question
     \PYGZhy{}\PYGZhy{}no\PYGZhy{}warnings     Skip global warnings, show command output only
 \PYGZhy{}v\textbar{}vv\textbar{}vvv, \PYGZhy{}\PYGZhy{}verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Help:
 run upgrade routines after installation of a new release. The release has to be installed before.
\end{Verbatim}

When you are performing an update or upgrade on your ownCloud server (see the
Maintenance section of this manual), it is better to use \code{occ} to perform the
database upgrade step, rather than the Web GUI, in order to avoid timeouts. PHP
scripts invoked from the Web interface are limited to 3600 seconds. In larger
environments this may not be enough, leaving the system in an inconsistent
state. After performing all the preliminary steps (see
{\hyperref[maintenance/upgrade::doc]{\emph{How to Upgrade Your ownCloud Server}}}) use this command to upgrade your databases,
like this example on CentOS Linux. Note how it details the steps:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade
ownCloud or one of the apps require upgrade \PYGZhy{} only a limited number of
commands are available
Turned on maintenance mode
Checked database schema update
Checked database schema update for apps
Updated database
Updating \PYGZlt{}gallery\PYGZgt{} ...
Updated \PYGZlt{}gallery\PYGZgt{} to 0.6.1
Updating \PYGZlt{}activity\PYGZgt{} ...
Updated \PYGZlt{}activity\PYGZgt{} to 2.1.0
Update successful
Turned off maintenance mode
\end{Verbatim}

Enabling verbosity displays timestamps:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade \PYGZhy{}v
ownCloud or one of the apps require upgrade \PYGZhy{} only a limited number of commands are available
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Turned on maintenance mode
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Checked database schema update
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Checked database schema update for apps
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Updated database
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Updated \PYGZlt{}files\PYGZus{}sharing\PYGZgt{} to 0.6.6
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Update successful
2015\PYGZhy{}06\PYGZhy{}23T09:06:15+0000 Turned off maintenance mode
\end{Verbatim}

If there is an error it throws an exception, and the error is detailed in your
ownCloud logfile, so you can use the log output to figure out what went wrong,
or to use in a bug report:

\begin{Verbatim}[commandchars=\\\{\}]
Turned on maintenance mode
Checked database schema update
Checked database schema update for apps
Updated database
Updating \PYGZlt{}files\PYGZus{}sharing\PYGZgt{} ...
Exception
ServerNotAvailableException: LDAP server is not available
Update failed
Turned off maintenance mode
\end{Verbatim}

In ownCloud 9.2 the migration simulation has been removed, so the \code{-{-}skip-migration-test} and \code{-{-}dry-run} commands are no longer available.


\subsection{Two-factor Authentication}
\label{configuration_server/occ_command:two-factor-auth-label}\label{configuration_server/occ_command:two-factor-authentication}
If a two-factor provider app is enabled, it is enabled for all users by default
(though the provider can decide whether or not the user has to pass the challenge).
In the case of an user losing access to the second factor (e.g. lost phone with
two-factor SMS verification), the admin can temporarily disable the two-factor
check for that user via the occ command:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ twofactor:disable \PYGZlt{}username\PYGZgt{}
\end{Verbatim}

To re-enable two-factor auth again use the following commmand:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ twofactor:enable \PYGZlt{}username\PYGZgt{}
\end{Verbatim}


\subsection{Disable Users}
\label{configuration_server/occ_command:disable-users}\label{configuration_server/occ_command:disable-user-label}
Admins can disable users via the occ command too:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:disable \PYGZlt{}username\PYGZgt{}
\end{Verbatim}

Use the following command to enable the user again:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ user:enable \PYGZlt{}username\PYGZgt{}
\end{Verbatim}

Note that once users are disabled, their connected browsers will be disconnected.


\section{Configuring the Activity App}
\label{configuration_server/activity_configuration::doc}\label{configuration_server/activity_configuration:configuring-the-activity-app}
You can configure your ownCloud server to automatically send out e-mail notifications
to your users for various events like:
\begin{itemize}
\item {} 
A file or folder has been shared

\item {} 
A new file or folder has been created

\item {} 
A file or folder has been changed

\item {} 
A file or folder has been deleted

\end{itemize}

Users can see actions (delete, add, modify) that happen to files they have access to.
Sharing actions are only visible to the sharer and sharee.


\subsection{Enabling the Activity App}
\label{configuration_server/activity_configuration:enabling-the-activity-app}
The Activity App is shipped and enabled by default. If it is not enabled
simply go to your ownCloud Apps page to enable it.


\subsection{Configuring your ownCloud for the Activity App}
\label{configuration_server/activity_configuration:configuring-your-owncloud-for-the-activity-app}
To configure your ownCloud to send out e-mail notifications a working
{\hyperref[configuration_server/email_configuration::doc]{\emph{Email Configuration}}} is mandatory.

Furthermore it is recommended to configure the background job \code{Webcron} or
\code{Cron} as described in {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}}.

There is also a configuration option \code{activity\_expire\_days} available in your
\code{config.php} (See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}) which allows
you to clean-up older activies from the database.


\section{Configuring the ClamAV Antivirus Scanner}
\label{configuration_server/antivirus_configuration::doc}\label{configuration_server/antivirus_configuration:configuring-the-clamav-antivirus-scanner}
You can configure your ownCloud server to automatically run a virus scan on
newly-uploaded files with the Antivirus App for Files. The Antivirus App for
Files integrates the open source anti-virus engine \href{http://www.clamav.net/index.html}{ClamAV}  with ownCloud. ClamAV detects all forms
of malware including Trojan horses, viruses, and worms, and it operates on all
major file types including Windows, Linux, and Mac files, compressed files,
executables, image files, Flash, PDF, and many others. ClamAV's Freshclam
daemon automatically updates its malware signature database at scheduled
intervals.

ClamAV runs on Linux and any Unix-type operating system, and Microsoft Windows.
However, it has only been tested with ownCloud on Linux, so these instructions
are for Linux systems. You must first install ClamAV, and then install and
configure the Antivirus App for Files on ownCloud.


\subsection{Installing ClamAV}
\label{configuration_server/antivirus_configuration:installing-clamav}
As always, the various Linux distributions manage installing and configuring
ClamAV in different ways.
\begin{description}
\item[{Debian, Ubuntu, Linux Mint}] \leavevmode
On Debian and Ubuntu systems, and their many variants, install ClamAV with
these commands:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get install clamav clamav\PYGZhy{}daemon
\end{Verbatim}

\end{description}

The installer automatically creates default configuration files and launches the
\code{clamd} and \code{freshclam} daemons. You don't have to do anything more, though
it's a good idea to review the ClamAV documentation and your settings in
\code{/etc/clamav/}. Enable verbose logging in both \code{clamd.conf} and
\code{freshclam.conf} until you get any kinks worked out.
\begin{description}
\item[{Red Hat 7, CentOS 7}] \leavevmode
On Red Hat 7 and related systems you must install the Extra Packages for
Enterprise Linux (EPEL) repository, and then install ClamAV:

\begin{Verbatim}[commandchars=\\\{\}]
yum install epel\PYGZhy{}release
yum install clamav clamav\PYGZhy{}scanner clamav\PYGZhy{}scanner\PYGZhy{}systemd clamav\PYGZhy{}server
clamav\PYGZhy{}server\PYGZhy{}systemd clamav\PYGZhy{}update
\end{Verbatim}

\end{description}

This installs two configuration files: \code{/etc/freshclam.conf} and
\code{/etc/clamd.d/scan.conf}. You must edit both of these before you can run
ClamAV. Both files are well-commented, and \code{man clamd.conf} and \code{man
freshclam.conf} explain all the options.  Refer to \code{/etc/passwd} and
\code{/etc/group} when you need to verify the ClamAV user and group.

First edit \code{/etc/freshclam.conf} and configure your options.
\code{freshclam} updates your malware database, so you want it to run frequently to
get updated malware signatures. Run it manually post-installation to download
your first set of malware signatures:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{freshclam}
\end{Verbatim}

The EPEL packages do not include an init file for \code{freshclam}, so the quick
and easy way to set it up for regular checks is with a cron job. This example
runs it every hour at 47 minutes past the hour:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} m   h  dom mon dow  command
  47  *  *   *    *  /usr/bin/freshclam \PYGZhy{}\PYGZhy{}quiet
\end{Verbatim}

Please avoid any multiples of 10, because those are when the ClamAV servers are
hit the hardest for updates.

Next, edit \code{/etc/clamd.d/scan.conf}. When you're finished you must enable
the \code{clamd} service file and start \code{clamd}:

\begin{Verbatim}[commandchars=\\\{\}]
systemctl enable clamd@scan.service
systemctl start clamd@scan.service
\end{Verbatim}

That should take care of everything. Enable verbose logging in \code{scan.conf}
and \code{freshclam.conf} until it is running the way you want.


\subsection{Enabling the Antivirus App for Files}
\label{configuration_server/antivirus_configuration:enabling-the-antivirus-app-for-files}
Simply go to your ownCloud Apps page to enable it.
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-app.png}
\end{figure}


\subsection{Configuring ClamAV on ownCloud}
\label{configuration_server/antivirus_configuration:configuring-clamav-on-owncloud}
Next, go to your ownCloud Admin page and set your ownCloud logging level to
Everything.
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-logging.png}
\end{figure}

Now find your Antivirus Configuration panel on your Admin page.
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-config.png}
\end{figure}

ClamAV runs in one of three modes:
\begin{itemize}
\item {} 
Daemon (Socket): ClamAV is running on the same server as ownCloud. The ClamAV
daemon, \code{clamd}, runs in the background. When there is no activity \code{clamd}
places a minimal load on your system. If your users upload large volumes of
files you will see high CPU usage.

\item {} 
Daemon: ClamAV is running on a different server. This is a good option
for ownCloud servers with high volumes of file uploads.

\item {} 
Executable: ClamAV is running on the same server as ownCloud, and the
\code{clamscan} command is started and then stopped with each file upload.
\code{clamscan} is slow and not always reliable for on-demand usage; it is
better to use one of the daemon modes.

\end{itemize}
\begin{description}
\item[{Daemon (Socket)}] \leavevmode
ownCloud should detect your \code{clamd} socket and fill in the \code{Socket}
field. This is the \code{LocalSocket} option in \code{clamd.conf}. You can
run \code{netstat} to verify:

\begin{Verbatim}[commandchars=\\\{\}]
netstat \PYGZhy{}a\textbar{}grep clam
unix 2 [ ACC ] STREAM LISTENING 15857 /var/run/clamav/clamd.ctl
\end{Verbatim}
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-daemon-socket.png}
\end{figure}

The \code{Stream Length} value sets the number of bytes read in one pass.
10485760 bytes, or ten megabytes, is the default. This value should be
no larger than the PHP \code{memory\_limit} settings, or physical memory if
\code{memory\_limit} is set to -1 (no limit).

\code{Action for infected files found while scanning} gives you the choice of
logging any alerts without deleting the files, or immediately deleting
infected files.

\item[{Daemon}] \leavevmode
For the Daemon option you need the hostname or IP address of the remote
server running ClamAV, and the server's port number.
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-daemon-socket.png}
\end{figure}

\item[{Executable}] \leavevmode
The Executable option requires the path to \code{clamscan}, which is the
interactive ClamAV scanning command. ownCloud should find it automatically.
\begin{figure}[htbp]
\centering

\includegraphics{antivirus-executable.png}
\end{figure}

\end{description}

When you are satisfied with how ClamAV is operating, you might want to go
back and change all of your logging to less verbose levels.


\section{Configuring Memory Caching}
\label{configuration_server/caching_configuration:configuring-memory-caching}\label{configuration_server/caching_configuration::doc}
You can significantly improve your ownCloud server performance with memory
caching, where frequently-requested objects are stored in memory for faster
retrieval. There are two types of caches to use: a PHP opcode cache, which is
commonly called \emph{opcache}, and data caching for your Web server. If you do not
install and enable a local memcache you will see a warning on your ownCloud
admin page. \textbf{A memcache is not required and you may safely ignore the warning
if you prefer.}

\begin{notice}{note}{Note:}
If you enable only a distributed cache in
your \code{config.php} (\code{memcache.distributed}) and not a
local cache (\code{memcache.local}) you will still see the cache warning.
\end{notice}

A PHP opcache stores compiled PHP scripts so they don't need to be re-compiled
every time they are called. PHP bundles the Zend OPcache in core since version
5.5, so you don't need to install an opcache for PHP 5.6+.

Data caching is supplied by the Alternative PHP Cache, user (APCu) in PHP
5.6+, Memcached, or Redis.

ownCloud supports multiple memory caching backends, so you can choose the type
of memcache that best fits your needs. The supported caching backends are:
\begin{itemize}
\item {} \begin{description}
\item[{\href{https://pecl.php.net/package/APCu}{APCu}, APCu 4.0.6 and up required.}] \leavevmode
A local cache for systems running PHP 5.6 and up.

\end{description}

\item {} \begin{description}
\item[{\href{http://www.memcached.org/}{Memcached}}] \leavevmode
Distributed cache for multi-server ownCloud installations.

\end{description}

\item {} \begin{description}
\item[{\href{http://redis.io/}{Redis}, PHP module 2.2.6 and up required.}] \leavevmode
For distributed caching.

\end{description}

\end{itemize}

Memcaches must be explicitly configured in ownCloud 8.1 and up by installing
and enabling your desired cache, and then adding the appropriate entry to
\code{config.php} (See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}} for an overview of
all possible config parameters).

You may use both a local and a distributed cache. Recommended caches are APCu
and Redis. After installing and enabling your chosen memcache, verify that it is
active by running {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}}.


\subsection{APCu}
\label{configuration_server/caching_configuration:id1}
PHP 5.6 and up include the Zend OPcache in core, and on most Linux
distributions it is enabled by default. However, it does
not bundle a data cache. APCu is a data cache, and it is available in most
Linux distributions. On Red Hat/CentOS/Fedora systems running PHP 5.6 and up
install \code{php-pecl-apcu}. On Debian/Ubuntu/Mint systems install \code{php5-apcu}.
On Ubuntu 14.04LTS, the APCu version is 4.0.2, which is too old to use with ownCloud. ownCloud requires 4.0.6+. You may install 4.0.7 from Ubuntu backports with this command:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get install php5\PYGZhy{}apcu/trusty\PYGZhy{}backports
\end{Verbatim}

Then restart your Web server.

After restarting your Web server, add this line to your \code{config.php} file:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\end{Verbatim}

Refresh your ownCloud admin page, and the cache warning should disappear.


\subsection{Memcached}
\label{configuration_server/caching_configuration:id2}
Memcached is a reliable oldtimer for shared caching on distributed servers,
and performs well with ownCloud with one exception: it is not suitable to use
with {\hyperref[configuration_files/files_locking_transactional::doc]{\emph{Transactional File Locking}}}
because it does not store locks, and data can disappear from the cache at any time
(Redis is the best memcache for this).

\begin{notice}{note}{Note:}
Be sure to install the \textbf{memcached} PHP module, and not memcache, as
in the following examples. ownCloud supports only the \textbf{memcached} PHP
module.
\end{notice}

Setting up Memcached is easy. On Debian/Ubuntu/Mint install \code{memcached} and
\code{php5-memcached}. The installer will automatically start \code{memcached} and
configure it to launch at startup.

On Red Hat/CentOS/Fedora install \code{memcached} and
\code{php-pecl-memcached}. It will not start automatically, so you must use
your service manager to start \code{memcached}, and to launch it at boot as a
daemon.

You can verify that the Memcached daemon is running with \code{ps ax}:

\begin{Verbatim}[commandchars=\\\{\}]
ps ax \textbar{} grep memcached
19563 ? Sl 0:02 /usr/bin/memcached \PYGZhy{}m 64 \PYGZhy{}p 11211 \PYGZhy{}u memcache \PYGZhy{}l
127.0.0.1
\end{Verbatim}

Restart your Web server, add the appropriate entries to your
\code{config.php}, and refresh your ownCloud admin page. This example uses APCu
for the local cache, Memcached as the distributed memcache, and lists all the
servers in the shared cache pool with their port numbers:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\PYGZsq{}memcache.distributed\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Memcached\PYGZsq{},
\PYGZsq{}memcached\PYGZus{}servers\PYGZsq{} =\PYGZgt{} array(
     array(\PYGZsq{}localhost\PYGZsq{}, 11211),
     array(\PYGZsq{}server1.example.com\PYGZsq{}, 11211),
     array(\PYGZsq{}server2.example.com\PYGZsq{}, 11211),
     ),
\end{Verbatim}


\subsection{Redis}
\label{configuration_server/caching_configuration:id3}
Redis is an excellent modern memcache to use for both distributed caching, and
as a local cache for {\hyperref[configuration_files/files_locking_transactional::doc]{\emph{Transactional File Locking}}} because it guarantees
that cached objects are available for as long as they are needed.

The Redis PHP module must be version 2.2.6+. If you are running a Linux
distribution that does not package the supported versions of this module, or
does not package Redis at all, see {\hyperref[configuration_server/caching_configuration:install-redis-label]{\emph{Additional Redis Installation Help}}}.

On Debian/Ubuntu/Mint install \code{redis-server} and \code{php5-redis}. The installer
will automatically launch \code{redis-server} and configure it to launch at
startup.

On CentOS and Fedora install \code{redis} and \code{php-pecl-redis}. It will not
start automatically, so you must use your service manager to start
\code{redis}, and to launch it at boot as a daemon.

You can verify that the Redis daemon is running with \code{ps ax}:

\begin{Verbatim}[commandchars=\\\{\}]
ps ax \textbar{} grep redis
22203 ? Ssl    0:00 /usr/bin/redis\PYGZhy{}server 127.0.0.1:6379
\end{Verbatim}

Restart your Web server, add the appropriate entries to your \code{config.php}, and
refresh your ownCloud admin page. This example \code{config.php} configuration uses
Redis for the local server cache:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
     \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 6379,
      ),
\end{Verbatim}

For best performance, use Redis for file locking by adding this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\end{Verbatim}

If you want to connect to Redis configured to listen on an Unix socket (which is
recommended if Redis is running on the same system as ownCloud) use this example
\code{config.php} configuration:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/run/redis/redis.sock\PYGZsq{},
     \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 0,
      ),
\end{Verbatim}

Redis is very configurable; consult \href{http://redis.io/documentation}{the Redis documentation} to learn more.


\subsection{Cache Directory Location}
\label{configuration_server/caching_configuration:cache-directory-location}
The cache directory defaults to \code{data/\$user/cache} where \code{\$user} is the
current user. You may use the \code{'cache\_path'} directive in \code{config.php}
(See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}) to select a different location.


\subsection{Recommendations Based on Type of Deployment}
\label{configuration_server/caching_configuration:recommendations-based-on-type-of-deployment}

\subsubsection{Small/Private Home Server}
\label{configuration_server/caching_configuration:small-private-home-server}
Only use APCu:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\end{Verbatim}


\subsubsection{Small Organization, Single-server Setup}
\label{configuration_server/caching_configuration:small-organization-single-server-setup}
Use APCu for local caching, Redis for file locking:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
 \PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
      \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
      \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 6379,
       ),
\end{Verbatim}


\subsubsection{Large Organization, Clustered Setup}
\label{configuration_server/caching_configuration:large-organization-clustered-setup}
Use Redis for everything except local memcache. Use the server's IP address or hostname so that it is accessible to other hosts:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.distributed\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}server1\PYGZsq{},  //hostname example
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}12.34.56.78\PYGZsq{},  //IP address example
     \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 6379,
      ),
\end{Verbatim}


\subsubsection{Additional notes for Redis vs. APCu on Memory Caching}
\label{configuration_server/caching_configuration:additional-notes-for-redis-vs-apcu-on-memory-caching}
APCu is faster at local caching than Redis. If you have enough memory, use APCu for Memory Caching
and Redis for File Locking. If you are low on memory, use Redis for both.


\subsection{Additional Redis Installation Help}
\label{configuration_server/caching_configuration:additional-redis-installation-help}\label{configuration_server/caching_configuration:install-redis-label}
If your version of Mint or Ubuntu does not package the required version of
\code{php5-redis}, then try \href{https://www.techandme.se/how-to-configure-redis-cache-in-ubuntu-14-04-with-owncloud/}{this Redis guide on Tech and Me} for a complete Redis installation on Ubuntu 14.04 using PECL.
These instructions are adaptable for any distro that does not package the
supported version, or that does not package Redis at all, such as SUSE Linux
Enterprise Server and Red Hat Enterprise Linux.

The Redis PHP module must be at least version 2.2.6.

See \href{https://pecl.php.net/package/redis}{https://pecl.php.net/package/redis}

On Debian/Mint/Ubuntu, use \code{apt-cache} to see the available
\code{php5-redis} version, or the version of your installed package:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}cache policy php5\PYGZhy{}redis
\end{Verbatim}

On CentOS and Fedora, the \code{yum} command shows available and installed version
information:

\begin{Verbatim}[commandchars=\\\{\}]
yum search php\PYGZhy{}pecl\PYGZhy{}redis
\end{Verbatim}


\section{Defining Background Jobs}
\label{configuration_server/background_jobs_configuration:defining-background-jobs}\label{configuration_server/background_jobs_configuration::doc}
A system like ownCloud sometimes requires tasks to be done on a regular basis without the need for user interaction or hindering ownCloud performance. For that purpose, as a system administrator, you can define background jobs (for example, database clean-ups) which are executed without any need for user interaction.

These jobs are typically referred to as \emph{cron jobs}.  Cron jobs are commands or shell-based scripts that are scheduled to run periodically at fixed times, dates, or intervals.   \code{cron.php} is an ownCloud internal process that runs such background jobs on demand.

ownCloud plug-in applications register actions with \code{cron.php} automatically to take care of typical housekeeping operations, such as garbage collecting of temporary files or checking for newly updated files using \code{filescan()} for externally mounted file systems.


\subsection{Parameters}
\label{configuration_server/background_jobs_configuration:parameters}
In the admin settings menu you can configure how cron-jobs should be executed.
You can choose between the following options:
\begin{itemize}
\item {} 
AJAX

\item {} 
Webcron

\item {} 
Cron

\end{itemize}


\subsection{Cron Jobs}
\label{configuration_server/background_jobs_configuration:cron-jobs}
You can schedule cron jobs in three ways -- using AJAX, Webcron, or cron. The default method is to use AJAX.  However, the recommended method is to use cron.  The following sections describe the differences between each method.


\subsubsection{AJAX}
\label{configuration_server/background_jobs_configuration:ajax}
The AJAX scheduling method is the default option.  Unfortunately, however, it is also the least reliable. Each time a user visits the ownCloud page, a single background job is executed. The advantage of this mechanism is that it does not require access to the system nor registration with a third party service. The disadvantage of this mechanism, when compared to the Webcron service, is that it requires regular visits to the page for it to be triggered.

\begin{notice}{note}{Note:}
Especially when using the Activity App or external storages, where new
files are added, updated or deleted one of the two methods below should be
preferred.
\end{notice}


\subsubsection{Webcron}
\label{configuration_server/background_jobs_configuration:webcron}
By registering your ownCloud \code{cron.php} script address at an external webcron
service (for example, \href{http://www.easycron.com/}{easyCron}), you ensure that background jobs are executed
regularly. To use this type of service, your server you must be able to access
your server using the Internet. For example:

\begin{Verbatim}[commandchars=\\\{\}]
URL to call: http[s]://\PYGZlt{}domain\PYGZhy{}of\PYGZhy{}your\PYGZhy{}server\PYGZgt{}/owncloud/cron.php
\end{Verbatim}


\subsubsection{Cron}
\label{configuration_server/background_jobs_configuration:cron}
Using the operating system cron feature is the preferred method for executing regular tasks.  This method enables the execution of scheduled jobs without the inherent limitations the Web server might have.

To run a cron job on a *nix system, every 15 minutes, under the default Web server user (often, \code{www-data} or \code{wwwrun}), you must set up the following cron job to call the \textbf{cron.php} script:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} crontab \PYGZhy{}u www\PYGZhy{}data \PYGZhy{}e
*/15  *  *  *  * php \PYGZhy{}f /var/www/owncloud/cron.php
\end{Verbatim}

You can verify if the cron job has been added and scheduled by executing:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} crontab \PYGZhy{}u www\PYGZhy{}data \PYGZhy{}l
*/15  *  *  *  * php \PYGZhy{}f /var/www/owncloud/cron.php
\end{Verbatim}

\begin{notice}{note}{Note:}
You have to replace the path \code{/var/www/owncloud/cron.php} with the path to your current ownCloud installation.
\end{notice}

\begin{notice}{note}{Note:}
You have to make sure that \code{php} is found by \code{cron}. Best practice is to expressly add the full path like \code{/usr/bin/php}.
\end{notice}

\begin{notice}{note}{Note:}
On some systems it might be required to call \textbf{php-cli} instead of \textbf{php}.
\end{notice}

\begin{notice}{note}{Note:}
Please refer to the crontab man page for the exact command syntax.
\end{notice}


\section{Config.php Parameters}
\label{configuration_server/config_sample_php_parameters:config-php-parameters}\label{configuration_server/config_sample_php_parameters::doc}\label{configuration_server/config_sample_php_parameters:easycron}
ownCloud uses the \code{config/config.php} file to control server operations.
\code{config/config.sample.php} lists all the configurable parameters within
ownCloud, along with example or default values. This document provides a more
detailed reference. Most options are configurable on your Admin page, so it
is usually not necessary to edit \code{config/config.php}.

\begin{notice}{note}{Note:}
The installer creates a configuration containing the essential parameters.
Only manually add configuration parameters to \code{config/config.php} if you need to
use a special value for a parameter. \textbf{Do not copy everything from}
\code{config/config.sample.php} \textbf{. Only enter the parameters you wish to modify!}
\end{notice}

ownCloud supports loading configuration parameters from multiple files.
You can add arbitrary files ending with \code{.config.php} in the \code{config/}
directory, for example you could place your email server configuration
in \code{email.config.php}. This allows you to easily create and manage
custom configurations, or to divide a large complex configuration file
into a set of smaller files. These custom files are not overwritten by
ownCloud, and the values in these files take precedence over \code{config.php}.


\subsection{Default Parameters}
\label{configuration_server/config_sample_php_parameters:default-parameters}
These parameters are configured by the ownCloud installer, and are required
for your ownCloud server to operate.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}instanceid\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

This is a unique identifier for your ownCloud installation, created
automatically by the installer. This example is for documentation only,
and you should never use it because it will not work. A valid \code{instanceid}
is created when you install ownCloud.

`instanceid' =\textgreater{} `d3c944a9a',

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}passwordsalt\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The salt used to hash all passwords, auto-generated by the ownCloud
installer. (There are also per-user salts.) If you lose this salt you lose
all your passwords. This example is for documentation only, and you should
never use it.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}trusted\PYGZus{}domains\PYGZsq{} =\PYGZgt{}
  array (
    \PYGZsq{}demo.example.org\PYGZsq{},
    \PYGZsq{}otherdomain.example.org\PYGZsq{},
  ),
\end{Verbatim}

Your list of trusted domains that users can log into. Specifying trusted
domains prevents host header poisoning. Do not remove this, as it performs
necessary security checks.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}datadirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/www/owncloud/data\PYGZsq{},
\end{Verbatim}

Where user files are stored; this defaults to \code{data/} in the ownCloud
directory. The SQLite database is also stored here, when you use SQLite.

(SQLite is not available in ownCloud Enterprise Edition)

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The current version number of your ownCloud installation. This is set up
during installation and update, so you shouldn't need to change it.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbtype\PYGZsq{} =\PYGZgt{} \PYGZsq{}sqlite\PYGZsq{},
\end{Verbatim}

Identifies the database used with this installation. See also config option
\code{supportedDatabases}
\begin{description}
\item[{Available:}] \leavevmode\begin{itemize}
\item {} 
sqlite (SQLite3 - Not in Enterprise Edition)

\item {} 
mysql (MySQL/MariaDB)

\item {} 
pgsql (PostgreSQL)

\item {} 
oci (Oracle - Enterprise Edition Only)

\end{itemize}

\end{description}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbhost\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Your host server name, for example \code{localhost}, \code{hostname},
\code{hostname.example.com}, or the IP address. To specify a port use
\code{hostname:\#\#\#\#}; to specify a Unix socket use
\code{localhost:/path/to/socket}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbname\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
\end{Verbatim}

The name of the ownCloud database, which is set during installation. You
should not need to change this.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbuser\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The user that ownCloud uses to write to the database. This must be unique
across ownCloud instances using the same SQL database. This is set up during
installation, so you shouldn't need to change it.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbpassword\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The password for the database user. This is set up during installation, so
you shouldn't need to change it.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbtableprefix\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Prefix for the ownCloud tables in the database.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}installed\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Indicates whether the ownCloud instance was installed successfully; \code{true}
indicates a successful installation, and \code{false} indicates an unsuccessful
installation.


\subsection{Default config.php Examples}
\label{configuration_server/config_sample_php_parameters:default-config-php-examples}
When you use SQLite as your ownCloud database, your \code{config.php} looks like
this after installation. The SQLite database is stored in your ownCloud
\code{data/} directory. SQLite is a simple, lightweight embedded database that
is good for testing and for simple installations, but for production ownCloud
systems you should use MySQL, MariaDB, or PosgreSQL.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}CONFIG = array (
  \PYGZsq{}instanceid\PYGZsq{} =\PYGZgt{} \PYGZsq{}occ6f7365735\PYGZsq{},
  \PYGZsq{}passwordsalt\PYGZsq{} =\PYGZgt{} \PYGZsq{}2c5778476346786306303\PYGZsq{},
  \PYGZsq{}trusted\PYGZus{}domains\PYGZsq{} =\PYGZgt{}
  array (
    0 =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
    1 =\PYGZgt{} \PYGZsq{}studio\PYGZsq{},
  ),
  \PYGZsq{}datadirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/www/owncloud/data\PYGZsq{},
  \PYGZsq{}dbtype\PYGZsq{} =\PYGZgt{} \PYGZsq{}sqlite3\PYGZsq{},
  \PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}7.0.2.1\PYGZsq{},
  \PYGZsq{}installed\PYGZsq{} =\PYGZgt{} true,
);
\end{Verbatim}

This example is from a new ownCloud installation using MariaDB:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}CONFIG = array (
  \PYGZsq{}instanceid\PYGZsq{} =\PYGZgt{} \PYGZsq{}oc8c0fd71e03\PYGZsq{},
  \PYGZsq{}passwordsalt\PYGZsq{} =\PYGZgt{} \PYGZsq{}515a13302a6b3950a9d0fdb970191a\PYGZsq{},
  \PYGZsq{}trusted\PYGZus{}domains\PYGZsq{} =\PYGZgt{}
  array (
    0 =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
    1 =\PYGZgt{} \PYGZsq{}studio\PYGZsq{},
    2 =\PYGZgt{} \PYGZsq{}192.168.10.155\PYGZsq{}
  ),
  \PYGZsq{}datadirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/www/owncloud/data\PYGZsq{},
  \PYGZsq{}dbtype\PYGZsq{} =\PYGZgt{} \PYGZsq{}mysql\PYGZsq{},
   \PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}7.0.2.1\PYGZsq{},
  \PYGZsq{}dbname\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
  \PYGZsq{}dbhost\PYGZsq{} =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
  \PYGZsq{}dbtableprefix\PYGZsq{} =\PYGZgt{} \PYGZsq{}oc\PYGZus{}\PYGZsq{},
  \PYGZsq{}dbuser\PYGZsq{} =\PYGZgt{} \PYGZsq{}oc\PYGZus{}carla\PYGZsq{},
  \PYGZsq{}dbpassword\PYGZsq{} =\PYGZgt{} \PYGZsq{}67336bcdf7630dd80b2b81a413d07\PYGZsq{},
  \PYGZsq{}installed\PYGZsq{} =\PYGZgt{} true,
);
\end{Verbatim}


\subsection{User Experience}
\label{configuration_server/config_sample_php_parameters:user-experience}
These optional parameters control some aspects of the user interface. Default
values, where present, are shown.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}default\PYGZus{}language\PYGZsq{} =\PYGZgt{} \PYGZsq{}en\PYGZsq{},
\end{Verbatim}

This sets the default language on your ownCloud server, using ISO\_639-1
language codes such as \code{en} for English, \code{de} for German, and \code{fr} for
French. It overrides automatic language detection on public pages like login
or shared items. User's language preferences configured under ``personal -\textgreater{}
language'' override this setting after they have logged in.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}defaultapp\PYGZsq{} =\PYGZgt{} \PYGZsq{}files\PYGZsq{},
\end{Verbatim}

Set the default app to open on login. Use the app names as they appear in the
URL after clicking them in the Apps menu, such as documents, calendar, and
gallery. You can use a comma-separated list of app names, so if the first
app is not enabled for a user then ownCloud will try the second one, and so
on. If no enabled apps are found it defaults to the Files app.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}knowledgebaseenabled\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

\code{true} enables the Help menu item in the user menu (top right of the
ownCloud Web interface). \code{false} removes the Help item.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enable\PYGZus{}avatars\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

\code{true} enables avatars, or user profile photos. These appear on the User
page, on user's Personal pages and are used by some apps (contacts, mail,
etc). \code{false} disables them.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}allow\PYGZus{}user\PYGZus{}to\PYGZus{}change\PYGZus{}display\PYGZus{}name\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

\code{true} allows users to change their display names (on their Personal
pages), and \code{false} prevents them from changing their display names.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}remember\PYGZus{}login\PYGZus{}cookie\PYGZus{}lifetime\PYGZsq{} =\PYGZgt{} 60*60*24*15,
\end{Verbatim}

Lifetime of the remember login cookie, which is set when the user clicks the
\code{remember} checkbox on the login screen. The default is 15 days, expressed
in seconds.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}session\PYGZus{}lifetime\PYGZsq{} =\PYGZgt{} 60 * 60 * 24,
\end{Verbatim}

The lifetime of a session after inactivity; the default is 24 hours,
expressed in seconds.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}session\PYGZus{}keepalive\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Enable or disable session keep-alive when a user is logged in to the Web UI.

Enabling this sends a ``heartbeat'' to the server to keep it from timing out.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}token\PYGZus{}auth\PYGZus{}enforced\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Enforce token authentication for clients, which blocks requests using the user
password for enhanced security. Users need to generate tokens in personal settings
which can be used as passwords on their clients.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}skeletondirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/path/to/owncloud/core/skeleton\PYGZsq{},
\end{Verbatim}

The directory where the skeleton files are located. These files will be
copied to the data directory of new users. Leave empty to not copy any
skeleton files.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}user\PYGZus{}backends\PYGZsq{} =\PYGZgt{} array(
        array(
                \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OC\PYGZus{}User\PYGZus{}IMAP\PYGZsq{},
                \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} array(\PYGZsq{}\PYGZob{}imap.gmail.com:993/imap/ssl\PYGZcb{}INBOX\PYGZsq{})
        )
),
\end{Verbatim}

The \code{user\_backends} app (which needs to be enabled first) allows you to
configure alternate authentication backends. Supported backends are:
IMAP (OC\_User\_IMAP), SMB (OC\_User\_SMB), and FTP (OC\_User\_FTP).

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}lost\PYGZus{}password\PYGZus{}link\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://example.org/link/to/password/reset\PYGZsq{},
\end{Verbatim}

If your user backend does not allow to reset the password (e.g. when it's a
read-only user backend like LDAP), you can specify a custom link, where the
user is redirected to, when clicking the ``reset password'' link after a failed
login-attempt.


\subsection{Mail Parameters}
\label{configuration_server/config_sample_php_parameters:mail-parameters}
These configure the email settings for ownCloud notifications and password
resets.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}domain\PYGZsq{} =\PYGZgt{} \PYGZsq{}example.com\PYGZsq{},
\end{Verbatim}

The return address that you want to appear on emails sent by the ownCloud
server, for example \code{oc-admin@example.com}, substituting your own domain,
of course.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}from\PYGZus{}address\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
\end{Verbatim}

FROM address that overrides the built-in \code{sharing-noreply} and
\code{lostpassword-noreply} FROM addresses.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpdebug\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Enable SMTP class debugging.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpmode\PYGZsq{} =\PYGZgt{} \PYGZsq{}sendmail\PYGZsq{},
\end{Verbatim}

Which mode to use for sending mail: \code{sendmail}, \code{smtp}, \code{qmail} or
\code{php}.

If you are using local or remote SMTP, set this to \code{smtp}.

If you are using PHP mail you must have an installed and working email system
on the server. The program used to send email is defined in the \code{php.ini}
file.

For the \code{sendmail} option you need an installed and working email system on
the server, with \code{/usr/sbin/sendmail} installed on your Unix system.

For \code{qmail} the binary is /var/qmail/bin/sendmail, and it must be installed
on your Unix system.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtphost\PYGZsq{} =\PYGZgt{} \PYGZsq{}127.0.0.1\PYGZsq{},
\end{Verbatim}

This depends on \code{mail\_smtpmode}. Specify the IP address of your mail
server host. This may contain multiple hosts separated by a semi-colon. If
you need to specify the port number append it to the IP address separated by
a colon, like this: \code{127.0.0.1:24}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpport\PYGZsq{} =\PYGZgt{} 25,
\end{Verbatim}

This depends on \code{mail\_smtpmode}. Specify the port for sending mail.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtptimeout\PYGZsq{} =\PYGZgt{} 10,
\end{Verbatim}

This depends on \code{mail\_smtpmode}. This sets the SMTP server timeout, in
seconds. You may need to increase this if you are running an anti-malware or
spam scanner.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpsecure\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

This depends on \code{mail\_smtpmode}. Specify when you are using \code{ssl} or
\code{tls}, or leave empty for no encryption.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpauth\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

This depends on \code{mail\_smtpmode}. Change this to \code{true} if your mail
server requires authentication.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpauthtype\PYGZsq{} =\PYGZgt{} \PYGZsq{}LOGIN\PYGZsq{},
\end{Verbatim}

This depends on \code{mail\_smtpmode}. If SMTP authentication is required, choose
the authentication type as \code{LOGIN} (default) or \code{PLAIN}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtpname\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

This depends on \code{mail\_smtpauth}. Specify the username for authenticating to
the SMTP server.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mail\PYGZus{}smtppassword\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

This depends on \code{mail\_smtpauth}. Specify the password for authenticating to
the SMTP server.


\subsection{Proxy Configurations}
\label{configuration_server/config_sample_php_parameters:proxy-configurations}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwritehost\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The automatic hostname detection of ownCloud can fail in certain reverse
proxy and CLI/cron situations. This option allows you to manually override
the automatic detection; for example \code{www.example.com}, or specify the port
\code{www.example.com:8080}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwriteprotocol\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

When generating URLs, ownCloud attempts to detect whether the server is
accessed via \code{https} or \code{http}. However, if ownCloud is behind a proxy
and the proxy handles the \code{https} calls, ownCloud would not know that
\code{ssl} is in use, which would result in incorrect URLs being generated.

Valid values are \code{http} and \code{https}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwritewebroot\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

ownCloud attempts to detect the webroot for generating URLs automatically.

For example, if \code{www.example.com/owncloud} is the URL pointing to the
ownCloud instance, the webroot is \code{/owncloud}. When proxies are in use, it
may be difficult for ownCloud to detect this parameter, resulting in invalid
URLs.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwritecondaddr\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

This option allows you to define a manual override condition as a regular
expression for the remote IP address. For example, defining a range of IP
addresses starting with \code{10.0.0.} and ending with 1 to 3:
\code{\textasciicircum{}10\textbackslash{}.0\textbackslash{}.0\textbackslash{}.{[}1-3{]}\$}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwrite.cli.url\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Use this configuration parameter to specify the base URL for any URLs which
are generated within ownCloud using any kind of command line tools (cron or
occ). The value should contain the full base URL:
\code{https://www.example.com/owncloud}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}htaccess.RewriteBase\PYGZsq{} =\PYGZgt{} \PYGZsq{}/\PYGZsq{},
\end{Verbatim}

To have clean URLs without \emph{/index.php} this parameter needs to be configured.

This parameter will be written as ``RewriteBase'' on update and installation of
ownCloud to your \emph{.htaccess} file. While this value is often simply the URL
path of the ownCloud installation it cannot be set automatically properly in
every scenario and needs thus some manual configuration.

In a standard Apache setup this usually equals the folder that ownCloud is
accessible at. So if ownCloud is accessible via ``\href{https://mycloud.org/owncloud}{https://mycloud.org/owncloud}''
the correct value would most likely be ``/owncloud''. If ownCloud is running
under ``\href{https://mycloud.org/}{https://mycloud.org/}'' then it would be ``/''.

Note that above rule is not valid in every case, there are some rare setup
cases where this may not apply. However, to avoid any update problems this
configuration value is explicitly opt-in.

After setting this value run \emph{occ maintenance:update:htaccess} and when following
conditions are met ownCloud uses URLs without index.php in it:
\begin{itemize}
\item {} 
\emph{mod\_rewrite} is installed

\item {} 
\emph{mod\_env} is installed

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}proxy\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The URL of your proxy server, for example \code{proxy.example.com:8081}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}proxyuserpwd\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

The optional authentication for the proxy to use to connect to the internet.

The format is: \code{username:password}.


\subsection{Deleted Items (trash bin)}
\label{configuration_server/config_sample_php_parameters:deleted-items-trash-bin}
These parameters control the Deleted files app.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}trashbin\PYGZus{}retention\PYGZus{}obligation\PYGZsq{} =\PYGZgt{} \PYGZsq{}auto\PYGZsq{},
\end{Verbatim}

If the trash bin app is enabled (default), this setting defines the policy
for when files and folders in the trash bin will be permanently deleted.

The app allows for two settings, a minimum time for trash bin retention,
and a maximum time for trash bin retention.
Minimum time is the number of days a file will be kept, after which it
may be deleted. Maximum time is the number of days at which it is guaranteed
to be deleted.
Both minimum and maximum times can be set together to explicitly define
file and folder deletion. For migration purposes, this setting is installed
initially set to ``auto'', which is equivalent to the default setting in
ownCloud 8.1 and before.

Available values:
\begin{itemize}
\item {} \begin{description}
\item[{\code{auto}}] \leavevmode
default setting. keeps files and folders in the trash bin for 30 days
and automatically deletes anytime after that if space is needed (note:
files may not be deleted if space is not needed).

\end{description}

\item {} \begin{description}
\item[{\code{D, auto}}] \leavevmode
keeps files and folders in the trash bin for D+ days, delete anytime if
space needed (note: files may not be deleted if space is not needed)

\end{description}

\item {} \begin{description}
\item[{\code{auto, D}}] \leavevmode
delete all files in the trash bin that are older than D days
automatically, delete other files anytime if space needed

\end{description}

\item {} \begin{description}
\item[{\code{D1, D2}}] \leavevmode
keep files and folders in the trash bin for at least D1 days and
delete when exceeds D2 days

\end{description}

\item {} \begin{description}
\item[{\code{disabled}}] \leavevmode
trash bin auto clean disabled, files and folders will be kept forever

\end{description}

\end{itemize}


\subsection{File versions}
\label{configuration_server/config_sample_php_parameters:file-versions}
These parameters control the Versions app.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}versions\PYGZus{}retention\PYGZus{}obligation\PYGZsq{} =\PYGZgt{} \PYGZsq{}auto\PYGZsq{},
\end{Verbatim}

If the versions app is enabled (default), this setting defines the policy
for when versions will be permanently deleted.

The app allows for two settings, a minimum time for version retention,
and a maximum time for version retention.
Minimum time is the number of days a version will be kept, after which it
may be deleted. Maximum time is the number of days at which it is guaranteed
to be deleted.
Both minimum and maximum times can be set together to explicitly define
version deletion. For migration purposes, this setting is installed
initially set to ``auto'', which is equivalent to the default setting in
ownCloud 8.1 and before.

Available values:
\begin{itemize}
\item {} \begin{description}
\item[{\code{auto}}] \leavevmode
default setting. Automatically expire versions according to expire
rules. Please refer to {\hyperref[configuration_files/file_versioning::doc]{\emph{Controlling File Versions and Aging}}} for
more information.

\end{description}

\item {} \begin{description}
\item[{\code{D, auto}}] \leavevmode
keep versions at least for D days, apply expire rules to all versions
that are older than D days

\end{description}

\item {} \begin{description}
\item[{\code{auto, D}}] \leavevmode
delete all versions that are older than D days automatically, delete
other versions according to expire rules

\end{description}

\item {} \begin{description}
\item[{\code{D1, D2}}] \leavevmode
keep versions for at least D1 days and delete when exceeds D2 days

\end{description}

\item {} \begin{description}
\item[{\code{disabled}}] \leavevmode
versions auto clean disabled, versions will be kept forever

\end{description}

\end{itemize}


\subsection{ownCloud Verifications}
\label{configuration_server/config_sample_php_parameters:owncloud-verifications}
ownCloud performs several verification checks. There are two options,
\code{true} and \code{false}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}appcodechecker\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Checks an app before install whether it uses private APIs instead of the
proper public APIs. If this is set to true it will only allow to install or
enable apps that pass this check.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}updatechecker\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Check if ownCloud is up-to-date and shows a notification if a new version is
available.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}updater.server.url\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://updates.owncloud.com/server/\PYGZsq{},
\end{Verbatim}

URL that ownCloud should use to look for updates

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}has\PYGZus{}internet\PYGZus{}connection\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Is ownCloud connected to the Internet or running in a closed network?

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}check\PYGZus{}for\PYGZus{}working\PYGZus{}webdav\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Allows ownCloud to verify a working WebDAV connection. This is done by
attempting to make a WebDAV request from PHP.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}check\PYGZus{}for\PYGZus{}working\PYGZus{}wellknown\PYGZus{}setup\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Allows ownCloud to verify a working .well-known URL redirects. This is done
by attempting to make a request from JS to
\href{https://your-domain.com/.well-known/caldav/}{https://your-domain.com/.well-known/caldav/}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}check\PYGZus{}for\PYGZus{}working\PYGZus{}htaccess\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

This is a crucial security check on Apache servers that should always be set
to \code{true}. This verifies that the \code{.htaccess} file is writable and works.

If it is not, then any options controlled by \code{.htaccess}, such as large
file uploads, will not work. It also runs checks on the \code{data/} directory,
which verifies that it can't be accessed directly through the Web server.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}config\PYGZus{}is\PYGZus{}read\PYGZus{}only\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

In certain environments it is desired to have a read-only configuration file.

When this switch is set to \code{true} ownCloud will not verify whether the
configuration is writable. However, it will not be possible to configure
all options via the Web interface. Furthermore, when updating ownCloud
it is required to make the configuration file writable again for the update
process.


\subsection{Logging}
\label{configuration_server/config_sample_php_parameters:logging}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}log\PYGZus{}type\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
\end{Verbatim}

By default the ownCloud logs are sent to the \code{owncloud.log} file in the
default ownCloud data directory.

If syslogging is desired, set this parameter to \code{syslog}.
Setting this parameter to \code{errorlog} will use the PHP error\_log function
for logging.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}logfile\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/log/owncloud.log\PYGZsq{},
\end{Verbatim}

Log file path for the ownCloud logging type.

Defaults to \code{{[}datadirectory{]}/owncloud.log}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}loglevel\PYGZsq{} =\PYGZgt{} 2,
\end{Verbatim}

Loglevel to start logging at. Valid values are: 0 = Debug, 1 = Info, 2 =
Warning, 3 = Error, and 4 = Fatal. The default value is Warning.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}syslog\PYGZus{}tag\PYGZsq{} =\PYGZgt{} \PYGZsq{}ownCloud\PYGZsq{},
\end{Verbatim}

If you maintain different instances and aggregate the logs, you may want
to distinguish between them. \code{syslog\_tag} can be set per instance
with a unique id. Only available if \code{log\_type} is set to \code{syslog}.

The default value is \code{ownCloud}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}log.condition\PYGZsq{} =\PYGZgt{} [
        \PYGZsq{}shared\PYGZus{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}57b58edb6637fe3059b3595cf9c41b9\PYGZsq{},
        \PYGZsq{}users\PYGZsq{} =\PYGZgt{} [\PYGZsq{}sample\PYGZhy{}user\PYGZsq{}],
        \PYGZsq{}apps\PYGZsq{} =\PYGZgt{} [\PYGZsq{}files\PYGZsq{}],
],
\end{Verbatim}

Log condition for log level increase based on conditions. Once one of these
conditions is met, the required log level is set to debug. This allows to
debug specific requests, users or apps
\begin{description}
\item[{Supported conditions:}] \leavevmode\begin{itemize}
\item {} \begin{description}
\item[{\code{shared\_secret}: if a request parameter with the name \emph{log\_secret} is set to}] \leavevmode
this value the condition is met

\end{description}

\item {} \begin{description}
\item[{\code{users}:  if the current request is done by one of the specified users,}] \leavevmode
this condition is met

\end{description}

\item {} \begin{description}
\item[{\code{apps}:   if the log message is invoked by one of the specified apps,}] \leavevmode
this condition is met

\end{description}

\end{itemize}

\end{description}

Defaults to an empty array.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}logdateformat\PYGZsq{} =\PYGZgt{} \PYGZsq{}F d, Y H:i:s\PYGZsq{},
\end{Verbatim}

This uses PHP.date formatting; see \href{http://php.net/manual/en/function.date.php}{http://php.net/manual/en/function.date.php}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}logtimezone\PYGZsq{} =\PYGZgt{} \PYGZsq{}Europe/Berlin\PYGZsq{},
\end{Verbatim}

The default timezone for logfiles is UTC. You may change this; see
\href{http://php.net/manual/en/timezones.php}{http://php.net/manual/en/timezones.php}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}log\PYGZus{}query\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Append all database queries and parameters to the log file. Use this only for
debugging, as your logfile will become huge.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}cron\PYGZus{}log\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Log successful cron runs.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}log\PYGZus{}rotate\PYGZus{}size\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Enables log rotation and limits the total size of logfiles. The default is 0,
or no rotation. Specify a size in bytes, for example 104857600 (100 megabytes
= 100 * 1024 * 1024 bytes). A new logfile is created with a new name when the
old logfile reaches your limit. If a rotated log file is already present, it
will be overwritten.


\subsection{Alternate Code Locations}
\label{configuration_server/config_sample_php_parameters:alternate-code-locations}
Some of the ownCloud code may be stored in alternate locations.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}customclient\PYGZus{}desktop\PYGZsq{} =\PYGZgt{}
        \PYGZsq{}https://owncloud.org/install/\PYGZsh{}install\PYGZhy{}clients\PYGZsq{},
\PYGZsq{}customclient\PYGZus{}android\PYGZsq{} =\PYGZgt{}
        \PYGZsq{}https://play.google.com/store/apps/details?id=com.owncloud.android\PYGZsq{},
\PYGZsq{}customclient\PYGZus{}ios\PYGZsq{} =\PYGZgt{}
        \PYGZsq{}https://itunes.apple.com/us/app/owncloud/id543672169?mt=8\PYGZsq{},
\end{Verbatim}

This section is for configuring the download links for ownCloud clients, as
seen in the first-run wizard and on Personal pages.


\subsection{Apps}
\label{configuration_server/config_sample_php_parameters:apps}
Options for the Apps folder, Apps store, and App code checker.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}appstoreenabled\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

When enabled, admins may install apps from the ownCloud app store.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}appstoreurl\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://api.owncloud.com/v1\PYGZsq{},
\end{Verbatim}

The URL of the appstore to use.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}appstore.experimental.enabled\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Whether to show experimental apps in the appstore interface

Experimental apps are not checked for security issues and are new or known
to be unstable and under heavy development. Installing these can cause data
loss or security breaches.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}apps\PYGZus{}paths\PYGZsq{} =\PYGZgt{} array(
        array(
                \PYGZsq{}path\PYGZsq{}=\PYGZgt{} \PYGZsq{}/var/www/owncloud/apps\PYGZsq{},
                \PYGZsq{}url\PYGZsq{} =\PYGZgt{} \PYGZsq{}/apps\PYGZsq{},
                \PYGZsq{}writable\PYGZsq{} =\PYGZgt{} true,
        ),
),
\end{Verbatim}

Use the \code{apps\_paths} parameter to set the location of the Apps directory,
which should be scanned for available apps, and where user-specific apps
should be installed from the Apps store. The \code{path} defines the absolute
file system path to the app folder. The key \code{url} defines the HTTP Web path
to that folder, starting from the ownCloud webroot. The key \code{writable}
indicates if a Web server can write files to that folder.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}appcodechecker\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Checks an app before install whether it uses private APIs instead of the
proper public APIs. If this is set to true it will only allow to install or
enable apps that pass this check.


\subsection{Previews}
\label{configuration_server/config_sample_php_parameters:previews}
ownCloud supports previews of image files, the covers of MP3 files, and text
files. These options control enabling and disabling previews, and thumbnail
size.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enable\PYGZus{}previews\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

By default, ownCloud can generate previews for the following filetypes:
\begin{itemize}
\item {} 
Image files

\item {} 
Covers of MP3 files

\item {} 
Text documents

\end{itemize}

Valid values are \code{true}, to enable previews, or
\code{false}, to disable previews

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}max\PYGZus{}x\PYGZsq{} =\PYGZgt{} 2048,
\end{Verbatim}

The maximum width, in pixels, of a preview. A value of \code{null} means there
is no limit.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}max\PYGZus{}y\PYGZsq{} =\PYGZgt{} 2048,
\end{Verbatim}

The maximum height, in pixels, of a preview. A value of \code{null} means there
is no limit.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}max\PYGZus{}scale\PYGZus{}factor\PYGZsq{} =\PYGZgt{} 10,
\end{Verbatim}

If a lot of small pictures are stored on the ownCloud instance and the
preview system generates blurry previews, you might want to consider setting
a maximum scale factor. By default, pictures are upscaled to 10 times the
original size. A value of \code{1} or \code{null} disables scaling.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}max\PYGZus{}filesize\PYGZus{}image\PYGZsq{} =\PYGZgt{} 50,
\end{Verbatim}

max file size for generating image previews with imagegd (default behaviour)
If the image is bigger, it'll try other preview generators,
but will most likely show the default mimetype icon

Value represents the maximum filesize in megabytes
Default is 50
Set to -1 for no limit

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}libreoffice\PYGZus{}path\PYGZsq{} =\PYGZgt{} \PYGZsq{}/usr/bin/libreoffice\PYGZsq{},
\end{Verbatim}

custom path for LibreOffice/OpenOffice binary

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}preview\PYGZus{}office\PYGZus{}cl\PYGZus{}parameters\PYGZsq{} =\PYGZgt{}
        \PYGZsq{} \PYGZhy{}\PYGZhy{}headless \PYGZhy{}\PYGZhy{}nologo \PYGZhy{}\PYGZhy{}nofirststartwizard \PYGZhy{}\PYGZhy{}invisible \PYGZhy{}\PYGZhy{}norestore \PYGZsq{}.
        \PYGZsq{}\PYGZhy{}\PYGZhy{}convert\PYGZhy{}to pdf \PYGZhy{}\PYGZhy{}outdir \PYGZsq{},
\end{Verbatim}

Use this if LibreOffice/OpenOffice requires additional arguments.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enabledPreviewProviders\PYGZsq{} =\PYGZgt{} array(
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}PNG\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}JPEG\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}GIF\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}BMP\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}XBitmap\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}MP3\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}TXT\PYGZsq{},
        \PYGZsq{}OC\PYGZbs{}Preview\PYGZbs{}MarkDown\PYGZsq{}
),
\end{Verbatim}

Only register providers that have been explicitly enabled

The following providers are enabled by default:
\begin{itemize}
\item {} 
OC\textbackslash{}Preview\textbackslash{}PNG

\item {} 
OC\textbackslash{}Preview\textbackslash{}JPEG

\item {} 
OC\textbackslash{}Preview\textbackslash{}GIF

\item {} 
OC\textbackslash{}Preview\textbackslash{}BMP

\item {} 
OC\textbackslash{}Preview\textbackslash{}XBitmap

\item {} 
OC\textbackslash{}Preview\textbackslash{}MarkDown

\item {} 
OC\textbackslash{}Preview\textbackslash{}MP3

\item {} 
OC\textbackslash{}Preview\textbackslash{}TXT

\end{itemize}

The following providers are disabled by default due to performance or privacy
concerns:
\begin{itemize}
\item {} 
OC\textbackslash{}Preview\textbackslash{}Illustrator

\item {} 
OC\textbackslash{}Preview\textbackslash{}Movie

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOffice2003

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOffice2007

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOfficeDoc

\item {} 
OC\textbackslash{}Preview\textbackslash{}OpenDocument

\item {} 
OC\textbackslash{}Preview\textbackslash{}PDF

\item {} 
OC\textbackslash{}Preview\textbackslash{}Photoshop

\item {} 
OC\textbackslash{}Preview\textbackslash{}Postscript

\item {} 
OC\textbackslash{}Preview\textbackslash{}StarOffice

\item {} 
OC\textbackslash{}Preview\textbackslash{}SVG

\item {} 
OC\textbackslash{}Preview\textbackslash{}TIFF

\item {} 
OC\textbackslash{}Preview\textbackslash{}Font

\end{itemize}

\begin{notice}{note}{Note:}
Troubleshooting steps for the MS Word previews are available
at the {\hyperref[configuration_files/collaborative_documents_configuration::doc]{\emph{Configuring the Collaborative Documents App}}}
section of the Administrators Manual.
\end{notice}

The following providers are not available in Microsoft Windows:
\begin{itemize}
\item {} 
OC\textbackslash{}Preview\textbackslash{}Movie

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOfficeDoc

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOffice2003

\item {} 
OC\textbackslash{}Preview\textbackslash{}MSOffice2007

\item {} 
OC\textbackslash{}Preview\textbackslash{}OpenDocument

\item {} 
OC\textbackslash{}Preview\textbackslash{}StarOffice

\end{itemize}


\subsection{LDAP}
\label{configuration_server/config_sample_php_parameters:ldap}
Global settings used by LDAP User and Group Backend

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}ldapUserCleanupInterval\PYGZsq{} =\PYGZgt{} 51,
\end{Verbatim}

defines the interval in minutes for the background job that checks user
existence and marks them as ready to be cleaned up. The number is always
minutes. Setting it to 0 disables the feature.

See command line (occ) methods ldap:show-remnants and user:delete


\subsection{Comments}
\label{configuration_server/config_sample_php_parameters:comments}
Global settings for the Comments infrastructure

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}comments.managerFactory\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Comments\PYGZbs{}ManagerFactory\PYGZsq{},
\end{Verbatim}

Replaces the default Comments Manager Factory. This can be utilized if an
own or 3rdParty CommentsManager should be used that – for instance – uses the
filesystem instead of the database to keep the comments.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}systemtags.managerFactory\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}SystemTag\PYGZbs{}ManagerFactory\PYGZsq{},
\end{Verbatim}

Replaces the default System Tags Manager Factory. This can be utilized if an
own or 3rdParty SystemTagsManager should be used that – for instance – uses the
filesystem instead of the database to keep the comments.


\subsection{Maintenance}
\label{configuration_server/config_sample_php_parameters:maintenance}
These options are for halting user activity when you are performing server
maintenance.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}maintenance\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Enable maintenance mode to disable ownCloud

If you want to prevent users from logging in to ownCloud before you start
doing some maintenance work, you need to set the value of the maintenance
parameter to true. Please keep in mind that users who are already logged-in
are kicked out of ownCloud instantly.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}singleuser\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

When set to \code{true}, the ownCloud instance will be unavailable for all users
who are not in the \code{admin} group.


\subsection{SSL}
\label{configuration_server/config_sample_php_parameters:ssl}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}openssl\PYGZsq{} =\PYGZgt{} array(
        \PYGZsq{}config\PYGZsq{} =\PYGZgt{} \PYGZsq{}/absolute/location/of/openssl.cnf\PYGZsq{},
),
\end{Verbatim}

Extra SSL options to be used for configuration.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enable\PYGZus{}certificate\PYGZus{}management\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Allow the configuration of system wide trusted certificates


\subsection{Memory caching backend configuration}
\label{configuration_server/config_sample_php_parameters:memory-caching-backend-configuration}
Available cache backends:
\begin{itemize}
\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}APC}        Alternative PHP Cache backend

\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}APCu}       APC user backend

\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}ArrayCache} In-memory array-based backend (not recommended)

\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}Memcached}  Memcached backend

\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}Redis}      Redis backend

\item {} 
\code{\textbackslash{}OC\textbackslash{}Memcache\textbackslash{}XCache}     XCache backend

\end{itemize}

Advice on choosing between the various backends:
\begin{itemize}
\item {} 
APCu should be easiest to install. Almost all distributions have packages.
Use this for single user environment for all caches.

\item {} 
Use Redis or Memcached for distributed environments.
For the local cache (you can configure two) take APCu.

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.local\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}APCu\PYGZsq{},
\end{Verbatim}

Memory caching backend for locally stored data
\begin{itemize}
\item {} 
Used for host-specific data, e.g. file paths

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.distributed\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Memcached\PYGZsq{},
\end{Verbatim}

Memory caching backend for distributed data
\begin{itemize}
\item {} 
Used for installation-specific data, e.g. database caching

\item {} 
If unset, defaults to the value of memcache.local

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
        \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{}, // can also be a unix domain socket: \PYGZsq{}/tmp/redis.sock\PYGZsq{}
        \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 6379,
        \PYGZsq{}timeout\PYGZsq{} =\PYGZgt{} 0.0,
        \PYGZsq{}password\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{}, // Optional, if not defined no password will be used.
        \PYGZsq{}dbindex\PYGZsq{} =\PYGZgt{} 0, // Optional, if undefined SELECT will not run and will use Redis Server\PYGZsq{}s default DB Index.
),
\end{Verbatim}

Connection details for redis to use for memory caching.

For enhanced security it is recommended to configure Redis
to require a password. See \href{http://redis.io/topics/security}{http://redis.io/topics/security}
for more information.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcached\PYGZus{}servers\PYGZsq{} =\PYGZgt{} array(
        // hostname, port and optional weight. Also see:
        // http://www.php.net/manual/en/memcached.addservers.php
        // http://www.php.net/manual/en/memcached.addserver.php
        array(\PYGZsq{}localhost\PYGZsq{}, 11211),
        //array(\PYGZsq{}other.host.local\PYGZsq{}, 11211),
),
\end{Verbatim}

Server details for one or more memcached servers to use for memory caching.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcached\PYGZus{}options\PYGZsq{} =\PYGZgt{} array(
        // Set timeouts to 50ms
        \PYGZbs{}Memcached::OPT\PYGZus{}CONNECT\PYGZus{}TIMEOUT =\PYGZgt{} 50,
        \PYGZbs{}Memcached::OPT\PYGZus{}RETRY\PYGZus{}TIMEOUT =\PYGZgt{}   50,
        \PYGZbs{}Memcached::OPT\PYGZus{}SEND\PYGZus{}TIMEOUT =\PYGZgt{}    50,
        \PYGZbs{}Memcached::OPT\PYGZus{}RECV\PYGZus{}TIMEOUT =\PYGZgt{}    50,
        \PYGZbs{}Memcached::OPT\PYGZus{}POLL\PYGZus{}TIMEOUT =\PYGZgt{}    50,

        // Enable compression
        \PYGZbs{}Memcached::OPT\PYGZus{}COMPRESSION =\PYGZgt{}          true,

        // Turn on consistent hashing
        \PYGZbs{}Memcached::OPT\PYGZus{}LIBKETAMA\PYGZus{}COMPATIBLE =\PYGZgt{} true,

        // Enable Binary Protocol
        \PYGZbs{}Memcached::OPT\PYGZus{}BINARY\PYGZus{}PROTOCOL =\PYGZgt{}      true,

        // Binary serializer vill be enabled if the igbinary PECL module is available
        //\PYGZbs{}Memcached::OPT\PYGZus{}SERIALIZER =\PYGZgt{} \PYGZbs{}Memcached::SERIALIZER\PYGZus{}IGBINARY,
),
\end{Verbatim}

Connection options for memcached, see \href{http://apprize.info/php/scaling/15.html}{http://apprize.info/php/scaling/15.html}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}cache\PYGZus{}path\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Location of the cache folder, defaults to \code{data/\$user/cache} where
\code{\$user} is the current user. When specified, the format will change to
\code{\$cache\_path/\$user} where \code{\$cache\_path} is the configured cache directory
and \code{\$user} is the user.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}cache\PYGZus{}chunk\PYGZus{}gc\PYGZus{}ttl\PYGZsq{} =\PYGZgt{} 86400, // 60*60*24 = 1 day
\end{Verbatim}

TTL of chunks located in the cache folder before they're removed by
garbage collection (in seconds). Increase this value if users have
issues uploading very large files via the ownCloud Client as upload isn't
completed within one day.


\subsection{Using Object Store with ownCloud}
\label{configuration_server/config_sample_php_parameters:using-object-store-with-owncloud}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZsq{} =\PYGZgt{} array(
        \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OC\PYGZbs{}\PYGZbs{}Files\PYGZbs{}\PYGZbs{}ObjectStore\PYGZbs{}\PYGZbs{}Swift\PYGZsq{},
        \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} array(
                // trystack will user your facebook id as the user name
                \PYGZsq{}username\PYGZsq{} =\PYGZgt{} \PYGZsq{}facebook100000123456789\PYGZsq{},
                // in the trystack dashboard go to user \PYGZhy{}\PYGZgt{} settings \PYGZhy{}\PYGZgt{} API Password to
                // generate a password
                \PYGZsq{}password\PYGZsq{} =\PYGZgt{} \PYGZsq{}Secr3tPaSSWoRdt7\PYGZsq{},
                // must already exist in the objectstore, name can be different
                \PYGZsq{}container\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
                // create the container if it does not exist. default is false
                \PYGZsq{}autocreate\PYGZsq{} =\PYGZgt{} true,
                // required, dev\PYGZhy{}/trystack defaults to \PYGZsq{}RegionOne\PYGZsq{}
                \PYGZsq{}region\PYGZsq{} =\PYGZgt{} \PYGZsq{}RegionOne\PYGZsq{},
                // The Identity / Keystone endpoint
                \PYGZsq{}url\PYGZsq{} =\PYGZgt{} \PYGZsq{}http://8.21.28.222:5000/v2.0\PYGZsq{},
                // required on dev\PYGZhy{}/trystack
                \PYGZsq{}tenantName\PYGZsq{} =\PYGZgt{} \PYGZsq{}facebook100000123456789\PYGZsq{},
                // dev\PYGZhy{}/trystack uses swift by default, the lib defaults to \PYGZsq{}cloudFiles\PYGZsq{}
                // if omitted
                \PYGZsq{}serviceName\PYGZsq{} =\PYGZgt{} \PYGZsq{}swift\PYGZsq{},
                // The Interface / url Type, optional
                \PYGZsq{}urlType\PYGZsq{} =\PYGZgt{} \PYGZsq{}internal\PYGZsq{}
        ),
),
\end{Verbatim}

This example shows how to configure ownCloud to store all files in a
swift object storage.

It is important to note that ownCloud in object store mode will expect
exclusive access to the object store container because it only stores the
binary data for each file. The metadata is currently kept in the local
database for performance reasons.

WARNING: The current implementation is incompatible with any app that uses
direct file IO and circumvents our virtual filesystem. That includes
Encryption and Gallery. Gallery will store thumbnails directly in the
filesystem and encryption will cause severe overhead because key files need
to be fetched in addition to any requested file.

One way to test is applying for a trystack account at \href{http://trystack.org/}{http://trystack.org/}


\subsection{Sharing}
\label{configuration_server/config_sample_php_parameters:sharing}
Global settings for Sharing

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}sharing.managerFactory\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Share20\PYGZbs{}ProviderFactory\PYGZsq{},
\end{Verbatim}

Replaces the default Share Provider Factory. This can be utilized if
own or 3rdParty Share Providers be used that – for instance – uses the
filesystem instead of the database to keep the share information.


\subsection{All other configuration options}
\label{configuration_server/config_sample_php_parameters:all-other-configuration-options}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}dbdriveroptions\PYGZsq{} =\PYGZgt{} array(
        PDO::MYSQL\PYGZus{}ATTR\PYGZus{}SSL\PYGZus{}CA =\PYGZgt{} \PYGZsq{}/file/path/to/ca\PYGZus{}cert.pem\PYGZsq{},
        PDO::MYSQL\PYGZus{}ATTR\PYGZus{}INIT\PYGZus{}COMMAND =\PYGZgt{} \PYGZsq{}SET wait\PYGZus{}timeout = 28800\PYGZsq{}
),
\end{Verbatim}

Additional driver options for the database connection, eg. to enable SSL
encryption in MySQL or specify a custom wait timeout on a cheap hoster.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}sqlite.journal\PYGZus{}mode\PYGZsq{} =\PYGZgt{} \PYGZsq{}DELETE\PYGZsq{},
\end{Verbatim}

sqlite3 journal mode can be specified using this configuration parameter -
can be `WAL' or `DELETE' see for more details \href{https://www.sqlite.org/wal.html}{https://www.sqlite.org/wal.html}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}supportedDatabases\PYGZsq{} =\PYGZgt{} array(
        \PYGZsq{}sqlite\PYGZsq{},
        \PYGZsq{}mysql\PYGZsq{},
        \PYGZsq{}pgsql\PYGZsq{},
        \PYGZsq{}oci\PYGZsq{},
),
\end{Verbatim}

Database types that are supported for installation.
\begin{description}
\item[{Available:}] \leavevmode\begin{itemize}
\item {} 
sqlite (SQLite3 - Not in Enterprise Edition)

\item {} 
mysql (MySQL)

\item {} 
pgsql (PostgreSQL)

\item {} 
oci (Oracle - Enterprise Edition Only)

\end{itemize}

\end{description}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}tempdirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/tmp/owncloudtemp\PYGZsq{},
\end{Verbatim}

Override where ownCloud stores temporary files. Useful in situations where
the system temporary directory is on a limited space ramdisk or is otherwise
restricted, or if external storages which do not support streaming are in
use.

The Web server user must have write access to this directory.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}hashingCost\PYGZsq{} =\PYGZgt{} 10,
\end{Verbatim}

The hashing cost used by hashes generated by ownCloud
Using a higher value requires more time and CPU power to calculate the hashes

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}blacklisted\PYGZus{}files\PYGZsq{} =\PYGZgt{} array(\PYGZsq{}.htaccess\PYGZsq{}),
\end{Verbatim}

Blacklist a specific file or files and disallow the upload of files
with this name. \code{.htaccess} is blocked by default.

WARNING: USE THIS ONLY IF YOU KNOW WHAT YOU ARE DOING.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}share\PYGZus{}folder\PYGZsq{} =\PYGZgt{} \PYGZsq{}/\PYGZsq{},
\end{Verbatim}

Define a default folder for shared files and folders other than root.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}theme\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

If you are applying a theme to ownCloud, enter the name of the theme here.

The default location for themes is \code{owncloud/themes/}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}cipher\PYGZsq{} =\PYGZgt{} \PYGZsq{}AES\PYGZhy{}256\PYGZhy{}CFB\PYGZsq{},
\end{Verbatim}

The default cipher for encrypting files. Currently AES-128-CFB and
AES-256-CFB are supported.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}minimum.supported.desktop.version\PYGZsq{} =\PYGZgt{} \PYGZsq{}1.7.0\PYGZsq{},
\end{Verbatim}

The minimum ownCloud desktop client version that will be allowed to sync with
this server instance. All connections made from earlier clients will be denied
by the server. Defaults to the minimum officially supported ownCloud version at
the time of release of this server version.

When changing this, note that older unsupported versions of the ownCloud desktop
client may not function as expected, and could lead to permanent data loss for
clients or other unexpected results.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}quota\PYGZus{}include\PYGZus{}external\PYGZus{}storage\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

EXPERIMENTAL: option whether to include external storage in quota
calculation, defaults to false.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filesystem\PYGZus{}check\PYGZus{}changes\PYGZsq{} =\PYGZgt{} 0,
\end{Verbatim}

Specifies how often the local filesystem (the ownCloud data/ directory, and
NFS mounts in data/) is checked for changes made outside ownCloud. This
does not apply to external storages.

0 -\textgreater{} Never check the filesystem for outside changes, provides a performance
increase when it's certain that no changes are made directly to the
filesystem

1 -\textgreater{} Check each file or folder at most once per request, recommended for
general use if outside changes might happen.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}part\PYGZus{}file\PYGZus{}in\PYGZus{}storage\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

By default ownCloud will store the part files created during upload in the
same storage as the upload target. Setting this to false will store the part
files in the root of the users folder which might be required to work with certain
external storage setups that have limited rename capabilities.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}asset\PYGZhy{}pipeline.enabled\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

All css and js files will be served by the Web server statically in one js
file and one css file if this is set to \code{true}. This improves performance.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}assetdirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/www/owncloud\PYGZsq{},
\end{Verbatim}

The parent of the directory where css and js assets will be stored if
pipelining is enabled; this defaults to the ownCloud directory. The assets
will be stored in a subdirectory of this directory named `assets'. The
server \emph{must} be configured to serve that directory as \$WEBROOT/assets.

You will only likely need to change this if the main ownCloud directory
is not writeable by the Web server in your configuration.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}mount\PYGZus{}file\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/www/owncloud/data/mount.json\PYGZsq{},
\end{Verbatim}

Where \code{mount.json} file should be stored, defaults to \code{data/mount.json}
in the ownCloud directory.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filesystem\PYGZus{}cache\PYGZus{}readonly\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

When \code{true}, prevent ownCloud from changing the cache due to changes in the
filesystem for all storage.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Secret used by ownCloud for various purposes, e.g. to encrypt data. If you
lose this string there will be data corruption.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}trusted\PYGZus{}proxies\PYGZsq{} =\PYGZgt{} array(\PYGZsq{}203.0.113.45\PYGZsq{}, \PYGZsq{}198.51.100.128\PYGZsq{}),
\end{Verbatim}

List of trusted proxy servers

If you configure these also consider setting \emph{forwarded\_for\_headers} which
otherwise defaults to \emph{HTTP\_X\_FORWARDED\_FOR} (the \emph{X-Forwarded-For} header).

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}forwarded\PYGZus{}for\PYGZus{}headers\PYGZsq{} =\PYGZgt{} array(\PYGZsq{}HTTP\PYGZus{}X\PYGZus{}FORWARDED\PYGZsq{}, \PYGZsq{}HTTP\PYGZus{}FORWARDED\PYGZus{}FOR\PYGZsq{}),
\end{Verbatim}

Headers that should be trusted as client IP address in combination with
\emph{trusted\_proxies}. If the HTTP header looks like `X-Forwarded-For', then use
`HTTP\_X\_FORWARDED\_FOR' here.

If set incorrectly, a client can spoof their IP address as visible to
ownCloud, bypassing access controls and making logs useless!

Defaults to `HTTP\_X\_FORWARED\_FOR' if unset

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}max\PYGZus{}filesize\PYGZus{}animated\PYGZus{}gifs\PYGZus{}public\PYGZus{}sharing\PYGZsq{} =\PYGZgt{} 10,
\end{Verbatim}

max file size for animating gifs on public-sharing-site.

If the gif is bigger, it'll show a static preview

Value represents the maximum filesize in megabytes. Default is \code{10}. Set to
\code{-1} for no limit.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filelocking.enabled\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

Enables transactional file locking.

This is enabled by default.

Prevents concurrent processes from accessing the same files
at the same time. Can help prevent side effects that would
be caused by concurrent operations. Mainly relevant for
very large installations with many users working with
shared files.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filelocking.ttl\PYGZsq{} =\PYGZgt{} 3600,
\end{Verbatim}

Set the time-to-live for locks in secconds.

Any lock older than this will be automatically cleaned up.

If not set this defaults to either 1 hour or the php max\_execution\_time, whichever is higher.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}\PYGZbs{}OC\PYGZbs{}\PYGZbs{}Memcache\PYGZbs{}\PYGZbs{}Redis\PYGZsq{},
\end{Verbatim}

Memory caching backend for file locking

Because most memcache backends can clean values without warning using redis
is highly recommended to \emph{avoid data loss}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}upgrade.disable\PYGZhy{}web\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Disable the web based updater

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}debug\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Set this ownCloud instance to debugging mode

Only enable this for local development and not in production environments
This will disable the minifier and outputs some additional debug information

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}data\PYGZhy{}fingerprint\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

Sets the data-fingerprint of the current data served

This is a property used by the clients to find out if a backup has been
restored on the server. Once a backup is restored run
./occ maintenance:data-fingerprint
To set this to a new value.

Updating/Deleting this value can make connected clients stall until
the user has resolved conflicts.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}copied\PYGZus{}sample\PYGZus{}config\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

This entry is just here to show a warning in case somebody copied the sample
configuration. DO NOT ADD THIS SWITCH TO YOUR CONFIGURATION!

If you, brave person, have read until here be aware that you should not
modify \emph{ANY} settings in this file without reading the documentation.


\subsection{App config options}
\label{configuration_server/config_sample_php_parameters:app-config-options}
Retention for activities of the activity app:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}activity\PYGZus{}expire\PYGZus{}days\PYGZsq{} =\PYGZgt{} 365,
\end{Verbatim}

Every day a cron job is ran, which deletes all activities for all users
which are older then the number of days that is set for \code{activity\_expire\_days}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}wnd.logging.enable\PYGZsq{} =\PYGZgt{} true,
\end{Verbatim}

This enables debug logs for the windows\_network\_drive app.


\section{Email Configuration}
\label{configuration_server/email_configuration::doc}\label{configuration_server/email_configuration:email-configuration}
ownCloud is capable of sending password reset emails, notifying users of new
file shares, changes in files, and activity notifications. Your users configure
which notifications they want to receive on their Personal pages.

ownCloud does not contain a full email server, but rather connects to your
existing mail server. You must have a functioning mail server for ownCloud to be
able to send emails. You may have a mail server on the same machine as ownCloud,
or it may be a remote server.

ownCloud 7 introduces a new feature, the graphical Email Configuration Wizard.
\begin{figure}[htbp]
\centering

\includegraphics{smtp-config-wizard.png}
\end{figure}

With the new wizard, connecting ownCloud to your mail server is fast and easy.
The wizard fills in the values in \code{config/config.php}, so you may use either
or both as you prefer.

The ownCloud Email wizard supports three types of mail server connections:
SMTP, PHP, and Sendmail. Use the SMTP configurator for a remote server, and PHP
or Sendmail when your mail server is on the same machine as ownCloud.

\begin{notice}{note}{Note:}
The Sendmail option refers to the Sendmail SMTP server, and any
drop-in Sendmail replacement such as Postfix, Exim, or Courier. All of
these include a \code{sendmail} binary, and are freely-interchangeable.
\end{notice}


\subsection{Configuring an SMTP Server}
\label{configuration_server/email_configuration:configuring-an-smtp-server}
You need the following information from your mailserver administrator to
connect ownCloud to a remote SMTP server:
\begin{itemize}
\item {} 
Encryption type: None, SSL/TLS or STARTTLS

\item {} 
The From address you want your outgoing ownCloud mails to use

\item {} 
Whether authentication is required

\item {} 
Authentication method: None, Login, Plain, or NT LAN Manager

\item {} 
The server's IP address or fully-qualified domain name

\item {} 
Login credentials, if required

\end{itemize}
\begin{figure}[htbp]
\centering

\includegraphics{smtp-config-smtp.png}
\end{figure}

Your changes are saved immediately, and you can click the Send Email button to
test your configuration. This sends a test message to the email address you
configured on your Personal page. The test message says:

\begin{Verbatim}[commandchars=\\\{\}]
If you received this email, the settings seem to be correct.

\PYGZhy{}\PYGZhy{}
ownCloud
web services under your control
\end{Verbatim}


\subsection{Configuring PHP and Sendmail}
\label{configuration_server/email_configuration:configuring-php-and-sendmail}
Configuring PHP or Sendmail requires only that you select one of them, and then
enter your desired return address.
\begin{figure}[htbp]
\centering

\includegraphics{smtp-config-php-sendmail.png}
\end{figure}

How do you decide which one to use? PHP mode uses your local \code{sendmail}
binary. Use this if you want to use \code{php.ini} to control some of your mail
server functions, such as setting paths, headers, or passing extra command
options to the \code{sendmail} binary. These vary according to which server you
are using, so consult your server's documentation to see what your options are.

In most cases the \code{smtp} option is best, because it removes the extra step of
passing through PHP, and you can control all of your mail server options in one
place, in your mail server configuration.


\subsection{Using Email Templates}
\label{configuration_server/email_configuration:using-email-templates}
Another useful new feature is editable email templates. Now you can edit
ownCloud's email templates on your Admin page. These are your available
templates:
\begin{itemize}
\item {} 
Sharing email (HTML) -- HTML version of emails notifying users of new file
shares

\item {} 
Sharing email  (plain text fallback) -- Plain text email notifying users of new file shares

\item {} 
Lost password mail -- Password reset email for users who lose their passwords.

\item {} 
Activity notification mail -- Notification of activities that users have
enabled in the Notifications section of their Personal pages.

\end{itemize}

In addition to providing the email templates, this feature enables you to apply
any preconfigured themes to the email.

To modify an email template to users:
\begin{enumerate}
\item {} 
Access the Admin page.

\item {} 
Scroll to the Mail templates section.

\item {} 
Select a template from the drop-down menu.

\item {} 
Make any desired modifications to the template.

\end{enumerate}

The templates are written in PHP and HTML, and are already loaded with the
relevant variables such as username, share links, and filenames. You can, if you
are careful, edit these even without knowing PHP or HTML; don't touch any of the
code, but you can edit the text portions of the messages. For example, this the
lost password mail template:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

   echo str\PYGZus{}replace(\PYGZsq{}\PYGZob{}link\PYGZcb{}\PYGZsq{}, \PYGZdl{}\PYGZus{}[\PYGZsq{}link\PYGZsq{}], \PYGZdl{}l\PYGZhy{}\PYGZgt{}t(\PYGZsq{}Use the following link to
   reset your password: \PYGZob{}link\PYGZcb{}\PYGZsq{}));
\end{Verbatim}

You could change the text portion of the template, \code{Use the following link to
reset your password:} to say something else, such as \code{Click the following link
to reset your password. If you did not ask for a password reset, ignore this
message.}

Again, be very careful to change nothing but the message text, because the
tiniest coding error will break the template.

\begin{notice}{note}{Note:}
You can edit the templates directly in the template text box, or you
can copy and paste them to a text editor for modification and then copy and
paste them back to the template text box for use when you are done.
\end{notice}


\subsection{Setting Mail Server Parameters in config.php}
\label{configuration_server/email_configuration:setting-mail-server-parameters-in-config-php}
If you prefer, you may set your mail server parameters in \code{config/config.php}.
The following examples are for SMTP, PHP, Sendmail, and Qmail.


\subsubsection{SMTP}
\label{configuration_server/email_configuration:smtp}
If you want to send email using a local or remote SMTP server it is necessary
to enter the name or IP address of the server, optionally followed by a colon
separated port number, e.g. \textbf{:425}. If this value is not given the default
port 25/tcp will be used unless you change that by modifying the
\textbf{mail\_smtpport} parameter. Multiple servers can be entered, separated by
semicolons:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpmode\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp\PYGZhy{}1.server.dom;smtp\PYGZhy{}2.server.dom:425\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpport\PYGZdq{}     =\PYGZgt{} 25,
\end{Verbatim}

or

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpmode\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp.server.dom\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpport\PYGZdq{}     =\PYGZgt{} 425,
\end{Verbatim}

If a malware or SPAM scanner is running on the SMTP server it might be
necessary that you increase the SMTP timeout to e.g. 30s:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtptimeout\PYGZdq{}  =\PYGZgt{} 30,
\end{Verbatim}

If the SMTP server accepts insecure connections, the default setting can be
used:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZsq{}\PYGZsq{},
\end{Verbatim}

If the SMTP server only accepts secure connections you can choose between
the following two variants:


\paragraph{SSL/TLS}
\label{configuration_server/email_configuration:ssl-tls}
A secure connection will be initiated using SSL/TLS via SMTPS on the default port 465/tcp:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp.server.dom:465\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZsq{}ssl\PYGZsq{},
\end{Verbatim}


\paragraph{STARTTLS}
\label{configuration_server/email_configuration:starttls}
A secure connection will be initiated using STARTTLS via SMTP on the default port 25/tcp:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp.server.dom\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZsq{}tls\PYGZsq{},
\end{Verbatim}

An alternative is the port 587/tcp (recommended):

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}smtp.server.dom:587\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZsq{}tls\PYGZsq{},
\end{Verbatim}


\paragraph{Authentication}
\label{configuration_server/email_configuration:authentication}
And finally it is necessary to configure if the SMTP server requires
authentication, if not, the default values can be taken as is.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpauth\PYGZdq{}     =\PYGZgt{} false,
  \PYGZdq{}mail\PYGZus{}smtpname\PYGZdq{}     =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtppassword\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
\end{Verbatim}

If SMTP authentication is required you have to set the required username
and password and can optionally choose between the authentication types
\textbf{LOGIN} (default) or \textbf{PLAIN}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpauth\PYGZdq{}     =\PYGZgt{} true,
  \PYGZdq{}mail\PYGZus{}smtpauthtype\PYGZdq{} =\PYGZgt{} \PYGZdq{}LOGIN\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpname\PYGZdq{}     =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtppassword\PYGZdq{} =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
\end{Verbatim}


\subsubsection{PHP mail}
\label{configuration_server/email_configuration:php-mail}
If you want to use PHP mail it is necessary to have an installed and working
email system on your server. Which program in detail is used to send email is
defined by the configuration settings in the \textbf{php.ini} file. (On *nix
systems this will most likely be Sendmail.) ownCloud should be able to send
email out of the box.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpmode\PYGZdq{}     =\PYGZgt{} \PYGZdq{}php\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}127.0.0.1\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpport\PYGZdq{}     =\PYGZgt{} 25,
  \PYGZdq{}mail\PYGZus{}smtptimeout\PYGZdq{}  =\PYGZgt{} 10,
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpauth\PYGZdq{}     =\PYGZgt{} false,
  \PYGZdq{}mail\PYGZus{}smtpauthtype\PYGZdq{} =\PYGZgt{} \PYGZdq{}LOGIN\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpname\PYGZdq{}     =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtppassword\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
\end{Verbatim}


\subsubsection{Sendmail}
\label{configuration_server/email_configuration:sendmail}
If you want to use the well known Sendmail program to send email, it is
necessary to have an installed and working email system on your *nix server.
The sendmail binary (\textbf{/usr/sbin/sendmail}) is usually part of that system.
ownCloud should be able to send email out of the box.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpmode\PYGZdq{}     =\PYGZgt{} \PYGZdq{}sendmail\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}127.0.0.1\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpport\PYGZdq{}     =\PYGZgt{} 25,
  \PYGZdq{}mail\PYGZus{}smtptimeout\PYGZdq{}  =\PYGZgt{} 10,
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpauth\PYGZdq{}     =\PYGZgt{} false,
  \PYGZdq{}mail\PYGZus{}smtpauthtype\PYGZdq{} =\PYGZgt{} \PYGZdq{}LOGIN\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpname\PYGZdq{}     =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtppassword\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
\end{Verbatim}


\subsubsection{qmail}
\label{configuration_server/email_configuration:qmail}
If you want to use the qmail program to send email, it is necessary to have an
installed and working qmail email system on your server. The sendmail binary
(\textbf{/var/qmail/bin/sendmail}) will then be used to send email. ownCloud should
be able to send email out of the box.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpmode\PYGZdq{}     =\PYGZgt{} \PYGZdq{}qmail\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtphost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}127.0.0.1\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpport\PYGZdq{}     =\PYGZgt{} 25,
  \PYGZdq{}mail\PYGZus{}smtptimeout\PYGZdq{}  =\PYGZgt{} 10,
  \PYGZdq{}mail\PYGZus{}smtpsecure\PYGZdq{}   =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpauth\PYGZdq{}     =\PYGZgt{} false,
  \PYGZdq{}mail\PYGZus{}smtpauthtype\PYGZdq{} =\PYGZgt{} \PYGZdq{}LOGIN\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtpname\PYGZdq{}     =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}mail\PYGZus{}smtppassword\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
\end{Verbatim}


\subsection{Send a Test Email}
\label{configuration_server/email_configuration:send-a-test-email}
To test your email configuration, save your email address in your personal
settings and then use the \textbf{Send email} button in the \emph{Email Server} section
of the Admin settings page.


\subsection{Using Self-Signed Certificates}
\label{configuration_server/email_configuration:using-self-signed-certificates}
When using self-signed certificates on the remote SMTP server the certificate
must be imported into ownCloud. Please refer to {\hyperref[configuration_server/import_ssl_cert::doc]{\emph{Importing System-wide and Personal SSL Certificates}}} for more information.


\subsection{Troubleshooting}
\label{configuration_server/email_configuration:troubleshooting}
If you are unable to send email, try turning on debugging. Do this by enabling
the \code{mail\_smtpdebug parameter} in \code{config/config.php}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpdebug\PYGZdq{} =\PYGZgt{} true;
\end{Verbatim}

\begin{notice}{note}{Note:}
Immediately after pressing the \textbf{Send email} button, as described
before, several \textbf{SMTP -\textgreater{} get\_lines(): ...} messages appear on the screen.
This is expected behavior and can be ignored.
\end{notice}

\textbf{Question}: Why is my web domain different from my mail domain?

\textbf{Answer}: The default domain name used for the sender address is the hostname
where your ownCloud installation is served.  If you have a different mail domain
name you can override this behavior by setting the following configuration
parameter:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}domain\PYGZdq{} =\PYGZgt{} \PYGZdq{}example.com\PYGZdq{},
\end{Verbatim}

This setting results in every email sent by ownCloud (for example, the password
reset email) having the domain part of the sender address appear as follows:

\begin{Verbatim}[commandchars=\\\{\}]
no\PYGZhy{}reply@example.com
\end{Verbatim}

\textbf{Question}: How can I find out if an SMTP server is reachable?

\textbf{Answer}: Use the ping command to check the server availability:

\begin{Verbatim}[commandchars=\\\{\}]
ping smtp.server.dom
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
PING smtp.server.dom (ip\PYGZhy{}address) 56(84) bytes of data.
64 bytes from your\PYGZhy{}server.local.lan (192.168.1.10): icmp\PYGZus{}req=1 ttl=64
time=3.64ms
\end{Verbatim}

\textbf{Question}: How can I find out if the SMTP server is listening on a specific
TCP port?

\textbf{Answer}: The best way to get mail server information is to ask your mail
server admin. If you are the mail server admin, or need information in a
hurry, you can use the \code{netstat} command. This example shows all active
servers on your system, and the ports they are listening on. The SMTP server is
listening on localhost port 25.

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZsh{} netstat \PYGZhy{}pant}
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
Active Internet connections (servers and established)
Proto Recv\PYGZhy{}Q Send\PYGZhy{}Q Local Address   Foreign Address  State  ID/Program name
tcp    0      0    0.0.0.0:631     0.0.0.0:*        LISTEN   4418/cupsd
tcp    0      0    127.0.0.1:25    0.0.0.0:*        LISTEN   2245/exim4
tcp    0      0    127.0.0.1:3306  0.0.0.0:*        LISTEN   1524/mysqld
\end{Verbatim}
\begin{itemize}
\item {} 
25/tcp is unencrypted smtp

\item {} 
110/tcp/udp is unencrypted pop3

\item {} 
143/tcp/udp is unencrypted imap4

\item {} 
465/tcp is encrypted smtps

\item {} 
993/tcp/udp is encrypted imaps

\item {} 
995/tcp/udp is encrypted pop3s

\end{itemize}

\textbf{Question}: How can I determine if the SMTP server supports SMTPS?

\textbf{Answer}: A good indication that the SMTP server supports SMTPS is that it
is listening on port \textbf{465}.

\textbf{Question}: How can I determine what authorization and encryption protocols
the mail server supports?

\textbf{Answer}: SMTP servers usually announce the availability of STARTTLS
immediately after a connection has been established. You can easily check this
using the \code{telnet} command.

\begin{notice}{note}{Note:}
You must enter the marked lines to obtain the information displayed.
\end{notice}

\begin{Verbatim}[commandchars=\\\{\}]
telnet smtp.domain.dom 25
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
Trying 192.168.1.10...
Connected to smtp.domain.dom.
Escape character is \PYGZsq{}\PYGZca{}]\PYGZsq{}.
220 smtp.domain.dom ESMTP Exim 4.80.1 Tue, 22 Jan 2013 22:39:55 +0100
EHLO your\PYGZhy{}server.local.lan                   \PYGZsh{} \PYGZlt{}\PYGZlt{}\PYGZlt{} enter this command
250\PYGZhy{}smtp.domain.dom Hello your\PYGZhy{}server.local.lan [ip\PYGZhy{}address]
250\PYGZhy{}SIZE 52428800
250\PYGZhy{}8BITMIME
250\PYGZhy{}PIPELINING
250\PYGZhy{}AUTH PLAIN LOGIN CRAM\PYGZhy{}MD5                 \PYGZsh{} \PYGZlt{}\PYGZlt{}\PYGZlt{} Supported auth protocols
250\PYGZhy{}STARTTLS                                  \PYGZsh{} \PYGZlt{}\PYGZlt{}\PYGZlt{} Encryption is supported
250 HELP
QUIT                                          \PYGZsh{} \PYGZlt{}\PYGZlt{}\PYGZlt{} enter this command
221 smtp.domain.dom closing connection
Connection closed by foreign host.
\end{Verbatim}


\subsection{Enabling Debug Mode}
\label{configuration_server/email_configuration:enabling-debug-mode}
If you are unable to send email, it might be useful to activate further debug
messages by enabling the mail\_smtpdebug parameter:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}mail\PYGZus{}smtpdebug\PYGZdq{} =\PYGZgt{} true,
\end{Verbatim}

\begin{notice}{note}{Note:}
Immediately after pressing the \textbf{Send email} button, as described
before, several \textbf{SMTP -\textgreater{} get\_lines(): ...} messages appear on the screen.
This is expected behavior and can be ignored.
\end{notice}


\section{Excluding Directories and Blacklisting Files}
\label{configuration_server/excluded_blacklisted_files::doc}\label{configuration_server/excluded_blacklisted_files:excluding-directories-and-blacklisting-files}

\subsection{Definitions of terms}
\label{configuration_server/excluded_blacklisted_files:definitions-of-terms}\begin{quote}\begin{description}
\item[{\textbf{Blacklisted}}] \leavevmode
Files that may harm the ownCloud environment like a foreign \code{.htaccess} file. Blacklisting prevents anyone from uploading blacklisted files to the ownCloud server.

\item[{\textbf{Excluded}}] \leavevmode
Existing directories on your ownCloud server, including external storage mounts, that are excluded from being processed by ownCloud. In effect they are invisible to ownCloud.

\end{description}\end{quote}

Both types are defined in \code{config.php}. Blacklisted files and excluded directories are not scanned by ownCloud, not viewed, not synced, and cannot be created, renamed, deleted, or accessed via direct path input from a file explorer. Even when a filepath is entered manually via a file explorer, the path cannot be accessed.

For example configurations please see \code{owncloud/config/config.sample.php}.


\subsection{Impact on System Performance}
\label{configuration_server/excluded_blacklisted_files:impact-on-system-performance}
If you have a filesystem mounted with 200,000 files and directories and 15 snapshots in rotation, you would now scan and process 200,000 elements plus 200,000 x 15 = 3,000,000 elements additionally. These additional 3,000,000 elements, 15 times more than the original quantity, would also be available for viewing and synchronisation. Because this is a big and unnecessary overhead, most times confusing to clients, further processing can be eliminated by using excluded directories.


\subsection{Blacklisted Files}
\label{configuration_server/excluded_blacklisted_files:blacklisted-files}
By default, ownCloud blacklists the file \code{.htaccess} to secure the running instance, which is important when using Apache as webserver. A foreign \code{.htaccess} file could overwrite rules defined by ownCloud. There is no explicit need to enter the file name \code{.htaccess} as parameter to the \code{blacklisted\_files} array in \code{config.php}, but you can add more blacklisted file names if necessary.


\subsection{Excluded Directories}
\label{configuration_server/excluded_blacklisted_files:excluded-directories}
\textbf{Reason for excluding directories:}
\begin{enumerate}
\item {} 
Enterprise storage systems, or special filesystems like ZFS and BtrFS are capable of snapshots. These snapshots are directories and keep point-in-time views of the data.

\item {} 
Snapshot directories are read-only.

\item {} 
There is no common naming for these directories, and most likely will never be. NetApp uses \code{.snapshot} and \code{\textasciitilde{}snapshot}, EMC eg \code{.ckpt}, HDS eg \code{.latest} and \code{\textasciitilde{}latest}, the ZFS filesystem uses \code{.zfs} and so on.

\item {} 
Viewing and scanning of these directories does not make any sense as these directories are used to ease backup, restores, and cloning

\item {} 
Directories which are part of the mounted filesystem, but must not be accessible via ownCloud.

\end{enumerate}

\textbf{Example:}

If you have a snapshot-capable storage or filesystem where snapshots are enabled and presented to clients, each directory will contain a ``special'' visible directory named e.g. \code{.snapshot}. Depending on the system, you may find underneath a list of snapshots taken and in the next lower level the complete set of files and directories which were present when the snapshot was created. In most systems, this mechanism is true in all directory levels:

\begin{Verbatim}[commandchars=\\\{\}]
/.snapshot
     /nightly.0
             /home
             /dat
             /pictures
             file\PYGZus{}1
             file\PYGZus{}2
     /nightly.1
             /home
             /dat
             /pictures
             file\PYGZus{}1
             file\PYGZus{}2
     /nightly.2
             /home
             /dat
             /pictures
             file\PYGZus{}1
             file\PYGZus{}2
     ...
/home
/dat
/pictures
file\PYGZus{}1
file\PYGZus{}2
...
\end{Verbatim}

Example \code{excluded\_directories} entries in \code{config.php} look like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}excluded\PYGZus{}directories\PYGZsq{} =\PYGZgt{}
       array (
               \PYGZsq{}.snapshot\PYGZsq{},
               \PYGZsq{}\PYGZti{}snapshot\PYGZsq{},
               \PYGZsq{}dir1\PYGZsq{},
               \PYGZsq{}dir2\PYGZsq{},
       ),
\end{Verbatim}

Note that these are not pathnames, but directory names without any slashes. Excluding \code{dir1} excludes:

\begin{Verbatim}[commandchars=\\\{\}]
/home/dir1
/etc/stuff/dir1
\end{Verbatim}

But not:

\begin{Verbatim}[commandchars=\\\{\}]
/home/.dir1
/etc/stuff/mydir1
\end{Verbatim}

Example \code{blacklisted\_files} entries in \code{config.php} look like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}blacklisted\PYGZus{}files\PYGZsq{} =\PYGZgt{}
       array (
               \PYGZsq{}hosts\PYGZsq{},
               \PYGZsq{}evil\PYGZus{}script.sh\PYGZsq{},
       ),
\end{Verbatim}


\section{Linking External Sites}
\label{configuration_server/external_sites::doc}\label{configuration_server/external_sites:linking-external-sites}
You can embed external Web sites inside your ownCloud pages with the External
Sites app, as this screenshot shows.
\begin{figure}[htbp]
\centering
\capstart

\scalebox{0.600000}{\includegraphics{external-sites-1.png}}
\caption{\emph{Click to enlarge}}\end{figure}

This is useful for quick access to important Web pages such as the
ownCloud manuals and informational pages for your company, and for presenting
external pages inside your custom ownCloud branding, if you use your own custom
themes.

The External sites app is included in all versions of ownCloud. Go to \textbf{Apps \textgreater{}
Not Enabled} to enable it. Then go to your ownCloud Admin page to create your
links, which are saved automatically. There is a dropdown menu to select an
icon, but there is only one default icon so you don't have to select one. Hover
your cursor to the right of your links to make the trashcan icon appear when you
want to remove them.
\begin{figure}[htbp]
\centering
\capstart

\scalebox{0.800000}{\includegraphics{external-sites-2.png}}
\caption{\emph{Click to enlarge}}\end{figure}

The links appear in the ownCloud dropdown menu on the top left after
refreshing your page, and have globe icons.
\begin{figure}[htbp]
\centering

\includegraphics{external-sites-3.png}
\end{figure}

Your links may or may not work correctly due to the various ways that Web
browsers and Web sites handle HTTP and HTTPS URLs, and because the External
Sites app embeds external links in IFrames. Modern Web browsers try very hard
to protect Web surfers from dangerous links, and safety apps like
\href{https://www.eff.org/privacybadger}{Privacy Badger} and ad-blockers may block
embedded pages. It is strongly recommended to enforce HTTPS on your ownCloud
server; do not weaken this, or any of your security tools, just to make
embedded Web pages work. After all, you can freely access them outside of
ownCloud.

Most Web sites that offer login functionalities use the \code{X-Frame-Options} or
\code{Content-Security-Policy} HTTP header which instructs browsers to not
allow their pages to be embedded for security reasons (e.g. ``Clickjacking''). You
can usually verify the reason why embedding the website is not possible by using
your browser's console tool. For example, this page has an invalid SSL
certificate.
\begin{figure}[htbp]
\centering

\includegraphics{external-sites-4.png}
\end{figure}

On this page, X-Frame-Options prevents the embedding.
\begin{figure}[htbp]
\centering

\includegraphics{external-sites-5.png}
\end{figure}

There isn't much you can do about these issues, but if you're curious you can
see what is happening.


\section{Custom Client Download Repositories}
\label{configuration_server/custom_client_repos::doc}\label{configuration_server/custom_client_repos:custom-client-download-repositories}
You may configure the URLs to your own download repositories for your ownCloud
desktop clients and mobile apps in \code{config/config.php}. This example shows
the default download locations:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}customclient\PYGZus{}desktop\PYGZdq{} =\PYGZgt{} \PYGZdq{}https://owncloud.org/sync\PYGZhy{}clients/\PYGZdq{},
  \PYGZdq{}customclient\PYGZus{}android\PYGZdq{} =\PYGZgt{} \PYGZdq{}https://play.google.com/store/apps/details?id=com.owncloud.android\PYGZdq{},
  \PYGZdq{}customclient\PYGZus{}ios\PYGZdq{}     =\PYGZgt{} \PYGZdq{}https://itunes.apple.com/us/app/owncloud/id543672169?mt=8\PYGZdq{},
\end{Verbatim}

Simply replace the URLs with the links to your own preferred download repos.

You may test alternate URLs without editing \code{config/config.php} by setting a test URL as an environment variable:

\begin{Verbatim}[commandchars=\\\{\}]
export OCC\PYGZus{}UPDATE\PYGZus{}URL=https://test.example.com
\end{Verbatim}

When you're finished testing you can disable the environment variable:

\begin{Verbatim}[commandchars=\\\{\}]
unset OCC\PYGZus{}UPDATE\PYGZus{}URL
\end{Verbatim}


\section{Knowledge Base Configuration}
\label{configuration_server/knowledgebase_configuration:knowledge-base-configuration}\label{configuration_server/knowledgebase_configuration::doc}
The usage of ownCloud is more or less self explaining but nevertheless a user
might run into a problem where he needs to consult the documentation or knowledge base. To ease access to the ownCloud
documentation and knowledge base, a help menu item is shown in the settings menu by default.


\subsection{Parameters}
\label{configuration_server/knowledgebase_configuration:parameters}
If you want to disable the ownCloud help menu item you can use the \textbf{knowledgebaseenabled} parameter inside the
\code{config/config.php}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}knowledgebaseenabled\PYGZdq{} =\PYGZgt{} true,
\end{Verbatim}

\begin{notice}{note}{Note:}
Disabling the help menu item might increase the number of support requests you have to answer in the future
\end{notice}


\section{Language Configuration}
\label{configuration_server/language_configuration::doc}\label{configuration_server/language_configuration:language-configuration}
In normal cases ownCloud will automatically detect the language of the Web-GUI.
If this does not work properly or you want to make sure that ownCloud always
starts with a given language, you can use the \textbf{default\_language} parameter.

Please keep in mind, that this will not effect a users language preference,
which has been configured under ``personal -\textgreater{} language'' once he has logged in.

Please check \code{settings/languageCodes.php} for the list of supported language
codes.


\subsection{Parameters}
\label{configuration_server/language_configuration:parameters}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}default\PYGZus{}language\PYGZdq{} =\PYGZgt{} \PYGZdq{}en\PYGZdq{},
\end{Verbatim}

This parameters can be set in the \code{config/config.php}


\section{Logging Configuration}
\label{configuration_server/logging_configuration::doc}\label{configuration_server/logging_configuration:logging-configuration}
Use your ownCloud log to review system status, or to help debug problems. You may adjust logging levels, and choose between using the ownCloud log or your syslog.


\subsection{Parameters}
\label{configuration_server/logging_configuration:parameters}
Logging levels range from \textbf{DEBUG}, which logs all activity, to \textbf{FATAL}, which logs only fatal errors.
\begin{itemize}
\item {} 
\textbf{0}: DEBUG: All activity; the most detailed logging.

\item {} 
\textbf{1}: INFO:  Activity such as user logins and file activities, plus warnings, errors, and fatal errors.

\item {} 
\textbf{2}: WARN:  Operations succeed, but with warnings of potential problems, plus errors and fatal errors.

\item {} 
\textbf{3}: ERROR: An operation fails, but other services and operations continue, plus fatal errors.

\item {} 
\textbf{4}: FATAL: The server stops.

\end{itemize}

By default the log level is set to \textbf{2} (WARN). Use \textbf{DEBUG} when you have a problem to diagnose, and then reset your log level to a less-verbose level as \textbf{DEBUG} outputs a lot of information, and can affect your server performance.

Logging level parameters are set in the \code{config/config.php} file, or on the Admin page of your ownCloud Web GUI.


\subsubsection{ownCloud}
\label{configuration_server/logging_configuration:owncloud}
All log information will be written to a separate log file which can be
viewed using the log viewer on your Admin page. By default, a log
file named \textbf{owncloud.log} will be created in the directory which has
been configured by the \textbf{datadirectory} parameter in \code{config/config.php}.

The desired date format can optionally be defined using the \textbf{logdateformat} parameter in \code{config/config.php}.
By default the \href{http://www.php.net/manual/en/function.date.php}{PHP date function} parameter ``\emph{c}'' is used, and therefore the
date/time is written in the format ``\emph{2013-01-10T15:20:25+02:00}''. By using the
date format in the example below, the date/time format will be written in the format
``\emph{January 10, 2013 15:20:25}''.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdq{}log\PYGZus{}type\PYGZdq{} =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
\PYGZdq{}logfile\PYGZdq{} =\PYGZgt{} \PYGZdq{}owncloud.log\PYGZdq{},
\PYGZdq{}loglevel\PYGZdq{} =\PYGZgt{} \PYGZdq{}3\PYGZdq{},
\PYGZdq{}logdateformat\PYGZdq{} =\PYGZgt{} \PYGZdq{}F d, Y H:i:s\PYGZdq{},
\end{Verbatim}


\subsubsection{syslog}
\label{configuration_server/logging_configuration:syslog}
All log information will be sent to your default syslog daemon.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdq{}log\PYGZus{}type\PYGZdq{} =\PYGZgt{} \PYGZdq{}syslog\PYGZdq{},
\PYGZdq{}logfile\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
\PYGZdq{}loglevel\PYGZdq{} =\PYGZgt{} \PYGZdq{}3\PYGZdq{},
\end{Verbatim}


\subsubsection{Conditional Logging Level Increase}
\label{configuration_server/logging_configuration:conditional-logging-level-increase}
You can configure the logging level to automatically increase to \code{debug} when one of three conditions are met:

\# \code{shared\_secret}: If a request parameter with the name \code{log\_secret} is set to this value the condition is met.

\# \code{users}: If the current request is done by one of the specified users, this condition is met.

\# \code{apps}: If the log message is invoked by one of the specified apps, this condition is met.

The following example demonstrates what all three conditions look like:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}log.condition\PYGZsq{} =\PYGZgt{} [
       \PYGZsq{}shared\PYGZus{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}57b58edb6637fe3059b3595cf9c41b9\PYGZsq{},
       \PYGZsq{}users\PYGZsq{} =\PYGZgt{} [\PYGZsq{}sample\PYGZhy{}user\PYGZsq{}],
       \PYGZsq{}apps\PYGZsq{} =\PYGZgt{} [\PYGZsq{}files\PYGZsq{}],
],
\end{Verbatim}


\section{Hardening and Security Guidance}
\label{configuration_server/harden_server:php-date-function}\label{configuration_server/harden_server::doc}\label{configuration_server/harden_server:hardening-and-security-guidance}
ownCloud aims to ship with secure defaults that do not need to get modified by
administrators. However, in some cases some additional security hardening can be
applied in scenarios were the administrator has complete control over
the ownCloud instance. This page assumes that you run ownCloud Server on Apache2
in a Linux environment.

\begin{notice}{note}{Note:}
ownCloud will warn you in the administration interface if some
critical security-relevant options are missing. However, it is still up to
the server administrator to review and maintain system security.
\end{notice}


\subsection{Limit on Password Length}
\label{configuration_server/harden_server:limit-on-password-length}
ownCloud uses the bcrypt algorithm, and thus for security and performance
reasons, e.g. Denial of Service as CPU demand increases exponentially, it only
verifies the first 72 characters of passwords. This applies to all passwords
that you use in ownCloud: user passwords, passwords on link shares, and
passwords on external shares.


\subsection{Operating system}
\label{configuration_server/harden_server:operating-system}

\subsubsection{Give PHP read access to \texttt{/dev/urandom}}
\label{configuration_server/harden_server:dev-urandom-label}\label{configuration_server/harden_server:give-php-read-access-to-dev-urandom}
ownCloud uses a \href{https://tools.ietf.org/html/rfc4086\#section-5.2}{RFC 4086 (``Randomness Requirements for Security'')} compliant
mixer to generate cryptographically secure pseudo-random numbers. This means
that when generating a random number ownCloud will request multiple random
numbers from different sources and derive from these the final random number.

The random number generation also tries to request random numbers from
\code{/dev/urandom}, thus it is highly recommended to configure your setup in such
a way that PHP is able to read random data from it.

\begin{notice}{note}{Note:}
When having an \code{open\_basedir} configured within your \code{php.ini} file,
make sure to include \code{/dev/urandom}.
\end{notice}


\subsubsection{Enable hardening modules such as SELinux}
\label{configuration_server/harden_server:enable-hardening-modules-such-as-selinux}
It is highly recommended to enable hardening modules such as SELinux where
possible. See {\hyperref[installation/selinux_configuration::doc]{\emph{SELinux Configuration}}} to learn more about
SELinux.


\subsection{Deployment}
\label{configuration_server/harden_server:deployment}

\subsubsection{Place data directory outside of the web root}
\label{configuration_server/harden_server:place-data-directory-outside-of-the-web-root}
It is highly recommended to place your data directory outside of the Web root
(i.e. outside of \code{/var/www}). It is easiest to do this on a new
installation.


\subsubsection{Disable preview image generation}
\label{configuration_server/harden_server:disable-preview-image-generation}
ownCloud is able to generate preview images of common filetypes such as images
or text files. By default the preview generation for some file types that we
consider secure enough for deployment is enabled by default. However,
administrators should be aware that these previews are generated using PHP
libraries written in C which might be vulnerable to attack vectors.

For high security deployments we recommend disabling the preview generation by
setting the \code{enable\_previews} switch to \code{false} in \code{config.php}. As an
administrator you are also able to manage which preview providers are enabled by
modifying the \code{enabledPreviewProviders} option switch.


\subsection{Use HTTPS}
\label{configuration_server/harden_server:use-https}\label{configuration_server/harden_server:use-https-label}
Using ownCloud without using an encrypted HTTPS connection opens up your server
to a man-in-the-middle (MITM) attack, and risks the interception of user data
and passwords. It is a best practice, and highly recommended, to always use
HTTPS on production servers, and to never allow unencrypted HTTP.

How to setup HTTPS on your Web server depends on your setup; please consult the
documentation for your HTTP server. The following examples are for Apache.


\subsubsection{Redirect all unencrypted traffic to HTTPS}
\label{configuration_server/harden_server:redirect-all-unencrypted-traffic-to-https}
To redirect all HTTP traffic to HTTPS administrators are encouraged to issue a
permanent redirect using the 301 status code. When using Apache this can be
achieved by adding a setting such as the following in the Apache VirtualHosts
configuration containing the \code{\textless{}VirtualHost *:80\textgreater{}} entry:

\begin{Verbatim}[commandchars=\\\{\}]
Redirect permanent / https://example.com/
\end{Verbatim}


\subsubsection{Enable HTTP Strict Transport Security}
\label{configuration_server/harden_server:enable-http-strict-transport-security}\label{configuration_server/harden_server:enable-hsts-label}
While redirecting all traffic to HTTPS is good, it may not completely prevent
man-in-the-middle attacks. Thus administrators are encouraged to set the HTTP
Strict Transport Security header, which instructs browsers to not allow any
connection to the ownCloud instance using HTTP, and it attempts to prevent site
visitors from bypassing invalid certificate warnings.

This can be achieved by setting the following settings within the Apache
VirtualHost file containing the \code{\textless{}VirtualHost *:443\textgreater{}} entry:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}IfModule mod\PYGZus{}headers.c\PYGZgt{}
  Header always set Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{}
\PYGZlt{}/IfModule\PYGZgt{}
\end{Verbatim}

If you don't have access to your Apache configuration it is also possible to add this
to the main \code{.htaccess} file shipped with ownCloud. Make sure you're adding it below
the line:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{} DO NOT CHANGE ANYTHING ABOVE THIS LINE \PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\end{Verbatim}

This example configuration will make all subdomains only accessible via HTTPS.
If you have subdomains not accessible via HTTPS, remove \code{includeSubDomains}.

\begin{notice}{note}{Note:}
This requires the \code{mod\_headers} extension in Apache.
\end{notice}

When using nginx as a Web server an example is already included in the
{\hyperref[installation/nginx_examples::doc]{\emph{nginx Example Configurations}}}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZsh{}add\PYGZus{}header Strict\PYGZhy{}Transport\PYGZhy{}Security \PYGZdq{}max\PYGZhy{}age=15552000; includeSubDomains\PYGZdq{};}
\end{Verbatim}

You need to remove the \code{\#} and reload nginx to enable this change.


\subsubsection{Proper SSL configuration}
\label{configuration_server/harden_server:proper-ssl-configuration}
Default SSL configurations by Web servers are often not state-of-the-art, and
require fine-tuning for an optimal performance and security experience. The
available SSL ciphers and options depend completely on your environment and
thus giving a generic recommendation is not really possible.

We recommend using the \href{https://mozilla.github.io/server-side-tls/ssl-config-generator/}{Mozilla SSL Configuration Generator} to generate a
suitable configuration suited for your environment, and the free \href{https://www.ssllabs.com/ssltest/}{Qualys
SSL Labs Tests} gives good guidance on whether your SSL server is correctly
configured.

Also ensure that HTTP compression is disabled to mitigate the BREACH attack.


\subsection{Use a dedicated domain for ownCloud}
\label{configuration_server/harden_server:use-a-dedicated-domain-for-owncloud}
Administrators are encouraged to install ownCloud on a dedicated domain such as
cloud.domain.tld instead of domain.tld to gain all the benefits offered by the
Same-Origin-Policy.


\subsection{Ensure that your ownCloud instance is installed in a DMZ}
\label{configuration_server/harden_server:ensure-that-your-owncloud-instance-is-installed-in-a-dmz}
As ownCloud supports features such as Federated File Sharing we do not consider
Server Side Request Forgery (SSRF) part of our threat model. In fact, given all our
external storage adapters this can be considered a feature and not a vulnerability.

This means that a user on your ownCloud instance could probe whether other hosts
are accessible from the ownCloud network. If you do not want this you need to
ensure that your ownCloud is properly installed in a segregated network and proper
firewall rules are in place.


\subsection{Serve security related Headers by the Web server}
\label{configuration_server/harden_server:serve-security-related-headers-by-the-web-server}
Basic security headers are served by ownCloud already in a default environment.
These include:
\begin{itemize}
\item {} \begin{description}
\item[{\code{X-Content-Type-Options: nosniff}}] \leavevmode\begin{itemize}
\item {} 
Instructs some browsers to not sniff the mimetype of files. This is used for example to prevent browsers from interpreting text files as JavaScript.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{\code{X-XSS-Protection: 1; mode=block}}] \leavevmode\begin{itemize}
\item {} 
Instructs browsers to enable their browser side Cross-Site-Scripting filter.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{\code{X-Robots-Tag: none}}] \leavevmode\begin{itemize}
\item {} 
Instructs search machines to not index these pages.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{\code{X-Frame-Options: SAMEORIGIN}}] \leavevmode\begin{itemize}
\item {} 
Prevents embedding of the ownCloud instance within an iframe from other domains to prevent Clickjacking and other similar attacks.

\end{itemize}

\end{description}

\end{itemize}

These headers are hard-coded into the ownCloud server, and need no intervention
by the server administrator.

For optimal security, administrators are encouraged to serve these basic HTTP
headers by the Web server to enforce them on response. To do this Apache has to
be configured to use the \code{.htaccess} file and the following Apache
modules need to be enabled:
\begin{itemize}
\item {} 
mod\_headers

\item {} 
mod\_env

\end{itemize}

Administrators can verify whether this security change is active by accessing a
static resource served by the Web server and verify that the above mentioned
security headers are shipped.


\section{Reverse Proxy Configuration}
\label{configuration_server/reverse_proxy_configuration:rfc-4086-randomness-requirements-for-security}\label{configuration_server/reverse_proxy_configuration::doc}\label{configuration_server/reverse_proxy_configuration:reverse-proxy-configuration}
ownCloud can be run through a reverse proxy, which can cache static assets such
as images, CSS or JS files, move the load of handling HTTPS to a different
server or load balance between multiple servers.


\subsection{Defining Trusted Proxies}
\label{configuration_server/reverse_proxy_configuration:defining-trusted-proxies}
For security, you must explicitly define the proxy servers that ownCloud is to
trust. Connections from trusted proxies will be specially treated to get the
real client information, for use in access control and logging. Parameters are
configured in \code{config/config.php}

Set the \textbf{trusted\_proxies} parameter as an array of IP address to define the
servers ownCloud should trust as proxies. This parameter provides protection
against client spoofing, and you should secure those servers as you would your
ownCloud server.

A reverse proxy can define HTTP headers with the original client IP address,
and ownCloud can use those headers to retrieve that IP address. ownCloud uses
the de-facto standard header `X-Forwarded-For' by default, but this can be
configured with the \textbf{forwarded\_for\_headers} parameter. This parameter is an
array of PHP lookup strings, for example `X-Forwarded-For' becomes
`HTTP\_X\_FORWARDED\_FOR'. Incorrectly setting this parameter may allow clients
to spoof their IP address as visible to ownCloud, even when going through the
trusted proxy! The correct value for this parameter is dependent on your
proxy software.


\subsection{Overwrite Parameters}
\label{configuration_server/reverse_proxy_configuration:overwrite-parameters}
The automatic hostname, protocol or webroot detection of ownCloud can fail in
certain reverse proxy situations. This configuration allows the automatic detection
to be manually overridden.

If ownCloud fails to automatically detect the hostname, protocol or webroot
you can use the \textbf{overwrite} parameters inside the \code{config/config.php}.
The \textbf{overwritehost} parameter is used to set the hostname of the proxy. You
can also specify a port. The \textbf{overwriteprotocol} parameter is used to set the
protocol of the proxy. You can choose between the two options \textbf{http} and
\textbf{https}. The \textbf{overwritewebroot} parameter is used to set the absolute web
path of the proxy to the ownCloud folder. When you want to keep the automatic
detection of one of the three parameters you can leave the value empty or don't
set it. The \textbf{overwritecondaddr} parameter is used to overwrite the values
dependent on the remote address. The value must be a \textbf{regular expression} of
the IP addresses of the proxy. This is useful when you use a reverse SSL proxy
only for https access and you want to use the automatic detection for http
access.


\subsection{Example}
\label{configuration_server/reverse_proxy_configuration:example}

\subsubsection{Multiple Domains Reverse SSL Proxy}
\label{configuration_server/reverse_proxy_configuration:multiple-domains-reverse-ssl-proxy}
If you want to access your ownCloud installation \textbf{http://domain.tld/owncloud}
via a multiple domains reverse SSL proxy
\textbf{https://ssl-proxy.tld/domain.tld/owncloud} with the IP address \textbf{10.0.0.1}
you can set the following parameters inside the \code{config/config.php}.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}CONFIG = array (
  \PYGZdq{}trusted\PYGZus{}proxies\PYGZdq{}   =\PYGZgt{} [\PYGZsq{}10.0.0.1\PYGZsq{}],
  \PYGZdq{}overwritehost\PYGZdq{}     =\PYGZgt{} \PYGZdq{}ssl\PYGZhy{}proxy.tld\PYGZdq{},
  \PYGZdq{}overwriteprotocol\PYGZdq{} =\PYGZgt{} \PYGZdq{}https\PYGZdq{},
  \PYGZdq{}overwritewebroot\PYGZdq{}  =\PYGZgt{} \PYGZdq{}/domain.tld/owncloud\PYGZdq{},
  \PYGZdq{}overwritecondaddr\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZca{}10\PYGZbs{}.0\PYGZbs{}.0\PYGZbs{}.1\PYGZdl{}\PYGZdq{},
);
\end{Verbatim}

\begin{notice}{note}{Note:}
If you want to use the SSL proxy during installation you have to
create the \code{config/config.php} otherwise you have to extend the existing
\textbf{\$CONFIG} array.
\end{notice}


\section{Using Third Party PHP Components}
\label{configuration_server/thirdparty_php_configuration:using-third-party-php-components}\label{configuration_server/thirdparty_php_configuration::doc}
ownCloud uses some third party PHP components to provide some of its functionality. These components are part of the software package and are contained in the \textbf{/3rdparty} folder.


\subsection{Managing Third Party Parameters}
\label{configuration_server/thirdparty_php_configuration:managing-third-party-parameters}
When using third party components, keep the following parameters in mind:
\begin{itemize}
\item {} 
\textbf{3rdpartyroot} -- Specifies the location of the 3rd-party folder. To change the default location of this folder, you can use this parameter to define the absolute file system path to the folder location.

\item {} 
\textbf{3rdpartyurl} -- Specifies the http web path to the 3rdpartyroot folder, starting at the ownCloud web root.

\end{itemize}

An example of what these parameters might look like is as follows:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}3rdpartyroot\PYGZdq{} =\PYGZgt{} OC::\PYGZdl{}SERVERROOT.\PYGZdq{}/3rdparty\PYGZdq{},
\PYGZdq{}3rdpartyurl\PYGZdq{}  =\PYGZgt{} \PYGZdq{}/3rdparty\PYGZdq{},
\end{Verbatim}


\section{JavaScript and CSS Asset Management}
\label{configuration_server/js_css_asset_management_configuration:javascript-and-css-asset-management}\label{configuration_server/js_css_asset_management_configuration::doc}
In production environments, JavaScript and CSS files should be delivered in a concatenated and compressed format.

ownCloud can automatically collect all JavaScript and CSS files, aggregate and compress them to then save the result in a folder called `assets' which can be found in the folder where ownCloud has been installed.

If your Web server has write access to your ownCloud installation, then the `assets' folder will be automatically created for you, otherwise, you need to create it yourself before enabling that option and you must give write access to your Web server user.

Assets found in that folder will from now on be served as static files by your Web server and will be automatically refreshed whenever ownCloud or one of its apps is updated.
It's important to note that apps installed via git might not always update their version number with every commit and this could lead to an out-of-sync asset folder.
It is not recommended to enable asset-pipelining when using apps pulled via git.


\subsection{Parameters}
\label{configuration_server/js_css_asset_management_configuration:parameters}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZdl{}CONFIG = array (
    ...
    \PYGZsq{}asset\PYGZhy{}pipeline.enabled\PYGZsq{} =\PYGZgt{} true,
    ...
  );
\end{Verbatim}

You can set this parameter in the \code{config/config.php}


\section{Automatic Configuration Setup}
\label{configuration_server/automatic_configuration:automatic-configuration-setup}\label{configuration_server/automatic_configuration::doc}
If you need to install ownCloud on multiple servers, you normally do not want
to set up each instance separately as described in
{\hyperref[configuration_database/linux_database_configuration::doc]{\emph{Database Configuration}}}.
For this reason, ownCloud provides an automatic configuration feature.

To take advantage of this feature, you must create a configuration file, called
\code{../owncloud/config/autoconfig.php}, and set the file parameters as required.
You can specify any number of parameters in this file.  Any unspecified parameters appear on the ``Finish setup'' screen when you first launch ownCloud.

The \code{../owncloud/config/autoconfig.php} is automatically removed after the initial configuration has been applied.


\subsection{Parameters}
\label{configuration_server/automatic_configuration:parameters}
When configuring parameters, you must understand that two parameters are named differently in this configuration file when compared to the standard \code{config.php} file.

\begin{tabulary}{\linewidth}{|L|L|}
\hline
\textsf{\relax 
autoconfig.php
} & \textsf{\relax 
config.php
}\\
\hline
directory
 & 
datadirectory
\\
\hline
dbpass
 & 
dbpassword
\\
\hline\end{tabulary}



\subsection{Automatic Configurations Examples}
\label{configuration_server/automatic_configuration:automatic-configurations-examples}
The following sections provide sample automatic configuration examples and what information is requested at the end of the configuration.


\subsubsection{Data Directory}
\label{configuration_server/automatic_configuration:data-directory}
Using the following parameter settings, the ``Finish setup'' screen requests database and admin credentials settings.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}AUTOCONFIG = array(
  \PYGZdq{}directory\PYGZdq{}     =\PYGZgt{} \PYGZdq{}/www/htdocs/owncloud/data\PYGZdq{},
);
\end{Verbatim}


\subsubsection{SQLite Database}
\label{configuration_server/automatic_configuration:sqlite-database}
Using the following parameter settings, the ``Finish setup'' screen requests data directory and admin credentials settings.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}AUTOCONFIG = array(
  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}sqlite\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
);
\end{Verbatim}


\subsubsection{MySQL Database}
\label{configuration_server/automatic_configuration:mysql-database}
Using the following parameter settings, the ``Finish setup'' screen requests data directory and admin credentials settings.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}AUTOCONFIG = array(
  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}mysql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpass\PYGZdq{}        =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}localhost\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
);
\end{Verbatim}

\begin{notice}{note}{Note:}
Keep in mind that the automatic configuration does not eliminate the need for
creating the  database user and database in advance, as described in
{\hyperref[configuration_database/linux_database_configuration::doc]{\emph{Database Configuration}}}.
\end{notice}


\subsubsection{PostgreSQL Database}
\label{configuration_server/automatic_configuration:postgresql-database}
Using the following parameter settings, the ``Finish setup'' screen requests data directory and admin credentials settings.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}AUTOCONFIG = array(
  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}pgsql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpass\PYGZdq{}        =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}localhost\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
);
\end{Verbatim}

\begin{notice}{note}{Note:}
Keep in mind that the automatic configuration does not eliminate the need for
creating the database user and database in advance, as described in
{\hyperref[configuration_database/linux_database_configuration::doc]{\emph{Database Configuration}}}.
\end{notice}


\subsubsection{All Parameters}
\label{configuration_server/automatic_configuration:all-parameters}
Using the following parameter settings, because all parameters are already configured in the file, the ownCloud installation skips the ``Finish setup'' screen.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}AUTOCONFIG = array(
  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}mysql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpass\PYGZdq{}        =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}localhost\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}adminlogin\PYGZdq{}    =\PYGZgt{} \PYGZdq{}root\PYGZdq{},
  \PYGZdq{}adminpass\PYGZdq{}     =\PYGZgt{} \PYGZdq{}root\PYGZhy{}password\PYGZdq{},
  \PYGZdq{}directory\PYGZdq{}     =\PYGZgt{} \PYGZdq{}/www/htdocs/owncloud/data\PYGZdq{},
);
\end{Verbatim}

\begin{notice}{note}{Note:}
Keep in mind that the automatic configuration does not eliminate the need for
creating the database user and database in advance, as described in
{\hyperref[configuration_database/linux_database_configuration::doc]{\emph{Database Configuration}}}.
\end{notice}


\section{ownCloud Server Tuning}
\label{configuration_server/oc_server_tuning::doc}\label{configuration_server/oc_server_tuning:owncloud-server-tuning}

\subsection{Using cron to perform background jobs}
\label{configuration_server/oc_server_tuning:using-cron-to-perform-background-jobs}
See {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}} for a description and the
benefits.


\subsection{Enable JavaScript and CSS Asset Management}
\label{configuration_server/oc_server_tuning:enable-javascript-and-css-asset-management}
See {\hyperref[configuration_server/js_css_asset_management_configuration::doc]{\emph{JavaScript and CSS Asset Management}}} for a description and the
benefits.


\subsection{Caching}
\label{configuration_server/oc_server_tuning:caching}\label{configuration_server/oc_server_tuning:id1}
Caching improves performance by storing data, code, and other objects in memory.
Memory cache configuration for the ownCloud server is no longer automatic in
ownCloud 8.1 and up, but must be installed and configured. See
{\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}}.


\subsection{Using MariaDB/MySQL instead of SQLite}
\label{configuration_server/oc_server_tuning:using-mariadb-mysql-instead-of-sqlite}
MySQL or MariaDB are preferred because of the \href{http://www.sqlite.org/whentouse.html}{performance limitations of
SQLite with highly concurrent applications}, like ownCloud.

See the section {\hyperref[configuration_database/linux_database_configuration::doc]{\emph{Database Configuration}}} for how to
configure ownCloud for MySQL or MariaDB. If your installation is already running on
SQLite then it is possible to convert to MySQL or MariaDB using the steps provided
in {\hyperref[configuration_database/db_conversion::doc]{\emph{Converting Database Type}}}.


\subsection{Using Redis-based Transactional File Locking}
\label{configuration_server/oc_server_tuning:using-redis-based-transactional-file-locking}
File locking is enabled by default, using the database locking backend. This
places a significant load on your database. See the section
{\hyperref[configuration_files/files_locking_transactional::doc]{\emph{Transactional File Locking}}} for how to
configure ownCloud to use Redis-based Transactional File Locking.


\subsection{SSL / Encryption App}
\label{configuration_server/oc_server_tuning:ssl-encryption-app}
SSL (HTTPS) and file encryption/decryption can be offloaded to a processor's
AES-NI extension. This can both speed up these operations while lowering
processing overhead. This requires a processor with the \href{http://wikipedia.org/wiki/AES\_instruction\_set}{AES-NI instruction set}.

Here are some examples how to check if your CPU / environment supports the
AES-NI extension:
\begin{itemize}
\item {} 
For each CPU core present: \code{grep flags /proc/cpuinfo} or as a summary for
all cores: \code{grep -m 1 \textasciicircum{}flags /proc/cpuinfo} If the result contains any
\code{aes}, the extension is present.

\item {} 
Search eg. on the Intel web if the processor used supports the extension
\href{http://ark.intel.com/MySearch.aspx?AESTech=true}{Intel Processor Feature Filter} You may set a filter by
\code{"AES New Instructions"} to get a reduced result set.

\item {} 
For versions of openssl \textgreater{}= 1.0.1, AES-NI does not work via an engine and
will not show up in the \code{openssl engine} command. It is active by default
on the supported hardware. You can check the openssl version via \code{openssl
version -a}

\item {} 
If your processor supports AES-NI but it does not show up eg via grep or
coreinfo, it is maybe disabled in the BIOS.

\item {} 
If your environment runs virtualized, check the virtualization vendor for
support.

\end{itemize}


\section{Enable index.php-less URLs}
\label{configuration_server/index_php_less_urls::doc}\label{configuration_server/index_php_less_urls:enable-index-php-less-urls}
Since ownCloud 9.0.3 you need to explicitly configure and enable index.php-less URLs
(e.g. \href{https://example.com/apps/files/}{https://example.com/apps/files/} instead of \href{https://example.com/index.php/apps/files/}{https://example.com/index.php/apps/files/}).
The following documentation provides the needed steps to configure this for the \code{Apache}
Web server. These steps are not necessary when using nginx as a web server because it is already
enabled in the {\hyperref[installation/nginx_examples::doc]{\emph{nginx Example Configurations}}}.


\subsection{Prerequisites}
\label{configuration_server/index_php_less_urls:prerequisites}
Before being able to use index.php-less URLs you need to enable the \code{mod\_rewrite} and
\code{mod\_env} Apache modules. Furthermore a configured \code{AllowOverride All} directive
within the vhost of your Web server is needed. Please have a look at the \code{Apache} manual
for how to enable and configure these.

Furthermore these instructions are only working when using Apache together with the \code{mod\_php}
Apache module for PHP. Other modules like \code{php-fpm} or \code{mod\_fastcgi} are unsupported.

Finally the user running your Web server (e.g. \code{www-data}) needs to be able to write into the
\code{.htaccess} file shipped within the ownCloud root directory (e.g. \code{/var/www/owncloud/.htaccess}).
If you have applied {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}} the user might be unable to write into this
file and the needed update will fail. You need to revert this strong permissions temporarily by
following the steps described in {\hyperref[maintenance/update:set-updating-permissions-label]{\emph{Setting Permissions for Updating}}}.


\subsection{Configuration steps}
\label{configuration_server/index_php_less_urls:configuration-steps}
The first step is to configure the \code{overwrite.cli.url} and \code{htaccess.RewriteBase}
config.php options (See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}). If you're accessing
your ownCloud instance via \code{https://example.com/} the following two options need
to be added / configured:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwrite.cli.url\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://example.com\PYGZsq{},
\PYGZsq{}htaccess.RewriteBase\PYGZsq{} =\PYGZgt{} \PYGZsq{}/\PYGZsq{},
\end{Verbatim}

If the instance is accessed via \code{https://example.com/owncloud} the following
configuration is needed:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}overwrite.cli.url\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://example.com/owncloud\PYGZsq{},
\PYGZsq{}htaccess.RewriteBase\PYGZsq{} =\PYGZgt{} \PYGZsq{}/owncloud\PYGZsq{},
\end{Verbatim}

As a second step ownCloud needs to enable index.php-less URLs. This is done:
\begin{itemize}
\item {} 
during the next update of your ownCloud instance

\item {} 
by manually running the occ command \code{occ maintenance:update:htaccess} (See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}})

\end{itemize}

Afterwards your instance should have index.php-less URLs enabled.


\subsection{Troubleshooting}
\label{configuration_server/index_php_less_urls:troubleshooting}
If accessing your ownCloud installation fails after following these instructions and you see
messages like this in your ownCloud log:

\begin{Verbatim}[commandchars=\\\{\}]
The requested uri(\PYGZbs{}\PYGZbs{}/login) cannot be processed by the script \PYGZsq{}\PYGZbs{}\PYGZbs{}/owncloud\PYGZbs{}\PYGZbs{}/index.php\PYGZsq{}
\end{Verbatim}

make sure that you have configured the two \code{config.php} options listed above correctly.


\chapter{User Management}
\label{configuration_user/index:user-management}\label{configuration_user/index::doc}

\section{User Management}
\label{configuration_user/user_configuration:user-management}\label{configuration_user/user_configuration::doc}
On the User management page of your ownCloud Web UI you can:
\begin{itemize}
\item {} 
Create new users

\item {} 
View all of your users in a single scrolling window

\item {} 
Filter users by group

\item {} 
See what groups they belong to

\item {} 
Edit their full names and passwords

\item {} 
See their data storage locations

\item {} 
View and set quotas

\item {} 
Create and edit their email addresses

\item {} 
Send an automatic email notification to new users

\item {} 
Delete them with a single click

\end{itemize}

The default view displays basic information about your users.
\begin{figure}[htbp]
\centering

\includegraphics{users-config.png}
\end{figure}

The Group filters on the left sidebar lets you quickly filter users by their
group memberships, and create new groups.
\begin{figure}[htbp]
\centering

\includegraphics{users-config-1.png}
\end{figure}

Click the gear icon on the lower left sidebar to set a default storage quota,
and to display additional fields: \textbf{Show storage location, Show last log in,
Show user backend, Send email to new users,} and \textbf{Show email address}.
\begin{figure}[htbp]
\centering

\includegraphics{users-config-2.png}
\end{figure}

User accounts have the following properties:
\begin{description}
\item[{\emph{Login Name (Username)}}] \leavevmode
The unique ID of an ownCloud user, and it cannot be changed.

\item[{\emph{Full Name}}] \leavevmode
The user's display name that appears on file shares, the ownCloud Web
interface, and emails. Admins and users may change the Full Name anytime. If
the Full Name is not set it defaults to the login name.

\item[{\emph{Password}}] \leavevmode
The admin sets the new user's first password. Both the user and the admin can
change the user's password at anytime.

\item[{\emph{Groups}}] \leavevmode
You may create groups, and assign group memberships to users. By default new
users are not assigned to any groups.

\item[{\emph{Group Admin}}] \leavevmode
Group admins are granted administrative privileges on specific groups, and
can add and remove users from their groups.

\item[{\emph{Quota}}] \leavevmode
The maximum disk space assigned to each user. Any user that exceeds the quota
cannot upload or sync data. You have the the option to include external
storage in user quotas.

\end{description}


\subsection{Creating a New User}
\label{configuration_user/user_configuration:creating-a-new-user}
To create a user account:
\begin{itemize}
\item {} 
Enter the new user's \textbf{Login Name} and their initial \textbf{Password}

\item {} 
Optionally, assign \textbf{Groups} memberships

\item {} 
Click the \textbf{Create} button

\end{itemize}
\begin{figure}[htbp]
\centering

\includegraphics{users-create.png}
\end{figure}

Login names may contain letters (a-z, A-Z), numbers (0-9), dashes (-),
underscores (\_), periods (.) and at signs (@). After creating the user, you
may fill in their \textbf{Full Name} if it is different than the login name, or
leave it for the user to complete.

If you have checked \textbf{Send email to new user} in the control panel on the
lower left sidebar, you may also enter the new user's email address, and
ownCloud will automatically send them a notification with their new login
information. You may edit this email using the email template editor on your
Admin page (see {\hyperref[configuration_server/email_configuration::doc]{\emph{Email Configuration}}}).


\subsection{Reset a User's Password}
\label{configuration_user/user_configuration:reset-a-user-s-password}
You cannot recover a user's password, but you can set a new one:
\begin{itemize}
\item {} 
Hover your cursor over the user's \textbf{Password} field

\item {} 
Click on the \textbf{pencil icon}

\item {} 
Enter the user's new password in the password field, and remember to provide
the user with their password

\end{itemize}

If you have encryption enabled, there are special considerations for user
password resets. Please see
{\hyperref[configuration_files/encryption_configuration::doc]{\emph{Encryption Configuration}}}.


\subsection{Renaming a User}
\label{configuration_user/user_configuration:renaming-a-user}
Each ownCloud user has two names: a unique \textbf{Login Name} used for
authentication, and a \textbf{Full Name}, which is their display name. You can edit
the display name of a user, but you cannot change the login name of any user.

To set or change a user's display name:
\begin{itemize}
\item {} 
Hover your cursor over the user's \textbf{Full Name} field

\item {} 
Click on the \textbf{Pencil icon}

\item {} 
Enter the user's new display name

\end{itemize}


\subsection{Granting Administrator Privileges to a User}
\label{configuration_user/user_configuration:granting-administrator-privileges-to-a-user}
ownCloud has two types of administrators: \textbf{Super Administrators} and \textbf{Group
Administrators}. Group administrators have the rights to create, edit and
delete users in their assigned groups. Group administrators cannot access
system settings, or add or modify users in the groups that they are not \textbf{Group
Administrators} for. Use the dropdown menus in the \textbf{Group Admin} column to
assign group admin privileges.
\begin{figure}[htbp]
\centering

\includegraphics{users-groups.png}
\end{figure}

\textbf{Super Administrators} have full rights on your ownCloud server, and can
access and modify all settings. To assign the \textbf{Super Administrators} role to
a user, simply add them to the \code{admin} group.


\subsection{Managing Groups}
\label{configuration_user/user_configuration:managing-groups}
You can assign new users to groups when you create them, and create new groups
when you create new users. You may also use the \textbf{Add Group} button at the top
of the left pane to create new groups. New group members will immediately
have access to file shares that belong to their new groups.


\subsection{Setting Storage Quotas}
\label{configuration_user/user_configuration:setting-storage-quotas}
Click the gear on the lower left pane to set a default storage quota. This is
automatically applied to new users. You may assign a different quota to any user
by selecting from the \textbf{Quota} dropdown, selecting either a preset value or
entering a custom value. When you create custom quotas, use the normal
abbreviations for your storage values such as 500 MB, 5 GB, 5 TB, and so on.

You now have a configurable option in \code{config.php} that controls whether
external storage is counted against user's quotas. This is still
experimental, and may not work as expected. The default is to not count
external storage as part of user storage quotas. If you prefer to include it,
then change the default \code{false} to \code{true}.:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}quota\PYGZus{}include\PYGZus{}external\PYGZus{}storage\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}

Metadata (such as thumbnails, temporary files, and encryption keys) takes up
about 10\% of disk space, but is not counted against user quotas. Users can check
their used and available space on their Personal pages. Only files that
originate with users count against their quotas, and not files shared with them
that originate from other users. For example, if you upload files to a
different user's share, those files count against your quota. If you re-share a
file that another user shared with you, that file does not count against your
quota, but the originating user's.

Encrypted files are a little larger than unencrypted files; the unencrypted size
is calculated against the user's quota.

Deleted files that are still in the trash bin do not count against quotas. The
trash bin is set at 50\% of quota. Deleted file aging is set at 30 days. When
deleted files exceed 50\% of quota then the oldest files are removed until the
total is below 50\%.

When version control is enabled, the older file versions are not counted
against quotas.

When a user creates a public share via URL, and allows uploads, any uploaded
files count against that user's quota.


\subsection{Deleting users}
\label{configuration_user/user_configuration:deleting-users}
Deleting a user is easy: hover your cursor over their name on the \textbf{Users} page
until a trashcan icon appears at the far right. Click the trashcan, and they're
gone. You'll see an undo button at the top of the page, which remains until you
refresh the page. When the undo button is gone you cannot recover the deleted
user.

All of the files owned by the user are deleted as well, including all files they
have shared. If you need to preserve the user's files and shares, you must first
download them from your ownCloud Files page, which compresses them into a zip
file, or use a sync client to copy them to your local computer. See
{\hyperref[configuration_files/file_sharing_configuration::doc]{\emph{File Sharing}}} to learn how to create
persistent file shares that survive user deletions.


\section{Resetting a Lost Admin Password}
\label{configuration_user/reset_admin_password::doc}\label{configuration_user/reset_admin_password:resetting-a-lost-admin-password}
The normal ways to recover a lost password are:
\begin{enumerate}
\item {} 
Click the password reset link on the login screen; this appears after a
failed login attempt. This works only if you have entered your email address
on your Personal page in the ownCloud Web interface, so that the ownCloud
server can email a reset link to you.

\item {} 
Ask another ownCloud server admin to reset it for you.

\end{enumerate}

If neither of these is an option, then you have a third option, and that is
using the \code{occ} command. \code{occ} is in the \code{owncloud} directory, for
example \code{/var/www/owncloud/occ}. \code{occ} has a command for resetting all
user passwords, \code{user:resetpassword}. It is best to run \code{occ} as the HTTP
user, as in this example on Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php /var/www/owncloud/occ user:resetpassword admin
Enter a new password:
Confirm the new password:
Successfully reset password for admin
\end{Verbatim}

If your ownCloud username is not \code{admin}, then substitute your ownCloud
username.

You can find your HTTP user in your HTTP configuration file. These are the
default Apache HTTP user:group on Linux distros:
\begin{itemize}
\item {} 
Centos, Red Hat, Fedora: apache:apache

\item {} 
Debian, Ubuntu, Linux Mint: www-data:www-data

\item {} 
openSUSE: wwwrun:www

\end{itemize}

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more about using the
\code{occ} command.


\section{Resetting a User Password}
\label{configuration_user/reset_user_password:resetting-a-user-password}\label{configuration_user/reset_user_password::doc}
The ownCloud login screen displays a \textbf{Wrong password. Reset it?} message
after a user enters an incorrect password, and then ownCloud automatically
resets their password. However, if you are using a read-only authentication
backend such as LDAP or Active Directory, this will not work. In this case you
may specify a custom URL in your \code{config.php} file to direct your user to a
server than can handle an automatic reset:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}lost\PYGZus{}password\PYGZus{}link\PYGZsq{} =\PYGZgt{} \PYGZsq{}https://example.org/link/to/password/reset\PYGZsq{},
\end{Verbatim}


\section{User Authentication with IMAP, SMB, and FTP}
\label{configuration_user/user_auth_ftp_smb_imap:user-authentication-with-imap-smb-and-ftp}\label{configuration_user/user_auth_ftp_smb_imap::doc}
You may configure additional user backends
in ownCloud's configuration \code{config/config.php} using the following
syntax:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}user\PYGZus{}backends\PYGZdq{} =\PYGZgt{} array (
    0 =\PYGZgt{} array (
            \PYGZdq{}class\PYGZdq{}     =\PYGZgt{} ...,
            \PYGZdq{}arguments\PYGZdq{} =\PYGZgt{} array (
                              0 =\PYGZgt{} ...
                              ),
    ),
),
\end{Verbatim}

\begin{notice}{note}{Note:}
A non-blocking or correctly configured SELinux setup is needed
for these backends to work. Please refer to the {\hyperref[installation/selinux_configuration:selinux-config-label]{\emph{SELinux Configuration}}}.
\end{notice}

Currently the “External user support” (user\_external) app, which you need to
enable first (See {\hyperref[installation/apps_management_installation::doc]{\emph{Installing and Managing Apps}}})
provides the following user backends:


\subsection{IMAP}
\label{configuration_user/user_auth_ftp_smb_imap:imap}
Provides authentication against IMAP servers
\begin{itemize}
\item {} 
\textbf{Class:} OC\_User\_IMAP

\item {} 
\textbf{Arguments:}  a mailbox string as defined \href{http://www.php.net/manual/en/function.imap-open.php}{in the PHP documentation}

\item {} 
\textbf{Dependency:} php-imap (See {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}})

\item {} 
\textbf{Example:}

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}user\PYGZus{}backends\PYGZdq{} =\PYGZgt{} array (
    0 =\PYGZgt{} array (
            \PYGZdq{}class\PYGZdq{}     =\PYGZgt{} \PYGZdq{}OC\PYGZus{}User\PYGZus{}IMAP\PYGZdq{},
            \PYGZdq{}arguments\PYGZdq{} =\PYGZgt{} array (
                              0 =\PYGZgt{} \PYGZsq{}\PYGZob{}imap.gmail.com:993/imap/ssl\PYGZcb{}\PYGZsq{}
                              ),
    ),
),
\end{Verbatim}


\subsection{SMB}
\label{configuration_user/user_auth_ftp_smb_imap:smb}
Provides authentication against Samba servers
\begin{itemize}
\item {} 
\textbf{Class:} OC\_User\_SMB

\item {} 
\textbf{Arguments:} the samba server to authenticate against

\item {} 
\textbf{Dependency:} PHP smbclient module or smbclient (see
{\hyperref[configuration_files/external_storage/smb::doc]{\emph{SMB/CIFS}}})

\item {} 
\textbf{Example:}

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}user\PYGZus{}backends\PYGZdq{} =\PYGZgt{} array (
    0 =\PYGZgt{} array (
            \PYGZdq{}class\PYGZdq{}     =\PYGZgt{} \PYGZdq{}OC\PYGZus{}User\PYGZus{}SMB\PYGZdq{},
            \PYGZdq{}arguments\PYGZdq{} =\PYGZgt{} array (
                              0 =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{}
                              ),
    ),
),
\end{Verbatim}


\subsection{FTP}
\label{configuration_user/user_auth_ftp_smb_imap:ftp}
Provides authentication against FTP servers
\begin{itemize}
\item {} 
\textbf{Class:} OC\_User\_FTP

\item {} 
\textbf{Arguments:} the FTP server to authenticate against

\item {} 
\textbf{Dependency:} php-ftp (See {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}})

\item {} 
\textbf{Example:}

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

\PYGZdq{}user\PYGZus{}backends\PYGZdq{} =\PYGZgt{} array (
    0 =\PYGZgt{} array (
            \PYGZdq{}class\PYGZdq{}     =\PYGZgt{} \PYGZdq{}OC\PYGZus{}User\PYGZus{}FTP\PYGZdq{},
            \PYGZdq{}arguments\PYGZdq{} =\PYGZgt{} array (
                              0 =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{}
                              ),
    ),
),
\end{Verbatim}


\section{User Authentication with LDAP}
\label{configuration_user/user_auth_ldap::doc}\label{configuration_user/user_auth_ldap:user-authentication-with-ldap}
ownCloud ships with an LDAP application to allow LDAP users (including Active
Directory) to appear in your ownCloud user listings. These users will
authenticate to ownCloud with their LDAP credentials, so you don't have to
create separate ownCloud user accounts for them. You will manage their ownCloud
group memberships, quotas, and sharing permissions just like any other ownCloud
user.

\begin{notice}{note}{Note:}
The PHP LDAP module is required; this is supplied by \code{php5-ldap} on
Debian/Ubuntu, and \code{php-ldap} on CentOS/Red Hat/Fedora. PHP 5.6+ or 7.0+ is
required in ownCloud 9.1.
\end{notice}

The LDAP application supports:
\begin{itemize}
\item {} 
LDAP group support

\item {} 
File sharing with ownCloud users and groups

\item {} 
Access via WebDAV and ownCloud Desktop Client

\item {} 
Versioning, external Storage and all other ownCloud features

\item {} 
Seamless connectivity to Active Directory, with no extra configuration
required

\item {} 
Support for primary groups in Active Directory

\item {} 
Auto-detection of LDAP attributes such as base DN, email, and the LDAP server
port number

\item {} 
Only read access to your LDAP (edit or delete of users on your LDAP is not
supported)

\end{itemize}

\begin{notice}{warning}{Warning:}
The LDAP app is not compatible with the \code{User backend using remote
HTTP servers} app. You cannot use both of them at the same time.
\end{notice}

\begin{notice}{note}{Note:}
A non-blocking or correctly configured SELinux setup is needed
for the LDAP backend to work. Please refer to the {\hyperref[installation/selinux_configuration:selinux-config-label]{\emph{SELinux Configuration}}}.
\end{notice}


\subsection{Configuration}
\label{configuration_user/user_auth_ldap:configuration}
First enable the \code{LDAP user and group backend} app on the Apps page in
ownCloud. Then go to your Admin page to configure it.

The LDAP configuration panel has four tabs. A correctly completed first tab
(``Server'') is mandatory to access the other tabs. A green indicator lights when
the configuration is correct. Hover your cursor over the fields to see some
pop-up tooltips.


\subsubsection{Server Tab}
\label{configuration_user/user_auth_ldap:server-tab}
Start with the Server tab. You may configure multiple servers if you have them.
At a minimum you must supply the LDAP server's hostname. If your server requires
authentication, enter your credentials on this tab. ownCloud will then attempt
to auto-detect the server's port and base DN. The base DN and port are
mandatory, so if ownCloud cannot detect them you must enter them manually.
\begin{figure}[htbp]
\centering

\includegraphics{ldap-wizard-1-server.png}
\end{figure}
\begin{description}
\item[{Server configuration:}] \leavevmode
Configure one or more LDAP servers. Click the \textbf{Delete Configuration}
button to remove the active configuration.

\item[{Host:}] \leavevmode
The host name or IP address of the LDAP server. It can also be a \textbf{ldaps://}
URI. If you enter the port number, it speeds up server detection.

Examples:
\begin{itemize}
\item {} 
\emph{directory.my-company.com}

\item {} 
\emph{ldaps://directory.my-company.com}

\item {} 
\emph{directory.my-company.com:9876}

\end{itemize}

\item[{Port:}] \leavevmode
The port on which to connect to the LDAP server. The field is disabled in the
beginning of a new configuration. If the LDAP server is running on a standard
port, the port will be detected automatically. If you are using a
non-standard port, ownCloud will attempt to detect it. If this fails you must
enter the port number manually.

Example:
\begin{itemize}
\item {} 
\emph{389}

\end{itemize}

\item[{User DN:}] \leavevmode
The name as DN of a user who has permissions to do searches in the LDAP
directory. Leave it empty for anonymous access. We recommend that you have a
special LDAP system user for this.

Example:
\begin{itemize}
\item {} 
\emph{uid=owncloudsystemuser,cn=sysusers,dc=my-company,dc=com}

\end{itemize}

\item[{Password:}] \leavevmode
The password for the user given above. Empty for anonymous access.

\item[{Base DN:}] \leavevmode
The base DN of LDAP, from where all users and groups can be reached. You may
enter multiple base DNs, one per line. (Base DNs for users and groups can be
set in the Advanced tab.) This field is mandatory. ownCloud attempts to
determine the Base DN according to the provided User DN or the provided
Host, and you must enter it manually if ownCloud does not detect it.

Example:
\begin{itemize}
\item {} 
\emph{dc=my-company,dc=com}

\end{itemize}

\end{description}


\subsubsection{User Filter}
\label{configuration_user/user_auth_ldap:user-filter}
Use this to control which LDAP users are listed as ownCloud users on your
ownCloud server. In order to control which LDAP users can login to your ownCloud
server use the Login filter. Those LDAP users who have access but are not listed
as users (if there are any) will be hidden users. You may bypass the form fields
and enter a raw LDAP filter if you prefer.
\begin{figure}[htbp]
\centering

\includegraphics{ldap-wizard-2-user.png}
\end{figure}
\begin{description}
\item[{only those object classes:}] \leavevmode
ownCloud will determine the object classes that are typically available for
user objects in your LDAP. ownCloud will automatically select the object
class that returns the highest amount of users. You may select multiple
object classes.

\item[{only from those groups:}] \leavevmode
If your LDAP server supports the \code{member-of-overlay} in LDAP filters, you
can define that only users from one or more certain groups are allowed to
appear in user listings in ownCloud. By default, no value will be selected.

\item[{You}] \leavevmode
may select multiple groups.

If your LDAP server does not support the member-of-overlay in LDAP filters,
the input field is disabled. Please contact your LDAP administrator.

\item[{Edit raw filter instead:}] \leavevmode
Clicking on this text toggles the filter mode and you can enter the raw LDAP
filter directly. Example:

\begin{Verbatim}[commandchars=\\\{\}]
(\PYGZam{}(objectClass=inetOrgPerson)(memberOf=cn=owncloudusers,ou=groups,
dc=example,dc=com))
\end{Verbatim}

\item[{x users found:}] \leavevmode
This is an indicator that tells you approximately how many users will be
listed in ownCloud. The number updates automatically after any changes.

\end{description}


\subsubsection{Login Filter}
\label{configuration_user/user_auth_ldap:login-filter}
The settings in the Login Filter tab determine which LDAP users can log in to
your ownCloud system and which attribute or attributes the provided login name
is matched against (e.g. LDAP/AD username, email address). You may select
multiple user details. (You may bypass the form fields and enter a raw LDAP
filter if you prefer.)

You may override your User Filter settings on the User Filter tab by using a raw
LDAP filter.
\begin{figure}[htbp]
\centering

\includegraphics{ldap-wizard-3-login.png}
\end{figure}
\begin{description}
\item[{LDAP Username:}] \leavevmode
If this value is checked, the login value will be compared to the username in
the LDAP directory. The corresponding attribute, usually \emph{uid} or
\emph{samaccountname} will be detected automatically by ownCloud.

\item[{LDAP Email Address:}] \leavevmode
If this value is checked, the login value will be compared to an email address
in the LDAP directory; specifically, the \emph{mailPrimaryAddress} and \emph{mail}
attributes.

\item[{Other Attributes:}] \leavevmode
This multi-select box allows you to select other attributes for the
comparison. The list is generated automatically from the user object
attributes in your LDAP server.

\item[{Edit raw filter instead:}] \leavevmode
Clicking on this text toggles the filter mode and you can enter the raw LDAP
filter directly.

The \textbf{\%uid} placeholder is replaced with the login name entered by the
user upon login.

Examples:
\begin{itemize}
\item {} 
only username:

\begin{Verbatim}[commandchars=\\\{\}]
(\PYGZam{}(objectClass=inetOrgPerson)(memberOf=cn=owncloudusers,ou=groups,
dc=example,dc=com)(uid=\PYGZpc{}uid)
\end{Verbatim}

\item {} 
username or email address:

\begin{Verbatim}[commandchars=\\\{\}]
((\PYGZam{}(objectClass=inetOrgPerson)(memberOf=cn=owncloudusers,ou=groups,
dc=example,dc=com)(\textbar{}(uid=\PYGZpc{}uid)(mail=\PYGZpc{}uid)))
\end{Verbatim}

\end{itemize}

\end{description}


\subsubsection{Group Filter}
\label{configuration_user/user_auth_ldap:group-filter}
By default, no LDAP groups will be available in ownCloud. The settings in the
group filter tab determine which groups will be available in ownCloud. You may
also elect to enter a raw LDAP filter instead.
\begin{figure}[htbp]
\centering

\includegraphics{ldap-wizard-4-group.png}
\end{figure}
\begin{description}
\item[{only those object classes:}] \leavevmode
ownCloud will determine the object classes that are typically available for
group objects in your LDAP server. ownCloud will only list object
classes that return at least one group object. You can select multiple
object classes. A typical object class is ``group'', or ``posixGroup''.

\item[{only from those groups:}] \leavevmode
ownCloud will generate a list of available groups found in your LDAP server.
and then you select the group or groups that get access to your ownCloud
server.

\item[{Edit raw filter instead:}] \leavevmode
Clicking on this text toggles the filter mode and you can enter the raw LDAP
filter directly.

Example:
\begin{itemize}
\item {} 
\emph{objectClass=group}

\item {} 
\emph{objectClass=posixGroup}

\end{itemize}

\item[{y groups found:}] \leavevmode
This tells you approximately how many groups will be available in ownCloud.
The number updates automatically after any change.

\end{description}


\subsection{Advanced Settings}
\label{configuration_user/user_auth_ldap:advanced-settings}
The LDAP Advanced Setting section contains options that are not needed for a
working connection. This provides controls to disable the current
configuration,
configure replica hosts, and various performance-enhancing options.

The Advanced Settings are structured into three parts:
\begin{itemize}
\item {} 
Connection Settings

\item {} 
Directory Settings

\item {} 
Special Attributes

\end{itemize}


\subsubsection{Connection Settings}
\label{configuration_user/user_auth_ldap:connection-settings}\begin{figure}[htbp]
\centering

\includegraphics{ldap-advanced-1-connection.png}
\end{figure}
\begin{description}
\item[{Configuration Active:}] \leavevmode
Enables or Disables the current configuration. By default, it is turned off.
When ownCloud makes a successful test connection it is automatically turned
on.

\item[{Backup (Replica) Host:}] \leavevmode
If you have a backup LDAP server, enter the connection settings here.
ownCloud will then automatically connect to the backup when the main server
cannot be reached. The backup server must be a replica of the main server so
that the object UUIDs match.

Example:
\begin{itemize}
\item {} 
\emph{directory2.my-company.com}

\end{itemize}

\item[{Backup (Replica) Port:}] \leavevmode
The connection port of the backup LDAP server. If no port is given,
but only a host, then the main port (as specified above) will be used.

Example:
\begin{itemize}
\item {} 
\emph{389}

\end{itemize}

\item[{Disable Main Server:}] \leavevmode
You can manually override the main server and make ownCloud only connect to
the backup server. This is useful for planned downtimes.

\item[{Turn off SSL certificate validation:}] \leavevmode
Turns off SSL certificate checking. Use it for testing only!

\item[{Cache Time-To-Live:}] \leavevmode
A cache is introduced to avoid unnecessary LDAP traffic, for example caching
usernames so they don't have to be looked up for every page, and speeding up
loading of the Users page. Saving the configuration empties the cache. The
time is given in seconds.

Note that almost every PHP request requires a new connection to the LDAP
server. If you require fresh PHP requests we recommend defining a minimum
lifetime of 15s or so, rather than completely eliminating the cache.

Examples:
\begin{itemize}
\item {} 
ten minutes: \emph{600}

\item {} 
one hour: \emph{3600}

\end{itemize}

\end{description}

See the Caching section below for detailed information on how the cache
operates.


\subsubsection{Directory Settings}
\label{configuration_user/user_auth_ldap:ldap-directory-settings}\label{configuration_user/user_auth_ldap:directory-settings}\begin{figure}[htbp]
\centering

\includegraphics{ldap-advanced-2-directory.png}
\end{figure}
\begin{description}
\item[{User Display Name Field:}] \leavevmode
The attribute that should be used as display name in ownCloud.
\begin{itemize}
\item {} 
Example: \emph{displayName}

\end{itemize}

\item[{2nd User Display Name Field:}] \leavevmode
An optional second attribute displayed in brackets after the display name,
for example using the \code{mail} attribute displays as \code{Molly Foo
(molly@example.com)}.

\item[{Base User Tree:}] \leavevmode
The base DN of LDAP, from where all users can be reached. This must be a
complete DN, regardless of what you have entered for your Base DN in the
Basic setting. You can specify multiple base trees, one on each line.
\begin{itemize}
\item {} 
Example:

\begin{DUlineblock}{0em}
\item[] \emph{cn=programmers,dc=my-company,dc=com}
\item[] \emph{cn=designers,dc=my-company,dc=com}
\end{DUlineblock}

\end{itemize}

\item[{User Search Attributes:}] \leavevmode
These attributes are used when searches for users are performed, for example
in the share dialogue. The user display name attribute is the
default. You may list multiple attributes, one per line.

If an attribute is not available on a user object, the user will not be
listed, and will be unable to login. This also affects the display name
attribute. If you override the default you must specify the display name
attribute here.
\begin{itemize}
\item {} 
Example:

\begin{DUlineblock}{0em}
\item[] \emph{displayName}
\item[] \emph{mail}
\end{DUlineblock}

\end{itemize}

\item[{Group Display Name Field:}] \leavevmode
The attribute that should be used as ownCloud group name. ownCloud allows a
limited set of characters (a-zA-Z0-9.-\_@). Once a group name is assigned it
cannot be changed.
\begin{itemize}
\item {} 
Example: \emph{cn}

\end{itemize}

\item[{Base Group Tree:}] \leavevmode
The base DN of LDAP, from where all groups can be reached. This must be a
complete DN, regardless of what you have entered for your Base DN in the
Basic setting. You can specify multiple base trees, one in each line.
\begin{itemize}
\item {} 
Example:

\begin{DUlineblock}{0em}
\item[] \emph{cn=barcelona,dc=my-company,dc=com}
\item[] \emph{cn=madrid,dc=my-company,dc=com}
\end{DUlineblock}

\end{itemize}

\item[{Group Search Attributes:}] \leavevmode
These attributes are used when a search for groups is done, for example in
the share dialogue. By default the group display name attribute as specified
above is used. Multiple attributes can be given, one in each line.

If you override the default, the group display name attribute will not be
taken into account, unless you specify it as well.
\begin{itemize}
\item {} 
Example:

\begin{DUlineblock}{0em}
\item[] \emph{cn}
\item[] \emph{description}
\end{DUlineblock}

\end{itemize}

\item[{Group Member association:}] \leavevmode
The attribute that is used to indicate group memberships, i.e. the attribute
used by LDAP groups to refer to their users.

ownCloud detects the value automatically. You should only change it if you
have a very valid reason and know what you are doing.
\begin{itemize}
\item {} 
Example: \emph{uniquemember}

\end{itemize}

\end{description}


\subsubsection{Special Attributes}
\label{configuration_user/user_auth_ldap:special-attributes}\begin{figure}[htbp]
\centering

\includegraphics{ldap-advanced-3-attributes.png}
\end{figure}
\begin{description}
\item[{Quota Field:}] \leavevmode
ownCloud can read an LDAP attribute and set the user quota according to its
value. Specify the attribute here, and it will return human-readable values,
e.g. ``2 GB''. Any quota set in LDAP overrides quotas set on the ownCloud user
management page.
\begin{itemize}
\item {} 
Example: \emph{ownCloudQuota}

\end{itemize}

\item[{Quota Default:}] \leavevmode
Override ownCloud default quota for LDAP users who do not have a quota set in
the Quota Field.
\begin{itemize}
\item {} 
Example: \emph{15 GB}

\end{itemize}

\item[{Email Field:}] \leavevmode
Set the user's email from their LDAP attribute. Leave it empty for default
behavior.
\begin{itemize}
\item {} 
Example: \emph{mail}

\end{itemize}

\item[{User Home Folder Naming Rule:}] \leavevmode
By default, the ownCloud server creates the user directory in your ownCloud
data directory and gives it the ownCloud username, .e.g \code{/var/www/owncloud/data/alice}. You may want to override this setting and name it after an LDAP
attribute value. The attribute can also return an absolute path, e.g.
\code{/mnt/storage43/alice}. Leave it empty for default behavior.
\begin{itemize}
\item {} 
Example: \emph{cn}

\end{itemize}

\end{description}

In new ownCloud installations (8.0.10, 8.1.5, 8.2.0 and up) the home folder rule is enforced. This means that once you set a home folder naming rule (get a home folder from an LDAP attribute), it must be available for all users. If it isn't available for a user, then that user will not be able to login. Also, the filesystem will not be set up for that user, so their file shares will not be available to other users.

In existing ownCloud installations the old behavior still applies, which is using the ownCloud username as the home folder when an LDAP attribute is not set. You may change this to enforcing the home folder rule with the \code{occ} command in ownCloud 8.2, like this example on Ubuntu:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ config:app:set user\PYGZus{}ldap enforce\PYGZus{}home\PYGZus{}folder\PYGZus{}naming\PYGZus{}rule \PYGZhy{}\PYGZhy{}value=1
\end{Verbatim}


\subsection{Expert Settings}
\label{configuration_user/user_auth_ldap:expert-settings}\begin{figure}[htbp]
\centering

\includegraphics{ldap-expert.png}
\end{figure}

\begin{notice}{warning}{Warning:}
In the Expert Settings fundamental behavior can be adjusted to your needs. The
configuration should be well-tested before starting production use.
\end{notice}
\begin{description}
\item[{Internal Username:}] \leavevmode
The internal username is the identifier in ownCloud for LDAP users. By default
it will be created from the UUID attribute. The UUID attribute ensures that
the username is unique, and that characters do not need to be converted. Only
these characters are allowed: {[}a-zA-Z0-9\_.@-{]}. Other characters are
replaced with their ASCII equivalents, or are simply omitted.

The LDAP backend ensures that there are no duplicate internal usernames in
ownCloud, i.e. that it is checking all other activated user backends
(including local ownCloud users). On collisions a random number (between 1000
and 9999) will be attached to the retrieved value. For example, if ``alice''
exists, the next username may be ``alice\_1337''.

The internal username is the default name for the user home folder in
ownCloud. It is also a part of remote URLs, for instance for all *DAV
services.

You can override all of this with the Internal Username setting. Leave it
empty for default behaviour. Changes will affect only newly mapped LDAP users.
\begin{itemize}
\item {} 
Example: \emph{uid}

\end{itemize}

\item[{Override UUID detection}] \leavevmode
By default, ownCloud auto-detects the UUID attribute. The UUID attribute is
used to uniquely identify LDAP users and groups. The internal username will
be created based on the UUID, if not specified otherwise.

You can override the setting and pass an attribute of your choice. You must
make sure that the attribute of your choice can be fetched for both users and
groups and it is unique. Leave it empty for default behaviour. Changes will
have effect only on newly mapped LDAP users and groups. It also will
have effect when a user's or group's DN changes and an old UUID was cached,
which will result in a new user. Because of this, the setting should be
applied before putting ownCloud in production use and clearing the bindings
(see the \code{User and Group Mapping} section below).
\begin{itemize}
\item {} 
Example: \emph{cn}

\end{itemize}

\item[{Username-LDAP User Mapping}] \leavevmode
ownCloud uses usernames as keys to store and assign data. In order to
precisely identify and recognize users, each LDAP user will have a internal
username in ownCloud. This requires a mapping from ownCloud username to LDAP
user. The created username is mapped to the UUID of the LDAP user.
Additionally the DN is cached as well to reduce LDAP interaction, but it is
not used for identification. If the DN changes, the change will be detected by
ownCloud by checking the UUID value.

The same is valid for groups.

The internal ownCloud name is used all over in ownCloud. Clearing the Mappings
will have leftovers everywhere. Never clear the mappings in a production
environment, but only in a testing or experimental server.

\textbf{Clearing the Mappings is not configuration sensitive, it affects all LDAP
configurations!}

\end{description}


\subsection{Testing the configuration}
\label{configuration_user/user_auth_ldap:testing-the-configuration}
The \textbf{Test Configuration} button checks the values as currently given in the
input fields. You do not need to save before testing. By clicking on the
button, ownCloud will try to bind to the ownCloud server using the
settings currently given in the input fields. If the binding fails you'll see a
yellow banner with the error message ``The configuration is invalid. Please have
a look at the logs for further details.''

When the configuration test reports success, save your settings and check if the
users and groups are fetched correctly on the Users page.


\subsection{ownCloud Avatar integration}
\label{configuration_user/user_auth_ldap:owncloud-avatar-integration}
ownCloud supports user profile pictures, which are also called avatars. If a user
has a photo stored in the \emph{jpegPhoto} or \emph{thumbnailPhoto} attribute on your LDAP
server, it will be used as their avatar. In this case the user cannot alter their
avatar (on their Personal page) as it must be changed in LDAP. \emph{jpegPhoto} is
preferred over \emph{thumbnailPhoto}.
\begin{figure}[htbp]
\centering

\includegraphics{ldap-fetched-avatar.png}
\end{figure}

If the \emph{jpegPhoto} or \emph{thumbnailPhoto} attribute is not set or empty, then
users can upload and manage their avatars on their ownCloud Personal pages.
Avatars managed in ownCloud are not stored in LDAP.

The \emph{jpegPhoto} or \emph{thumbnailPhoto} attribute is fetched once a day to make
sure the current photo from LDAP is used in ownCloud. LDAP avatars override
ownCloud avatars, and when an LDAP avatar is deleted then the most recent
ownCloud avatar replaces it.

Photos served from LDAP are automatically cropped and resized in ownCloud. This
affects only the presentation, and the original image is not changed.


\subsection{Troubleshooting, Tips and Tricks}
\label{configuration_user/user_auth_ldap:troubleshooting-tips-and-tricks}

\subsubsection{SSL Certificate Verification (LDAPS, TLS)}
\label{configuration_user/user_auth_ldap:ssl-certificate-verification-ldaps-tls}
A common mistake with SSL certificates is that they may not be known to PHP.
If you have trouble with certificate validation make sure that
\begin{itemize}
\item {} 
You have the certificate of the server installed on the ownCloud server

\item {} 
The certificate is announced in the system's LDAP configuration file (usually
\emph{/etc/ldap/ldap.conf}

\end{itemize}
\begin{itemize}
\item {} 
Using LDAPS, also make sure that the port is correctly configured (by default
636)

\end{itemize}


\subsubsection{Microsoft Active Directory}
\label{configuration_user/user_auth_ldap:microsoft-active-directory}
Compared to earlier ownCloud versions, no further tweaks need to be done to
make ownCloud work with Active Directory. ownCloud will automatically find the
correct configuration in the set-up process.


\subsubsection{memberOf / Read MemberOf permissions}
\label{configuration_user/user_auth_ldap:memberof-read-memberof-permissions}
If you want to use \code{memberOf} within your filter you might need to give your
querying user the permissions to use it. For Microsoft Active Directory this
is described \href{https://serverfault.com/questions/167371/what-permissions-are-required-for-enumerating-users-groups-in-active-directory/167401\#167401}{here}.


\subsubsection{Duplicating Server Configurations}
\label{configuration_user/user_auth_ldap:duplicating-server-configurations}
In case you have a working configuration and want to create a similar one or
``snapshot'' configurations before modifying them you can do the following:
\begin{enumerate}
\item {} 
Go to the \textbf{Server} tab

\item {} 
On \textbf{Server Configuration} choose \emph{Add Server Configuration}

\item {} 
Answer the question \emph{Take over settings from recent server configuration?}
with \emph{yes}.

\item {} 
(optional) Switch to \textbf{Advanced} tab and uncheck \textbf{Configuration Active}
in the \emph{Connection Settings}, so the new configuration is not used on Save

\item {} 
Click on \textbf{Save}

\end{enumerate}

Now you can modify and enable the configuration.


\subsection{Performance tips}
\label{configuration_user/user_auth_ldap:performance-tips}
See the documentation wiki for \href{https://github.com/owncloud/documentation/wiki/LDAP-Tips-for-Active-Directory-and-openLDAP}{additional LDAP tips and tricks}. The following performance tips are standard for inmproving LDAP performance.


\subsubsection{Caching}
\label{configuration_user/user_auth_ldap:caching}
Using caching to speed up lookups. See {\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}}). The ownCloud cache is populated on demand, and remains populated until the \textbf{Cache Time-To-Live} for each unique request expires. User logins are not cached, so if you need to improve login times set up a slave LDAP server to share the load.

You can adjust the \textbf{Cache Time-To-Live} value to balance performance and
freshness of LDAP data. All LDAP requests will be cached for 10 minutes by
default, and you can alter this with the \textbf{Cache Time-To-Live} setting. The
cache answers each request that is identical to a previous request, within the
time-to-live of the original request, rather than hitting the LDAP server.

The \textbf{Cache Time-To-Live} is related to each single request. After a cache
entry expires there is no automatic trigger for re-populating the information,
as the cache is populated only by new requests, for example by opening the
User administration page, or searching in a sharing dialog.

There is one trigger which is automatically triggered by a certain background
job which keeps the \code{user-group-mappings} up-to-date, and always in cache.

Under normal circumstances, all users are never loaded at the same time.
Typically the loading of users happens while page results are generated, in
steps of 30 until the limit is reached or no results are left. For this to
work on an oC-Server and LDAP-Server, \textbf{Paged Results} must be supported,
which presumes PHP \textgreater{}= 5.6.

ownCloud remembers which user belongs to which LDAP-configuration. That means
each request will always be directed to the right server unless a user is
defunct, for example due to a server migration or unreachable server. In this
case the other servers will also receive the request.


\subsubsection{LDAP indexing}
\label{configuration_user/user_auth_ldap:ldap-indexing}
Turn on indexing. Deciding which attributes to index depends on your configuration, and which LDAP server you are using. See \href{http://www.openldap.org/doc/admin24/tuning.html\#Indexes}{openLDAP Indexes} for openLDAP, and \href{https://technet.microsoft.com/en-us/library/aa995762(v=exchg.65).aspx}{How to Index an Attribute in Active Directory} for Active Directory. The openLDAP howto is especially useful for figuring out which attributes to index.


\subsubsection{Use precise base DNs}
\label{configuration_user/user_auth_ldap:use-precise-base-dns}
The more precise your base DN, the faster LDAP can search because it has fewer branches to search.


\subsubsection{Use precise filters}
\label{configuration_user/user_auth_ldap:use-precise-filters}
Use good filters to further define the scope of LDAP searches, and to intelligently direct your server where to search, rather than forcing it to perform needlessly-general searches.


\subsection{ownCloud LDAP Internals}
\label{configuration_user/user_auth_ldap:owncloud-ldap-internals}
Some parts of how the LDAP backend works are described here.


\subsubsection{User and Group Mapping}
\label{configuration_user/user_auth_ldap:user-and-group-mapping}
In ownCloud the user or group name is used to have all relevant information in
the database assigned. To work reliably a permanent internal user name and
group name is created and mapped to the LDAP DN and UUID. If the DN changes in
LDAP it will be detected, and there will be no conflicts.

Those mappings are done in the database table \code{ldap\_user\_mapping} and
\code{ldap\_group\_mapping}. The user name is also used for the user's folder (except
if something else is specified in \emph{User Home Folder Naming Rule}), which
contains files and meta data.

As of ownCloud 5 the internal user name and a visible display name are separated.
This is not the case for group names, yet, i.e. a group name cannot be altered.

That means that your LDAP configuration should be good and ready before putting
it into production. The mapping tables are filled early, but as long as you are
testing, you can empty the tables any time. Do not do this in production.


\subsubsection{Handling with Backup Server}
\label{configuration_user/user_auth_ldap:handling-with-backup-server}
When ownCloud is not able to contact the main LDAP server, ownCloud assumes it
is offline and will not try to connect again for the time specified in \textbf{Cache
Time-To-Live}. If you have a backup server configured ownCloud will connect to
it instead. When you have scheduled downtime, check \textbf{Disable Main Server}  to
avoid unnecessary connection attempts.


\section{LDAP User Cleanup}
\label{configuration_user/user_auth_ldap_cleanup:ldap-user-cleanup}\label{configuration_user/user_auth_ldap_cleanup::doc}
LDAP User Cleanup is a new feature in the \code{LDAP user and group backend}
application. LDAP User Cleanup is a background process that automatically
searches the ownCloud LDAP mappings table, and verifies if the LDAP users are
still available. Any users that are not available are marked as \code{deleted} in
the \code{oc\_preferences} database table. Then you can run a command to display
this table, displaying only the users marked as \code{deleted}, and then you have
the option of removing their data from your ownCloud data directory.

These items are removed upon cleanup:
\begin{itemize}
\item {} 
Local ownCloud group assignments

\item {} 
User preferences (DB table \code{oc\_preferences})

\item {} 
User's ownCloud home folder

\item {} 
User's corresponding entry in \code{oc\_storages}

\end{itemize}

There are two prerequisites for LDAP User Cleanup to operate:
\begin{enumerate}
\item {} 
Set \code{ldapUserCleanupInterval} in \code{config.php} to your desired check
interval in minutes. The default is 51 minutes.

\item {} 
All configured LDAP connections are enabled and operating correctly. As users
can exist on multiple LDAP servers, you want to be sure that all of your
LDAP servers are available so that a user on a temporarily disconnected LDAP
server is not marked as \code{deleted}.

\end{enumerate}

The background process examines 50 users at a time, and runs at the interval you
configured with \code{ldapUserCleanupInterval}. For example, if you have 200 LDAP
users and your \code{ldapUserCleanupInterval} is 20 minutes, the process will
examine the first 50 users, then 20 minutes later the next 50 users, and 20
minutes later the next 50, and so on.

There are two \code{occ} commands to use for examining a table of users marked as
deleted, and then manually deleting them.  The \code{occ} command is in your
ownCloud directory, for example \code{/var/www/owncloud/occ}, and it must be run as
your HTTP user. To learn more about \code{occ}, see
{\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}}.

These examples are for Ubuntu Linux:
\begin{enumerate}
\item {} 
\code{sudo -u www-data php occ ldap:show-remnants} displays a table with all
users that have been marked as deleted, and their LDAP data.

\item {} 
\code{sudo -u www-data php occ user:delete {[}user{]}} removes the user's data from the
ownCloud data directory.

\end{enumerate}

This example shows what the table of users marked as \code{deleted} looks like:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ ldap:show\PYGZhy{}remnants
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} ownCloud name   \textbar{} Display Name    \textbar{} LDAP UID         \textbar{} LDAP DN                              \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} aaliyah\PYGZus{}brown   \textbar{} aaliyah brown   \textbar{} aaliyah\PYGZus{}brown    \textbar{} uid=aaliyah\PYGZus{}brown,ou=people,dc=com   \textbar{}
\textbar{} aaliyah\PYGZus{}hammes  \textbar{} aaliyah hammes  \textbar{} aaliyah\PYGZus{}hammes   \textbar{} uid=aaliyah\PYGZus{}hammes,ou=people,dc=com  \textbar{}
\textbar{} aaliyah\PYGZus{}johnston\textbar{} aaliyah johnston\textbar{} aaliyah\PYGZus{}johnston \textbar{} uid=aaliyah\PYGZus{}johnston,ou=people,dc=com\textbar{}
\textbar{} aaliyah\PYGZus{}kunze   \textbar{} aaliyah kunze   \textbar{} aaliyah\PYGZus{}kunze    \textbar{} uid=aaliyah\PYGZus{}kunze,ou=people,dc=com   \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\end{Verbatim}

Then you can run \code{sudo -u www-data php occ user:delete aaliyah\_brown} to delete
user aaliyah\_brown. You must use the user's ownCloud name.


\subsection{Deleting Local ownCloud Users}
\label{configuration_user/user_auth_ldap_cleanup:deleting-local-owncloud-users}
You may also use \code{occ user:delete {[}user{]}} to remove a local ownCloud user;
this removes their user account and their data.


\section{User Provisioning API}
\label{configuration_user/user_provisioning_api::doc}\label{configuration_user/user_provisioning_api:user-provisioning-api}
The Provisioning API application enables a set of APIs that external systems can use to create,
edit, delete and query user attributes, query, set and remove groups, set quota
and query total storage used in ownCloud. Group admin users can also query
ownCloud and perform the same functions as an admin for groups they manage. The
API also enables an admin to query for active ownCloud applications, application
info, and to enable or disable an app remotely. HTTP
requests can be used via a Basic Auth header to perform any of the functions
listed above. The Provisioning API app is enabled by default.

The base URL for all calls to the share API is \textbf{owncloud\_base\_url/ocs/v1.php/cloud}.


\subsection{Instruction Set For Users}
\label{configuration_user/user_provisioning_api:instruction-set-for-users}

\subsubsection{\textbf{users / adduser}}
\label{configuration_user/user_provisioning_api:users-adduser}
Create a new user on the ownCloud server. Authentication is done by sending a
basic HTTP authentication header.

\textbf{Syntax: ocs/v1.php/cloud/users}
\begin{itemize}
\item {} 
HTTP method: POST

\item {} 
POST argument: userid - string, the required username for the new user

\item {} 
POST argument: password - string, the required password for the new user

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - invalid input data

\item {} 
102 - username already exists

\item {} 
103 - unknown error occurred whilst adding the user

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:example}\begin{itemize}
\item {} 
POST \code{http://admin:secret@example.com/ocs/v1.php/cloud/users -d
userid="Frank" -d password="frankspassword"}

\item {} 
Creates the user \code{Frank} with password \code{frankspassword}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:xml-output}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
 \PYGZlt{}meta\PYGZgt{}
  \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
  \PYGZlt{}message/\PYGZgt{}
 \PYGZlt{}/meta\PYGZgt{}
 \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / getusers}}
\label{configuration_user/user_provisioning_api:users-getusers}
Retrieves a list of users from the ownCloud server. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users}
\begin{itemize}
\item {} 
HTTP method: GET

\item {} 
url arguments: search - string, optional search string

\item {} 
url arguments: limit - int, optional limit value

\item {} 
url arguments: offset - int, optional offset value

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id1}\begin{itemize}
\item {} 
GET \code{http://admin:secret@example.com/ocs/v1.php/cloud/users?search=Frank}

\item {} 
Returns list of users matching the search string.

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id2}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}users\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}Frank\PYGZlt{}/element\PYGZgt{}
     \PYGZlt{}/users\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / getuser}}
\label{configuration_user/user_provisioning_api:users-getuser}
Retrieves information about a single user. Authentication is done by sending a
Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id3}\begin{itemize}
\item {} 
GET \code{http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank}

\item {} 
Returns information on the user \code{Frank}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id4}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}email\PYGZgt{}frank@example.org\PYGZlt{}/email\PYGZgt{}
    \PYGZlt{}quota\PYGZgt{}0\PYGZlt{}/quota\PYGZgt{}
    \PYGZlt{}enabled\PYGZgt{}true\PYGZlt{}/enabled\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / edituser}}
\label{configuration_user/user_provisioning_api:users-edituser}
Edits attributes related to a user. Users are able to edit email, displayname
and password; admins can also edit the quota value. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}}
\begin{itemize}
\item {} 
HTTP method: PUT

\item {} 
PUT argument: key, the field to edit (email, quota, display, password)

\item {} 
PUT argument: value, the new value for the field

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - user not found

\item {} 
102 - invalid input data

\end{itemize}


\paragraph{Examples}
\label{configuration_user/user_provisioning_api:examples}\begin{itemize}
\item {} 
PUT \code{PUT http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank -d
key="email" -d value="franksnewemail@example.org"}

\item {} 
Updates the email address for the user \code{Frank}

\item {} 
PUT \code{PUT http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank -d
key="quota" -d value="100MB"}

\item {} 
Updates the quota for the user \code{Frank}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id5}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / deleteuser}}
\label{configuration_user/user_provisioning_api:users-deleteuser}
Deletes a user from the ownCloud server. Authentication is done by sending a
Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}}
\begin{itemize}
\item {} 
HTTP method: DELETE

\end{itemize}

Statuscodes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - failure

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id6}\begin{itemize}
\item {} 
DELETE \code{http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank}

\item {} 
Deletes the user \code{Frank}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id7}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / getgroups}}
\label{configuration_user/user_provisioning_api:users-getgroups}
Retrieves a list of groups the specified user is a member of. Authentication is
done by sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/groups}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id8}\begin{itemize}
\item {} 
GET  \code{http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/groups}

\item {} 
Retrieves a list of groups of which \code{Frank} is a member

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id9}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}groups\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}admin\PYGZlt{}/element\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}group1\PYGZlt{}/element\PYGZgt{}
    \PYGZlt{}/groups\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / addtogroup}}
\label{configuration_user/user_provisioning_api:users-addtogroup}
Adds the specified user to the specified group. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/groups}
\begin{itemize}
\item {} 
HTTP method: POST

\item {} 
POST argument: groupid, string - the group to add the user to

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - no group specified

\item {} 
102 - group does not exist

\item {} 
103 - user does not exist

\item {} 
104 - insufficient privileges

\item {} 
105 - failed to add user to group

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id10}\begin{itemize}
\item {} 
POST \code{http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/groups
-d groupid="newgroup"}

\item {} 
Adds the user \code{Frank} to the group \code{newgroup}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id11}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / removefromgroup}}
\label{configuration_user/user_provisioning_api:users-removefromgroup}
Removes the specified user from the specified group. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/groups}
\begin{itemize}
\item {} 
HTTP method: DELETE

\item {} 
POST argument: groupid, string - the group to remove the user from

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - no group specified

\item {} 
102 - group does not exist

\item {} 
103 - user does not exist

\item {} 
104 - insufficient privileges

\item {} 
105 - failed to remove user from group

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id12}\begin{itemize}
\item {} 
DELETE
\code{http://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/groups -d
groupid="newgroup"}

\item {} 
Removes the user \code{Frank} from the group \code{newgroup}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id13}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / createsubadmin}}
\label{configuration_user/user_provisioning_api:users-createsubadmin}
Makes a user the subadmin of a group. Authentication is done by sending a Basic
HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/subadmins}
\begin{itemize}
\item {} 
HTTP method: POST

\item {} 
POST argument: groupid, string - the group of which to make the user a
subadmin

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - user does not exist

\item {} 
102 - group does not exist

\item {} 
103 - unknown failure

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id14}\begin{itemize}
\item {} 
POST
\code{https://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/subadmins
-d groupid="group"}

\item {} 
Makes the user \code{Frank} a subadmin of the \code{group} group

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id15}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / removesubadmin}}
\label{configuration_user/user_provisioning_api:users-removesubadmin}
Removes the subadmin rights for the user specified from the group specified.
Authentication is done by sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/subadmins}
\begin{itemize}
\item {} 
HTTP method: DELETE

\item {} 
DELETE argument: groupid, string - the group from which to remove the user's
subadmin rights

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - user does not exist

\item {} 
102 - user is not a subadmin of the group / group does not exist

\item {} 
103 - unknown failure

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id16}\begin{itemize}
\item {} 
DELETE
\code{https://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/subadmins
-d groupid="oldgroup"}

\item {} 
Removes \code{Frank's} subadmin rights from the \code{oldgroup} group

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id17}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{users / getsubadmingroups}}
\label{configuration_user/user_provisioning_api:users-getsubadmingroups}
Returns the groups in which the user is a subadmin. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/users/\{userid\}/subadmins}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - user does not exist

\item {} 
102 - unknown failure

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id18}\begin{itemize}
\item {} 
GET
\code{https://admin:secret@example.com/ocs/v1.php/cloud/users/Frank/subadmins}

\item {} 
Returns the groups of which \code{Frank} is a subadmin

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id19}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
      \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
      \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}message/\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}element\PYGZgt{}testgroup\PYGZlt{}/element\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsection{Instruction Set For Groups}
\label{configuration_user/user_provisioning_api:instruction-set-for-groups}

\subsubsection{\textbf{groups / getgroups}}
\label{configuration_user/user_provisioning_api:groups-getgroups}
Retrieves a list of groups from the ownCloud server. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/groups}
\begin{itemize}
\item {} 
HTTP method: GET

\item {} 
url arguments: search - string, optional search string

\item {} 
url arguments: limit - int, optional limit value

\item {} 
url arguments: offset - int, optional offset value

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id20}\begin{itemize}
\item {} 
GET \code{http://admin:secret@example.com/ocs/v1.php/cloud/groups?search=adm}

\item {} 
Returns list of groups matching the search string.

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id21}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}groups\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}admin\PYGZlt{}/element\PYGZgt{}
    \PYGZlt{}/groups\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{groups / addgroup}}
\label{configuration_user/user_provisioning_api:groups-addgroup}
Adds a new group. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/groups}
\begin{itemize}
\item {} 
HTTP method: POST

\item {} 
POST argument: groupid, string - the new groups name

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - invalid input data

\item {} 
102 - group already exists

\item {} 
103 - failed to add the group

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id22}\begin{itemize}
\item {} 
POST \code{http://admin:secret@example.com/ocs/v1.php/cloud/groups -d
groupid="newgroup"}

\item {} 
Adds a new group called \code{newgroup}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id23}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{groups / getgroup}}
\label{configuration_user/user_provisioning_api:groups-getgroup}
Retrieves a list of group members. Authentication is done by sending a Basic
HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/groups/\{groupid\}}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id24}\begin{itemize}
\item {} 
POST \code{http://admin:secret@example.com/ocs/v1.php/cloud/groups/admin}

\item {} 
Returns a list of users in the \code{admin} group

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id25}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}users\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}Frank\PYGZlt{}/element\PYGZgt{}
    \PYGZlt{}/users\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{groups / getsubadmins}}
\label{configuration_user/user_provisioning_api:groups-getsubadmins}
Returns subadmins of the group. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/groups/\{groupid\}/subadmins}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - group does not exist

\item {} 
102 - unknown failure

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id26}\begin{itemize}
\item {} 
GET
\code{https://admin:secret@example.com/ocs/v1.php/cloud/groups/mygroup/subadmins}

\item {} 
Return the subadmins of the group: \code{mygroup}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id27}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}message/\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}element\PYGZgt{}Tom\PYGZlt{}/element\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{groups / deletegroup}}
\label{configuration_user/user_provisioning_api:groups-deletegroup}
Removes a group. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/groups/\{groupid\}}
\begin{itemize}
\item {} 
HTTP method: DELETE

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - group does not exist

\item {} 
102 - failed to delete group

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id28}\begin{itemize}
\item {} 
DELETE \code{http://admin:secret@example.com/ocs/v1.php/cloud/groups/mygroup}

\item {} 
Delete the group \code{mygroup}

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id29}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsection{Instruction Set For Apps}
\label{configuration_user/user_provisioning_api:instruction-set-for-apps}

\subsubsection{\textbf{apps / getapps}}
\label{configuration_user/user_provisioning_api:apps-getapps}
Returns a list of apps installed on the ownCloud server. Authentication is done
by sending a Basic HTTP Authorization
header.

\textbf{Syntax: ocs/v1.php/cloud/apps/}
\begin{itemize}
\item {} 
HTTP method: GET

\item {} 
url argument: filter, string - optional (\code{enabled} or \code{disabled})

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
101 - invalid input data

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id30}\begin{itemize}
\item {} 
GET \code{http://admin:secret@example.com/ocs/v1.php/cloud/apps?filter=enabled}

\item {} 
Gets enabled apps

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id31}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}apps\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}files\PYGZlt{}/element\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}provisioning\PYGZus{}api\PYGZlt{}/element\PYGZgt{}
    \PYGZlt{}/apps\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{apps / getappinfo}}
\label{configuration_user/user_provisioning_api:apps-getappinfo}
Provides information on a specific application. Authentication is done by
sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/apps/\{appid\}}
\begin{itemize}
\item {} 
HTTP method: GET

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id32}\begin{itemize}
\item {} 
GET \code{http://admin:secret@example.com/ocs/v1.php/cloud/apps/files}

\item {} 
Get app info for the \code{files} app

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id33}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
  \PYGZlt{}data\PYGZgt{}
    \PYGZlt{}info/\PYGZgt{}
    \PYGZlt{}remote\PYGZgt{}
      \PYGZlt{}files\PYGZgt{}appinfo/remote.php\PYGZlt{}/files\PYGZgt{}
      \PYGZlt{}webdav\PYGZgt{}appinfo/remote.php\PYGZlt{}/webdav\PYGZgt{}
      \PYGZlt{}filesync\PYGZgt{}appinfo/filesync.php\PYGZlt{}/filesync\PYGZgt{}
    \PYGZlt{}/remote\PYGZgt{}
    \PYGZlt{}public/\PYGZgt{}
    \PYGZlt{}id\PYGZgt{}files\PYGZlt{}/id\PYGZgt{}
    \PYGZlt{}name\PYGZgt{}Files\PYGZlt{}/name\PYGZgt{}
    \PYGZlt{}description\PYGZgt{}File Management\PYGZlt{}/description\PYGZgt{}
    \PYGZlt{}licence\PYGZgt{}AGPL\PYGZlt{}/licence\PYGZgt{}
    \PYGZlt{}author\PYGZgt{}Robin Appelman\PYGZlt{}/author\PYGZgt{}
    \PYGZlt{}require\PYGZgt{}4.9\PYGZlt{}/require\PYGZgt{}
    \PYGZlt{}shipped\PYGZgt{}true\PYGZlt{}/shipped\PYGZgt{}
    \PYGZlt{}standalone\PYGZgt{}\PYGZlt{}/standalone\PYGZgt{}
    \PYGZlt{}default\PYGZus{}enable\PYGZgt{}\PYGZlt{}/default\PYGZus{}enable\PYGZgt{}
    \PYGZlt{}types\PYGZgt{}
      \PYGZlt{}element\PYGZgt{}filesystem\PYGZlt{}/element\PYGZgt{}
    \PYGZlt{}/types\PYGZgt{}
  \PYGZlt{}/data\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{apps / enable}}
\label{configuration_user/user_provisioning_api:apps-enable}
Enable an app.  Authentication is done by sending a Basic HTTP Authorization
header.

\textbf{Syntax: ocs/v1.php/cloud/apps/\{appid\}}
\begin{itemize}
\item {} 
HTTP method: POST

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id34}\begin{itemize}
\item {} 
POST \code{http://admin:secret@example.com/ocs/v1.php/cloud/apps/files\_texteditor}

\item {} 
Enable the \code{files\_texteditor} app

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id35}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{\textbf{apps / disable}}
\label{configuration_user/user_provisioning_api:apps-disable}
Disables the specified app. Authentication is
done by sending a Basic HTTP Authorization header.

\textbf{Syntax: ocs/v1.php/cloud/apps/\{appid\}}
\begin{itemize}
\item {} 
HTTP method: DELETE

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\end{itemize}


\paragraph{Example}
\label{configuration_user/user_provisioning_api:id36}\begin{itemize}
\item {} 
DELETE \code{http://admin:secret@example.com/ocs/v1.php/cloud/apps/files\_texteditor}

\item {} 
Disable the \code{files\_texteditor} app

\end{itemize}


\paragraph{XML Output}
\label{configuration_user/user_provisioning_api:id37}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
  \PYGZlt{}meta\PYGZgt{}
    \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
    \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}/meta\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\chapter{File Sharing and Management}
\label{configuration_files/index:file-sharing-and-management}\label{configuration_files/index::doc}

\section{File Sharing}
\label{configuration_files/file_sharing_configuration:file-sharing}\label{configuration_files/file_sharing_configuration::doc}
ownCloud users can share files with their ownCloud groups and other users on
the same ownCloud server, with ownCloud users on {\hyperref[configuration_files/federated_cloud_sharing_configuration::doc]{\emph{other ownCloud servers}}}, and create public shares for people who are not
ownCloud users. You have control of a number of user permissions on file shares:
\begin{itemize}
\item {} 
Allow users to share files

\item {} 
Allow users to create public shares

\item {} 
Require a password on public shares

\item {} 
Allow public uploads to public shares

\item {} 
Require an expiration date on public share links

\item {} 
Allow resharing

\item {} 
Restrict sharing to group members only

\item {} 
Allow email notifications of new public shares

\item {} 
Exclude groups from creating shares

\end{itemize}

\begin{notice}{note}{Note:}
ownCloud Enterprise includes a Share Link Password Policy app; see
{\hyperref[configuration_files/file_sharing_configuration:password-policy-label]{\emph{Share Link Password Policy}}}.
\end{notice}

Configure your sharing policy on your Admin page in the Sharing section.
\begin{figure}[htbp]
\centering

\includegraphics{sharing-files-1.png}
\end{figure}
\begin{itemize}
\item {} 
Check \code{Allow apps to use the Share API} to enable users to share files. If
this is not checked, no users can create file shares.

\item {} 
Check \code{Allow users to share via link} to enable creating public shares for
people who are not ownCloud users via hyperlink.

\item {} 
Check \code{Enforce password protection} to force users to set a password on all
public share links. This does not apply to local user and group shares.

\item {} 
Check \code{Allow public uploads} to allow anyone to upload files to
public shares.

\item {} 
Check \code{Allow users to send mail notification for shared files} to enable
sending notifications from ownCloud. (Your ownCloud server must be configured
to send mail)

\item {} 
Check \code{Set default expiration date} to set a default expiration date on
public shares.

\item {} 
Check \code{Allow resharing} to enable users to re-share files shared with them.

\item {} 
Check \code{Restrict users to only share with users in their groups} to confine
sharing within group memberships.
\begin{quote}

\begin{notice}{note}{Note:}
This setting does not apply to the Federated Cloud sharing
feature. If {\hyperref[configuration_files/federated_cloud_sharing_configuration::doc]{\emph{Federated Cloud Sharing}}} is
enabled, users can still share items with any users on any instances
(including the one they are on) via a remote share.
\end{notice}
\end{quote}

\item {} 
Check \code{Allow users to send mail notification for shared files} enables
users to send an email notification to every ownCloud user that the file is
shared with.

\item {} 
Check \code{Exclude groups from sharing} to prevent members of specific groups
from creating any file shares in those groups. When you check this, you'll
get a dropdown list of all your groups to choose from. Members of excluded
groups can still receive shares, but not create any

\item {} 
Check \code{Allow username autocompletion in share dialog} to enable
auto-completion of ownCloud usernames.

\end{itemize}

\begin{notice}{note}{Note:}
ownCloud does not preserve the mtime (modification time) of
directories, though it does update the mtimes on files. See
\href{https://github.com/owncloud/core/issues/7009}{Wrong folder date when syncing} for discussion of this.
\end{notice}


\subsection{Transferring Files to Another User}
\label{configuration_files/file_sharing_configuration:transferring-files-to-another-user}\label{configuration_files/file_sharing_configuration:transfer-userfiles-label}
You may transfer files from one user to another with \code{occ}. This is useful
when you have to remove a user. Be sure to transfer the files before you delete
the user!  This transfers all files from user1 to user2, and the shares and
metadata info associated with those files (shares, tags, comments, etc).
Trashbin contents are not transferred:

\begin{Verbatim}[commandchars=\\\{\}]
occ files:transfer\PYGZhy{}ownership user1 user2
\end{Verbatim}

(See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} for a complete \code{occ}
reference.)


\subsection{Creating Persistent File Shares}
\label{configuration_files/file_sharing_configuration:creating-persistent-file-shares}
When a user is deleted, their files are also deleted. As you can imagine, this
is a problem if they created file shares that need to be preserved, because
these disappear as well. In ownCloud files are tied to their owners, so
whatever happens to the file owner also happens to the files.

One solution is to create persistent shares for your users. You can retain
ownership of them, or you could create a special user for the purpose of
establishing permanent file shares. Simply create a shared folder in the usual
way, and share it with the users or groups who need to use it. Set the
appropriate permissions on it, and then no matter which users come and go, the
file shares will remain. Because all files added to the share, or edited in it,
automatically become owned by the owner of the share regardless of who adds or
edits them.


\subsection{Share Link Password Policy}
\label{configuration_files/file_sharing_configuration:share-link-password-policy}\label{configuration_files/file_sharing_configuration:password-policy-label}
ownCloud Enterprise users have the option of enabling the Share Link Password
Policy app. This allows you to enforce password length, required characters,
define special characters, and expiration dates on share links.
\begin{figure}[htbp]
\centering

\includegraphics{sharing-files-2.png}
\end{figure}

Note that you cannot use Emojis as special characters with MySQL, as it
supports UTF8 characters only of 1-3 bytes, and emojis require 4 bytes.


\section{Configuring Federation Sharing}
\label{configuration_files/federated_cloud_sharing_configuration:configuring-federation-sharing}\label{configuration_files/federated_cloud_sharing_configuration::doc}
Federated Cloud Sharing is now managed by the Federation app (9.0+), and is
now called Federation sharing. When you enable the Federation app you can
easily and securely link file shares between ownCloud servers, in effect
creating a cloud of ownClouds.


\subsection{Sharing With ownCloud 8 and Older}
\label{configuration_files/federated_cloud_sharing_configuration:sharing-with-owncloud-8-and-older}
Direct Federation shares ({\hyperref[configuration_files/federated_cloud_sharing_configuration:label-direct-share-link]{\emph{Creating a new Federation Share (9.0+ only)}}}) are not supported in
ownCloud 8 and older, so you must create Federation shares with public links
({\hyperref[configuration_files/federated_cloud_sharing_configuration:label-public-link-share]{\emph{Creating Federation Shares via Public Link Share}}}).


\subsection{Creating a new Federation Share (9.0+ only)}
\label{configuration_files/federated_cloud_sharing_configuration:label-direct-share-link}\label{configuration_files/federated_cloud_sharing_configuration:creating-a-new-federation-share-9-0-only}
Follow these steps to create a new Federation share between two ownCloud 9.0+
servers. This requires no action by the user on the remote server; all it takes
is a few steps on the originating server.
\begin{enumerate}
\item {} 
Enable the Federation app.

\item {} 
Go to your ownCloud Admin page and scroll to the Sharing
section. Verify that \textbf{Allow users on this server to send shares to other
servers} and \textbf{Allow users on this server to receive shares from other
servers} are enabled.

\item {} 
Now go to the Federation
section. By default, \textbf{Add server automatically once a federated share was
created successfully} is checked. The Federation app supports creating a
list of trusted ownCloud servers, which allows the trusted servers to
exchange user directories and auto-complete the names of external users when
you create shares. If you do not want this enabled, then un-check it.

\end{enumerate}
\begin{figure}[htbp]
\centering

\includegraphics{federation-0.png}
\end{figure}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
Now go to your Files page and select a folder to share. Click the share
icon, and then enter the username and URL of the user on the remote ownCloud
server. In this example, that is \code{freda@https://example.com/owncloud}.
When ownCloud verifies the link, it displays it with the \textbf{(remote)} label.
Click on this label to establish the link.

\end{enumerate}
\begin{figure}[htbp]
\centering

\includegraphics{federation-2.png}
\end{figure}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
When the link is successfully completed, you have a single share option,
and that is \textbf{can edit}.

\end{enumerate}
\begin{figure}[htbp]
\centering

\includegraphics{federation-3.png}
\end{figure}

You may disconnect the share at any time by clicking the trash can icon.


\subsection{Configuring Trusted ownCloud Servers}
\label{configuration_files/federated_cloud_sharing_configuration:configuring-trusted-owncloud-servers}
You may create a list of trusted ownCloud servers for Federation sharing. This
allows your linked ownCloud servers to share user directories, and to auto-fill
user names in share dialogs. If \textbf{Add server automatically once a federated
share was created successfully} is enabled on your Admin page, servers will be
automatically added to your trusted list when you create new Federation shares.

You may also enter ownCloud server URLs in the \textbf{Add ownCloud Server} field.
The yellow light indicates a successful connection, with no user names
exchanged. The green light indicates a successful connection with user names
exchanged. A red light means the connection failed.
\begin{figure}[htbp]
\centering

\includegraphics{federation-1.png}
\end{figure}


\subsection{Creating Federation Shares via Public Link Share}
\label{configuration_files/federated_cloud_sharing_configuration:label-public-link-share}\label{configuration_files/federated_cloud_sharing_configuration:creating-federation-shares-via-public-link-share}
You'll need to use a Public Link Share to create Federation shares with
ownCloud 8.x and older.

Check the \code{Share Link} checkbox to expose more sharing options (which are
described more fully in {\hyperref[configuration_files/file_sharing_configuration::doc]{\emph{File Sharing}}}). You may create a
Federation share by allowing ownCloud to create a public link for you, and then
email it to the person you want to create the share with.
\begin{figure}[htbp]
\centering

\includegraphics{create_public_share-6.png}
\end{figure}

You may optionally set a password and expiration date on it. When your recipient
receives your email they must click the link, or copy it to a Web
browser. They will see a page displaying a thumbnail of the file, with a button
to \textbf{Add to your ownCloud}.
\begin{figure}[htbp]
\centering

\includegraphics{create_public_share-8.png}
\end{figure}

Your recipient should click the \textbf{Add to your ownCloud} button. On the next
screen your recipient needs to enter the URL to their ownCloud
server, and then press the return key.
\begin{figure}[htbp]
\centering

\includegraphics{create_public_share-9.png}
\end{figure}

Your recipient has to take one more step, and that is to confirm creating the
federated cloud share link by clicking the \textbf{Add remote share} button.
\begin{figure}[htbp]
\centering

\includegraphics{create_public_share-10.png}
\end{figure}

Un-check the \code{Share Link} checkbox to disable any federated cloud share
created this way.


\subsection{Configuration Tips}
\label{configuration_files/federated_cloud_sharing_configuration:configuration-tips}
The Sharing section on your Admin page allows you to control how your users
manage federated cloud shares:
\begin{itemize}
\item {} 
Check \code{Enforce password protection} to require passwords on link shares.

\item {} 
Check \code{Set default expiration date} to require an expiration date on link
shares.

\item {} 
Check \code{Allow public uploads} to allow two-way file sharing.

\end{itemize}

Your Apache Web server must have \code{mod\_rewrite} enabled, and you must have
\code{trusted\_domains} correctly configured in \code{config.php} to allow external
connections (see {\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}}). Consider also
enabling SSL to encrypt all traffic between your servers .

Your ownCloud server creates the share link from the URL that you used to log
into the server, so make sure that you log into your server using a URL that is
accessible to your users. For example, if you log in via its LAN IP address,
such as \code{http://192.168.10.50}, then your share URL will be something like
\code{http://192.168.10.50/owncloud/index.php/s/jWfCfTVztGlWTJe}, which is not
accessible outside of your LAN. This also applies to using the server name; for
access outside of your LAN you need to use a fully-qualified domain name such as
\code{http://myserver.example.com}, rather than \code{http://myserver}.


\section{Uploading big files \textgreater{} 512MB}
\label{configuration_files/big_file_upload_configuration::doc}\label{configuration_files/big_file_upload_configuration:uploading-big-files-512mb}
The default maximum file size for uploads is 512MB. You can increase this
limit up to what your filesystem and operating system allows. There are certain
hard limits that cannot be exceeded:
\begin{itemize}
\item {} 
\textless{} 2GB on 32Bit OS-architecture

\item {} 
\textless{} 2GB on Windows (32Bit and 64Bit)

\item {} 
\textless{} 2GB with Server Version 4.5 or older

\item {} 
\textless{} 2GB with IE6 - IE8

\item {} 
\textless{} 4GB with IE9 - IE11

\end{itemize}

64-bit filesystems have much higher limits; consult the documentation for your
filesystem.

\begin{notice}{note}{Note:}
The ownCloud sync client is not affected by these upload limits
as it is uploading files in smaller chunks.
\end{notice}


\subsection{System Configuration}
\label{configuration_files/big_file_upload_configuration:system-configuration}\begin{itemize}
\item {} 
Make sure that the latest version of PHP (at least 5.6) is installed

\item {} 
Disable user quotas, which makes them unlimited

\item {} 
Your temp file or partition has to be big enough to hold multiple
parallel uploads from multiple users; e.g. if the max upload size is 10GB and
the average number of users uploading at the same time is 100: temp space has
to hold at least 10x100 GB

\end{itemize}


\subsection{Configuring Your Web server}
\label{configuration_files/big_file_upload_configuration:configuring-your-web-server}
\begin{notice}{note}{Note:}
ownCloud comes with its own \code{owncloud/.htaccess} file. Because \code{php-fpm}
can't read PHP settings in \code{.htaccess} these settings must be set in the
\code{owncloud/.user.ini} file.
\end{notice}

Set the following two parameters inside the corresponding php.ini file (see the
\textbf{Loaded Configuration File} section of {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}} to find your
relevant php.ini files)

\begin{Verbatim}[commandchars=\\\{\}]
php\PYGZus{}value upload\PYGZus{}max\PYGZus{}filesize = 16G
php\PYGZus{}value post\PYGZus{}max\PYGZus{}size = 16G
\end{Verbatim}

Adjust these values for your needs. If you see PHP timeouts in your logfiles,
increase the timeout values, which are in seconds:

\begin{Verbatim}[commandchars=\\\{\}]
php\PYGZus{}value max\PYGZus{}input\PYGZus{}time 3600
php\PYGZus{}value max\PYGZus{}execution\PYGZus{}time 3600
\end{Verbatim}

The \href{https://httpd.apache.org/docs/current/mod/mod\_reqtimeout.html}{mod\_reqtimeout}
Apache module could also stop large uploads from completing. If you're using this
module and getting failed uploads of large files either disable it in your Apache
config or raise the configured \code{RequestReadTimeout} timeouts.

There are also several other configuration options in your Web server config which
could prevent the upload of larger files. Please see the manual of your Web server
for how to configure those values correctly:


\subsubsection{Apache}
\label{configuration_files/big_file_upload_configuration:apache}\begin{itemize}
\item {} 
\href{https://httpd.apache.org/docs/current/en/mod/core.html\#limitrequestbody}{LimitRequestBody}

\item {} 
\href{https://httpd.apache.org/docs/current/mod/mod\_ssl.html\#sslrenegbuffersize}{SSLRenegBufferSize}

\end{itemize}


\subsubsection{Apache with mod\_fcgid}
\label{configuration_files/big_file_upload_configuration:apache-with-mod-fcgid}\begin{itemize}
\item {} 
\href{https://httpd.apache.org/mod\_fcgid/mod/mod\_fcgid.html\#fcgidmaxrequestinmem}{FcgidMaxRequestInMem}

\item {} 
\href{https://httpd.apache.org/mod\_fcgid/mod/mod\_fcgid.html\#fcgidmaxrequestlen}{FcgidMaxRequestLen}

\end{itemize}

\begin{notice}{note}{Note:}
If you are using Apache/2.4 with mod\_fcgid, as of February/March 2016,
\code{FcgidMaxRequestInMem} still needs to be significantly increased from its default value
to avoid the occurence of segmentation faults when uploading big files. This is not a regular
setting but serves as a workaround for \href{https://bz.apache.org/bugzilla/show\_bug.cgi?id=51747}{Apache with mod\_fcgid bug \#51747}.

Setting \code{FcgidMaxRequestInMem} significantly higher than normal may no longer be
necessary, once bug \#51747 is fixed.
\end{notice}


\subsubsection{NGINX}
\label{configuration_files/big_file_upload_configuration:nginx}\begin{itemize}
\item {} 
\href{http://nginx.org/en/docs/http/ngx\_http\_core\_module.html\#client\_max\_body\_size}{client\_max\_body\_size}

\item {} 
\href{http://nginx.org/en/docs/http/ngx\_http\_fastcgi\_module.html\#fastcgi\_read\_timeout}{fastcgi\_read\_timeout}

\item {} 
\href{http://nginx.org/en/docs/http/ngx\_http\_core\_module.html\#client\_body\_temp\_path}{client\_body\_temp\_path}

\end{itemize}

For more info how to configure nginx to raise the upload limits see also \href{https://github.com/owncloud/documentation/wiki/Uploading-files-up-to-16GB\#configuring-nginx}{this}
wiki entry.

\begin{notice}{note}{Note:}
Make sure that \code{client\_body\_temp\_path} points to a partition with
adequate space for your upload file size, and on the same partition as
the \code{upload\_tmp\_dir} or \code{tempdirectory} (see below). For optimal
performance, place these on a separate hard drive that is dedicated to
swap and temp storage.
\end{notice}

If your site is behind a Nginx frontend (for example a loadbalancer):

By default, downloads will be limited to 1GB due to \code{proxy\_buffering} and \code{proxy\_max\_temp\_file\_size} on the frontend.
\begin{itemize}
\item {} 
If you can access the frontend's configuration, disable \href{http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html\#proxy\_buffering}{proxy\_buffering} or increase \href{http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html\#proxy\_max\_temp\_file\_size}{proxy\_max\_temp\_file\_size} from the default 1GB.

\item {} 
If you do not have access to the frontend, set the \href{http://nginx.org/en/docs/http/ngx\_http\_proxy\_module.html\#proxy\_buffering}{X-Accel-Buffering} header to \code{add\_header X-Accel-Buffering no;} on your backend server.

\end{itemize}


\subsection{Configuring PHP}
\label{configuration_files/big_file_upload_configuration:configuring-php}
If you don't want to use the ownCloud \code{.htaccess} or \code{.user.ini} file, you may
configure PHP instead. Make sure to comment out any lines \code{.htaccess}
pertaining to upload size, if you entered any.

If you are running ownCloud on a 32-bit system, any \code{open\_basedir} directive
in your \code{php.ini} file needs to be commented out.

Set the following two parameters inside \code{php.ini}, using your own desired
file size values:

\begin{Verbatim}[commandchars=\\\{\}]
upload\PYGZus{}max\PYGZus{}filesize = 16G
post\PYGZus{}max\PYGZus{}size = 16G
\end{Verbatim}

Tell PHP which temp file you want it to use:

\begin{Verbatim}[commandchars=\\\{\}]
upload\PYGZus{}tmp\PYGZus{}dir = /var/big\PYGZus{}temp\PYGZus{}file/
\end{Verbatim}

\textbf{Output Buffering} must be turned off in \code{.htaccess} or \code{.user.ini} or \code{php.ini}, or PHP
will return memory-related errors:
\begin{itemize}
\item {} 
\code{output\_buffering = 0}

\end{itemize}


\subsection{Configuring ownCloud}
\label{configuration_files/big_file_upload_configuration:configuring-owncloud}
As an alternative to the \code{upload\_tmp\_dir} of PHP (e.g. if you don't have access to your
\code{php.ini}) you can also configure a temporary location for uploaded files by using the
\code{tempdirectory} setting in your \code{config.php} (See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}).

If you have configured the \code{session\_lifetime} setting in your \code{config.php}
(See {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}) file then
make sure it is not too
low. This setting needs to be configured to at least the time (in seconds) that
the longest upload will take. If unsure remove this completely from your
configuration to reset it to the default shown in the \code{config.sample.php}.


\subsubsection{Configuring upload limits within the GUI}
\label{configuration_files/big_file_upload_configuration:configuring-upload-limits-within-the-gui}
If all prerequisites described in this documentation are in place an admin can change the
upload limits on demand by using the \code{File handling} input box within the administrative
backend of ownCloud.
\begin{figure}[htbp]
\centering

\includegraphics{admin_filehandling-1.png}
\end{figure}

Depending on your environment you might get an insufficient permissions message shown for
this input box.
\begin{figure}[htbp]
\centering

\includegraphics{admin_filehandling-2.png}
\end{figure}

To be able to use this input box you need to make sure that:
\begin{itemize}
\item {} 
your Web server is be able to use the \code{.htaccess} file shipped by ownCloud (Apache only)

\item {} 
the user your Web server is running as has write permissions to the files \code{.htaccess} and \code{.user.ini}

\end{itemize}

{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}} might prevent write access to these files. As an admin you need
to decide between the ability to use the input box and a more secure ownCloud installation
where you need to manually modify the upload limits in the \code{.htaccess} and \code{.user.ini}
files described above.


\subsection{General upload issues}
\label{configuration_files/big_file_upload_configuration:general-upload-issues}
Various environmental factors could cause a restriction of the upload size. Examples are:
\begin{itemize}
\item {} 
the \code{LVE Manager} of \code{CloudLinux} which sets a \code{I/O limit}

\item {} 
some services like \code{Cloudflare} are also known to cause uploading issues

\item {} 
upload limits enforced by proxies used by your clients

\item {} 
other webserver modules like described in {\hyperref[issues/general_troubleshooting::doc]{\emph{General Troubleshooting}}}

\end{itemize}


\section{Configuring the Collaborative Documents App}
\label{configuration_files/collaborative_documents_configuration::doc}\label{configuration_files/collaborative_documents_configuration:configuring-the-collaborative-documents-app}
The Documents application supports editing documents within ownCloud, without the
need to launch an external application. The Documents app supports these
features:
\begin{itemize}
\item {} 
Cooperative edit, with multiple users editing files simultaneously.

\item {} 
Document creation within ownCloud.

\item {} 
Document upload.

\item {} 
Share and edit files in the browser, and then share them inside ownCloud or
through a public link.

\end{itemize}

Supported file formats are \emph{.odt}, \emph{.doc}, and \emph{.docx}. \emph{.odt} is supported
natively in ownCloud, and you must have LibreOffice or OpenOffice installed on
the ownCloud server to convert \emph{.doc}, and \emph{.docx} documents.


\subsection{Enabling the Documents App}
\label{configuration_files/collaborative_documents_configuration:enabling-the-documents-app}
Go to your Apps page and click the \code{Enable} button. You also have the option
to grant access to the Documents apps to selected user groups. By default it is
available to all groups.

\includegraphics{documents_app_enable.png}

See ``Collaborative Document Editing'' in the User manual to learn how to create
and share documents in the Documents application.


\subsection{Enabling and testing MS Word support}
\label{configuration_files/collaborative_documents_configuration:enabling-and-testing-ms-word-support}
Go to your admin settings menu. After choosing \code{Local} or \code{External} click
on the \code{Apply and test} button. If you have a working LibreOffice or OpenOffice
installation a green \code{Saved} icon should appear.

\includegraphics{documents_apply_test.png}


\subsubsection{Troubleshooting}
\label{configuration_files/collaborative_documents_configuration:troubleshooting}
If the mentioned test fails please make sure that:
\begin{itemize}
\item {} 
the PHP functions \code{escapeshellarg} and \code{shell\_exec} are not disabled in your
PHP configuration

\item {} 
the libreoffice/openoffice binary is within your PATH and is executeable for the
HTTP user

\item {} 
your SELinux configuration is not blocking the execution of the binary

\item {} 
the PHP \code{open\_basedir} is correctly configured to allow the access to the binary

\end{itemize}

More hints why the test is failing can be found in your \code{data/owncloud.log}.


\section{Providing Default Files}
\label{configuration_files/default_files_configuration::doc}\label{configuration_files/default_files_configuration:providing-default-files}
You may distribute a set of default files and folders to all users by placing
them in the \code{owncloud/core/skeleton} directory on your ownCloud server.
These files appear only to new users after their initial login, and existing
users will not see files that are added to this directory after their first
login. The files in the \code{skeleton} directory are copied into the users'
data directories, so they may change and delete the files without affecting the
originals.

This screenshot shows a set of photos in the \code{skeleton} directory.

\includegraphics{skeleton-files.png}

They appear on the user's ownCloud Files page just like any other files.

\includegraphics{skeleton-files1.png}


\subsection{Additional Configuration}
\label{configuration_files/default_files_configuration:additional-configuration}
The configuration option \code{skeletondirectory} available in your
\code{config.php} (See
{\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}) allows
you to configure the directory where the skeleton files are located.
These files will be copied to the data directory of new users. Leave
empty to not copy any skeleton files.


\section{Configuring External Storage (GUI)}
\label{configuration_files/external_storage_configuration_gui::doc}\label{configuration_files/external_storage_configuration_gui:configuring-external-storage-gui}
The External Storage Support application enables you to mount external storage
services and devices as secondary ownCloud storage devices. You may also allow
users to mount their own external storage services.

ownCloud 9.0 introduces a new set of {\hyperref[configuration_server/occ_command:files-external-label]{\emph{occ commands for managing external storage}}}.

Also new in 9.0 is an option for the ownCloud admin to enable or disable sharing
on individual external mountpoints (see
{\hyperref[configuration_files/external_storage_configuration_gui:external-storage-mount-options-label]{\emph{Mount Options}}}). Sharing on such mountpoints is
disabled by default.


\subsection{Enabling External Storage Support}
\label{configuration_files/external_storage_configuration_gui:enabling-external-storage-support}
\begin{notice}{warning}{Warning:}
Enabling this app will disable the \textbf{Stay logged in} checkbox on the login page.
\end{notice}

The External storage support application is enabled on your Apps page.
\begin{figure}[htbp]
\centering

\includegraphics{enable-app.png}
\end{figure}


\subsection{Storage Configuration}
\label{configuration_files/external_storage_configuration_gui:storage-configuration}
To create a new external storage mount, select an available backend from the
dropdown \textbf{Add storage}. Each backend has different required options, which
are configured in the configuration fields.
\begin{figure}[htbp]
\centering

\includegraphics{add_storage.png}
\end{figure}

Each backend may also accept multiple authentication methods. These are selected
with the dropdown under \textbf{Authentication}. Different backends support different
authentication mechanisms; some specific to the backend, others are more
generic. See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more detailed
information.

When you select an authentication mechanism, the configuration fields change as
appropriate for the mechanism. The SFTP backend, for one example, supports
\textbf{username and password}, \textbf{Log-in credentials, save in session}, and \textbf{RSA
public key}.
\begin{figure}[htbp]
\centering

\includegraphics{auth_mechanism.png}
\end{figure}

Required fields are marked with a red border. When all required fields are
filled, the storage is automatically saved. A green dot next to the storage row
indicates the storage is ready for use. A red or yellow icon indicates
that ownCloud could not connect to the external storage, so you need to
re-check your configuration and network availability.

If there is an error on the storage, it will be marked as unavailable for ten
minutes. To re-check it, click the colored icon or reload your Admin page.


\subsection{User and Group Permissions}
\label{configuration_files/external_storage_configuration_gui:user-and-group-permissions}
A storage configured in a user's Personal settings is available only to the user
that created it. A storage configured in the Admin settings is available to
all users by default, and it can be restricted to specific users and groups in
the \textbf{Available for} field.
\begin{figure}[htbp]
\centering

\includegraphics{applicable.png}
\end{figure}


\subsection{Mount Options}
\label{configuration_files/external_storage_configuration_gui:external-storage-mount-options-label}\label{configuration_files/external_storage_configuration_gui:mount-options}
Hover your cursor to the right of any storage configuration to expose
the settings button and trashcan. Click the trashcan to delete the
mountpoint. The settings button allows you to configure each storage mount
individually with the following options:
\begin{itemize}
\item {} 
Encryption

\item {} 
Previews

\item {} 
Enable Sharing

\item {} 
Filesystem check frequency (Never, Once per direct access)

\end{itemize}

The \textbf{Encryption} checkbox is visible only when the Encryption app is enabled.

\textbf{Enable Sharing} allows the ownCloud admin to enable or disable sharing on individual mountpoints.
When sharing is disabled the shares are retained internally, so that you can re-enable sharing
and the previous shares become available again. Sharing is disabled by default.
\begin{figure}[htbp]
\centering

\includegraphics{mount_options.png}
\end{figure}


\subsection{Using Self-Signed Certificates}
\label{configuration_files/external_storage_configuration_gui:using-self-signed-certificates}
When using self-signed certificates for external storage mounts the certificate
must be imported into ownCloud. Please refer to {\hyperref[configuration_server/import_ssl_cert::doc]{\emph{Importing System-wide and Personal SSL Certificates}}}
for more information.


\subsection{Available storage backends}
\label{configuration_files/external_storage_configuration_gui:available-storage-backends}
The following backends are provided by the external storages app. Other apps
may provide their own backends, which are not listed here.


\subsubsection{Amazon S3}
\label{configuration_files/external_storage/amazons3:amazon-s3}\label{configuration_files/external_storage/amazons3::doc}
To connect your Amazon S3 buckets to ownCloud, you will need:
\begin{itemize}
\item {} 
S3 access key

\item {} 
S3 secret key

\item {} 
Bucket name

\end{itemize}

In the \textbf{Folder name} field enter a local folder name for your S3 mountpoint.
If this does not exist it will be created.

In the \textbf{Available for} field enter the users or groups who have permission to
access your S3 mount.

The \code{Enable SSL} checkbox enables HTTPS connections; using HTTPS is always
highly-recommended.
\begin{figure}[htbp]
\centering

\includegraphics{amazons3.png}
\end{figure}

Optionally, you can override the hostname, port and region of your S3 server,
which is required for non-Amazon servers such as Ceph Object Gateway.

\textbf{Enable path style} is usually not required (and is, in fact, incompatible
with newer Amazon datacenters), but can be used with non-Amazon servers where
the DNS infrastructure cannot be controlled. Ordinarily, requests will be
made with \code{http://bucket.hostname.domain/}, but with path style enabled,
requests are made with \code{http://hostname.domain/bucket} instead.

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{Dropbox}
\label{configuration_files/external_storage/dropbox:dropbox}\label{configuration_files/external_storage/dropbox::doc}
While Dropbox supports the newer OAuth 2.0, ownCloud uses OAuth 1.0, so you can
safely ignore any references to OAuth 2.0 in the Dropbox configuration.

Connecting Dropbox is a little more work because you have to create a Dropbox
app. Log into the \href{http://www.dropbox.com/developers}{Dropbox Developers page}
and click \textbf{Create Your App}:
\begin{figure}[htbp]
\centering

\includegraphics{dropbox.png}
\end{figure}

Next, for \textbf{Choose an API} check \textbf{Dropbox API}.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-1.png}
\end{figure}

The next option is choosing which folders to share, or to share everything in
your Dropbox.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-2.png}
\end{figure}

Then enter your app name. This is anything you want it to be.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-3.png}
\end{figure}

Then click the \textbf{Create App} button.

Now you are on your app page, which displays its settings and more options. Do
not click \textbf{Development (Apply for production)} because that is for apps
that you want to release publicly.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-4.png}
\end{figure}

Click \textbf{Enable additional users} to allow multiple ownCloud users to access
your new Dropbox share.

Now go to your ownCloud Admin page. Your ownCloud configuration requires only
the local mount name, the \textbf{App Key} and the \textbf{App Secret}, and which users
or groups have access to the share. Remember the little gear icon at the
far right for additional options.

After entering your local mount name, \textbf{App Key} and \textbf{App Secret}, click
\textbf{Grant access}.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-6.png}
\end{figure}

If you are not already logged into Dropbox, you will be prompted to login
and authorize access. This happens only once, when you are first creating
the new share. Click \textbf{Allow}, and you're done.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-5.png}
\end{figure}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{FTP/FTPS}
\label{configuration_files/external_storage/ftp:ftp-ftps}\label{configuration_files/external_storage/ftp::doc}
To connect to an FTP server, you will need:
\begin{itemize}
\item {} 
A folder name for your local mountpoint; the folder will be created if it
does not exist

\item {} 
The URL of the FTP server

\item {} 
Port number (default: 21)

\item {} 
FTP server username and password

\item {} 
Remote Subfolder, the FTP directory to mount in ownCloud. ownCloud defaults
to the root directory. If you specify a subfolder you must leave
off the leading slash. For example, \code{public\_html/images}

\end{itemize}

Your new mountpoint is available to all users by default, and you may restrict
access by entering specific users or groups in the \textbf{Available for} field.

Optionally, ownCloud can use FTPS (FTP over SSL) by checking \textbf{Secure ftps://}.
This requires additional configuration with your root certificate if the FTP
server uses a self-signed certificate (See {\hyperref[configuration_server/import_ssl_cert::doc]{\emph{Importing System-wide and Personal SSL Certificates}}}).
\begin{figure}[htbp]
\centering

\includegraphics{ftp.png}
\end{figure}

\begin{notice}{note}{Note:}
The external storage \code{FTP/FTPS} needs the \code{allow\_url\_fopen} PHP
setting to be set to \code{1}. When having connection problems make sure that it
is not set to \code{0} in your \code{php.ini}. See {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}} to learn
how to find the right \code{php.ini} file to edit.
\end{notice}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

FTP uses the password authentication scheme; see {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for
more information on authentication schemes.


\subsubsection{Google Drive}
\label{configuration_files/external_storage/google:google-drive}\label{configuration_files/external_storage/google::doc}
ownCloud uses OAuth 2.0 to connect to Google Drive. This requires configuration
through Google to get an app ID and app secret, as ownCloud registers itself
as an app.

All applications that access a Google API must be registered through the
\href{https://console.developers.google.com/}{Google Cloud Console}. Follow along carefully
because the Google interface is a bit of a maze and it's easy to get lost.

If you already have a Google account, such as Groups, Drive, or Mail, you can
use your existing login to log into the Google Cloud Console. After logging in
click  the \textbf{Create Project} button.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive.png}
\end{figure}

Give your project a name, and either accept the default \textbf{Project ID} or
create
your own, then click the \textbf{Create} button.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive1.png}
\end{figure}

You'll be returned to your dashboard.
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{google-drive2.png}}
\end{figure}

Google helpfully highlights your next step in blue, the \textbf{Use Google APIs}
box. Make sure that your new project is selected, click on \textbf{Use Google APIs} ,
and it takes you to Google's APIs screen. There are many Google APIs; look for
the \textbf{Google Apps APIs} and click \textbf{Drive API.}
\begin{figure}[htbp]
\centering

\includegraphics{google-drive3.png}
\end{figure}

\textbf{Drive API} takes you to the API Manager overview. Click the blue \textbf{Enable
API} button.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive4.png}
\end{figure}

Now you must create your credentials, so click on \textbf{Go to credentials}.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive5.png}
\end{figure}

For some reason Google warns us again that we need to create credentials. We
will use 0Auth 2.0.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive6.png}
\end{figure}

Now we have to create a consent screen. This is the information in the screen
Google shows you when you connect your new Google app to ownCloud the first
time. Click \textbf{Configure consent screen}. Then fill in the required form fields.
Your logo must be hosted, as you cannot upload it, so enter its URL. When
you're finished click \textbf{Save}.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive8.png}
\end{figure}

The next screen that opens is \textbf{Create Client ID}. Check \textbf{Web Application},
then enter your app name. \textbf{Authorized JavaScript Origins} is your root domain,
for example \code{https://example.com}, without a trailing slash. You need two
\textbf{Authorized Redirect URIs}, and they must be in this form:

\begin{Verbatim}[commandchars=\\\{\}]
https://example.com/owncloud/index.php/settings/personal
https://example.com/owncloud/index.php/settings/admin
\end{Verbatim}

Replace \code{https://example.com/owncloud/} with your own ownCloud server URL,
then click \textbf{Create}.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive9.png}
\end{figure}

Now Google reveals to you your \textbf{Client ID} and \textbf{Client Secret}. Click
\textbf{OK}.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive10.png}
\end{figure}

You can see these anytime in your Google console; just click on your app name
to see complete information.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive11.png}
\end{figure}

Now you have everything you need to mount your Google Drive in ownCloud.

Go to the External Storage section of your Admin page, create your new folder
name, enter the Client ID and Client Secret, and click \textbf{Grant Access}. Your
consent page appears when ownCloud makes a successful connection. Click
\textbf{Allow}.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive12.png}
\end{figure}

When you see the green light confirming a successful connection
you're finished.
\begin{figure}[htbp]
\centering

\includegraphics{google-drive13.png}
\end{figure}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.
603026686136-qnv9ooocacrkrh1vs0cht83eprgm2sbb.apps.googleusercontent.com


\subsubsection{Local}
\label{configuration_files/external_storage/local:local}\label{configuration_files/external_storage/local::doc}
Local storages provide access to any directory on the ownCloud server. Since
this is a significant security risk, Local storage can only be configured in
the ownCloud admin settings. Non-admin users cannot create Local storage
mounts.

Use this to mount any directory on your ownCloud server that is outside
of your ownCloud \code{data/} directory. This directory must be readable and
writable by your HTTP server user. These ownership and permission examples
are on Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data chown \PYGZhy{}R www\PYGZhy{}data:www\PYGZhy{}data /localdir
sudo \PYGZhy{}u www\PYGZhy{}data chmod \PYGZhy{}R 0750 /localdir
\end{Verbatim}

See {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}} for information on correct file permissions, and
find your HTTP user {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}}.

In the \textbf{Folder name} field enter the folder name that you want to appear on
your ownCloud Files page.

In the \textbf{Configuration} field enter the full filepath of the directory you
want to mount.

In the \textbf{Available for} field enter the users or groups who have permission to
access the mount. By default all users have access.
\begin{figure}[htbp]
\centering

\includegraphics{local.png}
\end{figure}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{OpenStack Object Storage}
\label{configuration_files/external_storage/openstack:openstack-object-storage}\label{configuration_files/external_storage/openstack::doc}
OpenStack Object Storage is used to connect to an OpenStack Swift server, or to
Rackspace. Two authentication mechanisms are available: one is the generic
OpenStack mechanism, and the other is used exclusively for Rackspace, a provider
of object storage that uses the OpenStack Swift protocol.

The OpenStack authentication mechanism uses the OpenStack Keystone v2
protocol. Your ownCloud configuration needs:
\begin{itemize}
\item {} 
\textbf{Bucket}. This is user-defined; think of it as a subdirectory of your total
storage. The bucket will be created if it does not exist.

\item {} 
\textbf{Username} of your account.

\item {} 
\textbf{Password} of your account.

\item {} 
\textbf{Tenant name} of your account. (A tenant is similar to a user group.)

\item {} 
\textbf{Identity Endpoint URL}, the URL to log in to your OpenStack account.

\end{itemize}
\begin{figure}[htbp]
\centering

\includegraphics{openstack.png}
\end{figure}

The Rackspace authentication mechanism requires:
\begin{itemize}
\item {} 
\textbf{Bucket}

\item {} 
\textbf{Username}

\item {} 
\textbf{API key}.

\end{itemize}

You must also enter the term \textbf{cloudFiles} in the \textbf{Service name} field.
\begin{figure}[htbp]
\centering

\includegraphics{rackspace.png}
\end{figure}

It may be necessary to specify a \textbf{Region}. Your region should be named in
your account information, and you can read about Rackspace regions at
\href{https://support.rackspace.com/how-to/about-regions/}{About Regions}.

The timeout of HTTP requests is set in the \textbf{Request timeout} field, in
seconds.

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{ownCloud}
\label{configuration_files/external_storage/owncloud:owncloud}\label{configuration_files/external_storage/owncloud::doc}
An ownCloud storage is a specialized {\hyperref[configuration_files/external_storage/webdav::doc]{\emph{WebDAV}}} storage, with optimizations
for ownCloud-ownCloud communication. See the {\hyperref[configuration_files/external_storage/webdav::doc]{\emph{WebDAV}}} documentation to
learn how to configure an ownCloud external storage.

When filling in the \textbf{URL} field, use the path to the root of the ownCloud
installation, rather than the path to the WebDAV endpoint. So, for a server at
\code{https://example.com/owncloud}, use \code{https://example.com/owncloud} and not
\code{https://example.com/owncloud/remote.php/dav}.

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{SFTP}
\label{configuration_files/external_storage/sftp::doc}\label{configuration_files/external_storage/sftp:sftp}
ownCloud's SFTP (FTP over an SSH tunne) backend supports both password and
public key authentication.

The \textbf{Host} field is required; a port can be specified as part of the \textbf{Host}
field in the following format: \code{hostname.domain:port}. The default port is 22
(SSH).

For public key authentication, you can generate a public/private key pair from
your \textbf{SFTP with secret key login} configuration.
\begin{figure}[htbp]
\centering

\includegraphics{auth_mechanism.png}
\end{figure}

After generating your keys, you need to copy your new public key to the
destination server to \code{.ssh/authorized\_keys}. ownCloud will then use its
private key to authenticate to the SFTP server.

The default \textbf{Remote Subfolder} is the root directory (\code{/}) of the remote
SFTP server, and you may enter any directory you wish.

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{SMB/CIFS}
\label{configuration_files/external_storage/smb::doc}\label{configuration_files/external_storage/smb:smb-cifs}
ownCloud can connect to Windows file servers or other SMB-compatible servers
with the SMB/CIFS backend.

\begin{notice}{note}{Note:}
The SMB/CIFS backend requires the PHP smbclient module, version 0.8.0+, to be installed on the ownCloud server. This should be included in any Linux distribution; on Debian, Ubuntu, CentOS, and Fedora it is \code{php-smbclient}. See \href{https://github.com/eduardok/libsmbclient-php}{eduardok/libsmbclient-php} if your distribution does not include it; this provides source archives and instructions how to install binary packages.
\end{notice}

You also need the Samba client installed on your Linux system. This is included in
all Linux distributions; on Debian, Ubuntu, and other Debian derivatives this
is \code{smbclient}. On SUSE, Red Hat, CentOS, and other Red Hat derivatives it is
\code{samba-client}. You also need \code{which} and \code{stdbuf}, which should be included in most Linux distributions.

You need the following information:
\begin{itemize}
\item {} 
Folder name for your local mountpoint.

\item {} 
Host: The URL of the Samba server.

\item {} 
Username: The username or domain/username used to login to the Samba
server.

\item {} 
Password: the password to login to the Samba server.

\item {} 
Share: The share on the Samba server to mount.

\item {} 
Remote Subfolder: The remote subfolder inside the Samba share to mount
(optional, defaults to /). To assign the ownCloud logon username
automatically to the subfolder, use \code{\$user} instead of a particular
subfolder name.

\item {} 
And finally, the ownCloud users and groups who get access to the share.

\end{itemize}

Optionally, you can specify a \code{Domain}. This is useful in
cases where the
SMB server requires a domain and a username, and an advanced authentication
mechanism like session credentials is used so that the username cannot be
modified. This is concatenated with the username, so the backend gets
\code{domain\textbackslash{}username}
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{smb.png}}
\end{figure}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.


\subsubsection{WebDAV}
\label{configuration_files/external_storage/webdav::doc}\label{configuration_files/external_storage/webdav:webdav}
Use this backend to mount a directory from any WebDAV server, or another
ownCloud server.

You need the following information:
\begin{itemize}
\item {} 
Folder name: The name of your local mountpoint.

\item {} 
The URL of the WebDAV or ownCloud server.

\item {} 
Username and password for the remote server

\item {} 
Secure \href{https://}{https://}: We always recommend \href{https://}{https://} for security, though you can
leave this unchecked for \href{http://}{http://}.

\end{itemize}

Optionally, a \code{Remote Subfolder} can be specified to change the destination
directory. The default is to use the whole root.
\begin{figure}[htbp]
\centering

\includegraphics{webdav.png}
\end{figure}

\begin{notice}{note}{Note:}
CPanel users should install \href{https://documentation.cpanel.net/display/ALD/Web+Disk}{Web Disk} to enable WebDAV
functionality.
\end{notice}

See {\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}} for additional mount
options and information.

See {\hyperref[configuration_files/external_storage/auth_mechanisms::doc]{\emph{External Storage Authentication mechanisms}}} for more information on authentication schemes.

\begin{notice}{note}{Note:}
A non-blocking or correctly configured SELinux setup is needed
for these backends to work. Please refer to the {\hyperref[installation/selinux_configuration:selinux-config-label]{\emph{SELinux Configuration}}}.
\end{notice}


\subsection{Allow Users to Mount External Storage}
\label{configuration_files/external_storage_configuration_gui:allow-users-to-mount-external-storage}
Check \textbf{Enable User External Storage} to allow your users to mount their own
external storage services, and check the backends you want to allow. Beware, as
this allows a user to make potentially arbitrary connections to other services
on your network!
\begin{figure}[htbp]
\centering

\includegraphics{user_mounts.png}
\end{figure}


\subsection{Detecting Files Added to External Storages}
\label{configuration_files/external_storage_configuration_gui:detecting-files-added-to-external-storages}
We recommend configuring the background job \textbf{Webcron} or
\textbf{Cron} (see {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}})
to enable ownCloud to automatically detect files added to your external
storages.

\begin{notice}{note}{Note:}
You cannot scan/detect changed files on external storage mounts when you select
the \textbf{Log-in credentials, save in session} authentication mechanism. However, there is
a workaround, and that is to use Ajax cron mode. See {\hyperref[configuration_files/external_storage/auth_mechanisms:password-auth-workaround-label]{\emph{Password-based Mechanisms}}}
for more information.
\end{notice}

ownCloud may not always be able to find out what has been
changed remotely (files changed without going through ownCloud), especially
when it's very deep in the folder hierarchy of the external storage.

You might need to setup a cron job that runs \code{sudo -u www-data php occ files:scan -{-}all}
(or replace ``--all'' with the user name, see also {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}})
to trigger a rescan of the user's files periodically (for example every 15 minutes), which includes
the mounted external storage.


\section{Configuring External Storage (Configuration File)}
\label{configuration_files/external_storage_configuration:configuring-external-storage-configuration-file}\label{configuration_files/external_storage_configuration::doc}
Starting with ownCloud 9.0, the \code{data/mount.json} file for configuring
external storages has been removed, and replaced with a set of
{\hyperref[configuration_server/occ_command:files-external-label]{\emph{occ commands}}}.


\section{External Storage Authentication mechanisms}
\label{configuration_files/external_storage/auth_mechanisms:external-storage-authentication-mechanisms}\label{configuration_files/external_storage/auth_mechanisms::doc}
ownCloud storage backends accept one or more authentication schemes such as
passwords, OAuth, or token-based, to name a few examples. Each authentication
scheme may be implemented by multiple authentication mechanisms. Different
mechanisms require different configuration parameters, depending on their
behaviour.


\subsection{Special Mechanisms}
\label{configuration_files/external_storage/auth_mechanisms:special-mechanisms}
The \textbf{None} authentication mechanism requires no configuration parameters, and
is used when a backend requires no authentication.

The \textbf{Built-in} authentication mechanism itself requires no configuration
parameters, but is used as a placeholder for legacy storages that have not been
migrated to the new system and do not take advantage of generic authentication
mechanisms. The authentication parameters are provided directly by the backend.


\subsection{Password-based Mechanisms}
\label{configuration_files/external_storage/auth_mechanisms:password-auth-workaround-label}\label{configuration_files/external_storage/auth_mechanisms:password-based-mechanisms}
The \textbf{Username and password} mechanism requires a manually-defined username and
password. These get passed directly to the backend.

The \textbf{Log-in credentials, save in session} mechanism uses the ownCloud login
credentials of the user to connect to the storage. These are not stored anywhere
on the server, but rather in the user session, giving increased security. The
drawbacks are that sharing is disabled when this mechanism is in use, as
ownCloud has no access to the storage credentials, and background file scanning
does not work.

\begin{notice}{note}{Note:}
There is a workaround that allows background file scanning when using
\textbf{Log-in credentials, save in session}, and that is using Ajax cron mode.
(See {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}}.) Be
aware that the Ajax cron mode is triggered by browsing the ownCloud Web GUI.
\end{notice}


\subsection{Public-key Mechanisms}
\label{configuration_files/external_storage/auth_mechanisms:public-key-mechanisms}
Currently only the RSA mechanism is implemented, where a public/private
keypair is generated by ownCloud and the public half shown in the GUI. The keys
are generated in the SSH format, and are currently 1024 bits in length. Keys
can be regenerated with a button in the GUI.
\begin{figure}[htbp]
\centering

\includegraphics{auth_rsa.png}
\end{figure}


\subsection{OAuth}
\label{configuration_files/external_storage/auth_mechanisms:oauth}
OAuth 1.0 and OAuth 2.0 are both implemented, but currently limited to the
Dropbox and Google Drive backends respectively. These mechanisms require
additional configuration at the service provider, where an app ID and app
secret are provided and then entered into ownCloud. Then ownCloud can
perform an authentication request, establishing the storage connection.
\begin{figure}[htbp]
\centering

\includegraphics{dropbox-oc.png}
\end{figure}


\section{Encryption Configuration}
\label{configuration_files/encryption_configuration:encryption-configuration}\label{configuration_files/encryption_configuration::doc}
The primary purpose of the ownCloud server-side encryption is to protect users'
files on remote storage, such as Dropbox and Google Drive, and to do it easily
and seamlessly from within ownCloud.

In ownCloud 9.0 the server-side encryption separates encryption of local and
remote storage. This allows you to encrypt remote storage, such as Dropbox and
Google, without having to also encrypt your home storage on your ownCloud
server.

\begin{notice}{note}{Note:}
Starting with ownCloud 9.0 we support Authenticated Encryption for all
newly encrypted files. See \href{https://hackerone.com/reports/108082}{https://hackerone.com/reports/108082} for more
technical information about the impact.

For maximum security make sure to configure external storage with ``Check for
changes: Never''. This will let ownCloud ignore new files not added via ownCloud,
so a malicious external storage administrator could not add new files to the
storage without your knowledge. Of course, this is not wise if your external
storage is subject to legitimate external changes.
\end{notice}

ownCloud server-side encryption encrypts files stored on the ownCloud server,
and files on remote storage that is connected to your ownCloud server.
Encryption and decryption are performed on the ownCloud server. All files sent
to remote storage will be encrypted by the ownCloud server, and upon retrieval,
decrypted before serving them to you and anyone you have shared them with.

\begin{notice}{note}{Note:}
Encrypting files increases their size by roughly 35\%, so you must
take this into account when you are provisioning storage and setting
storage quotas. User's quotas are based on the unencrypted file size, and
not the encrypted file size.
\end{notice}

When files on external storage are encrypted in ownCloud, you cannot share them
directly from the external storage services, but only through ownCloud sharing
because the key to decrypt the data never leaves the ownCloud server.

ownCloud's server-side encryption generates a strong encryption key, which is
unlocked by user's passwords. Your users don't need to track an extra
password, but simply log in as they normally do. It encrypts only the contents
of files, and not filenames and directory structures.

You should regularly backup all encryption keys to prevent permanent data loss.
The encryption keys are stored in the following directories:
\begin{description}
\item[{\code{data/\textless{}user\textgreater{}/files\_encryption}}] \leavevmode
Users' private keys and all other keys necessary to decrypt the users' files

\item[{\code{data/files\_encryption}}] \leavevmode
private keys and all other keys necessary to decrypt the files stored on a
system wide external storage

\end{description}

When encryption is enabled, all files are encrypted and decrypted by the
ownCloud application, and stored encrypted on your remote storage.
This protects your data on externally hosted storage. The ownCloud
admin and the storage admin will see only encrypted files when browsing backend
storage.

\begin{notice}{warning}{Warning:}
Encryption keys are stored only on the ownCloud server, eliminating
exposure of your data to third-party storage providers. The encryption app
does \textbf{not} protect your data if your ownCloud server is compromised, and it
does not prevent ownCloud administrators from reading user's files. This
would require client-side encryption, which this app does not provide. If
your ownCloud server is not connected to any external storage services then
it is better to use other encryption tools, such as file-level or
whole-disk encryption.

Note also that SSL terminates at or before Apache on the ownCloud server, and
all files will exist in an unencrypted state between the SSL connection
termination and the ownCloud code that encrypts and decrypts files. This is
also potentially exploitable by anyone with administrator access to your
server. Read \href{https://owncloud.org/blog/how-owncloud-uses-encryption-to-protect-your-data/}{How ownCloud uses encryption to protect your data} for more information.
\end{notice}


\subsection{Before Enabling Encryption}
\label{configuration_files/encryption_configuration:before-enabling-encryption}
Plan very carefully before enabling encryption because it is not reversible via
the ownCloud Web interface. If you lose your encryption keys your files are not
recoverable. Always have backups of your encryption keys stored in a safe
location, and consider enabling all recovery options.

You have more options via the \code{occ} command (see {\hyperref[configuration_files/encryption_configuration:occ-encryption-label]{\emph{occ Encryption Commands}}})


\subsection{Enabling Encryption}
\label{configuration_files/encryption_configuration:enabling-encryption}\label{configuration_files/encryption_configuration:enable-encryption-label}
ownCloud encryption consists of two parts. The base encryption system is
enabled and disabled on your Admin page. First you must enable this, and then
select an encryption module to load. Currently the only available encryption
module is the ownCloud Default Encryption Module.

First go to the \textbf{Server-side encryption} section of your Admin page and check
\textbf{Enable server-side encryption}. You have one last chance to change your mind.
\begin{figure}[htbp]
\centering

\includegraphics{encryption3.png}
\end{figure}

After clicking the \textbf{Enable Encryption} button you see the message ``No
encryption module loaded, please load a encryption module in the app menu'', so
go to your Apps page to enable the ownCloud Default Encryption Module.
\begin{figure}[htbp]
\centering

\includegraphics{encryption1.png}
\end{figure}

Return to your Admin page to see the ownCloud Default Encryption
Module added to the module selector, and automatically selected. Now you must
log out and then log back in to initialize your encryption keys.
\begin{figure}[htbp]
\centering

\includegraphics{encryption14.png}
\end{figure}

When you log back in, there is a checkbox for enabling encryption on your home
storage. This is checked by default. Un-check to avoid encrypting your home
storage.
\begin{figure}[htbp]
\centering

\includegraphics{encryption15.png}
\end{figure}


\subsection{Sharing Encrypted Files}
\label{configuration_files/encryption_configuration:sharing-encrypted-files}
After encryption is enabled your users must also log out and log back in to
generate their personal encryption keys. They will see a yellow warning banner
that says ``Encryption App is enabled but your keys are not initialized, please
log-out and log-in again.''

Share owners may need to re-share files after encryption is enabled; users
trying to access the share will see a message advising them to ask the share
owner to re-share the file with them. For individual shares, un-share and
re-share the file. For group shares, share with any individuals who can't access
the share. This updates the encryption, and then the share owner can remove the
individual shares.
\begin{figure}[htbp]
\centering

\includegraphics{encryption9.png}
\end{figure}


\subsection{Encrypting External Mountpoints}
\label{configuration_files/encryption_configuration:encrypting-external-mountpoints}
You and your users can encrypt individual external mountpoints. You must have
external storage enabled on your Admin page, and enabled for your users.

Encryption settings can be configured in the mount options for an external
storage mount, see {\hyperref[configuration_files/external_storage_configuration_gui:external-storage-mount-options-label]{\emph{Mount Options}}}
({\hyperref[configuration_files/external_storage_configuration_gui::doc]{\emph{Configuring External Storage (GUI)}}})


\subsection{Enabling Users File Recovery Keys}
\label{configuration_files/encryption_configuration:enabling-users-file-recovery-keys}
If you lose your ownCloud password, then you lose access to your encrypted
files. If one of your users loses their ownCloud password their files are
unrecoverable. You cannot reset their password in the normal way; you'll see a
yellow banner warning ``Please provide an admin recovery password, otherwise all
user data will be lost''.

To avoid all this, create a Recovery Key. Go to the Encryption section of your
Admin page and set a recovery key password.
\begin{figure}[htbp]
\centering

\includegraphics{encryption10.png}
\end{figure}

Then your users have the option of enabling password recovery on their Personal
pages. If they do not do this, then the Recovery Key won't work for them.
\begin{figure}[htbp]
\centering

\includegraphics{encryption7.png}
\end{figure}

For users who have enabled password recovery, give them a new password and
recover access to their encrypted files by supplying the Recovery Key on the
Users page.
\begin{figure}[htbp]
\centering

\includegraphics{encryption8.png}
\end{figure}

You may change your Recovery Key password.
\begin{figure}[htbp]
\centering

\includegraphics{encryption12.png}
\end{figure}


\subsection{occ Encryption Commands}
\label{configuration_files/encryption_configuration:occ-encryption-label}\label{configuration_files/encryption_configuration:occ-encryption-commands}
If you have shell access you may use the \code{occ} command to perform encryption
operations, and you have additional options such as decryption and creating a
single master encryption key. See {\hyperref[configuration_server/occ_command:encryption-label]{\emph{Encryption}}}  for detailed
instructions on using \code{occ}.

Get the current status of encryption and the loaded encryption module:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:status
 \PYGZhy{} enabled: false
 \PYGZhy{} defaultModule: OC\PYGZus{}DEFAULT\PYGZus{}MODULE
\end{Verbatim}

This is equivalent to checking \textbf{Enable server-side encryption} on your Admin
page:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:enable
Encryption enabled

Default module: OC\PYGZus{}DEFAULT\PYGZus{}MODULE
\end{Verbatim}

List the available encryption modules:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:list\PYGZhy{}modules
 \PYGZhy{} OC\PYGZus{}DEFAULT\PYGZus{}MODULE: Default encryption module [default*]
\end{Verbatim}

Select a different default Encryption module (currently the only available
module is OC\_DEFAULT\_MODULE):

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:set\PYGZhy{}default\PYGZhy{}module [Module ID].
\end{Verbatim}

The {[}module ID{]} is taken from the \code{encryption:list-modules} command.

Encrypt all data files for all users. For performance reasons, when you enable
encryption on an ownCloud server only new and changed files are encrypted. This
command gives you the option to encrypt all files. You must first put your
ownCloud server into single-user mode to prevent any user activity until
encryption is completed:

\begin{Verbatim}[commandchars=\\\{\}]
occ maintenance:singleuser
Single user mode is currently enabled
\end{Verbatim}

Then run \code{occ}:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:encrypt\PYGZhy{}all

You are about to start to encrypt all files stored in your ownCloud.
It will depend on the encryption module you use which files get encrypted.
Depending on the number and size of your files this can take some time.
Please make sure that no users access their files during this process!

Do you really want to continue? (y/n)
\end{Verbatim}

When you type \code{y} it creates a key pair for each of your users, and then
encrypts their files, displaying progress until all user files are encrypted.

Decrypt all user data files, or optionally a single user:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:decrypt\PYGZhy{}all [username]
\end{Verbatim}

View current location of keys:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:show\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root
Current key storage root:  default storage location (data/)
\end{Verbatim}

Move keys to a different root folder, either locally or on a different server.
The folder must already exist, be owned by root and your HTTP group, and be
restricted to root and your HTTP group. This example is for Ubuntu Linux. Note
that the new folder is relative to your \code{occ} directory:

\begin{Verbatim}[commandchars=\\\{\}]
mkdir /etc/keys
chown \PYGZhy{}R root:www\PYGZhy{}data /etc/keys
chmod \PYGZhy{}R 0770 /etc/keys
occ encryption:change\PYGZhy{}key\PYGZhy{}storage\PYGZhy{}root ../../../etc/keys
Start to move keys:
   4 [============================]
Key storage root successfully changed to ../../../etc/keys
\end{Verbatim}

Create a new master key. Use this when you have a single-sign on
infrastructure.  Use this only on fresh installations with no existing data, or
on systems where encryption has not already been enabled. It is not possible to
disable it:

\begin{Verbatim}[commandchars=\\\{\}]
occ encryption:enable\PYGZhy{}master\PYGZhy{}key
\end{Verbatim}


\subsection{Disabling Encryption}
\label{configuration_files/encryption_configuration:disabling-encryption}
You may disable encryption only with \code{occ}. Make sure you have backups of all
encryption keys, including users'. Put your ownCloud server into
single-user mode, and then disable your encryption module with this command:

\begin{Verbatim}[commandchars=\\\{\}]
occ maintenance:singleuser \PYGZhy{}\PYGZhy{}on
occ encryption:disable
\end{Verbatim}

Take it out of single-user mode when you are finished:

\begin{Verbatim}[commandchars=\\\{\}]
occ maintenance:singleuser \PYGZhy{}\PYGZhy{}off
\end{Verbatim}


\subsection{Files Not Encrypted}
\label{configuration_files/encryption_configuration:files-not-encrypted}
Only the data in the files in \code{data/user/files} are encrypted, and not the
filenames or folder structures. These files are never encrypted:
\begin{itemize}
\item {} 
Existing files in the trash bin \& Versions. Only new and changed files after
encryption is enabled are encrypted.

\item {} 
Existing files in Versions

\item {} 
Image thumbnails from the Gallery app

\item {} 
Previews from the Files app

\item {} 
The search index from the full text search app

\item {} 
Third-party app data

\end{itemize}

There may be other files that are not encrypted; only files that are exposed to
third-party storage providers are guaranteed to be encrypted.


\subsection{LDAP and Other External User Back-ends}
\label{configuration_files/encryption_configuration:ldap-and-other-external-user-back-ends}
If you use an external user back-end, such as an LDAP or Samba server, and you
change a user's password on the back-end, the user will be prompted to change
their ownCloud login to match on their next ownCloud login. The user will need
both their old and new passwords to do this. If you have enabled the Recovery
Key then you can change a user's password in the ownCloud Users panel to match
their back-end password, and then, of course, notify the user and give them
their new password.


\subsection{Encryption migration to ownCloud 8.0}
\label{configuration_files/encryption_configuration:encryption-migration-to-owncloud-8-0}\label{configuration_files/encryption_configuration:upgrading-encryption-label}
When you upgrade from older versions of ownCloud to ownCloud 8.0, you must manually migrate
your encryption keys with the \emph{occ} command after the upgrade is complete, like this
example for CentOS: \emph{sudo -u apache php occ encryption:migrate-keys} You must run \emph{occ} as
your HTTP user. See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more about \emph{occ}.


\subsection{Encryption migration to ownCloud 8.1}
\label{configuration_files/encryption_configuration:encryption-migration-to-owncloud-8-1}
The encryption backend has changed in ownCloud 8.1 again, so you must take some
additional steps to migrate encryption correctly. If you do not follow these
steps you may not be able to access your files.

Before you start your upgrade, put your ownCloud server into
\code{maintenance:singleuser} mode (See {\hyperref[maintenance/enable_maintenance::doc]{\emph{Maintenance Mode Configuration}}}.)
You must do this to prevent users and sync clients from accessing files before
you have completed your encryption migration.

After your upgrade is complete, follow the steps in
{\hyperref[configuration_files/encryption_configuration:enable-encryption-label]{\emph{Enabling Encryption}}} to
enable the new encryption system. Then click the \textbf{Start Migration} button on
your Admin page to migrate your encryption keys, or use the \code{occ} command. We
strongly recommend using the \code{occ} command; the \textbf{Start Migration} button is
for admins who do not have access to the console, for example installations on
shared hosting. This example is for Debian/Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ encryption:migrate
\end{Verbatim}

This example is for Red Hat/CentOS/Fedora Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u apache php occ encryption:migrate
\end{Verbatim}

You must run \code{occ} as your HTTP user; see
{\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}}.

When you are finished, take your ownCloud server out of
\code{maintenance:singleuser} mode.


\section{Transactional File Locking}
\label{configuration_files/files_locking_transactional:transactional-file-locking}\label{configuration_files/files_locking_transactional::doc}
ownCloud's Transactional File Locking mechanism locks files to avoid
file corruption during normal operation. It performs these functions:
\begin{itemize}
\item {} 
Operates at a higher level than the filesystem, so you don't need to use a
filesystem that supports locking

\item {} 
Locks parent directories so they cannot be renamed during any activity on
files inside the directories

\item {} 
Releases locks after file transactions are interrupted, for
example when a sync client loses the connection during an upload

\item {} 
Manages locking and releasing locks correctly on shared files during changes
from multiple users

\item {} 
Manages locks correctly on external storage mounts

\item {} 
Manages encrypted files correctly

\end{itemize}

What Transactional File locking is not for: it is not for preventing collisions
in collaborative document editing (see
{\hyperref[configuration_files/collaborative_documents_configuration::doc]{\emph{Configuring the Collaborative Documents App}}} to learn about collaboration with
the Documents app), nor will it prevent multiple users from editing the same
document, or give notice that other users are working on the same document.
Multiple users can open and edit a file at the same time and Transactional File
locking does not prevent this. Rather, it prevents simultaneous file saving.

\begin{notice}{note}{Note:}
Transactional file locking is in ownCloud core, and replaces the old
File Locking app. The File Locking app has been removed from ownCloud in
version 8.2.1. If your ownCloud server still has the File Locking app, you
must visit your Apps page to verify that it is disabled; the File Locking
app and Transactional File Locking cannot both operate at the same time.
\end{notice}

File locking is enabled by default, using the database locking backend. This
places a significant load on your database. Using \code{memcache.locking} relieves
the database load and improves performance. Admins of ownCloud servers with
heavy workloads should install a memcache. (See
{\hyperref[configuration_server/caching_configuration::doc]{\emph{Configuring Memory Caching}}}.)

To use a memcache with Transactional File Locking, you must install the Redis
server and corresponding PHP module. After installing Redis you must enter a
configuration in your \code{config.php} file like this example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filelocking.enabled\PYGZsq{} =\PYGZgt{} true,
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}localhost\PYGZsq{},
     \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 6379,
     \PYGZsq{}timeout\PYGZsq{} =\PYGZgt{} 0.0,
     \PYGZsq{}password\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZsq{}, // Optional, if not defined no password will be used.
      ),
\end{Verbatim}

\begin{notice}{note}{Note:}
For enhanced security it is recommended to configure Redis to require
a password. See \href{http://redis.io/topics/security}{http://redis.io/topics/security} for more information.
\end{notice}

If you want to configure Redis to listen on an Unix socket (which is
recommended if Redis is running on the same system as ownCloud) use this example
\code{config.php} configuration:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}filelocking.enabled\PYGZsq{} =\PYGZgt{} true,
\PYGZsq{}memcache.locking\PYGZsq{} =\PYGZgt{} \PYGZsq{}\PYGZbs{}OC\PYGZbs{}Memcache\PYGZbs{}Redis\PYGZsq{},
\PYGZsq{}redis\PYGZsq{} =\PYGZgt{} array(
     \PYGZsq{}host\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/run/redis/redis.sock\PYGZsq{},
     \PYGZsq{}port\PYGZsq{} =\PYGZgt{} 0,
     \PYGZsq{}timeout\PYGZsq{} =\PYGZgt{} 0.0,
      ),
\end{Verbatim}

See \code{config.sample.php} to see configuration examples for Redis, and for all
supported memcaches.

If you are on Ubuntu you can follow \href{https://www.techandme.se/how-to-configure-redis-cache-in-ubuntu-14-04-with-owncloud/}{this guide} for a complete installation from scratch.

Learn more about Reds at \href{http://redis.io/}{Redis}. Memcached, the popular
distributed memory caching system, is not suitable for the new file locking
because it is not designed to store locks, and data can disappear from the cache
at any time. Redis is a key-value store, and it guarantees that cached objects
are available for as long as they are needed.

Debian Jesse users, please see this \href{https://github.com/owncloud/core/issues/20675}{Github discussion} if you have problems with
LDAP authentication.


\section{Previews Configuration}
\label{configuration_files/previews_configuration:previews-configuration}\label{configuration_files/previews_configuration::doc}
The ownCloud thumbnail system generates previews of files for all
ownCloud apps that display files, such as Files and Gallery.

The following image shows some examples of previews of various file types.
\begin{figure}[htbp]
\centering

\includegraphics{preview_images.png}
\end{figure}

By default, ownCloud can generate previews for the following filetypes:
\begin{itemize}
\item {} 
Images files

\item {} 
Cover of MP3 files

\item {} 
Text documents

\end{itemize}

\begin{notice}{note}{Note:}
Older versions of ownCloud also supported the preview generation
of other file types such as PDF, SVG or various office documents.
Due to security concerns those providers have been disabled by
default and are considered unsupported.
While those providers are still available, we discourage enabling
them, and they are not documented.
\end{notice}


\subsection{Parameters}
\label{configuration_files/previews_configuration:parameters}
Please notice that the ownCloud preview system comes already with sensible
defaults, and therefore it is usually unnecessary to adjust those configuration
values.


\subsubsection{Disabling previews:}
\label{configuration_files/previews_configuration:disabling-previews}
Under certain circumstances, for example if the server has limited
resources, you might want to consider disabling the generation of previews.
Note that if you do this all previews in all apps are disabled, including
the Gallery app, and will display generic icons instead of
thumbnails.

Set the configuration option \code{enable\_previews} in config.php to \code{false}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}enable\PYGZus{}previews\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}


\subsubsection{Maximum preview size:}
\label{configuration_files/previews_configuration:maximum-preview-size}
There are two configuration options to set the maximum size of a preview.

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}x\PYGZsq{} =\PYGZgt{} null,
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}y\PYGZsq{} =\PYGZgt{} null,
\end{Verbatim}

By default, both options are set to null. `Null' is equal to no limit.
Numeric values represent the size in pixels. The following code limits previews
to a maximum size of 100×100px:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}x\PYGZsq{} =\PYGZgt{} 100,
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}y\PYGZsq{} =\PYGZgt{} 100,
\end{Verbatim}

`preview\_max\_x' represents the x-axis and `preview\_max\_y' represents the y-axis.


\subsubsection{Maximum scale factor:}
\label{configuration_files/previews_configuration:maximum-scale-factor}
If a lot of small pictures are stored on the ownCloud instance and the preview
system generates blurry previews, you might want to consider setting a maximum
scale factor. By default, pictures are upscaled to 10 times the original size:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}scale\PYGZus{}factor\PYGZsq{} =\PYGZgt{} 10,
\end{Verbatim}

If you want to disable scaling at all, you can set the config value to `1':

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}scale\PYGZus{}factor\PYGZsq{} =\PYGZgt{} 1,
\end{Verbatim}

If you want to disable the maximum scaling factor, you can set the config value
to `null':

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
  \PYGZsq{}preview\PYGZus{}max\PYGZus{}scale\PYGZus{}factor\PYGZsq{} =\PYGZgt{} null,
\end{Verbatim}


\section{Controlling File Versions and Aging}
\label{configuration_files/file_versioning:controlling-file-versions-and-aging}\label{configuration_files/file_versioning::doc}
The Versions app (files\_versions) expires old file versions automatically to
ensure that users don't exceed their storage quotas. This is the default
pattern used to delete old versions:
\begin{itemize}
\item {} 
For the first second we keep one version

\item {} 
For the first 10 seconds ownCloud keeps one version every 2 seconds

\item {} 
For the first minute ownCloud keeps one version every 10 seconds

\item {} 
For the first hour ownCloud keeps one version every minute

\item {} 
For the first 24 hours ownCloud keeps one version every hour

\item {} 
For the first 30 days ownCloud keeps one version every day

\item {} 
After the first 30 days ownCloud keeps one version every week

\end{itemize}

The versions are adjusted along this pattern every time a new version is
created.

The Versions app never uses more that 50\% of the user's currently available
free space. If the stored versions exceed this limit, ownCloud deletes the
oldest file versions until it meets the disk space limit again.

You may alter the default pattern in \code{config.php}. The default setting is
\code{auto}, which sets the default pattern:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}versions\PYGZus{}retention\PYGZus{}obligation\PYGZsq{} =\PYGZgt{} \PYGZsq{}auto\PYGZsq{},
\end{Verbatim}

Additional options are:
\begin{itemize}
\item {} \begin{description}
\item[{\code{D, auto}}] \leavevmode
Keep versions at least for D days, apply expiration rules to all versions
that are older than D days

\end{description}

\item {} \begin{description}
\item[{\code{auto, D}}] \leavevmode
Delete all versions that are older than D days automatically, delete other
versions according to expiration rules

\end{description}

\item {} \begin{description}
\item[{\code{D1, D2}}] \leavevmode
Keep versions for at least D1 days and delete when they exceed D2 days.

\end{description}

\item {} \begin{description}
\item[{\code{disabled}}] \leavevmode
Disable Versions; no files will be deleted.

\end{description}

\end{itemize}


\subsection{Enterprise File Retention}
\label{configuration_files/file_versioning:enterprise-file-retention}
Enterprise customers have additional tools for managing file retention
policies; see {\hyperref[enterprise_file_management/files_tagging::doc]{\emph{Advanced File Tagging With the Workflow App (Enterprise only)}}}.


\section{Managing the Trashbin}
\label{configuration_files/trashbin_options::doc}\label{configuration_files/trashbin_options:managing-the-trashbin}
The ownCloud Trashbin (\code{files\_trashbin}) permanently deletes files according to users' storage quotas and age of files. When a user deletes a file it is not immediately removed from your ownCloud server, but goes into the Trashbin. Then the user has the options to un-delete the file, or to delete it permanently.
\begin{figure}[htbp]
\centering

\includegraphics{trashbin-1.png}
\end{figure}

As the ownCloud server administrator, you have two \code{occ} commands for permanently deleting files from the Trashbin manually, without waiting for the normal aging-out process:

\begin{Verbatim}[commandchars=\\\{\}]
trashbin
 trashbin:cleanup   Remove deleted files
 trashbin:expire    Expires the users trashbin
\end{Verbatim}

The \code{trashbin:cleanup} command removes the deleted files of all users, or you may specify certain users in a space-delimited list. This example removes all the deleted files of all users:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ trashbin:cleanup
Remove all deleted files
Remove deleted files for users on backend Database
 user1
 user2
 user3
 user4
\end{Verbatim}

This example removes the deleted files of user2 and user4:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ trashbin:cleanup user2 user4
 Remove deleted files of user2
 Remove deleted files of user4
\end{Verbatim}

\code{trashbin:expire} deletes only expired files according to the \code{trashbin\_retention\_obligation} setting in \code{config.php}. The default setting is \code{auto}, which keeps files in the trashbin for 30 days, then deletes the oldest files as space is needed to keep users within their storage quotas. Files may not be deleted if the space is not needed.

The default is to delete expired files for all users, or you may list users in a space-delimited list:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ trashbin:cleanup user1 user2
 Remove deleted files of user1
 Remove deleted files of user2
\end{Verbatim}

See the \textbf{Deleted Files} section in {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}}, and the {\hyperref[configuration_server/occ_command:trashbin-label]{\emph{Trashbin}}} section of {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}}.


\chapter{Database Configuration}
\label{configuration_database/index:database-configuration}\label{configuration_database/index::doc}

\section{Converting Database Type}
\label{configuration_database/db_conversion:converting-database-type}\label{configuration_database/db_conversion::doc}
You can convert a SQLite database to a more performing MySQL, MariaDB or
PostgreSQL database with the ownCloud command line tool. SQLite is good for
testing and simple single-user ownCloud servers, but it does not scale for multiple-user sites.

\begin{notice}{note}{Note:}
ownCloud Enterprise edition does not support SQLite.
\end{notice}


\subsection{Run the conversion}
\label{configuration_database/db_conversion:run-the-conversion}
First setup the new database, here called ``new\_db\_name''.
In ownCloud root folder call

\begin{Verbatim}[commandchars=\\\{\}]
php occ db:convert\PYGZhy{}type [options] type username hostname database
\end{Verbatim}

The Options
\begin{itemize}
\item {} 
\code{-{-}port="3306"}                       the database port (optional)

\item {} 
\code{-{-}password="mysql\_user\_password"}    password for the new database. If omitted the tool will ask you (optional)

\item {} 
\code{-{-}clear-schema}                      clear schema (optional)

\item {} 
\code{-{-}all-apps}                          by default, tables for enabled apps are converted, use to convert also tables of deactivated apps (optional)

\end{itemize}

\emph{Note:} The converter searches for apps in your configured app folders and uses
the schema definitions in the apps to create the new table. So tables of removed
apps will not be converted even with option \code{-{-}all-apps}

For example

\begin{Verbatim}[commandchars=\\\{\}]
php occ db:convert\PYGZhy{}type \PYGZhy{}\PYGZhy{}all\PYGZhy{}apps mysql oc\PYGZus{}mysql\PYGZus{}user 127.0.0.1 new\PYGZus{}db\PYGZus{}name
\end{Verbatim}

To successfully proceed with the conversion, you must type \code{yes} when prompted
with the question \code{Continue with the conversion?}

On success the converter will automatically configure the new database in your
ownCloud config \code{config.php}.


\subsection{Unconvertible Tables}
\label{configuration_database/db_conversion:unconvertible-tables}
If you updated your ownCloud installation there might exist old tables, which
are not used anymore. The converter will tell you which ones.

\begin{Verbatim}[commandchars=\\\{\}]
The following tables will not be converted:
oc\PYGZus{}permissions
...
\end{Verbatim}

You can ignore these tables.
Here is a list of known old tables:
\begin{itemize}
\item {} 
oc\_calendar\_calendars

\item {} 
oc\_calendar\_objects

\item {} 
oc\_calendar\_share\_calendar

\item {} 
oc\_calendar\_share\_event

\item {} 
oc\_fscache

\item {} 
oc\_log

\item {} 
oc\_media\_albums

\item {} 
oc\_media\_artists

\item {} 
oc\_media\_sessions

\item {} 
oc\_media\_songs

\item {} 
oc\_media\_users

\item {} 
oc\_permissions

\item {} 
oc\_queuedtasks

\item {} 
oc\_sharing

\end{itemize}


\section{Database Configuration}
\label{configuration_database/linux_database_configuration:database-configuration}\label{configuration_database/linux_database_configuration::doc}
ownCloud requires a database in which administrative data is stored. The following databases are currently supported:
\begin{itemize}
\item {} 
\href{http://www.mysql.com/}{MySQL} / \href{https://mariadb.org/}{MariaDB}

\item {} 
\href{http://www.postgresql.org/}{PostgreSQL}

\item {} 
\href{http://www.oracle.com/}{Oracle} (ownCloud Enterprise edition only)

\end{itemize}

The MySQL or MariaDB databases are the recommended database engines.


\subsection{Requirements}
\label{configuration_database/linux_database_configuration:requirements}
Choosing to use MySQL / MariaDB, PostgreSQL, or Oracle (ownCloud Enterprise
edition only) as your database requires that you install and set up the server
software first.
(Oracle users, see {\hyperref[enterprise_installation/oracle_db_configuration::doc]{\emph{Oracle Database Setup}}}.)

\begin{notice}{note}{Note:}
The steps for configuring a third party database are beyond the scope of this document.  Please refer to the documentation for your specific database choice for instructions.
\end{notice}


\subsubsection{MySQL / MariaDB with Binary Logging Enabled}
\label{configuration_database/linux_database_configuration:mysql-mariadb-with-binary-logging-enabled}\label{configuration_database/linux_database_configuration:db-binlog-label}
ownCloud is currently using a \code{TRANSACTION\_READ\_COMMITTED} transaction isolation
to avoid data loss under high load scenarios (e.g. by using the sync client with
many clients/users and many parallel operations). This requires a disabled or
correctly configured binary logging when using MySQL or MariaDB. Your system is
affected if you see the following in your log file during the installation or
update of ownCloud:
\begin{quote}

An unhandled exception has been thrown:
exception `PDOException' with message `SQLSTATE{[}HY000{]}: General error: 1665
Cannot execute statement: impossible to write to binary log since
BINLOG\_FORMAT = STATEMENT and at least one table uses a storage engine limited
to row-based logging. InnoDB is limited to row-logging when transaction
isolation level is READ COMMITTED or READ UNCOMMITTED.'
\end{quote}

There are two solutions. One is to disable binary logging. Binary logging
records all changes to your database, and how long each change took. The
purpose of binary logging is to enable replication and to support backup
operations.

The other is to change the BINLOG\_FORMAT = STATEMENT in your database
configuration file, or possibly in your database startup script, to
BINLOG\_FORMAT = MIXED. See \href{https://mariadb.com/kb/en/mariadb/overview-of-the-binary-log/}{Overview of the Binary
Log} and \href{https://dev.mysql.com/doc/refman/5.6/en/binary-log.html}{The
Binary Log} for
detailed information.


\subsubsection{MySQL / MariaDB ``READ COMMITED'' transaction isolation level}
\label{configuration_database/linux_database_configuration:mysql-mariadb-read-commited-transaction-isolation-level}\label{configuration_database/linux_database_configuration:db-transaction-label}
As discussed above ownCloud is using the \code{TRANSACTION\_READ\_COMMITTED} transaction isolation
level. Some database configurations are enforcing other transaction isolation levels. To avoid
data loss under high load scenarios (e.g. by using the sync client with many clients/users and
many parallel operations) you need to configure the transaction isolation level accordingly.
Please refer to the \href{https://dev.mysql.com/doc/refman/5.7/en/set-transaction.html}{MySQL manual}
for detailed information.


\subsubsection{MySQL / MariaDB storage engine}
\label{configuration_database/linux_database_configuration:db-storage-engine-label}\label{configuration_database/linux_database_configuration:mysql-mariadb-storage-engine}
Since ownCloud 7 only InnoDB is supported as a storage engine. There are some shared hosters that
do not support InnoDB and only MyISAM. Running ownCloud on such an environment is not supported.


\subsection{Parameters}
\label{configuration_database/linux_database_configuration:parameters}
For setting up ownCloud to use any database, use the instructions in {\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}}. You should not have to edit the respective values in the \code{config/config.php}.  However, in special cases (for example, if you want to connect your ownCloud instance to a database created by a previous installation of ownCloud), some modification might be required.


\subsubsection{Configuring a MySQL or MariaDB Database}
\label{configuration_database/linux_database_configuration:configuring-a-mysql-or-mariadb-database}
If you decide to use a MySQL or MariaDB database, ensure the following:
\begin{itemize}
\item {} 
That you have installed and enabled the pdo\_mysql extension in PHP

\item {} 
That the \textbf{mysql.default\_socket} points to the correct socket (if the database runs on the same server as ownCloud).

\end{itemize}

\begin{notice}{note}{Note:}
MariaDB is backwards compatible with MySQL.  All instructions work for both. You will not need to replace mysql with anything.
\end{notice}

The PHP configuration in \code{/etc/php5/conf.d/mysql.ini} could look like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} configuration for PHP MySQL module
extension=pdo\PYGZus{}mysql.so

[mysql]
mysql.allow\PYGZus{}local\PYGZus{}infile=On
mysql.allow\PYGZus{}persistent=On
mysql.cache\PYGZus{}size=2000
mysql.max\PYGZus{}persistent=\PYGZhy{}1
mysql.max\PYGZus{}links=\PYGZhy{}1
mysql.default\PYGZus{}port=
mysql.default\PYGZus{}socket=/var/lib/mysql/mysql.sock  \PYGZsh{} Debian squeeze: /var/run/mysqld/mysqld.sock
mysql.default\PYGZus{}host=
mysql.default\PYGZus{}user=
mysql.default\PYGZus{}password=
mysql.connect\PYGZus{}timeout=60
mysql.trace\PYGZus{}mode=Off
\end{Verbatim}

Now you need to create a database user and the database itself by using the
MySQL command line interface. The database tables will be created by ownCloud
when you login for the first time.

To start the MySQL command line mode use:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{mysql} \PYG{o}{\PYGZhy{}}\PYG{n}{uroot} \PYG{o}{\PYGZhy{}}\PYG{n}{p}
\end{Verbatim}

Then a \textbf{mysql\textgreater{}} or \textbf{MariaDB {[}root{]}\textgreater{}} prompt will appear. Now enter the following lines and confirm them with the enter key:

\begin{Verbatim}[commandchars=\\\{\}]
CREATE DATABASE IF NOT EXISTS owncloud;
GRANT ALL PRIVILEGES ON owncloud.* TO \PYGZsq{}username\PYGZsq{}@\PYGZsq{}localhost\PYGZsq{} IDENTIFIED BY \PYGZsq{}password\PYGZsq{};
\end{Verbatim}

You can quit the prompt by entering:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{quit}
\end{Verbatim}

An ownCloud instance configured with MySQL would contain the hostname on which
the database is running, a valid username and password to access it, and the
name of the database. The \code{config/config.php} as created by the
{\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}} would therefore contain entries like
this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}mysql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpassword\PYGZdq{}    =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}localhost\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}oc\PYGZus{}\PYGZdq{},
\end{Verbatim}


\subsubsection{PostgreSQL Database}
\label{configuration_database/linux_database_configuration:postgresql-database}
If you decide to use a PostgreSQL database make sure that you have installed
and enabled the PostgreSQL extension in PHP. The PHP configuration in \code{/etc/php5/conf.d/pgsql.ini} could look
like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{c}{\PYGZsh{} configuration for PHP PostgreSQL module}
\PYG{n}{extension}\PYG{o}{=}\PYG{n}{pdo\PYGZus{}pgsql}\PYG{o}{.}\PYG{n}{so}
\PYG{n}{extension}\PYG{o}{=}\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{so}

\PYG{p}{[}\PYG{n}{PostgresSQL}\PYG{p}{]}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{allow\PYGZus{}persistent} \PYG{o}{=} \PYG{n}{On}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{auto\PYGZus{}reset\PYGZus{}persistent} \PYG{o}{=} \PYG{n}{Off}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{max\PYGZus{}persistent} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{max\PYGZus{}links} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{ignore\PYGZus{}notice} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{pgsql}\PYG{o}{.}\PYG{n}{log\PYGZus{}notice} \PYG{o}{=} \PYG{l+m+mi}{0}
\end{Verbatim}

The default configuration for PostgreSQL (at least in Ubuntu 14.04) is to use the peer authentication method. Check \code{/etc/postgresql/9.3/main/pg\_hba.conf} to find out which authentication method is used in your setup.
To start the postgres command line mode use:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u postgres psql \PYGZhy{}d template1
\end{Verbatim}

Then a \textbf{template1=\#} prompt will appear. Now enter the following lines and confirm them with the enter key:

\begin{Verbatim}[commandchars=\\\{\}]
CREATE USER username CREATEDB;
CREATE DATABASE owncloud OWNER username;
\end{Verbatim}

You can quit the prompt by entering:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZbs{}q
\end{Verbatim}

An ownCloud instance configured with PostgreSQL would contain the path to the socket on
which the database is running as the hostname, the system username the php process is using,
and an empty password to access it, and the name of the database. The \code{config/config.php} as
created by the {\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}} would therefore contain entries like
this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}pgsql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpassword\PYGZdq{}    =\PYGZgt{} \PYGZdq{}\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}/var/run/postgresql\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}oc\PYGZus{}\PYGZdq{},
\end{Verbatim}

\begin{notice}{note}{Note:}
The host actually points to the socket that is used to connect to the database. Using localhost here will not work if postgreSQL is configured to use peer authentication. Also note, that no password is specified, because this authentication method doesn't use a password.
\end{notice}

If you use another authentication method (not peer), you'll need to use the following steps to get the database setup:
Now you need to create a database user and the database itself by using the
PostgreSQL command line interface. The database tables will be created by
ownCloud when you login for the first time.

To start the postgres command line mode use:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{psql} \PYG{o}{\PYGZhy{}}\PYG{n}{hlocalhost} \PYG{o}{\PYGZhy{}}\PYG{n}{Upostgres}
\end{Verbatim}

Then a \textbf{postgres=\#} prompt will appear. Now enter the following lines and confirm them with the enter key:

\begin{Verbatim}[commandchars=\\\{\}]
CREATE USER username WITH PASSWORD \PYGZsq{}password\PYGZsq{};
CREATE DATABASE owncloud TEMPLATE template0 ENCODING \PYGZsq{}UNICODE\PYGZsq{};
ALTER DATABASE owncloud OWNER TO username;
GRANT ALL PRIVILEGES ON DATABASE owncloud TO username;
\end{Verbatim}

You can quit the prompt by entering:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZbs{}q
\end{Verbatim}

An ownCloud instance configured with PostgreSQL would contain the hostname on
which the database is running, a valid username and password to access it, and
the name of the database. The \code{config/config.php} as created by the
{\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}} would therefore contain entries like
this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

  \PYGZdq{}dbtype\PYGZdq{}        =\PYGZgt{} \PYGZdq{}pgsql\PYGZdq{},
  \PYGZdq{}dbname\PYGZdq{}        =\PYGZgt{} \PYGZdq{}owncloud\PYGZdq{},
  \PYGZdq{}dbuser\PYGZdq{}        =\PYGZgt{} \PYGZdq{}username\PYGZdq{},
  \PYGZdq{}dbpassword\PYGZdq{}    =\PYGZgt{} \PYGZdq{}password\PYGZdq{},
  \PYGZdq{}dbhost\PYGZdq{}        =\PYGZgt{} \PYGZdq{}localhost\PYGZdq{},
  \PYGZdq{}dbtableprefix\PYGZdq{} =\PYGZgt{} \PYGZdq{}oc\PYGZus{}\PYGZdq{},
\end{Verbatim}


\subsection{Troubleshooting}
\label{configuration_database/linux_database_configuration:troubleshooting}\label{configuration_database/linux_database_configuration:db-troubleshooting-label}

\subsubsection{How to workaround General error: 2006 MySQL server has gone away}
\label{configuration_database/linux_database_configuration:how-to-workaround-general-error-2006-mysql-server-has-gone-away}
The database request takes too long and therefore the MySQL server times out. Its
also possible that the server is dropping a packet that is too large. Please
refer to the manual of your database for how to raise the configuration options
\code{wait\_timeout} and/or \code{max\_allowed\_packet}.

Some shared hosters are not allowing the access to these config options. For such
systems ownCloud is providing a \code{dbdriveroptions} configuration option within your
\code{config/config.php} where you can pass such options to the database driver.
Please refer to {\hyperref[configuration_server/config_sample_php_parameters::doc]{\emph{Config.php Parameters}}} for an example.


\subsubsection{How can I find out if my MySQL/PostgreSQL server is reachable?}
\label{configuration_database/linux_database_configuration:how-can-i-find-out-if-my-mysql-postgresql-server-is-reachable}
To check the server's network availability, use the ping command on
the server's host name (db.server.com in this example):

\begin{Verbatim}[commandchars=\\\{\}]
ping db.server.dom
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
PING db.server.dom (ip\PYGZhy{}address) 56(84) bytes of data.
64 bytes from your\PYGZhy{}server.local.lan (192.168.1.10): icmp\PYGZus{}req=1 ttl=64 time=3.64 ms
64 bytes from your\PYGZhy{}server.local.lan (192.168.1.10): icmp\PYGZus{}req=2 ttl=64 time=0.055 ms
64 bytes from your\PYGZhy{}server.local.lan (192.168.1.10): icmp\PYGZus{}req=3 ttl=64 time=0.062 ms
\end{Verbatim}

For a more detailed check whether the access to the database server software
itself works correctly, see the next question.


\subsubsection{How can I find out if a created user can access a database?}
\label{configuration_database/linux_database_configuration:how-can-i-find-out-if-a-created-user-can-access-a-database}
The easiest way to test if a database can be accessed is by starting the
command line interface:

\textbf{MySQL}:

Assuming the database server is installed on the same system you're running
the command from, use:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{mysql} \PYG{o}{\PYGZhy{}}\PYG{n}{uUSERNAME} \PYG{o}{\PYGZhy{}}\PYG{n}{p}
\end{Verbatim}

To acess a MySQL installation on a different machine, add the -h option with
the respective host name:

\begin{Verbatim}[commandchars=\\\{\}]
mysql \PYGZhy{}uUSERNAME \PYGZhy{}p \PYGZhy{}h HOSTNAME
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
mysql\PYGZgt{} SHOW VARIABLES LIKE \PYGZdq{}version\PYGZdq{};
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} Variable\PYGZus{}name \textbar{} Value  \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\textbar{} version       \textbar{} 5.1.67 \textbar{}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
1 row in set (0.00 sec)
mysql\PYGZgt{} quit
\end{Verbatim}

\textbf{PostgreSQL}:

Assuming the database server is installed on the same system you're running
the command from, use:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{psql} \PYG{o}{\PYGZhy{}}\PYG{n}{Uusername} \PYG{o}{\PYGZhy{}}\PYG{n}{downcloud}
\end{Verbatim}

To acess a MySQL installation on a different machine, add the -h option with
the respective host name:

\begin{Verbatim}[commandchars=\\\{\}]
psql \PYGZhy{}Uusername \PYGZhy{}downcloud \PYGZhy{}h HOSTNAME
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
postgres=\PYGZsh{} SELECT version();
PostgreSQL 8.4.12 on i686\PYGZhy{}pc\PYGZhy{}linux\PYGZhy{}gnu, compiled by GCC gcc (GCC) 4.1.3 20080704 (prerelease), 32\PYGZhy{}bit
(1 row)
postgres=\PYGZsh{} \PYGZbs{}q
\end{Verbatim}


\subsubsection{Useful SQL commands}
\label{configuration_database/linux_database_configuration:useful-sql-commands}
\textbf{Show Database Users}:

\begin{Verbatim}[commandchars=\\\{\}]
MySQL     : SELECT User,Host FROM mysql.user;
PostgreSQL: SELECT * FROM pg\PYGZus{}user;
\end{Verbatim}

\textbf{Show available Databases}:

\begin{Verbatim}[commandchars=\\\{\}]
MySQL     : SHOW DATABASES;
PostgreSQL: \PYGZbs{}l
\end{Verbatim}

\textbf{Show ownCloud Tables in Database}:

\begin{Verbatim}[commandchars=\\\{\}]
MySQL     : USE owncloud; SHOW TABLES;
PostgreSQL: \PYGZbs{}c owncloud; \PYGZbs{}d
\end{Verbatim}

\textbf{Quit Database}:

\begin{Verbatim}[commandchars=\\\{\}]
MySQL     : quit
PostgreSQL: \PYGZbs{}q
\end{Verbatim}


\chapter{Mimetypes Management}
\label{configuration_mimetypes/index:mimetypes-management}\label{configuration_mimetypes/index::doc}

\section{Mimetype Aliases}
\label{configuration_mimetypes/mimetype_aliases::doc}\label{configuration_mimetypes/mimetype_aliases:mimetype-aliases}
ownCloud allows you to create aliases for mimetypes, so that you can display
custom icons for files. For example, you might want a nice audio icon for audio
files instead of the default file icon.

By default ownCloud is distributed with
\code{owncloud/resources/config/mimetypealiases.dist.json}.
Do not modify this file, as it will be replaced when ownCloud is updated.
Instead, create your own \code{owncloud/config/mimetypealiases.json}
file with your custom aliases. Use the same syntax as in
\code{owncloud/resources/config/mimetypealiases.dist.json}.

Once you have made changes to your \code{mimetypealiases.json}, use the \code{occ}
command to propagate the changes through the system. This example is for
Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mimetype:update\PYGZhy{}js
\end{Verbatim}

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more about \code{occ}.

Some common mimetypes that may be useful in creating aliases are:
\begin{description}
\item[{image}] \leavevmode
Generic image

\item[{image/vector}] \leavevmode
Vector image

\item[{audio}] \leavevmode
Generic audio file

\item[{x-office/document}] \leavevmode
Word processed document

\item[{x-office/spreadsheet}] \leavevmode
Spreadsheet

\item[{x-office/presentation}] \leavevmode
Presentation

\item[{text}] \leavevmode
Generic text document

\item[{text/code}] \leavevmode
Source code

\end{description}


\section{Mimetype mapping}
\label{configuration_mimetypes/mimetype_mapping:mimetype-mapping}\label{configuration_mimetypes/mimetype_mapping::doc}
ownCloud allows administrators to specify the mapping of a file extension to a
mimetype. For example files ending in \code{mp3} map to \code{audio/mpeg}. Which
then in turn allows ownCloud to show the audio icon.

By default ownCloud comes with \code{mimetypemapping.dist.json}. This is a
simple json array.
Administrators should not update this file as it will get replaced on upgrades
of ownCloud. Instead the file \code{mimetypemapping.json} should be created and
modified, this file has precedence over the shipped file.


\section{Icon retrieval}
\label{configuration_mimetypes/index:icon-retrieval}
When an icon is retrieved for a mimetype, if the full mimetype cannot be found,
the search will fallback to looking for the part before the slash. Given a file
with the mimetype `image/my-custom-image', if no icon exists for the full
mimetype, the icon for `image' will be used instead. This allows specialised
mimetypes to fallback to generic icons when the relevant icons are unavailable.


\chapter{Maintenance}
\label{maintenance/index::doc}\label{maintenance/index:maintenance}

\section{Maintenance Mode Configuration}
\label{maintenance/enable_maintenance:maintenance-mode-configuration}\label{maintenance/enable_maintenance::doc}
You must put your ownCloud server into maintenance mode before performing
upgrades, and for performing troubleshooting and maintenance. Please
see {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn how to put your server into
the various maintenance modes (\code{maintenance:mode, maintenance:singleuser},
and \code{maintenance:repair}) with the \code{occ} command.

\code{maintenance:mode} locks the sessions of logged-in users and prevents new
logins. This is the mode to use for upgrades. You must run \code{occ} as the HTTP user,
like this example on Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}on
\end{Verbatim}

You may also put your
server into this mode by editing \code{config/config.php}. Change
\code{"maintenance" =\textgreater{} false} to \code{"maintenance" =\textgreater{} true}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php

 \PYGZdq{}maintenance\PYGZdq{} =\PYGZgt{} true,
\end{Verbatim}

Then change it back to \code{false} when you are finished.


\section{Backing up ownCloud}
\label{maintenance/backup:backing-up-owncloud}\label{maintenance/backup::doc}
When you backup your ownCloud server, there are four things that you need to copy:
\begin{enumerate}
\item {} 
Your \code{config/} directory.

\item {} 
Your \code{data/} directory.

\item {} 
Your ownCloud database.

\item {} 
Your custom theme files, if you have any. (See \href{https://doc.owncloud.org/server/9.2/developer\_manual/core/theming.html}{Theming ownCloud})

\end{enumerate}

When you install your ownCloud server from our \href{https://download.owncloud.org/download/repositories/stable/owncloud/}{Open Build Service}) packages (or from distro packages, which we do not recommend) \textbf{do not backup your ownCloud server files}, which are the other files in your \code{owncloud/} directory such as \code{core/}, \code{3rdparty/}, \code{apps/}, \code{assets/}, \code{lib/}, and all the rest of the ownCloud files. If you restore these files from backup they may not be in sync with the current package versions, and will fail the code integrity check. This may also cause other errors, such as white pages.

When you install ownCloud from the source tarballs this will not be an issue, and you can safely backup your entire ownCloud installation, with the exception of your ownCloud database. Databases cannot be copied, but you must use the database tools to make a correct database dump.

To restore your ownCloud installation from backup, see {\hyperref[maintenance/restore::doc]{\emph{Restoring ownCloud}}} .


\subsection{Backing Up the config/ and data/ Directories}
\label{maintenance/backup:backing-up-the-config-and-data-directories}
Simply copy your \code{config/} and \code{data/} folder to a place outside of your ownCloud environment. This example uses \code{rsync} to copy the two directories to \code{/backupdir}:

\begin{Verbatim}[commandchars=\\\{\}]
rsync \PYGZhy{}Aax config data /oc\PYGZhy{}backupdir/
\end{Verbatim}

There are many ways to backup normal files, and you may use whatever method you are accustomed to.


\subsection{Backup Database}
\label{maintenance/backup:backup-database}
You can't just copy a database, but must use the database tools to make a correct database dump.


\subsubsection{MySQL/MariaDB}
\label{maintenance/backup:mysql-mariadb}
MySQL or MariaDB, which is a drop-in MySQL replacement, is the recommended database engine. To backup MySQL/MariaDB:

\begin{Verbatim}[commandchars=\\\{\}]
mysqldump \PYGZhy{}\PYGZhy{}lock\PYGZhy{}tables \PYGZhy{}h [server] \PYGZhy{}u [username] \PYGZhy{}p[password] [db\PYGZus{}name] \PYGZgt{} owncloud\PYGZhy{}dbbackup\PYGZus{}{}`date +\PYGZdq{}\PYGZpc{}Y\PYGZpc{}m\PYGZpc{}d\PYGZdq{}{}`.bak
\end{Verbatim}


\subsubsection{SQLite}
\label{maintenance/backup:sqlite}
\begin{Verbatim}[commandchars=\\\{\}]
sqlite3 data/owncloud.db .dump \PYGZgt{} owncloud\PYGZhy{}dbbackup\PYGZus{}{}`date +\PYGZdq{}\PYGZpc{}Y\PYGZpc{}m\PYGZpc{}d\PYGZdq{}{}`.bak
\end{Verbatim}


\subsubsection{PostgreSQL}
\label{maintenance/backup:postgresql}
\begin{Verbatim}[commandchars=\\\{\}]
PGPASSWORD=\PYGZdq{}password\PYGZdq{} pg\PYGZus{}dump [db\PYGZus{}name] \PYGZhy{}h [server] \PYGZhy{}U [username] \PYGZhy{}f owncloud\PYGZhy{}dbbackup\PYGZus{}{}`date +\PYGZdq{}\PYGZpc{}Y\PYGZpc{}m\PYGZpc{}d\PYGZdq{}{}`.bak
\end{Verbatim}


\section{How to Upgrade Your ownCloud Server}
\label{maintenance/upgrade:how-to-upgrade-your-owncloud-server}\label{maintenance/upgrade::doc}
There are three ways to upgrade your ownCloud server:
\begin{itemize}
\item {} 
Using your {\hyperref[maintenance/package_upgrade::doc]{\emph{Linux package manager}}} with our official
ownCloud repositories. This is the recommended method.

\item {} 
With the {\hyperref[maintenance/update::doc]{\emph{Updater App}}} (Server Edition only). Recommended for
shared hosters, and for users who want an easy way to track different
release channels. (It is not available and not supported on the Enterprise
edition.)

\item {} 
{\hyperref[maintenance/manual_upgrade::doc]{\emph{Manually upgrading}}} with the ownCloud \code{.tar} archive
from \href{https://owncloud.org/install/}{owncloud.org/install/}.

\item {} 
Manually upgrading is also an option for users on shared hosting; download
and unpack the ownCloud tarball to your PC. Delete your existing ownCloud
files, except \code{data/} and \code{config/} files, on your hosting account. Then
transfer the new ownCloud files to your hosting account, again
preserving your existing \code{data/} and \code{config/} files.

\item {} 
Enterprise customers will use their Enterprise software
repositories to maintain their ownCloud servers, rather than the Open Build
Service. Please see {\hyperref[enterprise_installation/linux_installation::doc]{\emph{Installing \& Upgrading ownCloud Enterprise Edition}}} for
more information.

\end{itemize}

\begin{notice}{warning}{Warning:}
When upgrading from oC 9.0 to 9.1 with existing Calendars or Adressbooks
please have a look at the {\hyperref[release_notes::doc]{\emph{ownCloud 9.2 Release Notes}}} of oC 9.0 for important info
about the needed migration steps during that upgrade.
\end{notice}

When an update is available for your ownCloud server, you will see a
notification at the top of your ownCloud Web interface. When you click the
notification it brings you here, to this page.

\textbf{It is best to keep your ownCloud server upgraded regularly}, and to install
all point releases and major releases without skipping any of them, as skipping
releases increases the risk of errors. Major releases are 8.0, 8.1, 8.2, and
9.0. Point releases are intermediate releases for each major release. For
example, 8.0.9 and 8.1.3 are point releases. \textbf{Skipping major releases is not
supported.}

\textbf{Upgrading is disruptive}. Your ownCloud server will be put into maintenance
mode, so your users will be locked out until the upgrade is completed. Large
installations may take several hours to complete the upgrade.

\begin{notice}{warning}{Warning:}
\textbf{Downgrading is not supported} and risks corrupting your data! If
you want to revert to an older ownCloud version, make a new, fresh
installation and then restore your data from backup. Before doing this,
file a support ticket (if you have paid support) or ask for help in the
ownCloud forums to see if your issue can be resolved without downgrading.
\end{notice}


\subsection{Prerequisites}
\label{maintenance/upgrade:prerequisites}
You should always maintain {\hyperref[maintenance/backup::doc]{\emph{regular backups}}} and make a fresh
backup before every upgrade.

Then review third-party apps, if you have any, for compatibility with the new
ownCloud release. Any apps that are not developed by ownCloud show a 3rd party
designation. \textbf{Install unsupported apps at your own risk}. Then, before the
upgrade, all 3rd party apps must be disabled. After the upgrade is complete you
may re-enable them.


\subsection{Previous ownCloud Releases}
\label{maintenance/upgrade:previous-owncloud-releases}\label{maintenance/upgrade:owncloud-org-install}
You'll find previous ownCloud releases in the \href{https://owncloud.org/changelog/}{ownCloud Server Changelog}.


\subsection{Reverse Upgrade}
\label{maintenance/upgrade:reverse-upgrade}
If you need to reverse your upgrade, see {\hyperref[maintenance/restore::doc]{\emph{Restoring ownCloud}}}.


\subsection{Troubleshooting}
\label{maintenance/upgrade:troubleshooting}
When upgrading ownCloud and you are running MySQL or MariaDB with binary
logging enabled, your upgrade may fail with these errors in your MySQL/MariaDB log:

\begin{Verbatim}[commandchars=\\\{\}]
An unhandled exception has been thrown:
exception \PYGZsq{}PDOException\PYGZsq{} with message \PYGZsq{}SQLSTATE[HY000]: General error: 1665
Cannot execute statement: impossible to write to binary log since
BINLOG\PYGZus{}FORMAT = STATEMENT and at least one table uses a storage engine limited
to row\PYGZhy{}based logging. InnoDB is limited to row\PYGZhy{}logging when transaction
isolation level is READ COMMITTED or READ UNCOMMITTED.\PYGZsq{}
\end{Verbatim}

Please refer to {\hyperref[configuration_database/linux_database_configuration:db-binlog-label]{\emph{MySQL / MariaDB with Binary Logging Enabled}}} on how to correctly configure your
environment.

Occasionally, \emph{files do not show up after a upgrade}. A rescan of the files can
help:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php console.php files:scan \PYGZhy{}\PYGZhy{}all
\end{Verbatim}

See \href{https://owncloud.org/support}{the owncloud.org support page} for further
resources for both home and enterprise users.

Sometimes, ownCloud can get \emph{stuck in a upgrade}. This is usually due to the
process taking too long and encountering a PHP time-out. Stop the upgrade
process this way:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}off
\end{Verbatim}

Then start the manual process:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade
\end{Verbatim}

If this does not work properly, try the repair function:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:repair
\end{Verbatim}


\subsection{Migration Test}
\label{maintenance/upgrade:migration-test-label}\label{maintenance/upgrade:migration-test}
Previous versions of ownCloud included a migration test. ownCloud first ran a migration
simulation by copying the ownCloud database and performing the upgrade on the copy, to
ensure that the migration would succeed. Then the copied tables were deleted after the
upgrade was completed. This doubled the upgrade time, so admins could skip this test
(by risking a failed upgrade) with \code{php occ upgrade -{-}skip-migration-test}.

The migration test has been removed from ownCloud 9.2. ownCloud server admins should have
current backups before migration, and rely on backups to correct any problems from the migration.


\subsection{Encryption migration from oC 7.0 to 8.0 and 8.0 to 8.1}
\label{maintenance/upgrade:encryption-migration-from-oc-7-0-to-8-0-and-8-0-to-8-1}
The encryption backend was changed twice between ownCloud 7.0 and 8.0 as well as
between 8.0 and 8.1. If you're upgrading from these older versions please refer to
{\hyperref[configuration_files/encryption_configuration:upgrading-encryption-label]{\emph{Encryption migration to ownCloud 8.0}}} for the needed migration steps.


\subsection{Debian Migration to Official ownCloud Packages}
\label{maintenance/upgrade:debian-migration-to-official-owncloud-packages}
As of March 2016 Debian will not include ownCloud packages. Debian users can
migrate to the official ownCloud packages by following this guide,
\href{https://owncloud.org/blog/upgrading-owncloud-on-debian-stable-to-official-packages/}{Upgrading ownCloud on Debian Stable to official packages}.


\section{Upgrade ownCloud From Packages}
\label{maintenance/package_upgrade:upgrade-owncloud-from-packages}\label{maintenance/package_upgrade::doc}

\subsection{Upgrade Quickstart}
\label{maintenance/package_upgrade:upgrade-quickstart}
The best method for keeping ownCloud current on Linux servers is by configuring
your system to use ownCloud's \href{https://download.owncloud.org/download/repositories/stable/owncloud/}{Open Build Service} repository. Then stay
current by using your Linux package manager to install fresh ownCloud packages.
After installing upgraded packages you must run a few more steps to complete
the upgrade. These are the basic steps to upgrading ownCloud:

\begin{notice}{warning}{Warning:}
Make sure that you don't skip a major release when upgrading via repositories.
For example you can't upgrade from 8.1.x to 9.0.x directly as you would skip the 8.2.x
major release. See {\hyperref[maintenance/package_upgrade:skipped-release-upgrade-label]{\emph{Upgrading Across Skipped Releases}}} for more information.
\end{notice}
\begin{itemize}
\item {} 
{\hyperref[installation/apps_management_installation::doc]{\emph{Disable}}} all third-party apps.

\item {} 
Make a {\hyperref[maintenance/backup::doc]{\emph{fresh backup}}}.

\item {} 
Upgrade your ownCloud packages.

\item {} 
Run {\hyperref[configuration_server/occ_command:command-line-upgrade-label]{\emph{occ upgrade}}} (The optional parameter to skip migration
tests was removed from oC 9.2. See {\hyperref[maintenance/upgrade:migration-test-label]{\emph{Migration Test}}} for background information).

\item {} 
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Apply strong permissions}}} to your ownCloud directories.

\item {} 
Take your ownCloud server out of {\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{maintenance mode}}}.

\item {} 
Re-enable third-party apps.

\end{itemize}

\begin{notice}{warning}{Warning:}
When upgrading from oC 9.0 to 9.1 with existing Calendars or Addressbooks
please have a look at the {\hyperref[release_notes:release-notes-label]{\emph{9.0 release notes}}} for
important information about the needed migration steps during that upgrade.
\end{notice}


\subsection{Upgrade Tips}
\label{maintenance/package_upgrade:upgrade-tips}
Upgrading ownCloud from our \href{https://download.owncloud.org/download/repositories/stable/owncloud/}{Open Build Service} repository is just like any
normal Linux upgrade. For example, on Debian or Ubuntu Linux this is the
standard system upgrade command:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get update \PYGZam{}\PYGZam{} apt\PYGZhy{}get upgrade
\end{Verbatim}

Or you can upgrade just ownCloud with this command:

\begin{Verbatim}[commandchars=\\\{\}]
apt\PYGZhy{}get update \PYGZam{}\PYGZam{} apt\PYGZhy{}get install owncloud
\end{Verbatim}

On Fedora, CentOS, and Red Hat Linux use \code{yum} to see all available updates:

\begin{Verbatim}[commandchars=\\\{\}]
yum check\PYGZhy{}update
\end{Verbatim}

You can apply all available updates with this command:

\begin{Verbatim}[commandchars=\\\{\}]
yum update
\end{Verbatim}

Or update only ownCloud:

\begin{Verbatim}[commandchars=\\\{\}]
yum update owncloud
\end{Verbatim}

Your Linux package manager only downloads the current ownCloud packages. Then
your ownCloud server is immediately put into maintenance mode. You may not see
this until you refresh your ownCloud page.
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{upgrade-1.png}}
\end{figure}

Then use \code{occ} to complete the upgrade. You must run \code{occ} as your HTTP
user. This example is for Debian/Ubuntu:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade
\end{Verbatim}

This example is for CentOS/RHEL/Fedora:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u apache php occ upgrade
\end{Verbatim}

The optional parameter to skip migration tests during this step was removed in oC 9.2.
See {\hyperref[maintenance/upgrade:migration-test-label]{\emph{Migration Test}}} for background information.

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more.


\subsection{Setting Strong Directory Permissions}
\label{maintenance/package_upgrade:setting-strong-directory-permissions}
After upgrading, verify that your ownCloud directory permissions are set
according to {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}.


\subsection{Upgrading Across Skipped Releases}
\label{maintenance/package_upgrade:upgrading-across-skipped-releases}\label{maintenance/package_upgrade:skipped-release-upgrade-label}
It is best to update your ownCloud installation with every new point release (e.g. 8.1.10),
and to never skip any major release (e.g. don't skip 8.2.x between 8.1.x and 9.0.x). If you
have skipped any major release you can bring your ownCloud current with these steps:
\begin{enumerate}
\item {} 
Add the repository of your current version (e.g. 8.1.x)

\item {} 
Upgrade your current version to the latest point release (e.g. 8.1.10) via your package manager

\item {} 
Run the \code{occ upgrade} routine (see Upgrade Quickstart above)

\item {} 
Add the repository of the next major release (e.g. 8.2.x)

\item {} 
Upgrade your current version to the next major release (e.g. 8.2.8) via your package manager

\item {} 
Run the \code{occ upgrade} routine (see Upgrade Quickstart above)

\item {} 
Repeat from step 4 until you reach the last available major release (e.g. 9.1.x)

\end{enumerate}

You'll find repositories of previous ownCloud major releases in the \href{https://owncloud.org/changelog/}{ownCloud Server Changelog}.


\section{Upgrading ownCloud with the Updater App}
\label{maintenance/update::doc}\label{maintenance/update:upgrading-owncloud-with-the-updater-app}
The Updater app automates many of the steps of upgrading an ownCloud
installation. It is useful for installations that do not have root access,
such as shared hosting, for installations with a smaller number of users
and data, and it automates updating
{\hyperref[installation/source_installation::doc]{\emph{manual installations}}}.

\begin{notice}{warning}{Warning:}
When upgrading from oC 9.0 to 9.1 with existing Calendars or Adressbooks
please have a look at the {\hyperref[release_notes::doc]{\emph{ownCloud 9.2 Release Notes}}} of oC 9.0 for important info
about this migration.
\end{notice}

New in 9.0, the Updater app has {\hyperref[maintenance/update:updater-cli-label]{\emph{command-line options}}}.

\begin{notice}{note}{Note:}
The Updater app is \textbf{not enabled and not supported} in ownCloud
Enterprise edition.

The Updater app is \textbf{not included} in the
\href{https://download.owncloud.org/download/repositories/stable/owncloud/}{Linux packages on our Open Build Service},
but only in the \href{https://owncloud.org/install/\#instructions-server}{tar and zip archives}. When you install
ownCloud from packages you should keep it updated with your package manager.

\textbf{Downgrading} is not supported and risks corrupting your data! If you want
to revert to an older ownCloud version, install it from scratch and then
restore your data from backup. Before doing this, file a support ticket (if
you have paid support) or ask for help in the ownCloud forums to see if your
issue can be resolved without downgrading.
\end{notice}

You should maintain regular backups (see {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}}), and make a backup
before every update. The Updater app does not backup your database or data
directory.

The Updater app performs these operations:
\begin{itemize}
\item {} 
Creates an \code{updater\_backup} directory under your ownCloud data directory

\item {} 
Downloads and extracts updated package content into the
\code{updater\_backup/packageVersion} directory

\item {} 
Makes a copy of your current ownCloud instance, except for your data
directory, to \code{updater\_backup/currentVersion-randomstring}

\item {} 
Moves all directories except \code{data}, \code{config} and \code{themes} from the
current instance to \code{updater\_backup/tmp}

\item {} 
Moves all directories from \code{updater\_backup/packageVersion} to the current
version

\item {} 
Copies your old \code{config.php} to the new \code{config/} directory

\end{itemize}

Using the Updater app to update your ownCloud installation is just a few
steps:
\begin{enumerate}
\item {} 
You should see a notification at the top of any ownCloud page when there is
a new update available.

\item {} 
Even though the Updater app backs up important directories, you should
always have your own current backups (See {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}} for details.)

\item {} 
Verify that the HTTP user on your system can write to your whole ownCloud
directory; see the {\hyperref[maintenance/update:set-updating-permissions-label]{\emph{Setting Permissions for Updating}}} section below.

\item {} 
Navigate to your Admin page and click the \textbf{Update Center} button under
Updater. This takes you to the Updater control panel.

\item {} 
Click Update, and carefully read the messages. If there are any problems it
will tell you. The most common issue is directory permissions; your HTTP
user needs write permissions to your whole ownCloud directory. (See
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}.) Another common issue is SELinux rules
(see {\hyperref[installation/selinux_configuration:selinux-config-label]{\emph{SELinux Configuration}}}.) Otherwise you will see messages
about checking your installation and making backups.

\item {} 
Click Proceed, and then it performs the remaining steps, which takes a few
minutes.

\item {} 
If your directory permissions are correct, a backup was made, and
downloading the new ownCloud archive succeeded you will see the following
screen. Click the Start Update button to complete your update:

\end{enumerate}
\begin{figure}[htbp]
\centering

\scalebox{0.750000}{\includegraphics{upgrade-2.png}}
\end{figure}

\begin{notice}{note}{Note:}
If you have a large ownCloud installation and have shell access,
you should use the \code{occ upgrade} command, running it as your HTTP user,
instead of clicking the Start Update button, in order to avoid PHP
timeouts.
\end{notice}

This example is for Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ upgrade
\end{Verbatim}

The optional parameter to skip migration tests during this step was removed in oC 9.2.
See {\hyperref[maintenance/upgrade:migration-test-label]{\emph{Migration Test}}} for more information.
\begin{enumerate}
\setcounter{enumi}{7}
\item {} 
It runs for a few minutes, and when it is finished displays a success
message, which disappears after a short time.

\end{enumerate}

Refresh your Admin page to verify your new version number. In the Updater
section of your Admin page you can see the current status and backups. These
are backups of your old and new ownCloud installations, and do not contain your
data files. If your update works and there are no problems you can delete the
backups from this screen.

If the update fails, then you must update manually. (See {\hyperref[maintenance/manual_upgrade::doc]{\emph{Manually
upgrading}}}.)


\subsection{Setting Permissions for Updating}
\label{maintenance/update:setting-permissions-for-updating}\label{maintenance/update:set-updating-permissions-label}
For hardened security we  highly recommend setting the permissions on your
ownCloud directory as strictly as possible. These commands should be executed
immediately after the initial installation. Please follow the steps in
{\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}.

These strict permissions will prevent the Updater app from working, as it needs
your whole ownCloud directory to be owned by the HTTP user. Run this script to
set the appropriate permissions for updating. Replace the \code{ocpath} variable
with the path to your ownCloud directory, and replace the \code{htuser} and
\code{htgroup} variables with your HTTP user and group.:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}!/bin/bash
\PYGZsh{} Sets permissions of the owncloud instance for updating

ocpath=\PYGZsq{}/var/www/owncloud\PYGZsq{}
htuser=\PYGZsq{}www\PYGZhy{}data\PYGZsq{}
htgroup=\PYGZsq{}www\PYGZhy{}data\PYGZsq{}

chown \PYGZhy{}R \PYGZdl{}\PYGZob{}htuser\PYGZcb{}:\PYGZdl{}\PYGZob{}htgroup\PYGZcb{} \PYGZdl{}\PYGZob{}ocpath\PYGZcb{}
\end{Verbatim}

You can find your HTTP user in your HTTP server configuration files. Or you can
use {\hyperref[issues/general_troubleshooting:label-phpinfo]{\emph{PHP Version and Information}}} (Look for the \textbf{User/Group} line).
\begin{itemize}
\item {} 
The HTTP user and group in Debian/Ubuntu is \code{www-data}.

\item {} 
The HTTP user and group in Fedora/CentOS is \code{apache}.

\item {} 
The HTTP user and group in Arch Linux is \code{http}.

\item {} 
The HTTP user in openSUSE is \code{wwwrun}, and the HTTP group is \code{www}.

\end{itemize}

After the update is completed, re-apply the strong directory permissions
immediately by running the script in {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}.


\subsection{Command Line Options}
\label{maintenance/update:updater-cli-label}\label{maintenance/update:command-line-options}
The Updater app includes command-line options to automate updates, to create
checkpoints and to roll back to older checkpoints. You must run it as your HTTP
user. This example on Ubuntu Linux displays command options:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php updater/application.php list
\end{Verbatim}

See usage for commands, like this example for the \code{upgrade:checkpoint}
command:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php updater/application.php upgrade:checkpoint \PYGZhy{}h
\end{Verbatim}

You can display a help summary:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php updater/application.php \PYGZhy{}\PYGZhy{}help
\end{Verbatim}

When you run it without options it runs a system check:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php owncloud/updater/application.php
ownCloud updater 1.0 \PYGZhy{} CLI based ownCloud server upgrades
Checking system health.
\PYGZhy{} file permissions are ok.
Current version is 9.0.0.12
No updates found online.
Done
\end{Verbatim}

Create a checkpoint:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php updater/application.php upgrade:checkpoint  \PYGZhy{}\PYGZhy{}create
Created checkpoint 9.0.0.12\PYGZhy{}56d5e4e004964
\end{Verbatim}

List checkpoints:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php updater/application.php upgrade:checkpoint \PYGZhy{}\PYGZhy{}list
\end{Verbatim}

Restore an earlier checkpoint:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php owncloud/updater/application.php upgrade:checkpoint
 \PYGZhy{}\PYGZhy{}restore=9.0.0.12\PYGZhy{}56d5e4e004964
\end{Verbatim}

Add a line like this to your crontab to automatically create daily
checkpoints:

\begin{Verbatim}[commandchars=\\\{\}]
2 15 * * * sudo \PYGZhy{}u www\PYGZhy{}data php /path/to/owncloud/updater/application.php
upgrade:checkpoint \PYGZhy{}\PYGZhy{}create \PYGZgt{} /dev/null 2\PYGZgt{}\PYGZam{}1
\end{Verbatim}


\section{Manual ownCloud Upgrade}
\label{maintenance/manual_upgrade:manual-owncloud-upgrade}\label{maintenance/manual_upgrade::doc}
\begin{notice}{warning}{Warning:}
When upgrading from oC 9.0 to 9.1 with existing Calendars or Adressbooks
please have a look at the {\hyperref[release_notes::doc]{\emph{ownCloud 9.2 Release Notes}}} of oC 9.0 for important info
about the needed migration steps during that upgrade.
\end{notice}

Always start by making a fresh backup and disabling all 3rd party apps.

Put your server in maintenance mode. This prevents new logins, locks the
sessions of logged-in users, and displays a status screen so users know what is
happening. There are two ways to do this, and the preferred method is to use the
{\hyperref[configuration_server/occ_command::doc]{\emph{occ command}}}, which you must run as
your HTTP user. This example is for Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}on
\end{Verbatim}

The other way is by entering your \code{config.php} file and changing
\code{'maintenance' =\textgreater{} false,} to \code{'maintenance' =\textgreater{} true,}.
\begin{enumerate}
\item {} 
Back up your existing ownCloud Server database, data directory, and
\code{config.php} file. (See {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}}.)

\item {} 
Download and unpack the latest ownCloud Server release (Archive file) from
\href{https://owncloud.org/install/}{owncloud.org/install/} into an empty directory outside
of your current installation.

\begin{notice}{note}{Note:}
To unpack your new tarball, run:
tar xjf owncloud-{[}version{]}.tar.bz2
\end{notice}

\end{enumerate}

\begin{notice}{note}{Note:}
Enterprise users must download their new ownCloud archives from
their accounts on \href{https://customer.owncloud.com/owncloud/}{https://customer.owncloud.com/owncloud/}
\end{notice}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
Stop your Web server.

\item {} 
Rename your current ownCloud directory, for example \code{owncloud-old}.

\item {} 
Unpacking the new archive creates a new \code{owncloud} directory populated
with your new server files. Copy this directory and its contents to the
original location of your old server, for example \code{/var/www/}, so that
once again you have \code{/var/www/owncloud}.

\item {} 
Copy the \code{config.php} file from your old ownCloud directory to your new
ownCloud directory.

\item {} 
If you keep your \code{data/} directory in your \code{owncloud/} directory, copy
it from your old version of ownCloud to your new \code{owncloud/}. If you keep
it outside of \code{owncloud/} then you don't have to do anything with it,
because its location is configured in your original \code{config.php}, and
none of the upgrade steps touch it.

\item {} 
If you are using 3rd party applications, look in your new \code{owncloud/apps/}
directory to see if they are there. If not, copy them from your old \code{apps/}
directory to your new one. Make sure the directory permissions of your third
party application directories are the same as for the other ones.

\item {} 
Restart your Web server.

\item {} 
Now launch the upgrade from the command  line using \code{occ}, like this
example on CentOS Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u apache php occ upgrade
\end{Verbatim}

\end{enumerate}
\begin{quote}

The optional parameter to skip migration tests during this step was removed in oC 9.2.
See {\hyperref[maintenance/upgrade:migration-test-label]{\emph{Migration Test}}} for background information.

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more.
\end{quote}
\begin{enumerate}
\setcounter{enumi}{10}
\item {} 
The upgrade operation takes a few minutes to a few hours, depending on the
size of your installation. When it is finished you will see a success
message, or an error message that will tell where it went wrong.

\end{enumerate}

Assuming your upgrade succeeded, disable the maintenance mode:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ maintenance:mode \PYGZhy{}\PYGZhy{}off
\end{Verbatim}

Login and take a look at the bottom of your Admin page to
verify the version number. Check your other settings to make sure they're
correct. Go to the Apps page and review the core apps to make sure the right
ones are enabled. Re-enable your third-party apps. Then apply strong
permissions to your ownCloud directories ({\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Directory Permissions}}}).


\section{Restoring ownCloud}
\label{maintenance/restore::doc}\label{maintenance/restore:owncloud-org-install}\label{maintenance/restore:restoring-owncloud}
When you install ownCloud from packages, follow these steps to restore your ownCloud installation. Start with a fresh ownCloud package installation in a new, empty directory. Then restore these items from your backup (see {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}}):
\begin{enumerate}
\item {} 
Your \code{config/} directory.

\item {} 
Your \code{data/} directory.

\item {} 
Your ownCloud database.

\item {} 
Your custom theme files, if you have any. (See \href{https://doc.owncloud.org/server/9.2/developer\_manual/core/theming.html}{Theming ownCloud})

\end{enumerate}

When you install ownCloud from the source tarballs you may safely restore your entire ownCloud installation from backup, with the exception of your ownCloud database. Databases cannot be copied, but you must use the database tools to make a correct restoration.

When you have completed your restoration, see {\hyperref[installation/installation_wizard:strong-perms-label]{\emph{Setting Strong Permissions}}}.


\subsection{Restore Directories}
\label{maintenance/restore:restore-directories}
Simply copy your configuration and data folder to your ownCloud environment. You could use this command, which restores the backup example in {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}}:

\begin{Verbatim}[commandchars=\\\{\}]
rsync \PYGZhy{}Aax config data /var/www/owncloud/
\end{Verbatim}

There are many ways to restore normal files from backups, and you may use whatever method you are accustomed to.


\subsection{Restore Database}
\label{maintenance/restore:restore-database}
\begin{notice}{note}{Note:}
This guide assumes that your previous backup is called
``owncloud-dbbackup.bak''
\end{notice}


\subsubsection{MySQL}
\label{maintenance/restore:mysql}
MySQL is the recommended database engine. To restore MySQL:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{mysql} \PYG{o}{\PYGZhy{}}\PYG{n}{h} \PYG{p}{[}\PYG{n}{server}\PYG{p}{]} \PYG{o}{\PYGZhy{}}\PYG{n}{u} \PYG{p}{[}\PYG{n}{username}\PYG{p}{]} \PYG{o}{\PYGZhy{}}\PYG{n}{p}\PYG{p}{[}\PYG{n}{password}\PYG{p}{]} \PYG{p}{[}\PYG{n}{db\PYGZus{}name}\PYG{p}{]} \PYG{o}{\PYGZlt{}} \PYG{n}{owncloud}\PYG{o}{\PYGZhy{}}\PYG{n}{dbbackup}\PYG{o}{.}\PYG{n}{bak}
\end{Verbatim}


\subsubsection{SQLite}
\label{maintenance/restore:sqlite}
\begin{Verbatim}[commandchars=\\\{\}]
rm data/owncloud.db
sqlite3 data/owncloud.db \PYGZlt{} owncloud\PYGZhy{}dbbackup.bak
\end{Verbatim}


\subsubsection{PostgreSQL}
\label{maintenance/restore:postgresql}
\begin{Verbatim}[commandchars=\\\{\}]
PGPASSWORD=\PYGZdq{}password\PYGZdq{} pg\PYGZus{}restore \PYGZhy{}c \PYGZhy{}d owncloud \PYGZhy{}h [server] \PYGZhy{}U [username]
owncloud\PYGZhy{}dbbackup.bak
\end{Verbatim}


\section{Migrating to a Different Server}
\label{maintenance/migrating:migrating-to-a-different-server}\label{maintenance/migrating::doc}
If the need arises ownCloud can be migrated to a different server. A typical use case would be a hardware change or a migration from the virtual appliance to a physical server. All migrations have to be performed with ownCloud offline and no accesses being made. Online migration is supported by ownCloud only when implementing industry-standard clustering and high-availability solutions before ownCloud is installed for the first time.

To start, let us be specific about the use case. A configured ownCloud instance runs reliably on one machine. For some reason (e.g. more powerful machine is available, but a move to a clustered environment not yet needed) the instance needs to be moved to a new machine. Depending on the size of the ownCloud instance the migration might take several hours. As a prerequisite it is assumed that the end users reach the ownCloud instance via a virtual hostname (a \code{CNAME} record in DNS) which can be pointed at the new location. It is also assumed that the authentication method (e.g. LDAP) remains the same after the migration.

\begin{notice}{warning}{Warning:}
At NO TIME any changes to the \textbf{ORIGINAL} system are required
\textbf{EXCEPT} putting ownCloud into maintenance mode.

This ensures, should anything unforeseen happen, you can go
back to your existing installation and provide your users
with a running ownCloud while debugging the problem.
\end{notice}
\begin{enumerate}
\item {} 
Set up the new machine with your desired Linux distribution. At this point you can either install ownCloud manually via the compressed archive (see {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}}, or with your Linux package manager (see {\hyperref[installation/linux_installation::doc]{\emph{Preferred Linux Installation Method}}}).

\item {} 
On the original machine turn on maintenance mode and then stop ownCloud. After waiting for 6-7 minutes for all sync clients to register the server as in maintenance mode, stop the application and/or Web server that serves ownCloud. (See {\hyperref[configuration_server/occ_command:maintenance-commands-label]{\emph{Maintenance Commands}}}.)

\item {} 
Create a dump from the database and copy it to the new machine, and import it into the new database (See {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}} and {\hyperref[maintenance/restore::doc]{\emph{Restoring ownCloud}}}).

\item {} 
Copy ONLY your data, configuration and database files from your original ownCloud instance to the new machine (See {\hyperref[maintenance/backup::doc]{\emph{Backing up ownCloud}}} and {\hyperref[maintenance/restore::doc]{\emph{Restoring ownCloud}}}).

\end{enumerate}

\begin{notice}{note}{Note:}
You must keep the \code{data/} directory's original filepath. Do not change this!
\end{notice}
\begin{enumerate}
\setcounter{enumi}{4}
\item {} 
The data files should keep their original timestamp (can be done by using \code{rsync} with \code{-t} option) otherwise the clients will re-download all the files after the migration. This step might take several hours, depending on your installation.

\item {} 
With ownCloud still in maintenance mode (confirm!) and \textbf{BEFORE} changing the \code{CNAME} record in the DNS start up the database, Web server / application server on the new machine and point your Web browser to the migrated ownCloud instance. Confirm that you see the maintenance mode notice, that a logfile entry is written by both the Web server and ownCloud and that no error messages occur. Then take ownCloud out of maintenance mode and repeat. Log in as admin and confirm normal function of ownCloud.

\item {} 
Change the \code{CNAME} entry in the DNS to point your users to the new
location.

\end{enumerate}


\chapter{Issues and Troubleshooting}
\label{issues/index::doc}\label{issues/index:issues-and-troubleshooting}

\section{General Troubleshooting}
\label{issues/general_troubleshooting:general-troubleshooting}\label{issues/general_troubleshooting::doc}
If you have trouble installing, configuring or maintaining ownCloud, please
refer to our community support channels:
\begin{itemize}
\item {} 
\href{https://central.owncloud.org}{The ownCloud Forums}

\end{itemize}

\begin{notice}{note}{Note:}
The ownCloud forums have a \href{https://central.owncloud.org/c/faq}{FAQ category} where each topic corresponds
to typical mistakes or frequently occurring issues
\end{notice}
\begin{itemize}
\item {} 
\href{https://mailman.owncloud.org/mailman/listinfo/user}{The ownCloud User mailing list}

\item {} 
The ownCloud IRC chat channel \code{irc://\#owncloud@freenode.net} on
freenode.net, also accessible via \href{http://webchat.freenode.net/?channels=owncloud}{webchat}

\end{itemize}

Please understand that all these channels essentially consist of users like you
helping each other out. Consider helping others out where you can, to contribute
back for the help you get. This is the only way to keep a community like
ownCloud healthy and sustainable!

If you are using ownCloud in a business or otherwise large scale deployment,
note that ownCloud Inc. offers the \href{https://owncloud.com/lp/community-or-enterprise/}{Enterprise Edition} with commercial
support options.


\subsection{Bugs}
\label{issues/general_troubleshooting:bugs}
If you think you have found a bug in ownCloud, please:
\begin{itemize}
\item {} 
Search for a solution (see the options above)

\item {} 
Double-check your configuration

\end{itemize}

If you can't find a solution, please use our \href{https://doc.owncloud.org/server/9.2/developer\_manual/bugtracker/index.html}{bugtracker}. You can generate a
configuration report with the {\hyperref[configuration_server/occ_command:config-commands-label]{\emph{occ config command}}}, with passwords automatically obscured.


\subsection{General Troubleshooting}
\label{issues/general_troubleshooting:id1}
Check the ownCloud {\hyperref[installation/system_requirements::doc]{\emph{System Requirements}}}, especially
supported browser versions.

When you see warnings about \code{code integrity}, refer to {\hyperref[issues/code_signing::doc]{\emph{Code Signing}}}.


\subsubsection{Disable 3rdparty / non-shipped apps}
\label{issues/general_troubleshooting:disable-3rdparty-non-shipped-apps}
It might be possible that 3rd party / non-shipped apps are causing various
different issues. Always disable 3rd party apps before upgrades, and for
troubleshooting. Please refer to the {\hyperref[configuration_server/occ_command:apps-commands-label]{\emph{Apps Commands}}} on how
to disable an app from command line.


\subsubsection{ownCloud Logfiles}
\label{issues/general_troubleshooting:owncloud-logfiles}
In a standard ownCloud installation the log level is set to \code{Normal}. To find
any issues you need to raise the log level to \code{All} in your \code{config.php}
file, or to \textbf{Everything} on your ownCloud Admin page. Please see
{\hyperref[configuration_server/logging_configuration::doc]{\emph{Logging Configuration}}} for more information on
these log levels.

Some logging - for example JavaScript console logging - needs debugging
enabled. Edit \code{config/config.php} and change \code{'debug' =\textgreater{} false,} to
\code{'debug' =\textgreater{} true,} Be sure to change it back when you are finished.

For JavaScript issues you will also need to view the javascript console. All
major browsers have developer tools for viewing the console, and you
usually access them by pressing F12. For Firefox we recommend to installing
the \href{https://getfirebug.com/}{Firebug extension}.

\begin{notice}{note}{Note:}
The logfile of ownCloud is located in the data directory
\code{owncloud/data/owncloud.log}.
\end{notice}


\subsubsection{PHP Version and Information}
\label{issues/general_troubleshooting:label-phpinfo}\label{issues/general_troubleshooting:php-version-and-information}
You will need to know your PHP version and configurations. To do this, create a
plain-text file named \textbf{phpinfo.php} and place it in your Web root, for
example \code{/var/www/html/phpinfo.php}. (Your Web root may be in a different
location; your Linux distribution documentation will tell you where.) This file
contains just this line:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php phpinfo(); ?\PYGZgt{}
\end{Verbatim}

Open this file in a Web browser by pointing your browser to
\code{localhost/phpinfo.php}:
\begin{figure}[htbp]
\centering

\includegraphics{phpinfo.png}
\end{figure}

Your PHP version is at the top, and the rest of the page contains abundant
system information such as active modules, active \code{.ini} files, and much more.
When you are finished reviewing your information you must delete
\code{phpinfo.php}, or move it outside of your Web directory, because it is a
security risk to expose such sensitive data.


\subsubsection{Debugging Sync Issues}
\label{issues/general_troubleshooting:debugging-sync-issues}
\begin{notice}{warning}{Warning:}
The data directory on the server is exclusive to ownCloud and must
not be modified manually.
\end{notice}

Disregarding this can lead to unwanted behaviours like:
\begin{itemize}
\item {} 
Problems with sync clients

\item {} 
Undetected changes due to caching in the database

\end{itemize}

If you need to directly upload files from the same server please use a WebDAV
command line client like \code{cadaver} to upload files to the WebDAV interface at:

\code{https://example.com/owncloud/remote.php/dav}


\subsubsection{Common problems / error messages}
\label{issues/general_troubleshooting:common-problems-error-messages}
Some common problems / error messages found in your logfiles as described above:
\begin{itemize}
\item {} 
\code{SQLSTATE{[}HY000{]} {[}1040{]} Too many connections} -\textgreater{} You need to increase the
connection limit of your database, please refer to the manual of your database
for more information.

\item {} 
\code{SQLSTATE{[}HY000{]}: General error: 5 database is locked} -\textgreater{} You're using
\code{SQLite}
which can't handle a lot of parallel requests. Please consider converting to
another database like described in
{\hyperref[configuration_database/db_conversion::doc]{\emph{Converting Database Type}}}.

\item {} 
\code{SQLSTATE{[}HY000{]}: General error: 2006 MySQL server has gone away} -\textgreater{} Please
refer to {\hyperref[configuration_database/linux_database_configuration:db-troubleshooting-label]{\emph{Troubleshooting}}} for more information.

\item {} 
\code{SQLSTATE{[}HY000{]} {[}2002{]} No such file or directory} -\textgreater{} There is a problem
accessing your SQLite database file in your data directory
(\code{data/owncloud.db}). Please check the permissions of this folder/file or
if it exists at all. If you're using MySQL please start your database.

\item {} 
\code{Connection closed / Operation cancelled} -\textgreater{} This could be caused by wrong
\code{KeepAlive} settings within your Apache config. Make sure that
\code{KeepAlive} is set to \code{On} and  also try to raise the limits of
\code{KeepAliveTimeout} and  \code{MaxKeepAliveRequests}.

\item {} 
\code{No basic authentication headers were found} -\textgreater{} This error is shown in your
\code{data/owncloud.log} file. Some Apache modules like \code{mod\_fastcgi}, \code{mod\_fcgid}
or \code{mod\_proxy\_fcgi} are not passing the needed authentication headers to
PHP and so the login to ownCloud via WebDAV, CalDAV and CardDAV clients is
failing. Information on how to correctly configure your environment can be
found at the \href{https://central.owncloud.org/t/no-basic-authentication-headers-were-found-message/819}{forums}.

\end{itemize}


\subsection{Troubleshooting Web server and PHP problems}
\label{issues/general_troubleshooting:troubleshooting-web-server-and-php-problems}

\subsubsection{Logfiles}
\label{issues/general_troubleshooting:logfiles}
When having issues the first step is to check the logfiles provided by PHP, the
Web server and ownCloud itself.

\begin{notice}{note}{Note:}
In the following the paths to the logfiles of a default Debian
installation running Apache2 with mod\_php is assumed. On other Web servers,
Linux distros or operating systems they can differ.
\end{notice}
\begin{itemize}
\item {} 
The logfile of Apache2 is located in \code{/var/log/apache2/error.log}.

\item {} 
The logfile of PHP can be configured in your \code{/etc/php5/apache2/php.ini}.
You need to set the directive \code{log\_errors} to \code{On} and choose the path
to store the logfile in the \code{error\_log} directive. After those changes you
need to restart your Web server.

\item {} 
The logfile of ownCloud is located in the data directory
\code{/var/www/owncloud/data/owncloud.log}.

\end{itemize}


\subsubsection{Web server and PHP modules}
\label{issues/general_troubleshooting:web-server-and-php-modules}
\begin{notice}{note}{Note:}
Lighttpd is not supported with ownCloud, and some ownCloud features
may not work at all on Lighttpd.
\end{notice}

There are some Web server or PHP modules which are known to cause various
problems like broken up-/downloads. The following shows a draft overview of
these modules:
\begin{enumerate}
\item {} 
Apache

\end{enumerate}
\begin{itemize}
\item {} 
mod\_pagespeed

\item {} 
mod\_evasive

\item {} 
mod\_security

\item {} 
mod\_reqtimeout

\item {} 
mod\_deflate

\item {} 
libapache2-mod-php5filter (use libapache2-mod-php5 instead)

\item {} 
mod\_spdy together with libapache2-mod-php5 / mod\_php (use fcgi or php-fpm
instead)

\item {} 
mod\_dav

\item {} 
mod\_xsendfile / X-Sendfile (causing broken downloads if not configured
correctly)

\end{itemize}
\begin{enumerate}
\setcounter{enumi}{1}
\item {} 
NginX

\end{enumerate}
\begin{itemize}
\item {} 
ngx\_pagespeed

\item {} 
HttpDavModule

\item {} 
X-Sendfile (causing broken downloads if not configured correctly)

\end{itemize}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
PHP

\end{enumerate}
\begin{itemize}
\item {} 
eAccelerator

\end{itemize}


\subsection{Troubleshooting WebDAV}
\label{issues/general_troubleshooting:trouble-webdav-label}\label{issues/general_troubleshooting:troubleshooting-webdav}

\subsubsection{General troubleshooting}
\label{issues/general_troubleshooting:id2}
ownCloud uses SabreDAV, and the SabreDAV documentation is comprehensive and
helpful.

See:
\begin{itemize}
\item {} 
\href{http://sabre.io/dav/faq/}{SabreDAV FAQ}

\item {} 
\href{http://sabre.io/dav/webservers}{Web servers} (Lists lighttpd as not
recommended)

\item {} 
\href{http://sabre.io/dav/large-files/}{Working with large files} (Shows a PHP
bug in older SabreDAV versions and information for mod\_security problems)

\item {} 
\href{http://sabre.io/dav/0bytes}{0 byte files} (Reasons for empty files on the
server)

\item {} 
\href{http://sabre.io/dav/clients/}{Clients} (A comprehensive list of WebDAV
clients, and possible problems with each one)

\item {} 
\href{http://sabre.io/dav/clients/finder/}{Finder, OS X's built-in WebDAV client}
(Describes problems with Finder on various Web servers)

\end{itemize}

There is also a well maintained FAQ thread available at the \href{https://central.owncloud.org/t/how-to-fix-caldav-carddav-webdav-problems/852}{ownCloud Forums}
which contains various additional information about WebDAV problems.


\subsubsection{Error 0x80070043 ``The network name cannot be found.'' while adding a network drive}
\label{issues/general_troubleshooting:error-0x80070043-the-network-name-cannot-be-found-while-adding-a-network-drive}
The windows native WebDAV client might fail with the following error message:

\begin{Verbatim}[commandchars=\\\{\}]
Error 0x80070043 \PYGZdq{}The network name cannot be found.\PYGZdq{} while adding a network drive
\end{Verbatim}

A known workaround for this issue is to update your Web server configuration. For Apache
you need to add something like the following (please update the path accordingly) to your
main Web server / Vhost configuration or the \code{.htaccess} placed in your document root:

\begin{Verbatim}[commandchars=\\\{\}]
RewriteEngine On
RewriteCond \PYGZpc{}\PYGZob{}REQUEST\PYGZus{}URI\PYGZcb{} \PYGZca{}(/)\PYGZdl{} [NC]
RewriteCond \PYGZpc{}\PYGZob{}REQUEST\PYGZus{}METHOD\PYGZcb{} \PYGZca{}(OPTIONS)\PYGZdl{}
RewriteRule .* https://\PYGZpc{}\PYGZob{}SERVER\PYGZus{}NAME\PYGZcb{}/owncloud/remote.php/webdav/ [R=301,L]
\end{Verbatim}

For nginx an example config addition could be:

\begin{Verbatim}[commandchars=\\\{\}]
location = / \PYGZob{}
    if (\PYGZdl{}http\PYGZus{}user\PYGZus{}agent = DavClnt) \PYGZob{}
        return 401;
    \PYGZcb{}
\PYGZcb{}
\end{Verbatim}


\subsection{Troubleshooting Contacts \& Calendar}
\label{issues/general_troubleshooting:troubleshooting-contacts-calendar}

\subsubsection{Service discovery}
\label{issues/general_troubleshooting:service-discovery}\label{issues/general_troubleshooting:service-discovery-label}
Some clients - especially on iOS/Mac OS X - have problems finding the proper
sync URL, even when explicitly configured to use it.

If you want to use CalDAV or CardDAV clients together with ownCloud it is
important to have a correct working setup of the following URLs:

\begin{DUlineblock}{0em}
\item[] \code{https://example.com/.well-known/carddav}
\item[] \code{https://example.com/.well-known/caldav}
\item[] 
\end{DUlineblock}

Those need to be redirecting your clients to the correct DAV endpoints. If
running ownCloud at the document root of your Web server the correct URL is:

\code{https://example.com/remote.php/dav}

and if running in a subfolder like \code{owncloud}:

\code{https://example.com/owncloud/remote.php/dav}

For the first case the \code{.htaccess} file shipped with ownCloud should do
this work for your when running Apache. You only need to make sure that your
Web server is using this file. When running NGINX please refer to
{\hyperref[installation/nginx_examples::doc]{\emph{nginx Example Configurations}}}.

If your ownCloud instance is installed in a subfolder called \code{owncloud} and
you're running Apache create or edit the \code{.htaccess} file within the
document root of your Web server and add the following lines:

\begin{Verbatim}[commandchars=\\\{\}]
Redirect 301 /.well\PYGZhy{}known/carddav /owncloud/remote.php/dav
Redirect 301 /.well\PYGZhy{}known/caldav /owncloud/remote.php/dav
\end{Verbatim}

Now change the URL in the client settings to just use:

\code{https://example.com}

instead of e.g.

\code{https://example.com/owncloud/remote.php/dav/principals/username}.

There are also several techniques to remedy this, which are described extensively at
the \href{http://sabre.io/dav/service-discovery/}{Sabre DAV website}.


\subsubsection{Unable to update Contacts or Events}
\label{issues/general_troubleshooting:unable-to-update-contacts-or-events}
If you get an error like:

\code{PATCH https://example.com/remote.php/dav HTTP/1.0 501 Not Implemented}

it is likely caused by one of the following reasons:
\begin{description}
\item[{Using Pound reverse-proxy/load balancer}] \leavevmode
As of writing this Pound doesn't support the HTTP/1.1 verb.
Pound is easily \href{http://www.apsis.ch/pound/pound\_list/archive/2013/2013-08/1377264673000}{patched}
to support HTTP/1.1.

\item[{Misconfigured Web server}] \leavevmode
Your Web server is misconfigured and blocks the needed DAV methods.
Please refer to {\hyperref[issues/general_troubleshooting:trouble-webdav-label]{\emph{Troubleshooting WebDAV}}} above for troubleshooting steps.

\end{description}


\subsection{Client Sync Stalls}
\label{issues/general_troubleshooting:client-sync-stalls}
One known reason is stray locks. These should expire automatically after an hour. If stray
locks don't expire (identified by e.g. repeated \code{file.txt is locked} and/or \code{Exception\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}FileLocked}
messages in your \code{data/owncloud.log}), make sure that you are running system cron and
not Ajax cron (See {\hyperref[configuration_server/background_jobs_configuration::doc]{\emph{Defining Background Jobs}}}).
See \href{https://github.com/owncloud/core/issues/22116}{https://github.com/owncloud/core/issues/22116} and \href{https://central.owncloud.org/t/file-is-locked-how-to-unlock/985}{https://central.owncloud.org/t/file-is-locked-how-to-unlock/985}
for some discussion and additional info of this issue.


\subsection{Other issues}
\label{issues/general_troubleshooting:other-issues}
Some services like \emph{Cloudflare} can cause issues by minimizing JavaScript
and loading it only when needed. When having issues like a not working
login button or creating new users make sure to disable such services
first.


\section{Code Signing}
\label{issues/code_signing:code-signing}\label{issues/code_signing::doc}\phantomsection\label{issues/code_signing:code-signing-label}
ownCloud supports code signing for the core releases, and for ownCloud
applications. Code signing gives our users an additional layer of security by
ensuring that nobody other than authorized persons can push updates.

It also ensures that all upgrades have been executed properly, so that no files
are left behind, and all old files are properly replaced. In the past, invalid
updates were a significant source of errors when updating ownCloud.


\subsection{FAQ}
\label{issues/code_signing:faq}

\subsubsection{Why Did ownCloud Add Code Signing?}
\label{issues/code_signing:why-did-owncloud-add-code-signing}
By supporting Code Signing we add another layer of security by ensuring that
nobody other than authorized persons can push updates for applications, and
ensuring proper upgrades.


\subsubsection{Do We Lock Down ownCloud?}
\label{issues/code_signing:do-we-lock-down-owncloud}
The ownCloud project is open source and always will be. We do not want to
make it more difficult for our users to run ownCloud. Any code signing errors on
upgrades will not prevent ownCloud from running, but will display a warning on
the Admin page. For applications that are not tagged ``Official'' the code signing
process is optional.


\subsubsection{Not Open Source Anymore?}
\label{issues/code_signing:not-open-source-anymore}
The ownCloud project is open source and always will be. The code signing
process is optional, though highly recommended. The code check for the
core parts of ownCloud is enabled when the ownCloud release version branch has
been set to stable.

For custom distributions of ownCloud it is recommended to change the release
version branch in version.php to something else than ``stable''.


\subsubsection{Is Code Signing Mandatory For Apps?}
\label{issues/code_signing:is-code-signing-mandatory-for-apps}
Code signing is optional for all third-party applications. Applications
with a tag of ``Official'' on apps.owncloud.com require code signing.


\subsection{Fixing Invalid Code Integrity Messages}
\label{issues/code_signing:fixing-invalid-code-integrity-messages}\label{issues/code_signing:code-signing-fix-warning-label}
A code integrity error message (``There were problems with the code integrity
check. More information…'') appears in a yellow banner at the top of your
ownCloud Web interface:

\includegraphics{code-integrity-notification.png}

\begin{notice}{note}{Note:}
The yellow banner is only shown for admin users.
\end{notice}

Clicking on this link will take you to your ownCloud admin page, which provides
the following options:
\begin{enumerate}
\item {} 
Link to this documentation entry.

\item {} 
Show a list of invalid files.

\item {} 
Trigger a rescan.

\end{enumerate}

\includegraphics{code-integrity-admin.png}

To debug issues caused by the code integrity check click on ``List of invalid
files...'', and you will be shown a text document listing the different issues. The
content of the file will look similar to the following example:

\begin{Verbatim}[commandchars=\\\{\}]
Technical information
=====================
The following list covers which files have failed the integrity check. Please read
the previous linked documentation to learn more about the errors and how to fix
them.

Results
=======
\PYGZhy{} core
      \PYGZhy{} INVALID\PYGZus{}HASH
              \PYGZhy{} /index.php
              \PYGZhy{} /version.php
      \PYGZhy{} EXTRA\PYGZus{}FILE
              \PYGZhy{} /test.php
\PYGZhy{} calendar
      \PYGZhy{} EXCEPTION
              \PYGZhy{} OC\PYGZbs{}IntegrityCheck\PYGZbs{}Exceptions\PYGZbs{}InvalidSignatureException
              \PYGZhy{} Signature data not found.
\PYGZhy{} tasks
      \PYGZhy{} EXCEPTION
              \PYGZhy{} OC\PYGZbs{}IntegrityCheck\PYGZbs{}Exceptions\PYGZbs{}InvalidSignatureException
              \PYGZhy{} Certificate has been revoked.

Raw output
==========
Array
(
    [core] =\PYGZgt{} Array
        (
            [INVALID\PYGZus{}HASH] =\PYGZgt{} Array
                (
                    [/index.php] =\PYGZgt{} Array
                        (
                            [expected] =\PYGZgt{}
                            f1c5e2630d784bc9cb02d5a28f55d6f24d06dae2a0fee685f3
                            c2521b050955d9d452769f61454c9ddfa9c308146ade10546c
                            fa829794448eaffbc9a04a29d216
                            [current] =\PYGZgt{}
                            ce08bf30bcbb879a18b49239a9bec6b8702f52452f88a9d321
                            42cad8d2494d5735e6bfa0d8642b2762c62ca5be49f9bf4ec2
                            31d4a230559d4f3e2c471d3ea094
                        )

                    [/version.php] =\PYGZgt{} Array
                        (
                            [expected] =\PYGZgt{}
                            c5a03bacae8dedf8b239997901ba1fffd2fe51271d13a00cc4
                            b34b09cca5176397a89fc27381cbb1f72855fa18b69b6f87d7
                            d5685c3b45aee373b09be54742ea
                            [current] =\PYGZgt{}
                            88a3a92c11db91dec1ac3be0e1c87f862c95ba6ffaaaa3f2c3
                            b8f682187c66f07af3a3b557a868342ef4a271218fe1c1e300
                            c478e6c156c5955ed53c40d06585
                        )

                )

            [EXTRA\PYGZus{}FILE] =\PYGZgt{} Array
                (
                    [/test.php] =\PYGZgt{} Array
                        (
                            [expected] =\PYGZgt{}
                            [current] =\PYGZgt{}
                            09563164f9904a837f9ca0b5f626db56c838e5098e0ccc1d8b
                            935f68fa03a25c5ec6f6b2d9e44a868e8b85764dafd1605522
                            b4af8db0ae269d73432e9a01e63a
                        )

                )

        )

    [calendar] =\PYGZgt{} Array
        (
            [EXCEPTION] =\PYGZgt{} Array
                (
                    [class] =\PYGZgt{} OC\PYGZbs{}IntegrityCheck\PYGZbs{}Exceptions\PYGZbs{}InvalidSignature
                    Exception
                    [message] =\PYGZgt{} Signature data not found.
                )

        )
    [tasks] =\PYGZgt{} Array
        (
            [EXCEPTION] =\PYGZgt{} Array
                (
                    [class] =\PYGZgt{} OC\PYGZbs{}IntegrityCheck\PYGZbs{}Exceptions\PYGZbs{}InvalidSignatureException
                    [message] =\PYGZgt{} Certificate has been revoked.
                )

        )

)
\end{Verbatim}

In above error output it can be seen that:
\begin{enumerate}
\item {} 
In the ownCloud core (that is, the ownCloud server itself) the files
``index.php'' and ``version.php'' do have the wrong version.

\item {} 
In the ownCloud core the unrequired extra file ``/test.php'' has been found.

\item {} 
It was not possible to verify the signature of the calendar application.

\item {} 
The certificate of the task application was revoked.

\end{enumerate}

You have to do the following steps to solve this:
\begin{enumerate}
\item {} 
Upload the correct ``index.php'' and ``version.php'' files from e.g. the archive of your ownCloud version.

\item {} 
Delete the ``test.php'' file.

\item {} 
Contact the developer of the application. A new version of the app containing a valid signature file needs to be released.

\item {} 
Contact the developer of the application. A new version of the app signed with a valid signature needs to be released.

\end{enumerate}

For other means on how to receive support please take a look at
\href{https://owncloud.org/support/}{https://owncloud.org/support/}. After fixing these problems verify by clicking
``Rescan…''.

\begin{notice}{note}{Note:}
When using a FTP client to upload those files make sure it is using the
\code{Binary} transfer mode instead of the \code{ASCII} transfer mode.
\end{notice}


\subsection{Rescans}
\label{issues/code_signing:rescans}\label{issues/code_signing:rescans-label}
Rescans are triggered at installation, and by updates. You may run scans manually with the \code{occ} command. The first command scans the ownCloud core files, and the second command scans the named app. There is not yet a command to manually scan all apps:

\begin{Verbatim}[commandchars=\\\{\}]
occ integrity:check\PYGZhy{}core
occ integrity:check\PYGZhy{}app \PYGZdl{}appid
\end{Verbatim}

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} to learn more about using \code{occ}.


\subsection{Errors}
\label{issues/code_signing:errors}
\begin{notice}{warning}{Warning:}
Please don't modify the mentioned \code{signature.json} itself.
\end{notice}

The following errors can be encountered when trying to verify a code signature.
\begin{itemize}
\item {} 
\code{INVALID\_HASH}
\begin{itemize}
\item {} 
The file has a different hash than specified within \code{signature.json}. This
usually happens when the file has been modified after writing the signature
data.

\end{itemize}

\item {} 
\code{MISSING\_FILE}
\begin{itemize}
\item {} 
The file cannot be found but has been specified within \code{signature.json}.
Either a required file has been left out, or \code{signature.json} needs to be
edited.

\end{itemize}

\item {} 
\code{EXTRA\_FILE}
\begin{itemize}
\item {} 
The file does not exist in \code{signature.json}. This usually happens when a
file has been removed and \code{signature.json} has not been updated. It also
happens if you have placed additional files in your ownCloud installation
folder.

\end{itemize}

\item {} 
\code{EXCEPTION}
\begin{itemize}
\item {} 
Another exception has prevented the code verification. There are currently
these following exceptions:
\begin{itemize}
\item {} 
\code{Signature data not found.{}`}
\begin{itemize}
\item {} 
The app has mandatory code signing enforced but no \code{signature.json}
file has been found in its \code{appinfo} folder.

\end{itemize}

\item {} 
\code{Certificate is not valid.}
\begin{itemize}
\item {} 
The certificate has not been issued by the official ownCloud Code
Signing Root Authority.

\end{itemize}

\item {} 
\code{Certificate is not valid for required scope. (Requested: \%s, current: \%s)}
\begin{itemize}
\item {} 
The certificate is not valid for the defined application. Certificates
are only valid for the defined app identifier and cannot be used for
others.

\end{itemize}

\item {} 
\code{Signature could not get verified.}
\begin{itemize}
\item {} 
There was a problem with verifying the signature of \code{signature.json}.

\end{itemize}

\item {} 
\code{Certificate has been revoked.}
\begin{itemize}
\item {} 
The certificate which was used to sign the application was revoked.

\end{itemize}

\end{itemize}

\end{itemize}

\end{itemize}


\chapter{Enterprise Edition Only}
\label{contents:enterprise-edition-only}

\section{Enterprise Edition Installation}
\label{enterprise_installation/index::doc}\label{enterprise_installation/index:enterprise-edition-installation}

\subsection{Installing \& Upgrading ownCloud Enterprise Edition}
\label{enterprise_installation/linux_installation:installing-upgrading-owncloud-enterprise-edition}\label{enterprise_installation/linux_installation::doc}
The recommended method for installing and maintaining your ownCloud Enterprise
edition is with your Linux package manager. Configure your package manager
to use the ownCloud Enterprise repository, import the signing key,
and then install and update ownCloud packages like any other software package.
Please refer to the \code{README - ownCloud Package Installation.txt} document in
your account at \href{https://customer.owncloud.com/owncloud/}{Customer.owncloud.com} account for instructions on setting
up your Linux package manager.

After you have completed your initial installation of ownCloud as detailed in
the README, follow the instructions in
{\hyperref[installation/installation_wizard::doc]{\emph{Installation Wizard}}} to finish setting up ownCloud.

To upgrade your Enterprise server, refer to
{\hyperref[maintenance/upgrade::doc]{\emph{How to Upgrade Your ownCloud Server}}}.


\subsubsection{Manual Installation}
\label{enterprise_installation/linux_installation:manual-installation}
Download the ownCloud archive from your account at \href{https://customer.owncloud.com/owncloud}{https://customer.owncloud.com/owncloud}, then follow the instructions at {\hyperref[installation/source_installation::doc]{\emph{Manual Installation on Linux}}}.


\subsubsection{SELinux}
\label{enterprise_installation/linux_installation:selinux}
Linux distributions that use SELinux need to take some extra steps so that
ownCloud will operate correctly under SELinux. Please see
{\hyperref[installation/selinux_configuration::doc]{\emph{SELinux Configuration}}} for some recommended configurations.


\subsection{Supported ownCloud Enterprise Edition Apps}
\label{enterprise_installation/supported_apps_installation:supported-owncloud-enterprise-edition-apps}\label{enterprise_installation/supported_apps_installation::doc}
See {\hyperref[installation/apps_supported::doc]{\emph{Supported Apps in ownCloud}}} for a list of supported apps.

\begin{notice}{note}{Note:}
3rd party and unsupported apps must be disabled before performing a
system upgrade. Then install the upgraded versions, and after the
upgrade is complete re-enable them.
\end{notice}


\subsection{License Keys}
\label{enterprise_installation/license_keys_installation::doc}\label{enterprise_installation/license_keys_installation:license-keys}

\subsubsection{Introduction}
\label{enterprise_installation/license_keys_installation:introduction}
You'll need to install a license key to use ownCloud Enterprise Edition. There
are two types of license keys: one is a free 30-day trial key. The other is a
full license key for Enterprise customers.

You can \href{https://owncloud.com/download/}{download and try ownCloud Enterprise for 30 days for free}, which auto-generates a free 30-day key. When
this key expires your ownCloud installation is not removed, so when you become
an Enterprise customer you can enter your new key to regain access. See \href{https://owncloud.com/how-to-buy-owncloud/}{How to
Buy ownCloud} for sales and
contact information.


\subsubsection{Configuration}
\label{enterprise_installation/license_keys_installation:configuration}
Once you get your Enterprise license key, it needs to be copied to your
ownCloud configuration file,
\code{config/config.php} file like this example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}license\PYGZhy{}key\PYGZsq{} =\PYGZgt{} \PYGZsq{}test\PYGZhy{}20150101\PYGZhy{}XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\PYGZhy{}YYYYYY’,
\end{Verbatim}

Each running instance of ownCloud requires a license key. Keys will work across
upgrades without issue, so new keys will not be required when you upgrade your
ownCloud Enterprise to a new version.


\subsection{Oracle Database Setup}
\label{enterprise_installation/oracle_db_configuration::doc}\label{enterprise_installation/oracle_db_configuration:oracle-database-setup}
This document will cover the setup and preparation of the ownCloud server to
support the use of Oracle as a backend database.  For the purposes of testing,
we are using Oracle Enterprise Linux as both the Web server that
will host ownCloud, and as a host for the Oracle Database.


\subsubsection{Outline of Steps}
\label{enterprise_installation/oracle_db_configuration:outline-of-steps}
This document will cover the following steps:
\begin{itemize}
\item {} 
Setup of the ownCloud user in Oracle: This involves setting up a user space
in Oracle for setting up the ownCloud database.

\item {} 
Installing the Oracle Instant Client on the Web server (facilitating the
connection to the Oracle Database).

\item {} 
Compiling and installing the Oracle PHP Plugin oci8 module

\item {} 
Pointing ownCloud at the Oracle database in the initial setup process

\end{itemize}

The document assumes that you already have your Oracle instance running, and
have provisioned the needed resources. It also assumes that you have installed
ownCloud with all of the prerequisites.


\subsubsection{Configuring Oracle}
\label{enterprise_installation/oracle_db_configuration:configuring-oracle}

\paragraph{Setting up the User Space for ownCloud}
\label{enterprise_installation/oracle_db_configuration:setting-up-the-user-space-for-owncloud}
Step one, if it has not already been completed by your \textsc{DBA} (DataBase Administrator), provision a user
space on the Oracle instance for ownCloud.  This can be done by logging in as a
DBA and running the script below:

\begin{Verbatim}[commandchars=\\\{\}]
CREATE USER owncloud IDENTIFIED BY password;
ALTER USER owncloud DEFAULT TABLESPACE users TEMPORARY TABLESPACE temp QUOTA unlimited ON users;
GRANT create session, create table, create procedure, create sequence, create trigger, create view, create synonym, alter session TO owncloud;
\end{Verbatim}

Substitute an actual password for \code{password}.  Items like TableSpace, Quota etc. will be determined by your DBA.


\paragraph{Downloading and Installing the Oracle Instant Client}
\label{enterprise_installation/oracle_db_configuration:downloading-and-installing-the-oracle-instant-client}
As our example system is Oracle Enterprise Linux, it is
necessary to go to the Oracle site and download the \href{http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html}{Oracle Instant Client} for
your OS Distribution.

\begin{notice}{note}{Note:}
Download the instant client and the instant client SDK and place them
in a directory on the server, in this example they are RPM packages.
\end{notice}
\begin{itemize}
\item {} 
Install the basic client from the RPM.  Use the \code{rpm –ivh} command

\item {} 
Install the SDK RPM package.  Use the \code{rpm –ivh} command

\end{itemize}

At this point, the Oracle Instant client is installed on the ownCloud Host (in
the home directory).


\paragraph{Install the OCI8 PHP Extension:}
\label{enterprise_installation/oracle_db_configuration:install-the-oci8-php-extension}
The next step is to compile and install the OCI8 PHP extension for connectivity to the Oracle Database.
\begin{itemize}
\item {} 
Create a folder for these bits on your server.

\item {} 
Download the latest version of the extension from \href{http://pecl.php.net/package/oci8}{http://pecl.php.net/package/oci8}.

\item {} 
Unpack the OCI8 PHP extension and copy it over to the server.

\item {} \begin{description}
\item[{There should be two things in the folder:}] \leavevmode\begin{itemize}
\item {} 
\code{package.xml} file

\item {} 
\code{oci8-*.*.*} folder (folder will change based on version of the extension you downloaded).

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Build the OCI8 module.}] \leavevmode\begin{itemize}
\item {} 
Change (\code{cd}) to the folder where you have copied the downloaded and uncompressed OCI8 bits.

\item {} 
Run the following command (there will be a significant amount of output):

\begin{Verbatim}[commandchars=\\\{\}]
pecl build
\end{Verbatim}

\end{itemize}

\end{description}
\begin{itemize}
\item {} 
Eventually the output will stop and ask for the \emph{Oracle Home Directory}, just press enter.

\end{itemize}

\item {} 
Change directory:

\begin{Verbatim}[commandchars=\\\{\}]
cd oci8\PYGZhy{}\PYGZlt{}version number\PYGZgt{}
\end{Verbatim}

\item {} 
Type the following command:

\begin{Verbatim}[commandchars=\\\{\}]
./configure –with\PYGZhy{}oci8=instantcleint,/usr/lib/oracle/\PYGZlt{}version number\PYGZgt{}/client64/lib
\end{Verbatim}

\item {} 
Again, there will be significant output

\item {} 
Enter the following command to compile: \code{make}

\item {} 
At this time there should be a folder called modules in the \code{oci8-\textless{}version\_\textgreater{}} folder.
Within this folder exists the \code{oci8.so} file.

\item {} 
Copy this to the directory where the modules are stored in the PHP install. It depends on
your distribution. This is the path for RHEL 6 and OEL 6:

\begin{Verbatim}[commandchars=\\\{\}]
cp oci8.so /usr/lib64/php/modules
\end{Verbatim}

\item {} \begin{description}
\item[{Create an \code{.ini} file}] \leavevmode\begin{itemize}
\item {} 
Navigate to the \code{php.d} directory: \code{cd /etc/php.d}

\item {} 
Edit a file called oci8.ini: \code{vi oci8.ini}

\item {} 
Make the file look as follows:

\begin{Verbatim}[commandchars=\\\{\}]
; Oracle Instant Client Shared Object
extension=oci8.so
\end{Verbatim}

\item {} 
Save the document

\end{itemize}

\end{description}

\end{itemize}


\subsubsection{Configure ownCloud}
\label{enterprise_installation/oracle_db_configuration:configure-owncloud}
The next step is to configure the ownCloud instance to point to the Oracle Database, again this document assumes
that ownCloud has previously been installed.


\paragraph{Configuration Wizard}
\label{enterprise_installation/oracle_db_configuration:configuration-wizard}
\includegraphics[width=5.778in,height=7.4165in]{oracle-1.png}


\subparagraph{Database user}
\label{enterprise_installation/oracle_db_configuration:database-user}
This is the user space created in step 2.1.
In our Example this would be owncloud.


\subparagraph{Database password}
\label{enterprise_installation/oracle_db_configuration:database-password}
Again this is defined in the script from section 2.1 above, or pre-configured and provided to you by your DBA.


\subparagraph{Database Name}
\label{enterprise_installation/oracle_db_configuration:database-name}
Represents the database or the service that has been pre-configured on the TSN Listener on the Database Server.
This should also be provided by the DBA.
In this example, the default setup in the Oracle install was orcl (there is a TSN Listener entry for orcl on our database server).

This is not like setting up with MySQL or SQL Server, where a database based on the name you give is created.
The oci8 code will call this specific service and it must be active on the TSN Listener on your Oracle Database server.


\subparagraph{Database Table Space}
\label{enterprise_installation/oracle_db_configuration:database-table-space}
Provided by the DBA.
In this example the users table space (as is seen in the user creation script above), was used.


\paragraph{Configuration File}
\label{enterprise_installation/oracle_db_configuration:configuration-file}
Assuming all of the steps have been followed to completion, the first run wizard should complete successfully, and an operating instance of ownCloud should appear.

The configuration file should look something like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZlt{}?php
\PYGZdl{}CONFIG = array (
\PYGZsq{}instanceid\PYGZsq{} =\PYGZgt{} \PYGZsq{}abcdefgh\PYGZsq{},
\PYGZsq{}passwordsalt\PYGZsq{} =\PYGZgt{} \PYGZsq{}01234567890123456789\PYGZsq{},
\PYGZsq{}datadirectory\PYGZsq{} =\PYGZgt{} \PYGZsq{}/var/data\PYGZsq{},
\PYGZsq{}dbtype\PYGZsq{} =\PYGZgt{} \PYGZsq{}oci\PYGZsq{},
\PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}8.2.x.y\PYGZsq{},
\PYGZsq{}dbname\PYGZsq{} =\PYGZgt{} \PYGZsq{}orcl\PYGZsq{},
\PYGZsq{}dbhost\PYGZsq{} =\PYGZgt{} \PYGZsq{}192.168.1.57\PYGZsq{},
\PYGZsq{}dbtableprefix\PYGZsq{} =\PYGZgt{} \PYGZsq{}oc\PYGZus{}\PYGZsq{},
\PYGZsq{}dbuser\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud1\PYGZsq{},
\PYGZsq{}dbpassword\PYGZsq{} =\PYGZgt{} \PYGZsq{}********\PYGZsq{},
\PYGZsq{}installed\PYGZsq{} =\PYGZgt{} true,
);
\end{Verbatim}


\paragraph{Useful SQL Commands}
\label{enterprise_installation/oracle_db_configuration:useful-sql-commands}
\textbf{Is my Database Reachable?}

On the machine where your Oracle database is installed, type:

\begin{Verbatim}[commandchars=\\\{\}]
sqlplus username
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
SQL\PYGZgt{} select * from v\PYGZdl{}version;

BANNER
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
Oracle Database 11g Express Edition Release 11.2.0.2.0 \PYGZhy{} 64bit Production
PL/SQL Release 11.2.0.2.0 \PYGZhy{} Production
CORE  11.2.0.2.0      Production
TNS for Linux: Version 11.2.0.2.0 \PYGZhy{} Production
NLSRTL Version 11.2.0.2.0 \PYGZhy{} Production

SQL\PYGZgt{} exit
\end{Verbatim}

\textbf{Show Database Users}:

\begin{Verbatim}[commandchars=\\\{\}]
Oracle    : SELECT * FROM all\PYGZus{}users;
\end{Verbatim}

\textbf{Show available Databases}:

\begin{Verbatim}[commandchars=\\\{\}]
Oracle    : SELECT name FROM v\PYGZdl{}database; (requires DBA privileges)
\end{Verbatim}

\textbf{Show ownCloud Tables in Database}:

\begin{Verbatim}[commandchars=\\\{\}]
Oracle    : SELECT table\PYGZus{}name FROM user\PYGZus{}tables;
\end{Verbatim}

\textbf{Quit Database}:

\begin{Verbatim}[commandchars=\\\{\}]
Oracle    : quit
\end{Verbatim}


\section{Creating Branded ownCloud Clients (Enterprise only)}
\label{enterprise_clients/index:creating-branded-owncloud-clients-enterprise-only}\label{enterprise_clients/index::doc}

\subsection{Creating Branded Client Apps (Enterprise Only)}
\label{enterprise_clients/creating_branded_apps:creating-branded-client-apps-enterprise-only}\label{enterprise_clients/creating_branded_apps::doc}

\subsubsection{Overview}
\label{enterprise_clients/creating_branded_apps:overview}
ownBrander is an ownCloud build service that is exclusive to Enterprise
customers for creating branded Android and iOS ownCloud sync apps, and branded
ownCloud desktop sync clients. You build your apps with the
ownBrander app on your \href{https://customer.owncloud.com/owncloud/}{Customer.owncloud.com} account, and within 24-48 hours
the completed, customized apps are loaded into your account. You must supply
your own artwork, and you'll find all the specifications and required elements
in ownBrander.

\includegraphics{ownbrander-1.png}


\subsubsection{Building a Branded Desktop Sync Client}
\label{enterprise_clients/creating_branded_apps:building-a-branded-desktop-sync-client}
See \href{https://doc.owncloud.com/branded\_clients/}{Building Branded ownCloud Clients (Enterprise Only)} for instructions on
building your own branded desktop sync client, and for setting up an automatic
update service.

Your users may run both a branded and un-branded desktop sync client
side-by-side. Both clients run independently of each other, and do not share
account information or files.


\subsubsection{Building a Branded iOS App}
\label{enterprise_clients/creating_branded_apps:building-a-branded-ios-app}
Building and distributing your branded iOS ownCloud app involves a large number
of interdependent steps. The process is detailed in the \href{https://doc.owncloud.com/branded\_clients/}{Building Branded
ownCloud Clients (Enterprise Only)} manual. Follow these instructions exactly
and in order, and you will have a nice branded iOS app that you can distribute
to your users.


\subsubsection{Building an Android App}
\label{enterprise_clients/creating_branded_apps:building-an-android-app}
Building and distributing your branded Android ownCloud app is fairly simple,
and the process is detailed in
\href{https://doc.owncloud.com/branded\_clients/}{Building Branded ownCloud Clients (Enterprise Only)}.


\subsection{Custom Client Download Repositories}
\label{enterprise_clients/custom_client_repos:building-branded-owncloud-clients-enterprise-only}\label{enterprise_clients/custom_client_repos::doc}\label{enterprise_clients/custom_client_repos:custom-client-download-repositories}
See {\hyperref[configuration_server/custom_client_repos::doc]{\emph{Custom Client Download Repositories}}} to learn how test and
configure custom download repository URLs for your branded clients.


\section{Enterprise Server Branding (Enterprise only)}
\label{enterprise_server_branding/index:enterprise-server-branding-enterprise-only}\label{enterprise_server_branding/index::doc}

\subsection{Custom Theming ownCloud (Enterprise only)}
\label{enterprise_server_branding/enterprise_server_branding::doc}\label{enterprise_server_branding/enterprise_server_branding:custom-theming-owncloud-enterprise-only}

\subsubsection{Overview}
\label{enterprise_server_branding/enterprise_server_branding:overview}
ownBrander is an ownCloud build service that is exclusive to Enterprise
edition customers for creating branded ownCloud clients and servers. You
may brand your ownCloud server using ownBrander to easily build a custom theme,
using your own logo and artwork. ownCloud has always been theme-able, but it was
a manual process that required editing CSS and PHP files. Now Enterprise
customers can use ownBrander, which provides an easy graphical wizard.

You need an Enterprise subscription, an account on
\href{https://customer.owncloud.com/owncloud}{Customer.owncloud.com}, and the
ownBrander app enabled on your account. When you
complete the steps in the wizard the ownBrander service builds your new branded
theme, and in 24-48 hours you'll see it in your account.
\begin{figure}[htbp]
\centering

\includegraphics{ownbrander-11.png}
\end{figure}

When you open the ownBrander app, go to the Web tab. You will see an
introduction and the wizard, which starts with uploading your logo. You will
need a number of images in specific sizes and formats, and the wizard tells you
what you need. Example images are on the right, and you can click to enlarge
them.
\begin{figure}[htbp]
\centering

\includegraphics{webbrander-1.png}
\end{figure}

\begin{notice}{note}{Note:}
If you see errors when you upload SVG files, such as ``Incorrect
extension.File type image/svg+xml is not correct'', ``This SVG is invalid'',
or ``Error uploading file: Incorrect size'', try opening the file in
\href{https://inkscape.org/en/}{Inkscape} then save as ``Plain SVG'' and
upload your SVG image again.
\end{notice}

The wizard has two sections. The first section contains all the required
elements: logos and other artwork, colors, naming, and your enterprise URL. The
Suggested section contains optional items such as additional logo placements
and custom URLs.

When you are finished, click the \textbf{Generate Web Server} button. If you want to
change anything, go ahead and change it and click the \textbf{Generate Web Server}
button. This will override your previous version, if it has not been created
yet.In 24-48 hours you'll find your new branded theme in the \textbf{Web} folder in
your \href{https://customer.owncloud.com/owncloud}{Customer.owncloud.com} account.

Inside the \textbf{Web} folder you'll find a \textbf{themes} folder. Copy this to your
\code{owncloud/themes} directory. You may name your \textbf{themes} folder anything you
want, for example \code{myBrandedTheme}. Then configure your ownCloud server to
use your branded theme by entering it in your \code{config.php} file:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdq{}theme\PYGZdq{} =\PYGZgt{} \PYGZdq{}myBrandedTheme\PYGZdq{}
\end{Verbatim}

If anything goes wrong with your new theme, comment out this line to re-enable
the default theme until you fix your branded theme. The branded theme follows
the same file structure as the default theme, and you may further customize it
by editing the source files.

\begin{notice}{note}{Note:}
Always edit only your custom theme files. Never edit the default
theme files.
\end{notice}


\section{External Storage (Enterprise only)}
\label{enterprise_external_storage/index:external-storage-enterprise-only}\label{enterprise_external_storage/index::doc}

\subsection{Enterprise-Only Authentication Options}
\label{enterprise_external_storage/enterprise_only_auth:enterprise-only-authentication-options}\label{enterprise_external_storage/enterprise_only_auth::doc}
In ownCloud 9.0+, there are five authentication backends for external storage
mounts:
\begin{itemize}
\item {} 
Username and password

\item {} 
Log-in credentials, save in session

\item {} 
Log-in credentials, save in database

\item {} 
User entered, store in database

\item {} 
Global credentials

\end{itemize}

The first two are common to all editions of ownCloud, and the last three are
only in the Enterprise edition. These are available to:
\begin{itemize}
\item {} 
FTP

\item {} 
ownCloud

\item {} 
SFTP

\item {} 
SMB/CIFS

\item {} 
WebDAV

\item {} 
Windows Network Drive

\end{itemize}
\begin{description}
\item[{Username and password}] \leavevmode
This is the default; a login entered by the admin when the external mount is
created. The login is stored in the database, which allows sharing, and
background jobs, such as file scanning, to operate.

\item[{Log-in credentials, save in session}] \leavevmode
Credentials are only stored in the session and not captured in the database.
Files cannot be shared, as credentials are not stored.

\item[{Log-in credentials, save in database}] \leavevmode
Credentials are stored in the database, and files can be shared.

\item[{User entered, store in database}] \leavevmode
Users provide their own login credentials, rather than using admin-supplied
credentials. User credentials are stored in the  database, and files can be
shared.

\item[{Global credentials}] \leavevmode
Re-usable credentials entered by the admin, files can be shared.

\end{description}

Global credentials are entered in a separate form.
\begin{figure}[htbp]
\centering

\includegraphics{auth_backends-2.png}
\end{figure}

Use the dropdown selector to choose the authentication backend when you create a
new external mount.
\begin{figure}[htbp]
\centering

\includegraphics{auth_backends.png}
\end{figure}


\subsection{LDAP Home Connector}
\label{enterprise_external_storage/ldap_home_connector_configuration:ldap-home-connector}\label{enterprise_external_storage/ldap_home_connector_configuration::doc}
The LDAP Home Connector App enables you to configure your ownCloud server
to display your users' Windows home directories on their Files pages,
just like any other folder. Typically, Windows home directories are stored
on a network server in a root folder, such as Users, which then contains
individual folders for each user.

You must already have the LDAP app enabled and a working LDAP/Active Directory
configuration in ownCloud.

Next, configure the root Windows home directory to be mounted on your ownCloud
server. Then use the LDAP Home Connector and LDAP app to connect it to ownCloud.


\subsubsection{Mount Home Directory}
\label{enterprise_external_storage/ldap_home_connector_configuration:mount-home-directory}
Create an entry in \code{/etc/fstab} for the remote Windows root home
directory mount. Store the credentials to access the home directory in a
separate file, for example \code{/etc/credentials}, with the username and
password on separate lines, like this:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{n}{username}\PYG{o}{=}\PYG{n}{winhomeuser}
\PYG{n}{password}\PYG{o}{=}\PYG{n}{winhomepassword}
\end{Verbatim}

Then add a line like this to \code{/etc/fstab}, substituting your own server
address and filenames:

\begin{Verbatim}[commandchars=\\\{\}]
//192.168.1.58/share /mnt/share cifs credentials=/etc/credentials,uid=33,gid=33
\end{Verbatim}


\subsubsection{Configure the LDAP Home Connector}
\label{enterprise_external_storage/ldap_home_connector_configuration:configure-the-ldap-home-connector}
Enable the LDAP Home Connector app. Then go to the LDAP Home Connector form
on your ownCloud admin page. In the \textbf{Display folder as:} field enter the name
as you want it to appear on your users' File pages.

Then in the \textbf{Attribute name:} field enter the LDAP attribute name that will
contain the home directory. Use any LDAP attribute that is not already in use,
then save your changes.

\includegraphics{ldap-home-connector-1.png}


\subsubsection{Configure the LDAP Server}
\label{enterprise_external_storage/ldap_home_connector_configuration:configure-the-ldap-server}
In Active Directory, open the user profile. Scroll to the \textbf{Extensions}
section and open the \textbf{Attribute Editor} tab

\includegraphics{ldap-home-connector-2.png}

Scroll to the attribute being used (UserSharedFolder in this instance), and
click \textbf{Edit}.  Enter the users home directory.

\includegraphics{ldap-home-connector-3.png}

Save your changes, and you are finished.


\subsection{Configuring SharePoint Integration}
\label{enterprise_external_storage/sharepoint-integration_configuration:configuring-sharepoint-integration}\label{enterprise_external_storage/sharepoint-integration_configuration::doc}
Native SharePoint support has been added to the ownCloud Enterprise edition as a
secondary storage location for SharePoint 2007, 2010 and 2013. When this is
enabled, users can access and sync all of their SharePoint content via ownCloud,
whether in the desktop sync, mobile or Web interfaces. Updated files are
bi-directionally synced automatically. SharePoint shares are created by the
ownCloud admin, and optionally by any users who have SharePoint credentials.

The ownCloud SharePoint plugin uses SharePoint document lists as remote storage
folders. ownCloud respects SharePoint access control lists (ACLs), so ownCloud
sharing is intentionally disabled for SharePoint mountpoints. This is to
preserve SharePoint ACLs and ensure content is properly accessed as per
SharePoint rules.

The plugin uses the Simple Object Access Protocol (SOAP) and WebDAV for the
uploads and downloads to talk to SharePoint servers.  Your ownCloud server must
have \code{php-soap} or \code{php5-soap} installed. Linux packages and ownCloud
appliances will install \code{php5-soap} as a required dependency.

The supported authentication methods are:
\begin{itemize}
\item {} 
Basic Auth

\item {} 
NTLM (Recommended)

\end{itemize}


\subsubsection{Creating a Sharepoint Mount}
\label{enterprise_external_storage/sharepoint-integration_configuration:creating-a-sharepoint-mount}
Enable the Sharepoint app, and then enter the \code{Admin} panel to set up
SharePoint connections in the \code{SharePoint Drive Configuration} section.

Enter your SharePoint Listing credentials. These credentials are not
stored in the database, but are used only during plugin setup to list the
Document Libraries available per SharePoint site.
\begin{figure}[htbp]
\centering

\includegraphics{sharepoint-1.png}
\end{figure}

\code{Global credentials} is optional. If you fill in these fields, these
credentials will be used on on all SharePoint mounts where you select: \textbf{Use
global credentials} as the authentication credentials.
\begin{figure}[htbp]
\centering

\includegraphics{sharepoint-2.png}
\end{figure}

Enter your ownCloud mountpoint in the \code{Local Folder Name} column. This is the
name of the folder that each user will see on the ownCloud filesystem. You may
use an existing folder, or enter a name to create a new mount point

Select who will have access to this mountpoint, by default \textbf{All users}, or a
user or a group.

Enter your SharePoint server URL, then click the little refresh icon to the left
of the \code{Document Library} field. If your credentials and URL are correct
you'll get a dropdown list of available SharePoint libraries. Select the
document library you want to mount.
\begin{figure}[htbp]
\centering

\includegraphics{sharepoint-3.png}
\end{figure}

Select which kind of Authentication credentials you want to use for this
mountpoint. If you select \textbf{Custom credentials} you will have to enter the
the credentials on this line. Otherwise, the global credentials or the user's
own credentials will be used. Click Save, and you're done


\subsubsection{Enabling Users}
\label{enterprise_external_storage/sharepoint-integration_configuration:enabling-users}
You may allow your users to create their own Sharepoint mounts on their
Personal pages, and allow sharing on these mounts.
\begin{figure}[htbp]
\centering

\includegraphics{sharepoint-4.png}
\end{figure}


\subsubsection{Note}
\label{enterprise_external_storage/sharepoint-integration_configuration:note}
Speed up load times by disabling file previews in \code{config.php}, because the
previews are generated by downloading the remote files to a temp file. This
means ownCloud will spend a lot of time creating previews for all of your
SharePoint content. To disable file previews, add the following line to the
ownCloud config file found in \code{/owncloud/config/config.php}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}enable\PYGZus{}previews\PYGZsq{} =\PYGZgt{} false,
\end{Verbatim}


\subsubsection{Troubleshooting}
\label{enterprise_external_storage/sharepoint-integration_configuration:troubleshooting}
SharePoint unsharing is handled in the background via Cron. If you remove the
sharing option from a Sharepoint mount, it will take a little time for the
share to be removed, until the Cron job runs

Turn on Sharepoint app logging by modifying the following line in
\code{apps/sharepoint/lib/sharepoint.php} to \code{TRUE}:

\begin{Verbatim}[commandchars=\\\{\}]
private static \PYGZdl{}enableLogs = TRUE;
\end{Verbatim}

Global mount points can't be accessed: You have to fill out your SharePoint
credentials as User on the personal settings page, or in the popup menu. These
credentials are used to mount all global mount points.

Personal mount points can't be accessed: You have to fill your SharePoint
credentials as User on the personal settings page in case your personal mount
point doesn't have its own credentials.

A user can't update the credentials: Verify that the correct credentials are
configured, and the correct type, either global or custom.


\subsection{Installing and Configuring the Windows Network Drive App}
\label{enterprise_external_storage/windows-network-drive_configuration::doc}\label{enterprise_external_storage/windows-network-drive_configuration:installing-and-configuring-the-windows-network-drive-app}
The Windows Network Drive app creates a control panel on your Admin page for
seamless mounting of SMB/CIFS file shares on ownCloud servers.

Any Windows file share, and Samba servers on Linux and other Unix-type operating
systems use the SMB/CIFS file-sharing protocol. The files and directories on the
SMB/CIFS server will be visible on your Files page just like your other ownCloud
files and folders. They are labeled with a little four-pane Windows-style icon,
and the left pane of your Files page includes a Windows Network Drive filter.
Figure 1 shows a new Windows Network Drive share marked with red warnings.
These indicate that ownCloud cannot connect to the share because it requires
the user to login, it is not available, or there is an error in the
configuration.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{wnd-1.png}
\caption{\emph{Figure 1: Windows Network Drive share on your Files page.}}\end{figure}

Files are synchronized bi-directionally, and you can create, upload, and delete
files and folders. ownCloud server admins can create Windows Network Drive
mounts, and optionally allow users to create their own personal Windows Network
Drive mounts.

Depending on the authentication method, passwords for each mount are encrypted
and stored in the ownCloud database, using a long random secret key stored in
\code{config.php}, which allows ownCloud to access the shares when the users who
own the mounts are not logged in. Or, passwords are not stored and available
only for the current session, which adds security.


\subsubsection{Installation}
\label{enterprise_external_storage/windows-network-drive_configuration:installation}
Enable the Windows Network Drive app on your ownCloud Apps page. Then there are
a few dependencies to install.

You must install \code{php-smbclient} version 0.8.0+. This should be included in most Linux distributions. See \href{https://github.com/eduardok/libsmbclient-php}{eduardok/libsmbclient-php} if your distribution does not include it; this provides source archives and instructions how to install binary packages.

You also need the Samba client installed on your Linux system. This is included in
all Linux distributions; on Debian, Ubuntu, and other Debian derivatives this
is \code{smbclient}. On SUSE, Red Hat, CentOS, and other Red Hat derivatives it is
\code{samba-client}. You also need \code{which} and \code{stdbuf}, which should be included in most Linux distributions.


\subsubsection{Creating a New Share}
\label{enterprise_external_storage/windows-network-drive_configuration:creating-a-new-share}
When you create a new WND share you need the login credentials for the share,
the server address, the share name, and the folder you want to connect to.
\begin{enumerate}
\item {} 
First enter the ownCloud mountpoint for your new WND share. This must not be
an existing folder.

\item {} 
Then select your authentication method; See {\hyperref[enterprise_external_storage/enterprise_only_auth::doc]{\emph{Enterprise-Only Authentication Options}}} for
complete information on the five available authentication methods.

\end{enumerate}
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{wnd-2.png}
\caption{\emph{Figure 2: WND mountpoint and authorization credentials.}}\end{figure}
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
Enter the address of the server that contains the WND share.

\item {} 
The Windows share name.

\item {} 
The root folder of the share. This is the folder name, or the
\code{\$user} variable for user's home directories. Note that the LDAP
\code{Internal Username Attribute} must be set to the \code{samaccountname} for
either the share or the root to work, and the user's home directory needs
to match the \code{samaccountname}. (See
{\hyperref[configuration_user/user_auth_ldap::doc]{\emph{User Authentication with LDAP}}}.)

\item {} 
Login credentials.

\item {} 
Select users or groups with access to the share. The default is all users.

\item {} 
Click the gear icon for additional mount options. Note that encryption is
enabled by default, while sharing is not. Sharing is not available for all
authorization methods; see {\hyperref[enterprise_external_storage/enterprise_only_auth::doc]{\emph{Enterprise-Only Authentication Options}}}.

\end{enumerate}
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{wnd-3.png}
\caption{\emph{Figure 3: WND server, credentials, and additional mount options.}}\end{figure}

Your changes are saved automatically.

\begin{notice}{note}{Note:}
When you create a new mountpoint using Login credentials you must log
out of ownCloud, and then log back in so you can access the share. You
only have to do this the first time.
\end{notice}


\subsubsection{Personal WND Mounts}
\label{enterprise_external_storage/windows-network-drive_configuration:personal-wnd-mounts}
Users create their own personal WND mounts on their Personal pages. These are
created the same way as Admin-created shares. Users have four options for
login credentials:
\begin{itemize}
\item {} 
Username and password

\item {} 
Log-in credentials, save in session

\item {} 
Log-in credentials, save in database

\item {} 
Global credentials

\end{itemize}


\subsubsection{libsmclient Issues}
\label{enterprise_external_storage/windows-network-drive_configuration:libsmclient-issues}
If your Linux distribution ships with \code{libsmbclient 3.x}, which is included in
the Samba client, you may need to set up the HOME variable in Apache to prevent
a segmentation fault. If you have \code{libsmbclient 4.1.6} and higher it doesn't
seem to be an issue, so you won't have to change your HOME variable.

To set up the HOME variable on Ubuntu, modify the \code{/etc/apache2/envvars}
file:

\begin{Verbatim}[commandchars=\\\{\}]
unset HOME
export HOME=/var/www
\end{Verbatim}

In Red Hat/CentOS, modify the \code{/etc/sysconfig/httpd} file and add the
following line to set the HOME variable in Apache:

\begin{Verbatim}[commandchars=\\\{\}]
export HOME=/usr/share/httpd
\end{Verbatim}

By default CentOS has activated SELinux, and the \code{httpd} process can not make
outgoing network connections. This will cause problems with the \code{curl},
\code{ldap}
and \code{samba} libraries. You'll need to get around this in order to make
this work. First check the status:

\begin{Verbatim}[commandchars=\\\{\}]
getsebool \PYGZhy{}a \textbar{} grep httpd
httpd\PYGZus{}can\PYGZus{}network\PYGZus{}connect \PYGZhy{}\PYGZhy{}\PYGZgt{} off
\end{Verbatim}

Then enable support for network connections:

\begin{Verbatim}[commandchars=\\\{\}]
setsebool \PYGZhy{}P httpd\PYGZus{}can\PYGZus{}network\PYGZus{}connect 1
\end{Verbatim}

In openSUSE, modify the \code{/usr/sbin/start\_apache2} file:

\begin{Verbatim}[commandchars=\\\{\}]
export HOME=/var/lib/apache2
\end{Verbatim}

Restart Apache, open your ownCloud Admin page and start creating SMB/CIFS
mounts.


\subsection{Windows Network Drive Listener}
\label{enterprise_external_storage/windows-network-drive_configuration:windows-network-drive-listener}
The SMB protocol supports registering for notifications of file changes on remote Windows SMB storage servers. Notifications are more efficient than polling for changes, as polling requires scanning the whole SMB storage. ownCloud supports SMB notifications with an \code{occ} command, \code{occ wnd:listen}.

\begin{notice}{note}{Note:}
The notifier only works with remote storages on Windows servers. It does not work reliably with Linux servers due to technical limitations.
\end{notice}

Your \code{smbclient} versions needs to be 4.x, as older versions do not support notifications.

The ownCloud server needs to know about changes of files on integrated storages so that the changed files will be synced to the ownCloud server, and to desktop sync clients. Files changed through the ownCloud Web interface or sync clients are automatically updated in the ownCloud filecache, but this is not possible when files are changed directly on remote SMB storage mounts.

To create a new SMB notification, start a listener on your ownCloud server with \code{occ wnd:listen}. The listener marks changed files, and a background job updates the file metadata.


\subsubsection{Setup Notifications for an SMB Share}
\label{enterprise_external_storage/windows-network-drive_configuration:setup-notifications-for-an-smb-share}
If you don't already have an SMB share, you must create one. Then start the listener with this command, like this example for Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data php occ wnd:listen \PYGZlt{}host\PYGZgt{} \PYGZlt{}share\PYGZgt{} \PYGZlt{}username\PYGZgt{} [password]
\end{Verbatim}

The \code{host} is your remote SMB server, which must be exactly the same as the server name in your WND configuration on your ownCloud Admin page. \code{share} is the share name, and \code{username} and \code{password} are the login credentials for the share. By default there is no output. Enable verbosity to see the notifications:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ wnd:listen \PYGZhy{}v server share useraccount
Please enter the password to access the share:
File removed : Capirotes/New Text Document.txt
File modified : Capirotes
File added : Capirotes/New Text Document.txt
File modified : Capirotes
File renamed : old name : Capirotes/New Text Document.txt
File renamed : new name : Capirotes/New Document.txt
\end{Verbatim}

Enable increased verbosity to see debugging messages, including which storages are updated and timing:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ wnd:listen \PYGZhy{}vvv server share useraccount
Please enter the password to access the share:
notification received in 1471450242
File removed : Capirotes/New Document.txt
found 1 related storages from mount id 1
updated storage wnd::admin@server/share// from mount id 1 \PYGZhy{}\PYGZgt{} removed internal path : Capirotes/New Document.txt
found 1 related storages from mount id 3
updated storage wnd::administrador@server/share// from mount id 3 \PYGZhy{}\PYGZgt{} removed internal path : Capirotes/New Document.txt
found 1 related storages from mount id 2
\end{Verbatim}

See {\hyperref[configuration_server/occ_command::doc]{\emph{Using the occ Command}}} for detailed help with \code{occ}.


\subsubsection{One Listener for Many Shares}
\label{enterprise_external_storage/windows-network-drive_configuration:one-listener-for-many-shares}
As the ownCloud server admin you can setup an SMB share for all of your users with a \code{\$user}
template variable in the root path. By using a ServiceUser you can listen to the common share path. The ServiceUser is any user with access to the share. You might create a special read-only user account to use in this case.

Example:

Share \code{/home} contains folders for every user, e.g. \code{/home/alice}
and \code{/home/bob}. So the admin configures the Windows Network Drive external storage with these values:
\begin{itemize}
\item {} 
Folder name: home

\item {} 
Storage Type: Windows Network Drive

\item {} 
Authentication: Log-in credentials, save in database

\item {} 
Configuration
\code{host: "172.18.16.220", share: "home", remote subfolder: "\$user", domain: ""}

\end{itemize}

Then starts the \code{wnd:listen} thread:

\begin{Verbatim}[commandchars=\\\{\}]
sudo \PYGZhy{}u www\PYGZhy{}data occ wnd:listen 172.18.16.220 home ServiceUser Password
\end{Verbatim}

Changes made by Bob or Alice made directly on the storage are now detected by the ownCloud server.


\subsubsection{Running the WND Listener as a Service}
\label{enterprise_external_storage/windows-network-drive_configuration:running-the-wnd-listener-as-a-service}
See \href{https://github.com/owncloud/documentation/wiki/Configuring-wnd:listen-to-run-as-a-service}{Configuring wnd:listen to run as a service} in the documentation wiki for tips on running the listenera as a service via cron, and by creating a Systemd startup script.


\subsection{Configuring S3 and OpenStack Swift Objects as Primary Storage}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:configuring-s3-and-openstack-swift-objects-as-primary-storage}\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration::doc}
In ownCloud Enterprise edition, you can configure S3 objects as primary
storage. This replaces the default ownCloud \code{owncloud/data} directory. You may
still need to keep the \code{owncloud/data} directory for these reasons:
\begin{itemize}
\item {} 
The ownCloud log file is saved in the data directory

\item {} 
Legacy apps may not support using anything but the \code{owncloud/data} directory

\end{itemize}

You can move your logfile by changing its location in \code{config.php}. You may still need
\code{owncloud/data} for backwards compatibility with some apps.


\subsubsection{Implications}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:implications}
ownCloud in object store mode expects exclusive access to the object store
container, because it only stores the binary data for each file. The metadata
are kept in the local database for performance reasons.

The current implementation is incompatible with any app that uses
direct file I/O and circumvents the ownCloud virtual filesystem. That includes
Encryption and Gallery. Gallery stores thumbnails directly in the
filesystem, and Encryption causes severe overhead because key files need
to be fetched in addition to any requested file.


\subsubsection{Configuration}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:configuration}
Look in \code{config.sample.php} for a example configurations. Copy the
relevant part to your \code{config.php} file. Any object store needs to implement
\code{\textbackslash{}\textbackslash{}OCP\textbackslash{}\textbackslash{}Files\textbackslash{}\textbackslash{}ObjectStore\textbackslash{}\textbackslash{}IObjectStore} and can be passed parameters in the
constructor with the \code{arguments} key:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZsq{} =\PYGZgt{} [
    \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}Implementation\PYGZbs{}\PYGZbs{}Of\PYGZbs{}\PYGZbs{}OCP\PYGZbs{}\PYGZbs{}Files\PYGZbs{}\PYGZbs{}ObjectStore\PYGZbs{}\PYGZbs{}IObjectStore\PYGZsq{},
    \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} [
        ...
    ],
],
\end{Verbatim}


\paragraph{Amazon S3}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:amazon-s3}
The S3 backend mounts a bucket of the Amazon S3 object store
into the virtual filesystem. The class to be used is \code{OCA\textbackslash{}ObjectStore\textbackslash{}S3}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZsq{} =\PYGZgt{} [
    \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OCA\PYGZbs{}ObjectStore\PYGZbs{}S3\PYGZsq{},
    \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} [
        // replace with your bucket
        \PYGZsq{}bucket\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
        \PYGZsq{}autocreate\PYGZsq{} =\PYGZgt{} true,
        // uncomment to enable server side encryption
        //\PYGZsq{}serversideencryption\PYGZsq{} =\PYGZgt{} \PYGZsq{}AES256\PYGZsq{},
        \PYGZsq{}options\PYGZsq{} =\PYGZgt{} [
            // version and region are required
            \PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}2006\PYGZhy{}03\PYGZhy{}01\PYGZsq{},
            // change to your region
            \PYGZsq{}region\PYGZsq{}  =\PYGZgt{} \PYGZsq{}eu\PYGZhy{}central\PYGZhy{}1\PYGZsq{},
            \PYGZsq{}credentials\PYGZsq{} =\PYGZgt{} [
                // replace key and secret with your credentials
                \PYGZsq{}key\PYGZsq{} =\PYGZgt{} \PYGZsq{}EJ39ITYZEUH5BGWDRUFY\PYGZsq{},
                \PYGZsq{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}M5MrXTRjkyMaxXPe2FRXMTfTfbKEnZCu+7uRTVSj\PYGZsq{},
            ],
        ],
    ],
],
\end{Verbatim}


\paragraph{Ceph S3}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:ceph-s3}
The S3 backend can also be used to mount the bucket of a ceph object store via the s3 API
into the virtual filesystem. The class to be used is \code{OCA\textbackslash{}ObjectStore\textbackslash{}S3}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZsq{} =\PYGZgt{} [
    \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OCA\PYGZbs{}ObjectStore\PYGZbs{}S3\PYGZsq{},
    \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} [
        // replace with your bucket
        \PYGZsq{}bucket\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
        \PYGZsq{}autocreate\PYGZsq{} =\PYGZgt{} true,
        \PYGZsq{}options\PYGZsq{} =\PYGZgt{} [
            // version and region are required
            \PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}2006\PYGZhy{}03\PYGZhy{}01\PYGZsq{},
            \PYGZsq{}region\PYGZsq{}  =\PYGZgt{} \PYGZsq{}\PYGZsq{},
            // replace key, secret and bucket with your credentials
            \PYGZsq{}credentials\PYGZsq{} =\PYGZgt{} [
                // replace key and secret with your credentials
                \PYGZsq{}key\PYGZsq{}    =\PYGZgt{} \PYGZsq{}EJ39ITYZEUH5BGWDRUFY\PYGZsq{},
                \PYGZsq{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}M5MrXTRjkyMaxXPe2FRXMTfTfbKEnZCu+7uRTVSj\PYGZsq{},
            ],
            // replace the ceph endpoint with your rgw url
            \PYGZsq{}endpoint\PYGZsq{} =\PYGZgt{} \PYGZsq{}http://cephhost:8000/\PYGZsq{},
            // Use path style when talking to ceph
            \PYGZsq{}command.params\PYGZsq{} =\PYGZgt{} [
                \PYGZsq{}PathStyle\PYGZsq{} =\PYGZgt{} true,
            ],
        ],
    ],
],
\end{Verbatim}


\subsubsection{S3 Multibucket Configuration}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:s3-multibucket-configuration}
ownCloud 9.1+ has multibucket support for S3 object stores:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZus{}multibucket\PYGZsq{} =\PYGZgt{} [
   \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OCA\PYGZbs{}ObjectStore\PYGZbs{}S3\PYGZsq{},
   \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} [
       \PYGZsq{}autocreate\PYGZsq{} =\PYGZgt{} true,
       \PYGZsq{}options\PYGZsq{} =\PYGZgt{} [
           \PYGZsq{}version\PYGZsq{} =\PYGZgt{} \PYGZsq{}2006\PYGZhy{}03\PYGZhy{}01\PYGZsq{},
           \PYGZsq{}region\PYGZsq{}  =\PYGZgt{} \PYGZsq{}eu\PYGZhy{}central\PYGZhy{}1\PYGZsq{},
           \PYGZsq{}credentials\PYGZsq{} =\PYGZgt{} [
               \PYGZsq{}key\PYGZsq{} =\PYGZgt{} \PYGZsq{}EJ39ITYZEUH5BGWDRUFY\PYGZsq{},
               \PYGZsq{}secret\PYGZsq{} =\PYGZgt{} \PYGZsq{}M5MrXTRjkyMaxXPe2FRXMTfTfbKEnZCu+7uRTVSj\PYGZsq{},
           ],
       ],
   ],
],
\end{Verbatim}


\paragraph{OpenStack Swift}
\label{enterprise_external_storage/s3_swift_as_primary_object_store_configuration:openstack-swift}
The Swift backend mounts a container on an OpenStack Object Storage server
into the virtual filesystem. The class to be used is \code{\textbackslash{}\textbackslash{}OC\textbackslash{}\textbackslash{}Files\textbackslash{}\textbackslash{}ObjectStore\textbackslash{}\textbackslash{}Swift}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}objectstore\PYGZsq{} =\PYGZgt{} [
    \PYGZsq{}class\PYGZsq{} =\PYGZgt{} \PYGZsq{}OC\PYGZbs{}\PYGZbs{}Files\PYGZbs{}\PYGZbs{}ObjectStore\PYGZbs{}\PYGZbs{}Swift\PYGZsq{},
    \PYGZsq{}arguments\PYGZsq{} =\PYGZgt{} [
        \PYGZsq{}username\PYGZsq{} =\PYGZgt{} \PYGZsq{}demo\PYGZsq{},
        \PYGZsq{}password\PYGZsq{} =\PYGZgt{} \PYGZsq{}password\PYGZsq{},
        \PYGZsq{}container\PYGZsq{} =\PYGZgt{} \PYGZsq{}owncloud\PYGZsq{},
        \PYGZsq{}autocreate\PYGZsq{} =\PYGZgt{} true,
        \PYGZsq{}region\PYGZsq{} =\PYGZgt{} \PYGZsq{}RegionOne\PYGZsq{},
        \PYGZsq{}url\PYGZsq{} =\PYGZgt{} \PYGZsq{}http://devstack:5000/v2.0\PYGZsq{},
        \PYGZsq{}tenantName\PYGZsq{} =\PYGZgt{} \PYGZsq{}demo\PYGZsq{},
        \PYGZsq{}serviceName\PYGZsq{} =\PYGZgt{} \PYGZsq{}swift\PYGZsq{},
        // url Type, optional, public, internal or admin
        \PYGZsq{}urlType\PYGZsq{} =\PYGZgt{} \PYGZsq{}internal\PYGZsq{}
    ],
],
\end{Verbatim}


\subsection{Jive Integration}
\label{enterprise_external_storage/jive_configuration:jive-integration}\label{enterprise_external_storage/jive_configuration::doc}
The Jive application allows Jive users to access files stored in Jive
from a mobile device, tablet, or desktop client. Users have complete access
through ownCloud Enterprise edition to upload, edit or download their files.

Jive can be configured as a data storage location for ownCloud, which means
files saved in Jive appear in folders within ownCloud. Jive remains the system
of record while ownCloud acts as a proxy, providing end-to-end file access for
users at their desks and on the go.


\subsubsection{Configuration}
\label{enterprise_external_storage/jive_configuration:configuration}
The Jive application is installed under the owncloud/apps directory on the server and enabled via the ownCloud
admin screen. This app is only available for ownCloud EE v6 or higher. Go to the ownCloud admin screen section
“Jive backend parameters” to configure the app to match your Jive server system parameters.

\includegraphics{jive_config.png}

\begin{tabulary}{\linewidth}{|L|L|L|}
\hline

Parameter
 & 
Description
 & 
Values
\\
\hline
Https
 & 
Verify the https server certificate. Certificate must be installed on the system.
 & 
Checkbox – enabled/disable
\\
\hline
Authentication
 & 
Chose the Authentication mechanism to use against Jive
 & 
basic OR oAuth
\\
\hline
Jive api url
 & 
URL string pointing to the Jive API
 & 
Example: \href{https://mycompany.jiveon.com/api/core/v3/}{https://mycompany.jiveon.com/api/core/v3/}
\\
\hline
Jive FS mount point
 & 
Folder where the Jive File share will be mounted
 & 
String value up to 10 characters max
\\
\hline
Jive category filter
 & 
List of categories that files have to be shown
 & 
Jive categories list, or blank
\\
\hline
Jive category separator
 & 
Separator for Jive catagories list
 & 
Comma by default or any single character
\\
\hline
Jive tag filter
 & 
Tag to use for private stuff in jive
 & 
Jive tag or blank
\\
\hline
Jive forbidden extensions
 & 
List of forbidden extensions

These will not be allowed for upload or download with Jive.
 & 
Examples include: .exe,.zip
\\
\hline
Jive forbidden extensions separator
 & 
Use this character to separate the list of extensions
 & 
Comma by default or any single character
\\
\hline
Jive maximum upload filesize
 & 
Maximum file size allowed in MB. This includes upload and downloads.
 & 
Numeric value
\\
\hline
Jive private folder
 & 
Folder name for private stuff in Jive
 & 
String value up to 250 characters max
\\
\hline
Activate large file sharing for Jive
 & 
Enable the large file sharing subsystem. This allows storage of files that are too large for Jive to be stored on the ownCloud server and available via the ownCloud web, mobile and desktop interfaces.
 & 
Checkbox – enable/disable
\\
\hline
Jive large file sharing FS mount point
 & 
Folder where the Jive large sharing File Share will be mounted
 & 
String value up to 10 characters max
\\
\hline
Show groups of which you are a member
 & 
If this is not checked, the plugin will show all available groups for you matching the filter, even groups that you are not a member
 & 
Enable/disable
\\
\hline\end{tabulary}



\subsubsection{Use Cases}
\label{enterprise_external_storage/jive_configuration:use-cases}
The ownCloud Jive plugin can be used in various ways to extend the access to the Jive content across multiple devices.


\paragraph{Web Client Use Cases}
\label{enterprise_external_storage/jive_configuration:web-client-use-cases}
\includegraphics[width=3.2398in,height=2.9898in]{jive_2.png}
\begin{itemize}
\item {} 
Create a folder in the “Jive File Share” Web Client folder to create a new Jive Group.
\begin{itemize}
\item {} 
Verify the Group is created in Jive.

\end{itemize}

\item {} 
Create a new Group in Jive and upload a file to that Group.
\begin{itemize}
\item {} 
Check the Web Client and download the file.

\item {} 
Verify that file is the same as the uploaded file.

\end{itemize}

\item {} 
Upload a file in the “Too Big For” Jive folder, and create the link in a Jive document.
\begin{itemize}
\item {} 
Verify that file link is in Jive.

\item {} 
Download the file via the link, and verify it is the same as the uploaded file.

\end{itemize}

\item {} 
Upload a file to the private “My Jive” Web Client folder.
\begin{itemize}
\item {} 
Check your Jive content and make sure the file has been uploaded.

\item {} 
Download the file and verify it is the same as the uploaded file.

\end{itemize}

\end{itemize}


\paragraph{Mobile Client Use Cases (iOs and Android)}
\label{enterprise_external_storage/jive_configuration:mobile-client-use-cases-ios-and-android}
Create a new folder in the Mobile Client to create a new Jive Group.

Upload a file in the Web Client folder, and see that file in the corresponding Jive Group.


\paragraph{Desktop Client Use Cases}
\label{enterprise_external_storage/jive_configuration:desktop-client-use-cases}
Create a folder in the Desktop Client to create a new Jive Group.

Upload a file in the Desktop Client folder, and see that file in the corresponding Jive Group.

The ownCloud folder structure hierarchy matches the Jive Groups the user can access. Sub folders under the Jive Group
folders that are created on the desktop will not sync to ownCloud or Jive because they will not match the Jive “Group”
view. If a sub folder is created under the Jive Group desktop folder, the desktop client will display an error that
this operation is not allowed. For example; if the folder structure is “JiveFileShare/GroupA”, any sub folder under
GroupA will not be synced to ownCloud or Jive.


\subsubsection{Configuring the Jive app}
\label{enterprise_external_storage/jive_configuration:configuring-the-jive-app}
This section explains how each configuration parameter changes the behavior of the app.


\paragraph{Verify https certificate}
\label{enterprise_external_storage/jive_configuration:verify-https-certificate}
If your Jive server is under https, it must provide a https certificate when a client connects to it. Curl (the client
that ownCloud is using to connect to Jive) usually verify that certificate, but to do that you must somehow supply
a CA cert so curl can verify against.

This feature is usually turn off to make the Jive app easier to use, because in this case curl won't verify the
certificate, so you don't need to have installed the CA cert. However, turning this off could be a security issue:
you could be connecting to a fake Jive server without notice.

If you want to turn on this feature, you must get the CA cert of the server (check “
\href{http://curl.haxx.se/docs/sslcerts.html}{http://curl.haxx.se/docs/sslcerts.html}
” for more information about how you can get the file you need)
and install it in your ownCloud server.

In order to know where you should install the CA cert, you can run

curl -v
\href{https://yourserver.com/}{https://yourserver.com/}

You should look the output for a line with the CA path:
\begin{itemize}
\item {} 
successfully set certificate verify locations:

\item {} 
CAfile: none

\item {} 
CApath: /etc/ssl/certs

\end{itemize}

That's the place where you should install the CA cert.

Once you have installed the CA cert, you should run again the same curl:

curl -v
\href{https://yourserver.com/}{https://yourserver.com/}

And look for:
\begin{itemize}
\item {} 
Server certificate:

\item {} 
subject: \textbf{*****}

\item {} 
start date: \textbf{*******}

\item {} 
expire date: \textbf{*****}

\item {} 
subjectAltName: \textbf{*******}

\item {} 
issuer: \textbf{******}

\item {} 
SSL certificate verify ok.

\end{itemize}

If the SSL is verified correctly (“SSL certificate verify ok.”), you just need to activate the checkbox.

Curl usually comes installed with some CA certs by default, so all the previous steps might not be needed. Just check
that curl can connect to your Jive server, and if so, activate this feature.


\paragraph{Authentication mechanism to use against Jive}
\label{enterprise_external_storage/jive_configuration:authentication-mechanism-to-use-against-jive}
To be able to access to Jive, the ownCloud plugin needs to use some kind of authentication. At this time, the plugin
supports basic and oAuth authentication.


\subparagraph{Basic authentication}
\label{enterprise_external_storage/jive_configuration:basic-authentication}
In order to use basic authentication, you should take into account the following things:
\begin{itemize}
\item {} 
The credentials used to access to ownCloud must match the ones used to connect to Jive. This means that if you
access to ownCloud with a user “PeterP” and password “PeterPassword”, the same user must exist in Jive with the same
password. Otherwise, the user won't be able to access to Jive.

\item {} 
If the credentials (typically the password) changes in one side, it must change in the other. You'll need to this manually.

\end{itemize}

The usage of basic authentication isn't recommended due to the following reasons:
\begin{itemize}
\item {} 
We need to store the password and be able to recover it. Although the password is stored encrypted, this is
not strictly secure.

\item {} 
Passwords are sent to the server in almost plain text. In fact it's a base64 encoded string of user and password,
but that's all the security the authentication provides.

\end{itemize}

If you plan to use basic authentication, at least make sure you connect through HTTPS protocol and inside a local LAN if possible.


\subparagraph{oAuth authentication}
\label{enterprise_external_storage/jive_configuration:oauth-authentication}
First of all, make sure Jive is prepared to support this authentication.

The usage of this authentication method solves the issue of having the same credentials in both ownCloud and Jive
server. This means that the ownCloud user “PeterP” with password “PeterPassword” can access to the contents of the Jive
user “John” with password “John007”. It's also possible that another ownCloud user “AliceK” access to the contents of
the Jive user “John” too at the same time.

Keep in mind that this isn't insecure: any ownCloud user that wants to access to John's Jive content (following
this little example) MUST know his Jive password.

If this authentication method is set, we don't store passwords BUT we still need to store some other things. These things are stored in plain text.

These are the steps to make it work (if your Jive server support this authentication):
\begin{enumerate}
\item {} 
Activate the oAuth authentication in the ownCloud admin settings (just the admin can do this)

\item {} 
Go to the ownCloud web interface, in the files app. A popup will appear.

\item {} 
Click on the link that appear in the popup

\item {} 
You'll get redirected to a Jive page asking for your Jive credentials. If this is not the case, it's recommended
to clean the browser cache and start again (to point 2) because you might be accessing to Jive with another user.

\item {} 
After entering your Jive credentials, you get redirected a page with an activation code. If you entered the
wrong credentials, you might not get redirected to that page. If this is the case click
in the link again in the ownCloud popup (point 3) which will redirect you to the activation code page.

\item {} 
Copy the activation code into the ownCloud popup,
and click in the “send code” button. If there is no error, you're done.

\end{enumerate}

WARNING:

Not all the oAuth flows are covered by the plugin. The expiration of the access token is handled automatically by
the plugin, so it will request a new access token if needed. HOWEVER, the expiration of the refresh token isn't
covered, so the plugin will likely stop working for that user (we won't be able to get more access tokens)

{[}Ask for info to know how to solve this issue?{]}

It's very important that the user access to ownCloud through the web interface first, so the user goes through
the oAuth flow for the first time (as described with the steps above) to get an access token. Otherwise, the
plugin won't get an access token and the user won't be able to get the files from Jive.


\paragraph{Jive API URL}
\label{enterprise_external_storage/jive_configuration:jive-api-url}
You'll need to enter the full URL of the Jive API. This includes the protocol (HTTP or HTTPS) and the port (if any).

An example of API URL could be: “
\href{https://myjiveserver.com/api/core/v3/}{https://myjiveserver.com/api/core/v3/}
”

Notice the following things:
\begin{itemize}
\item {} 
You must specify a protocol that is understandable by curl. Under normal circumstances, the protocol is limited to HTTP or HTTPS.

\item {} 
If your server is under a port different than the 80, you'll need to specify it. Take “
\href{https://jserver.prv:9999/api/core/v3/}{https://jserver.prv:9999/api/core/v3/}
” as an example

\item {} 
If your server isn't under the root URL, you can also specify the correct path: “
\href{https://myserver.prv:8888/path/to/jive/api/core/v3/}{https://myserver.prv:8888/path/to/jive/api/core/v3/}
”

\item {} 
The API URL should end with “/api/core/v3/” (be careful with the slash at the end)

\end{itemize}


\paragraph{Filters}
\label{enterprise_external_storage/jive_configuration:filters}
The Jive plugin comes with a set of filters that the admin can set to filter the content the users can access
through ownCloud. The drawback of using filters is that there isn't any performance gain because the filtering
is mainly done in the ownCloud side, and even can degrade performance in some cases. We'll explain the filters
one by one, and tell you what consequences have each one.


\subparagraph{Category filter and separator}
\label{enterprise_external_storage/jive_configuration:category-filter-and-separator}
You can filter files using one or several categories. This filter applies only to groups and files
inside those groups.
Your private files won't be affected by this filter.

In order to set this filter, you can provide a list of categories, all in one line. In order to separate the
different categories, you must use the separator set in the “category separator” text box.
\begin{quote}

Jive category filter : syncWithMe,sync,syncMe

Jive category separator : ,
\end{quote}

You can also achieve the same behavior with:
\begin{quote}

Jive category filter : syncWithMe\#sync\#syncMe

Jive category separator : \#
\end{quote}

The plugin will show all groups which have ALL those categories set. If there is a group with any of the
categories missing, that group won't be shown. Anyway, you should only need to set one category.

It's important to notice that, although you can set only one category or leave the text box empty, the
category separator MUST always be set. In fact, you shouldn't need to change the default value of the category separator.

Files shown inside those groups will be also affected by this filter. This means that all the files
shown inside those groups must have all the categories too.

Files uploaded through ownCloud to those groups will have all the categories set in Jive automatically.
If you want to add more categories to those files, you'll need to do it manually through Jive.

The usage of the category filter can degrade the performance a lot.
We need to make extra calls to Jive to get the categories for each group, one extra call per group returned by Jive in the first place.
There is also the limitation of not having more than 25 categories set per group.
Use this filter with extreme caution.

You can “disable” this filter just by setting the category filter empty. This will prevent the extra call from
being made, and will show all available groups.


\subparagraph{Tag filter}
\label{enterprise_external_storage/jive_configuration:tag-filter}
This filter works only for private files. Files inside groups won't be affected by this filter.

You can only set one tag for the files that will be shown in ownCloud. Make sure you set one of the tags from Jive
as they're shown there. It's highly recommended to use only lowercase letters to set the tag to prevent possible
issues when the tag is set in Jive.

The usage of this filter won't alter significantly the performance

It's important to notice that the filter will be applied to all users. Users won't be able to set their own tag to sync their own files.

This filter can also be “disabled” by setting the filter empty.


\subparagraph{Forbidden extensions filter and separator}
\label{enterprise_external_storage/jive_configuration:forbidden-extensions-filter-and-separator}
This filter is set the same way as the category filter: you provide a list of extensions that are separated
by the char set in the separator text box.
\begin{quote}

Jive forbidden extensions: .exe,.zip,.tar.gz

Jive forbidden extensions separator : ,
\end{quote}

You can also achieve the same behavior with:
\begin{quote}

Jive forbidden extensions: .exe\#.zip\#.tar.gz

Jive forbidden extensions separator: \#
\end{quote}
\begin{description}
\item[{Keep in mind that the filter is performed against the end of the filename, that's why the “.” is important. If}] \leavevmode
you set “exe” as a forbidden extension, a file named “texe” or “f1.lexe” will be affected by this filter.

\end{description}

You must also take into account that, by using only the filename, we avoid to download the file, so the
performance isn't significantly degraded.
On the other hand, we cannot verify that a “.png” file is what it claims to be.

This filter works for any file, and for uploads and downloads through ownCloud. This means that you won't be able to
upload a file with any of those extensions from onwCloud and the Jive files which have those extensions won't
be shown (and consequently they won't be downloaded). Of course, you can still upload the files from Jive
(if Jive allows it) and have them there.


\subparagraph{Maximum upload file size}
\label{enterprise_external_storage/jive_configuration:maximum-upload-file-size}
This filter allows you to limit the size of the files that will go through ownCloud. All files uploads and
downloads will be affected by this filter. You won't be able to upload files bigger than the file size limit
and the Jive files bigger than the limit won't be shown in ownCloud (and consequently they won't be downloaded)

Under normal circumstances, you want to match the limit with the one Jive has.
This way you can notify errors regarding the file size faster because the files won't reach the Jive server, and
at the same time you allow the users to upload up to the maximum limit that Jive allows.
(Note: we can't know this limit from ownCloud, so we can't provide a sensitive default value, plus the value can
change among Jive instances. You might need to adjust the value manually).

You can also set the limit to a lower value than what it's in Jive, so only small files will be delivered from ownCloud.


\subparagraph{Show groups of which you are member}
\label{enterprise_external_storage/jive_configuration:show-groups-of-which-you-are-member}
Under normal circumstances, you can see all available groups in Jive, including open, member-only and private
groups, only secrets groups are outside. Even if you're not a member of those groups, you can still see their contents.

For small Jive installations (less than 100 available groups per user) this is usually enough, and it has an
acceptable performance. However, for larger installations, with more than 500 groups available per user, the
performance is degraded a lot.

For these larger installations, this checkbox comes in handy.

Again, under normal circumstances, it's common that a user is member of just a few groups (let's say less than 25)
even if there are thousand of groups available that the user can see. It usually makes sense to show the contents
of only those 25 groups, not every group available.

By activating this checkbox, the user will see only those 25 groups instead of
all available groups.
This will increase the performance a lot, specially for larger installations, as long as each user isn't member
of too many groups. Anyway, if there are user who are member of too many groups, the performance will still be degraded.


\paragraph{FS mount points}
\label{enterprise_external_storage/jive_configuration:fs-mount-points}
This Jive plugin mounts one (or two) virtual filesystems on the normal one in a transparent way.

From a user point of view, these virtual filesystems appear as new folders inside the root one.

From the settings page, you can change the mount points names. The folders will change accordingly.


\subparagraph{Jive FS mount point}
\label{enterprise_external_storage/jive_configuration:jive-fs-mount-point}
The name of the folder that will hold the Jive virtual FS. The name shouldn't collide with any existing name in the root folder to prevent possible issues.
The virtual FS will be mounted inside the root folder of the ownCloud FS.

As said, the contents of the folder will be the groups that the user can access through ownCloud (recheck the “filters” section).


\subparagraph{Jive private folder}
\label{enterprise_external_storage/jive_configuration:jive-private-folder}
The folder where your private Jive files will be stored. The name of the folder will be the same for all users, although the contents will likely differ.

This private folder will be inside
the Jive mount point, as if it were another group.

Files inside this folder will be only visible to you, but they will be stored in Jive. They won't be visible neither for ownCloud users nor Jive users.

In order to prevent collisions with other groups, the folder name might be changed automatically by adding “(private)” to the end of the folder name
if it's needed
.


\subparagraph{Large file sharing subsystem}
\label{enterprise_external_storage/jive_configuration:large-file-sharing-subsystem}
The large file sharing allow you to share files over the Jive limits (typically size limits). You can enable
or disable this subsystem by checking or un-checking the checkbox, and provide the corresponding mount point.
Use a non-existent folder name to prevent issues.

Files inside that folder will be stored inside the ownCloud server. However those files can be shared by link to Jive.

The process is like the following:
\begin{enumerate}
\item {} 
Upload a file (or folder) inside the large file sharing folder (by default named as “Too Big For”)

\item {} 
Once the file is uploaded, click in the “share” action, and then click in the “Share link” checkbox

\item {} 
By default the share link will expire after 1 week. You can change the value and / or protect the link by password

\item {} 
Click the “Submit to Jive” button (the name can be changed depending on the actual Jive folder name)

\item {} 
A new browser tab should appear with the Jive draft ready to be edited (you might need to enter your
Jive credentials first). The draft will have some predefined text, but you can edit it to your needs.
Once you publish the document, it's done.

\end{enumerate}


\paragraph{Notifications}
\label{enterprise_external_storage/jive_configuration:notifications}
This Jive plugin runs a connectivity check between ownCloud and Jive whenever the web page is loaded. This
check allows you to know some potential issues between the ownCloud – Jive connection.

When a potential issue is detected, a notification will be shown, so you'll know what's happening.

You can control the time the notification is shown in the “notification time for the connectivity check”
configuration. The time is in seconds.


\section{User Management (Enterprise only)}
\label{enterprise_user_management/index:user-management-enterprise-only}\label{enterprise_user_management/index::doc}

\subsection{Shibboleth Integration (Enterprise only)}
\label{enterprise_user_management/user_auth_shibboleth:shibboleth-integration-enterprise-only}\label{enterprise_user_management/user_auth_shibboleth::doc}

\subsubsection{Introduction}
\label{enterprise_user_management/user_auth_shibboleth:introduction}
The ownCloud Shibboleth user backend application integrates ownCloud with a
Shibboleth Service Provider (SP) and allows operations in federated and
single-sign-on (SSO) infrastructures. Setting up Shibboleth has two big steps:
\begin{enumerate}
\item {} 
Enable and configure the Apache Shibboleth module.

\item {} 
Enable and configure the ownCloud Shibboleth app.

\end{enumerate}


\subsubsection{The Apache Shibboleth module}
\label{enterprise_user_management/user_auth_shibboleth:the-apache-shibboleth-module}
Currently supported installations are based on the \href{https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig}{native Apache integration}.
The individual configuration of the service provider is highly dependent on
the operating system, as well as on the integration with the Identity
Providers (IdP), and require case-by-case analysis and installation.

A good starting point for the service provider installation can be found in
\href{https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPLinuxInstall}{the official Shibboleth Wiki}.

A successful installation and configuration will populate Apache environment
variables with at least a unique user id which is then used by the ownCloud
Shibboleth app to login a user.

See the \href{https://github.com/owncloud/documentation/wiki/Shibboleth-example-configurations}{documentation Wiki} for more configuration examples.


\paragraph{Apache Configuration}
\label{enterprise_user_management/user_auth_shibboleth:apache-configuration}
This is an example configuration as installed and operated on a Linux server
running the Apache 2.4 Web server. These configurations are highly operating system
specific and require a high degree of customization.

The ownCloud instance itself is installed in \code{/var/www/owncloud/}.  The
following aliases are defined in an Apache virtual host directive:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} non\PYGZhy{}Shibboleth access
Alias /owncloud /var/www/owncloud/
\PYGZsh{} for Shibboleth access
Alias /oc\PYGZhy{}shib /var/www/owncloud/
\end{Verbatim}

Further Shibboleth specific configuration as defined in
\code{/etc/apache2/conf.d/shib.conf}:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}
\PYGZsh{} Load the Shibboleth module.
\PYGZsh{}
LoadModule mod\PYGZus{}shib /usr/lib64/shibboleth/mod\PYGZus{}shib\PYGZus{}24.so

\PYGZsh{}
\PYGZsh{} Ensures handler will be accessible.
\PYGZsh{}
\PYGZlt{}Location /Shibboleth.sso\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Configure the module for content.
\PYGZsh{}

\PYGZsh{}
\PYGZsh{} Besides the exceptions below, this location is now under control of
\PYGZsh{} Shibboleth
\PYGZsh{}
\PYGZlt{}Location /oc\PYGZhy{}shib\PYGZgt{}
  AuthType shibboleth
  ShibRequireSession On
  ShibUseHeaders Off
  ShibExportAssertion On
  require valid\PYGZhy{}user
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow non
\PYGZsh{} shibboleth webdav access
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZdq{}/oc\PYGZhy{}shib/remote.php/nonshib\PYGZhy{}webdav\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow public link
\PYGZsh{} sharing
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZbs{}
\PYGZdq{}/oc\PYGZhy{}shib/(status.php\PYGZdl{}\PYGZbs{}
\textbar{}index.php/s/\PYGZbs{}
\textbar{}public.php\PYGZbs{}
\textbar{}cron.php\PYGZdl{}\PYGZbs{}
\textbar{}core/img/\PYGZbs{}
\textbar{}index.php/apps/files\PYGZus{}sharing/ajax/publicpreview.php\PYGZdl{}\PYGZbs{}
\textbar{}index.php/apps/files/ajax/upload.php\PYGZdl{}\PYGZbs{}
\textbar{}apps/files/templates/fileexists.html\PYGZdl{}\PYGZbs{}
\textbar{}index.php/apps/files/ajax/mimeicon.php\PYGZdl{}\PYGZbs{}
\textbar{}index.php/apps/files\PYGZus{}sharing/ajax/list.php\PYGZdl{}\PYGZbs{}
\textbar{}themes/\PYGZbs{}
\textbar{}index.php/apps/files\PYGZus{}pdfviewer/\PYGZbs{}
\textbar{}apps/files\PYGZus{}pdfviewer/)\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow public gallery
\PYGZsh{} sharing
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZbs{}
\PYGZdq{}/oc\PYGZhy{}shib/(index.php/apps/gallery/s/\PYGZbs{}
\textbar{}index.php/apps/gallery/slideshow\PYGZdl{}\PYGZbs{}
\textbar{}index.php/apps/gallery/.*\PYGZbs{}.public)\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow public link
\PYGZsh{} sharing
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZdq{}/oc\PYGZhy{}shib/.*\PYGZbs{}.css\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow public link
\PYGZsh{} sharing
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZdq{}/oc\PYGZhy{}shib/.*\PYGZbs{}.js\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}

\PYGZsh{}
\PYGZsh{} Shibboleth is disabled for the following location to allow public link
\PYGZsh{} sharing
\PYGZsh{}
\PYGZlt{}Location \PYGZti{} \PYGZdq{}/oc\PYGZhy{}shib/.*\PYGZbs{}.woff\PYGZdq{}\PYGZgt{}
  AuthType None
  Require all granted
\PYGZlt{}/Location\PYGZgt{}
\end{Verbatim}

Depending on the ownCloud Shibboleth app mode, you may need to revisit this
configuration.


\subsubsection{The ownCloud Shibboleth App}
\label{enterprise_user_management/user_auth_shibboleth:the-owncloud-shibboleth-app}
After enabling the Shibboleth app on your Apps page, you need to choose the app
mode and map the necessary Shibboleth environment variables to ownCloud user
attributes on your Admin page.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{shib-gui5.png}
\caption{\emph{figure 1: Enabling Shibboleth on the ownCloud Admin page}}\end{figure}


\paragraph{Choosing the App Mode}
\label{enterprise_user_management/user_auth_shibboleth:choosing-the-app-mode}
After enabling the app it will be in \textbf{Not active} mode, which ignores a
Shibboleth session and allows you to login as an administrator and inspect the
currently available Apache environment variables. Use this mode to set up the
environment mapping for the other modes, and in case you locked yourself out of
the system. You can also change the app mode and environment mappings by using
the \code{occ} command, like this example on Ubuntu Linux:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ shibboleth:mode notactive
\PYGZdl{} sudo \PYGZhy{}u www\PYGZhy{}data php occ shibboleth:mapping \PYGZhy{}\PYGZhy{}uid login
\end{Verbatim}

In \textbf{Single sign-on only} mode the app checks if the environment variable for
the Shibboleth session, by default \textbf{Shib-Session-Id}, is set. If that is the
case it will take the value of the environment variable as the \code{uid}, by
default \code{eppn}, and check if a user is known by that \code{uid}. In effect, this
allows another user backend, eg. the LDAP app, to provide the \code{displayname},
\code{email} and \code{avatar}.
\begin{quote}

\begin{notice}{note}{Note:}
As an example the IdP can send the \textbf{sAMAccountName} which the
Apache Shibboleth module writes to a custom Apache environment variable
called \code{login}. The ownCloud Shibboleth app reads that \code{login}
environment variable and tries to find an LDAP user with that \code{uid}. For
this to work the LDAP backend also needs to be configured to use the
\textbf{sAMAccountName} as the \textbf{Internal Username Attribute} in the
{\hyperref[configuration_user/user_auth_ldap::doc]{\emph{LDAP expert settings}}}.
\end{notice}

\begin{notice}{note}{Note:}
In many scenarios Shibboleth is not intended to hide the user's
password from the service provider, but only to implement SSO. If that is
the case it is sufficient to protect the ownCloud base url with Shibboleth.
This will send Web users to the IdP but allow desktop and mobile clients to
continue using username and password, preventing popups due to an expired
Shibboleth session lifetime.
\end{notice}
\end{quote}

In \textbf{Autoprovision Users} mode the app will not ask another user backend, but
instead provision users on the fly by reading the two additional environment
variables for display name and email address.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{shib-gui6.png}
\caption{\emph{figure 2: Mapping Shibboleth environment configuration variables to ownCloud
user attributes}}\end{figure}

In ownCloud 8.1 the Shibboleth environment variable mapping was stored in
\code{apps/user\_shibboleth/config.php}. This file was overwritten on upgrades,
preventing a seamless upgrade procedure. In ownCloud 8.2+ the variables are
stored in the ownCloud database, making Shibboleth automatically upgradeable.


\subsubsection{Shibboleth with Desktop and Mobile Clients}
\label{enterprise_user_management/user_auth_shibboleth:shibboleth-with-desktop-and-mobile-clients}
The ownCloud Desktop Client can interact with an
ownCloud instance running inside a Shibboleth Service Provider by using built-in
browser components for authentication against the IdP.

The regular ownCloud Android and iOS mobile apps do not work with Shibboleth.
However, customers who create
{\hyperref[enterprise_clients/creating_branded_apps::doc]{\emph{branded mobile apps with ownBrander}}}
have the option to enable SAML authentication in ownBrander.

Enterprise customers also have the option to request a regular ownCloud
mobile client built to use Shibboleth from their ownCloud account
representatives.

The ownCloud desktop sync client and mobile apps store users' logins, so
your users only need to enter their logins the first time they set up their
accounts.

\begin{notice}{note}{Note:}
The ownCloud clients may use only a single Shibboleth login per
ownCloud server; multi-account is not supported with Shibboleth.
\end{notice}

These screenshots show what the user sees at account setup. Figure 1
shows a test Shibboleth login screen from
\href{https://www.testshib.org/index.html}{Testshib.org} on the ownCloud desktop
sync client.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{shib-gui1.png}
\caption{\emph{figure 3: First login screen}}\end{figure}

Then after going through the setup wizard, the desktop sync client displays the
server and login information just like it does for any other ownCloud server
connections.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{shib-gui4.png}
\caption{\emph{figure 4: ownCloud client displays server information}}\end{figure}

To your users, it doesn't look or behave differently on the desktop sync
client, Android app, or iOS app from an ordinary ownCloud account setup. The
only difference is the initial setup screen where they enter their account
login.


\subsubsection{WebDAV Support}
\label{enterprise_user_management/user_auth_shibboleth:webdav-support}
Users of standard WebDAV clients can use an alternative
WebDAV Url, for example \code{https://cloud.example.com/remote.php/nonshib-webdav/}
to log in with their username and password. The password is generated on the
Personal settings page.

\includegraphics{shibboleth-personal.png}

\begin{notice}{note}{Note:}
In \textbf{Single sign-on only} mode the alternative WebDAV Url feature
will not work, as we have no way to store the WebDAV password. Instead the
normal WebDAV endpoint can be omittet from the Shibboleth authentication,
allowing WebDAV clients to use normal username and password based
authentication. That includes the desktop and mobile clients.
\end{notice}

For provisioning purpose an OCS API has been added to revoke a generated
password for a user:

Syntax: \code{/v1/cloud/users/\{userid\}/non\_shib\_password}
\begin{itemize}
\item {} 
HTTP method: DELETE

\end{itemize}

Status codes:
\begin{itemize}
\item {} 
100 - successful

\item {} 
998 - user unknown

\end{itemize}

Example:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZdl{} curl \PYGZhy{}X DELETE \PYGZdq{}https://cloud.example.com/ocs/v1.php/cloud/users/myself@testshib.org/non\PYGZus{}shib\PYGZus{}password\PYGZdq{} \PYGZhy{}u admin:admin
\PYGZlt{}?xml version=\PYGZdq{}1.0\PYGZdq{}?\PYGZgt{}
\PYGZlt{}ocs\PYGZgt{}
 \PYGZlt{}meta\PYGZgt{}
  \PYGZlt{}status\PYGZgt{}ok\PYGZlt{}/status\PYGZgt{}
  \PYGZlt{}statuscode\PYGZgt{}100\PYGZlt{}/statuscode\PYGZgt{}
  \PYGZlt{}message/\PYGZgt{}
 \PYGZlt{}/meta\PYGZgt{}
 \PYGZlt{}data/\PYGZgt{}
\PYGZlt{}/ocs\PYGZgt{}
\end{Verbatim}


\subsubsection{Known Limitations}
\label{enterprise_user_management/user_auth_shibboleth:known-limitations}

\paragraph{Encryption}
\label{enterprise_user_management/user_auth_shibboleth:encryption}
File encryption can only be used together with Shibboleth when the
{\hyperref[configuration_files/encryption_configuration:occ-encryption-label]{\emph{master key-based encryption}}} is used because the
per- user encryption requires the user's password to unlock the private
encryption key. Due to the nature of Shibboleth the user's password is not known
to the service provider.


\paragraph{Other Login Mechanisms}
\label{enterprise_user_management/user_auth_shibboleth:other-login-mechanisms}
You can allow other login mechanisms (e.g. LDAP or ownCloud native) by creating
a second Apache virtual host configuration. This second location is not
protected by Shibboleth, and you can use your other ownCloud login mechanisms.


\paragraph{Session Timeout}
\label{enterprise_user_management/user_auth_shibboleth:session-timeout}
Session timeout on Shibboleth is controlled by the IdP. It is not possible to
have a session length longer than the length controlled by the IdP. In extreme
cases this could result in re-login on mobile clients and desktop clients every
hour.


\paragraph{UID Considerations and Windows Network Drive compatability}
\label{enterprise_user_management/user_auth_shibboleth:uid-considerations-and-windows-network-drive-compatability}
When using \code{user\_shibboleth} in \textbf{Single sign-on only} mode, together with
\code{user\_ldap}, both apps need to resolve to the same \code{uid}.
\code{user\_shibboleth} will do the authentication, and \code{user\_ldap} will provide
user details such as \code{email} and \code{displayname}. In the case of Active
Directory, multiple attributes can be used as the \code{uid}. But they all have
different implications to take into account:

\textbf{sAMAccountName}
\begin{itemize}
\item {} 
\emph{Example:} jfd

\item {} 
\emph{Uniqueness:} Domain local, might change e.g. marriage

\item {} 
\emph{Other implications:} Works with \code{windows\_network\_drive} app

\end{itemize}

\textbf{userPrincipalName}
\begin{itemize}
\item {} 
\emph{Example:} \href{mailto:jfd@owncloud.com}{jfd@owncloud.com}

\item {} 
\emph{Uniqueness:} Forest local, might change on eg. marriage

\item {} 
\emph{Other implications:} TODO check WND compatability

\end{itemize}

\textbf{objectSid}
\begin{itemize}
\item {} 
\emph{Example:} S-1-5-21-2611707862-2219215769-354220275-1137

\item {} 
\emph{Uniqueness:} Domain local, changes when the user is moved to a new domain

\item {} 
\emph{Other implications:} Incompatible with \code{windows\_network\_drive} app

\end{itemize}

\textbf{sIDHistory}
\begin{itemize}
\item {} 
\emph{Example:} Multi-value

\item {} 
\emph{Uniqueness:} Contains previous objectSIDs

\item {} 
\emph{Other implications:} Incompatible with \code{windows\_network\_drive} app

\end{itemize}

\textbf{objectGUID}
\begin{itemize}
\item {} 
\emph{Example:} 47AB881D-0655-414D-982F-02998C905A28

\item {} 
\emph{Uniqueness:} Globally unique

\item {} 
\emph{Other implications:} Incompatible with \code{windows\_network\_drive} app

\end{itemize}

Keep in mind that ownCloud will derive the home folder from the \code{uid}, unless
a home folder naming rule is in place. The only truly stable attribute is the
\code{objectGUID}, so that should be used. If not for the \code{uid} then at least as
the home folder naming rule. The tradeoff here is that if you want to use
\code{windows\_network\_drive} you are bound to the \code{sAMAccountName}, as that is
used as the login.

Also be aware that using \code{user\_shibboleth} in \textbf{Autoprovision Users} mode
will not allow you to use SSO for additional \code{user\_ldap} users,
because \code{uid} collisions will be detected by \code{user\_ldap}.


\section{Enterprise File Management (Enterprise Only)}
\label{enterprise_file_management/index:enterprise-file-management-enterprise-only}\label{enterprise_file_management/index::doc}

\subsection{Enabling Anonymous Uploads with Files Drop (Enterprise Only)}
\label{enterprise_file_management/files_drop::doc}\label{enterprise_file_management/files_drop:enabling-anonymous-uploads-with-files-drop-enterprise-only}
The Files Drop application, introduced in ownCloud 8.0.3 Enterprise
Subscription, allows anyone to upload files with the click of a button to the
directory of your choosing, without needing a login, and they cannot see or
change the contents of the directory. It is the perfect replacement for
attaching large files to email, maintaining an FTP server, and commercial
file-sharing services.

When files are uploaded to your Files Drop directory, you can manage them just
like any other ownCloud share: you may share them, restrict access, edit, and
delete them.


\subsubsection{Setting Up the Files Drop App}
\label{enterprise_file_management/files_drop:setting-up-the-files-drop-app}
Setting up Files Drop is a matter of a few clicks. First go to your Apps page
and enable it.

\includegraphics{files-drop-1.png}

Now your users will see a configuration section on their Personal pages.

\includegraphics{files-drop-2.png}

Click the \textbf{Choose} button to open a dialog to select your upload directory.
You may wish to first create a special upload directory (on your Files page),
which in the following example is name \textbf{upload}.
\begin{figure}[htbp]
\centering

\includegraphics{files-drop-3.png}
\end{figure}

On your Personal page you should now see a URL for your upload directory. Share
this URL with anyone you want to allow uploads to your File Drop folder. Note
that the maximum upload size in this example is 512MB. (The default
ownCloud upload file size limit is 512MB. See
{\hyperref[configuration_files/big_file_upload_configuration::doc]{\emph{Uploading big files \textgreater{} 512MB}}} to learn how to
customize this.)

\includegraphics{files-drop-4.png}


\subsubsection{Using the Files Drop App}
\label{enterprise_file_management/files_drop:using-the-files-drop-app}
Uploading files via the Files Drop app is simple. Open your Web browser to the
share URL created by ownCloud:
\begin{figure}[htbp]
\centering

\includegraphics{files-drop-5.png}
\end{figure}

Click the \textbf{Click to upload file} button. This opens a file picker, and you
select the file or directory you want to upload.
\begin{figure}[htbp]
\centering

\includegraphics{files-drop-6.png}
\end{figure}

When your upload is completed, you'll see a confirmation message with the
filenames.
\begin{figure}[htbp]
\centering

\includegraphics{files-drop-7.png}
\end{figure}


\subsection{Advanced File Tagging With the Workflow App (Enterprise only)}
\label{enterprise_file_management/files_tagging:advanced-file-tagging-with-the-workflow-app-enterprise-only}\label{enterprise_file_management/files_tagging::doc}
New in ownCloud 9.0, the Workflow App provides advanced management of file
tagging. The app has three parts: Tag Manager, Automatic Tagging, and Retention.

The Workflow App should be enabled by default (Apps page), and the three
configuration modules visible on your ownCloud Admin page.

See \href{https://doc.owncloud.com/server/9.2/user\_manual/files/access\_webgui.html}{Tagging Files} in
the ownCloud User manual to learn how to apply and filter tags on files.


\subsubsection{Tag Manager}
\label{enterprise_file_management/files_tagging:tag-manager}
The Tag Manager is for creating new tags, editing existing tags, and deleting tags. Tags may be marked as \textbf{Visible}, \textbf{Restricted}, or \textbf{Invisible}.

\textbf{Visible} means that all users may see, rename, and apply these tags to files and folders.

\textbf{Restricted} means tags are assignable and editable only to the user groups that you select. Other users can filter files by restricted tags, but cannot tag files with them or rename them. The tags are marked (restricted).

\textbf{Invisible} means visible only to ownCloud admins.

Use the \textbf{Collaborative tag management} module on your ownCloud admin page to edit and create tags.
\begin{figure}[htbp]
\centering

\includegraphics{workflow-1.png}
\end{figure}

This is what your tags look like in the \textbf{Tags} view on your files page. Non-admin users will not see invisible tags, but they will see visible and restricted tags.
\begin{figure}[htbp]
\centering

\includegraphics{workflow-5.png}
\end{figure}


\subsubsection{Automatic Tagging}
\label{enterprise_file_management/files_tagging:automatic-tagging}
The Automatic Tagging module operates on newly-uploaded files. Create a set of
conditions, and then when a file or folder matches those conditions it is
automatically tagged. The tag must already have been created with the Tag
Manager.

For example, you can assign the invisible tag \textbf{iOS Uploads} to all files
uploaded from iOS devices. This tag is visible only to admins.
\begin{figure}[htbp]
\centering

\includegraphics{workflow-2.png}
\end{figure}

When files with this tag are shared with you, you can view them with the Tags
filter on the Files page.
\begin{figure}[htbp]
\centering

\includegraphics{workflow-3.png}
\end{figure}

Automatic Tagging is especially useful with the Retention module.


\subsubsection{Retention}
\label{enterprise_file_management/files_tagging:retention}
The Retention module is your housecleaning power tool, because it automatically
deletes files after a time period that you specify. Select which tag to
set a time limit on, and then set your time limit. File age is calculated from
the file mtime (modification time).
\begin{figure}[htbp]
\centering

\includegraphics{workflow-4.png}
\end{figure}

For best performance, retention tags should be applied high in your file
hierarchy. If subfolders have the same tags as their parent folders, their tags
must also be processed, so it will take a little longer.


\subsubsection{Retention Engines}
\label{enterprise_file_management/files_tagging:retention-engines}
There are two retention engines that further allow you to fine-tune your
retention settings: \textbf{TagBasedRetention} and \textbf{UserBasedRetention}.
\textbf{TagBasedRetention} is the default.

\textbf{TagBasedRetention}: This checks files that have a particular tag
assigned. Then it checks (depth-first) the children of the tagged item, before
continuing with the other tagged items. Children that have already been checked
will not be checked a second time.

This is optimised for processing smaller numbers of files that have multiple
retention tags.

\textbf{UserBasedRetention}: Examines files per user. It first iterates over all
files and folders (siblings first), then examines the tags for those items and
checks their respective retention periods. This is optimised for many files with
few retention tags.

To select UserBasedRetention, add this line to your ee.config.php:

\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsq{}workflow.retention\PYGZus{}engine\PYGZsq{} =\PYGZgt{} userbased,
\end{Verbatim}


\section{Enterprise Logging Apps (Enterprise only)}
\label{enterprise_logging/index:enterprise-logging-apps-enterprise-only}\label{enterprise_logging/index::doc}

\subsection{Enterprise Logging Apps}
\label{enterprise_logging/enterprise_logging_apps:enterprise-logging-apps}\label{enterprise_logging/enterprise_logging_apps::doc}
The \textbf{Log user and file sharing actions} app (\code{apps/admin\_audit}) records the
file sharing activity of your users, file tagging, and user logins and logouts.
\begin{figure}[htbp]
\centering

\includegraphics{logging-1.png}
\end{figure}

Your logging level must be set to at least \textbf{Info, warnings, errors, and fatal
issues} on your ownCloud admin page, or \code{'loglevel' =\textgreater{} 1} in \code{config.php}.

View your logfiles on your admin page. Click the \textbf{Download logfile} button to
dump the plain text log, or open the logfile directly in a text editor. The
default location is \code{owncloud/data/owncloud.log}.

See {\hyperref[configuration_server/logging_configuration::doc]{\emph{Logging Configuration}}} and
{\hyperref[enterprise_file_management/files_tagging::doc]{\emph{Advanced File Tagging With the Workflow App (Enterprise only)}}} for more information on
logging and tagging.


\section{Enterprise Firewall (Enterprise only)}
\label{enterprise_firewall/index::doc}\label{enterprise_firewall/index:enterprise-firewall-enterprise-only}

\subsection{File Firewall (Enterprise only)}
\label{enterprise_firewall/file_firewall::doc}\label{enterprise_firewall/file_firewall:file-firewall-enterprise-only}
The File Firewall GUI enables you to create and manage firewall rule sets from
your ownCloud admin page. The File Firewall gives you finer-grained control of
access and sharing, with rules for allowing or denying access, and restrictions
per group, upload size, client devices, IP address, time of day, and many more
criteria. For additional flexibility the File Firewall also supports regular
expressions.

Each rule consists of one or more conditions. A request matches a rule if
all conditions evaluate to true. If a request matches at least one of the
defined rules, the request is blocked and the file content can not be read or
written.

\begin{notice}{note}{Note:}
As of ownCloud 9.0, the File Firewall app cannot lock out administrators from the Web interface when      rules are misconfigured.
\end{notice}

Figure 1 shows an empty firewall configuration panel. Set your logging level to
\textbf{Failures Only} for debugging, and create a new ruleset by clicking the \textbf{Add
Group} button. After setting up your rules you must click the \textbf{Save Rules}
button.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{firewall-1.png}
\caption{\emph{Figure 1: Empty File Firewall configuration panel}}\end{figure}

Figure 2 shows two rules. The first rule, \textbf{No Support outside
office hours}, prevents members of the support group from logging into the
ownCloud Web interface from 5pm-9am, and also blocks client syncing.

The second rule prevents members of the qa-team group from accessing the Web UI
from IP addresses that are outside of the local network.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{firewall-2.png}
\caption{\emph{Figure 2: Two example rules that restrict logins per user group}}\end{figure}

All other users are not affected, and can log in anytime from anywhere.


\subsubsection{Available Conditions}
\label{enterprise_firewall/file_firewall:available-conditions}\begin{description}
\item[{User Group}] \leavevmode
The user (is\textbar{}is not) a member of the selected group.

\item[{User Agent}] \leavevmode
The User-Agent of the request (matches\textbar{}does not match) the given string.

\item[{User Device}] \leavevmode
A shortcut for matching all known (\code{android} \textbar{} \code{ios} \textbar{} \code{desktop}) sync clients by
their User Agent string.

\item[{Request Time}] \leavevmode
The time of the request (has to\textbar{}must not) be in a single range from beginning
time to end time.

\item[{Request URL}] \leavevmode
The \textbf{full page URL} (has to\textbar{}must not) (match\textbar{}contain\textbar{}begin with\textbar{}end) with a
given string.

\item[{Request Type}] \leavevmode
The request (is\textbar{}is not) a (WebDAV\textbar{}public share link\textbar{}other) request.

\item[{Request IP Range (IPv4) and IP Range (IPv6)}] \leavevmode
The request's \code{REMOTE\_ADDR} header (is\textbar{}is not) matching the given IP range.

\item[{Subnet (IPv4) and Subnet (IPv6)}] \leavevmode
The request's \code{SERVER\_ADDR} header (is\textbar{}is not) matching the given IP range.

\item[{File Size Upload}] \leavevmode
When a file is uploaded the size has to be (less\textbar{}less or equal\textbar{}greater\textbar{}greater
or equal) to the given size.

\item[{File Mimetype Upload}] \leavevmode
When a file is uploaded the mimetype (is\textbar{}is not\textbar{}begins with\textbar{}does not begin
with\textbar{}ends with\textbar{}does not end with) the given string.

\item[{System File Tag}] \leavevmode
One of the parent folders or the file itself (is\textbar{}is not) tagged with a System
tag.

\item[{Regular Expression}] \leavevmode
The File Firewall supports regular expressions, allowing you to create custom
rules using the following conditions:

\end{description}
\begin{itemize}
\item {} 
IP Range (IPv4)

\item {} 
IP Range (IPv6)

\item {} 
Subnet (IPv4)

\item {} 
Subnet (IPv6)

\item {} 
User agent

\item {} 
User group

\item {} 
Request URL

\end{itemize}

You can combine multiple rules into one rule. E.g., if a rule applies to both
the support and the qa-team you could write your rule like this:

\begin{Verbatim}[commandchars=\\\{\}]
Regular Expression \PYGZgt{} \PYGZca{}(support\textbar{}qa\PYGZhy{}team)\PYGZdl{} \PYGZgt{} is \PYGZgt{} User group
\end{Verbatim}


\subsubsection{No Manual Editing}
\label{enterprise_firewall/file_firewall:no-manual-editing}
We do not recommend modifying the configuration values directly in your
\code{config.php}. These use JSON encoding, so the values are difficult to read
and a single typo will break all of your rules.


\subsubsection{Controlling Access to Folders}
\label{enterprise_firewall/file_firewall:controlling-access-to-folders}
The easiest way to block access to a folder, starting with ownCloud 9.0, is to use a
system tag. A new rule type was added which allows you to block access to
files and folders, where at least one of the parents has a given tag. Now you
just need to add the tag to the folder or file, and then block the tag with the
File Firewall.

This example blocks access to any folder with the tag ``Confidential''.

Block by System Tag:

\begin{Verbatim}[commandchars=\\\{\}]
System file tag:   is       \PYGZdq{}Confidential\PYGZdq{}
Subnet IPv4:       is not   \PYGZdq{}255.255.255.0/24\PYGZdq{}
\end{Verbatim}
\begin{figure}[htbp]
\centering

\includegraphics{firewall-3.png}
\end{figure}


\subsubsection{Custom Configuration for Branded Clients}
\label{enterprise_firewall/file_firewall:custom-configuration-for-branded-clients}
If you are using {\hyperref[enterprise_clients/index::doc]{\emph{branded ownCloud clients}}},
you may define \code{firewall.branded\_clients} in your \code{config.php} to identify
your branded clients in the firewall \textbf{``User Device''} rule.

The configuration is a \code{User-Agent} =\textgreater{} \code{Device} map. \code{Device} must be one
of the following:
\begin{itemize}
\item {} 
android

\item {} 
android\_branded

\item {} 
ios

\item {} 
ios\_branded

\item {} 
desktop

\item {} 
desktop\_branded

\end{itemize}

The \code{User-Agent} is always compared all lowercase. By default the agent is
compared with \code{equals}. When a trailing or leading asterisk, \code{*}, is found,
the agent is compared with \code{starts with} or \code{ends with}. If the agent has
both a leading and a trailing \code{*}, the string must appear anywhere. For
technical reasons the \code{User-Agent} string must be at least 4 characters
(including wildcards). (When you build your branded client you have the option
to create a custom User Agent.)

In this example configuration you need to replace the example User Agent
strings, for example \code{'android\_branded'}, with your own User Agent strings:

\begin{Verbatim}[commandchars=\\\{\}]
// config.php

 \PYGZsq{}firewall.branded\PYGZus{}clients\PYGZsq{} =\PYGZgt{} array(
   \PYGZsq{}my ownbrander android user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}android\PYGZus{}branded\PYGZsq{},
   \PYGZsq{}my ownbrander second android user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}android\PYGZus{}branded\PYGZsq{},
   \PYGZsq{}my ownbrander ios user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}ios\PYGZus{}branded\PYGZsq{},
   \PYGZsq{}my ownbrander second ios user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}ios\PYGZus{}branded\PYGZsq{},
   \PYGZsq{}my ownbrander desktop user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}desktop\PYGZus{}branded\PYGZsq{},
   \PYGZsq{}my ownbrander second desktop user agent string\PYGZsq{} =\PYGZgt{} \PYGZsq{}desktop\PYGZus{}branded\PYGZsq{},
 ),
\end{Verbatim}

The Web UI dropdown then expands to the following options:
\begin{itemize}
\item {} 
Android Client - always visible

\item {} 
iOS Client - always visible

\item {} 
Desktop Client - always visible

\item {} 
Android Client (Branded) - visible when at least one \code{android\_branded} is defined

\item {} 
iOS Client (Branded) - visible when at least one \code{ios\_branded} is defined

\item {} 
Desktop Client (Branded) - visible when at least one \code{desktop\_branded} is defined

\item {} 
All branded clients - visible when at least one of \code{android\_branded},
\code{ios\_branded} or \code{desktop\_branded} is defined

\item {} 
All non-branded clients - visible when at least one of \code{android\_branded},
\code{ios\_branded} or \code{desktop\_branded} is defined

\item {} 
Others (Browsers, etc.) - always visible

\end{itemize}

Then these options operate this way:
\begin{itemize}
\item {} 
The \code{* Client} options only match \code{android}, \code{ios} and \code{desktop} respectively.

\item {} 
The \code{* Client (Branded)} options match the \code{*\_branded} agents equivalent.

\item {} 
\code{All branded clients} matches: \code{android\_branded}, \code{ios\_branded} and
\code{desktop\_branded}

\item {} 
\code{All non-branded clients} matches: \code{android}, \code{ios} and \code{desktop}

\end{itemize}


\section{Enterprise Troubleshooting}
\label{enterprise_troubleshooting:enterprise-troubleshooting}\label{enterprise_troubleshooting::doc}
When you have problems with your ownCloud Enterprise installation, refer to
{\hyperref[issues/general_troubleshooting::doc]{\emph{General Troubleshooting}}} to see if you can resolve your issue
without opening a support ticket. If you need to open a support ticket, use the
Open Ticket button in your account on
\href{https://customer.owncloud.com/owncloud/}{https://customer.owncloud.com/owncloud/}.

Bug reports and trouble tickets usually need a copy of your ownCloud server
configuration report. You have two ways to generate a configuration report.
\begin{enumerate}
\item {} 
Use the {\hyperref[configuration_server/occ_command:config-commands-label]{\emph{occ config command}}}.

\item {} 
Use the \textbf{Enterprise license key} app on your ownCloud Admin page to
generate the report with the click of a button.

\end{enumerate}
\begin{figure}[htbp]
\centering

\includegraphics{config-report-1.png}
\end{figure}

Both methods automatically obscure passwords and secrets.



\renewcommand{\indexname}{Index}
\printindex
\end{document}
